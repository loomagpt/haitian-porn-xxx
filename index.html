<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Haitian Tube - Premium Video Sharing Platform</title>
    
    <!-- Search Engine Optimization -->
    <meta name="description" content="Haitian Tube - Premium video sharing platform with shorts, full videos, and creator community. Watch, share, and discover amazing content.">
    <meta name="keywords" content="video sharing, haitian tube, shorts, streaming, video platform, social media, creators">
    <meta name="author" content="Haitian Tube">
    <meta property="og:title" content="Haitian Tube - Premium Video Sharing">
    <meta property="og:description" content="Watch, share, and discover amazing video content on Haitian Tube">
    <meta property="og:type" content="website">
    
    <!-- Fluid Player -->
    <link rel="stylesheet" href="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.css">
    <script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    
    <!-- Parse SDK -->
    <script src="https://npmcdn.com/parse/dist/parse.min.js"></script>
    
    <style>
        /* Page Scaling */
        html {
            zoom: 0.9;
            -moz-transform: scale(0.9);
            -moz-transform-origin: 0 0;
        }
        
        :root {
            --primary-red: #FF0000;
            --primary-dark: #CC0000;
            --secondary-blue: #065FD4;
            --accent-green: #00A900;
            --bg-dark: #0F0F0F;
            --bg-surface: #212121;
            --bg-surface-light: #3D3D3D;
            --text-primary: #FFFFFF;
            --text-secondary: #AAAAAA;
            --text-muted: #717171;
            --bg-light: #FFFFFF;
            --bg-gray: #F8F8F8;
            --text-dark: #030303;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.4);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.5);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Header Styles */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 64px;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            padding: 0 24px;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-right: 40px;
        }

        .logo-icon {
            color: var(--primary-red);
            font-size: 32px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .logo-text {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-red), #FF6B6B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 40px;
            color: var(--text-primary);
            font-size: 16px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-red);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 2px rgba(255, 0, 0, 0.2);
        }

        .search-button {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary-red);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-button:hover {
            background: var(--primary-dark);
            transform: translateY(-50%) scale(1.05);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-left: auto;
        }

        .action-button {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .action-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .upload-btn {
            background: var(--primary-red);
            color: white;
            padding: 10px 24px;
            border-radius: 24px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
        }

        .upload-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-red), var(--secondary-blue));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .user-avatar:hover {
            transform: scale(1.05);
            border-color: var(--primary-red);
        }

        /* Main Layout */
        .main-container {
            display: flex;
            margin-top: 64px;
            min-height: calc(100vh - 64px);
        }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background: rgba(15, 15, 15, 0.95);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px 0;
            position: fixed;
            top: 64px;
            left: 0;
            height: calc(100vh - 64px);
            overflow-y: auto;
            z-index: 900;
            backdrop-filter: blur(10px);
        }

        .sidebar-section {
            padding: 0 12px;
            margin-bottom: 24px;
        }

        .sidebar-section h3 {
            font-size: 14px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding: 0 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 24px;
            padding: 12px 24px;
            color: var(--text-primary);
            text-decoration: none;
            border-radius: var(--radius-sm);
            margin: 4px 12px;
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-item.active {
            background: rgba(255, 0, 0, 0.1);
            color: var(--primary-red);
            font-weight: 500;
        }

        .nav-item.active .nav-icon {
            color: var(--primary-red);
        }

        .nav-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            margin-left: 240px;
            padding: 24px;
            background: var(--bg-dark);
        }

        /* Video Detail Page */
        .video-detail-container {
            display: none;
            max-width: 1100px;
            margin: 0 auto;
        }

        .video-detail-player {
            width: 100%;
            margin-bottom: 24px;
            position: relative;
        }

        #detail-video-player {
            width: 100%;
            height: auto;
            border-radius: var(--radius-md);
            overflow: hidden;
            background: #000;
        }

        /* Video Slider Ads Container */
        .video-slider-ads {
            width: 100%;
            margin: 20px 0;
            min-height: 250px;
            border-radius: var(--radius-md);
            overflow: hidden;
            background: var(--bg-surface);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-slider-ads ins {
            width: 100%;
            height: 250px;
            display: block;
        }

        .video-detail-info {
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            padding: 24px;
            margin-bottom: 24px;
        }

        .video-detail-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            line-height: 1.4;
        }

        .video-detail-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .video-actions {
            display: flex;
            gap: 12px;
        }

        .video-action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .video-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .video-action-btn.liked {
            color: var(--primary-red);
            background: rgba(255, 0, 0, 0.1);
        }

        .video-action-btn.disliked {
            color: var(--secondary-blue);
            background: rgba(6, 95, 212, 0.1);
        }

        .video-detail-creator {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .creator-info {
            flex: 1;
        }

        .creator-name {
            font-weight: 500;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .creator-subs {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .subscribe-btn {
            background: var(--primary-red);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 20px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .subscribe-btn:hover {
            background: var(--primary-dark);
        }

        .subscribe-btn.subscribed {
            background: var(--text-secondary);
        }

        .video-description {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-top: 20px;
        }

        .video-description h3 {
            margin-bottom: 12px;
            font-size: 18px;
        }

        .video-description p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .video-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
        }

        .video-tag {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }

        .video-tag:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .related-videos {
            margin-top: 40px;
        }

        .related-videos h2 {
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        /* TikTok Style Shorts Player */
        .shorts-player-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 2000;
            overflow: hidden;
        }

        .shorts-player {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .short-video-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 85vh;
            border-radius: 16px;
            overflow: hidden;
            background: #000;
        }

        .short-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .short-video-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 0 20px;
        }

        .short-control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .short-control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .short-info-overlay {
            position: absolute;
            bottom: 100px;
            left: 20px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            max-width: 80%;
        }

        .short-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .short-creator {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 12px;
        }

        /* TikTok-style Short Actions */
        .short-actions {
            position: absolute;
            right: 20px;
            bottom: 100px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .short-action-btn {
            background: none;
            border: none;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .short-action-btn:hover {
            transform: scale(1.1);
        }

        .short-action-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }

        .short-action-count {
            font-size: 12px;
            font-weight: 500;
        }

        .short-action-btn.liked .short-action-icon {
            background: rgba(255, 0, 0, 0.3);
            color: var(--primary-red);
        }

        .short-action-btn.disliked .short-action-icon {
            background: rgba(6, 95, 212, 0.3);
            color: var(--secondary-blue);
        }

        .close-shorts {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        .short-ad-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            z-index: 10;
        }

        /* Mobile Fullpage Interstitial */
        .mobile-interstitial {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .interstitial-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .interstitial-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        /* Banner Ads */
        .banner-ad {
            width: 100%;
            margin: 20px 0;
            text-align: center;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .banner-ad img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
            border-radius: var(--radius-md);
        }

        /* Videos Grid */
        .videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .video-card {
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            box-shadow: var(--shadow-sm);
        }

        .video-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            background: var(--bg-surface-light);
        }

        .video-thumbnail {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            background: #000;
            overflow: hidden;
        }

        .video-thumbnail img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .video-card:hover .video-thumbnail img {
            transform: scale(1.05);
        }

        .video-duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .video-info {
            padding: 16px;
        }

        .video-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.4;
        }

        .video-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .video-creator {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .creator-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-red), var(--secondary-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            color: white;
            font-size: 14px;
        }

        /* Short Videos Section */
        .shorts-section {
            margin: 40px 0;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .section-header h2 {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .shorts-icon {
            color: var(--primary-red);
            font-size: 28px;
        }

        .shorts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .short-card {
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .short-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .short-thumbnail {
            width: 100%;
            height: 320px;
            position: relative;
            overflow: hidden;
        }

        .short-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .short-info {
            padding: 12px;
        }

        .short-title {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .short-stats {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Video Player */
        .video-player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .player-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            z-index: 10;
        }

        .close-player {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .close-player:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .player-content {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 80px 20px 20px;
        }

        /* Auth Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(10px);
        }

        .auth-container {
            background: var(--bg-surface);
            border-radius: var(--radius-lg);
            padding: 40px;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h2 {
            font-size: 28px;
            margin-bottom: 8px;
            background: linear-gradient(45deg, var(--primary-red), #FF6B6B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px;
            border-radius: var(--radius-sm);
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            font-weight: 500;
            transition: var(--transition);
        }

        .auth-tab.active {
            background: var(--primary-red);
            color: white;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-input {
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 2px rgba(255, 0, 0, 0.2);
        }

        .auth-button {
            padding: 14px;
            background: var(--primary-red);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .auth-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3);
        }

        .auth-divider {
            text-align: center;
            position: relative;
            margin: 20px 0;
            color: var(--text-secondary);
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 45%;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .auth-divider::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            width: 45%;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .social-auth {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .google-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 14px;
            background: white;
            color: #333;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .google-button:hover {
            background: #f5f5f5;
            transform: translateY(-2px);
        }

        /* Upload Modal */
        .upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .upload-container {
            background: var(--bg-surface);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: var(--shadow-lg);
        }

        .upload-header {
            margin-bottom: 30px;
            text-align: center;
        }

        .upload-header h2 {
            font-size: 28px;
            margin-bottom: 8px;
            background: linear-gradient(45deg, var(--primary-red), #FF6B6B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .upload-dropzone {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .upload-dropzone:hover {
            border-color: var(--primary-red);
            background: rgba(255, 0, 0, 0.05);
        }

        .upload-dropzone.dragover {
            border-color: var(--primary-red);
            background: rgba(255, 0, 0, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 64px;
            color: var(--primary-red);
            margin-bottom: 20px;
        }

        .upload-input {
            display: none;
        }

        .upload-progress {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 30px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-red), #FF6B6B);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .upload-preview {
            display: none;
            margin-bottom: 30px;
        }

        .preview-video {
            width: 100%;
            max-height: 300px;
            border-radius: var(--radius-md);
            background: #000;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .cancel-button {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .cancel-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .submit-button {
            padding: 12px 24px;
            background: var(--primary-red);
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .submit-button:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .submit-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-surface);
            color: var(--text-primary);
            padding: 16px 24px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 4000;
            transform: translateX(100%);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            max-width: 400px;
            border-left: 4px solid var(--primary-red);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-success {
            border-left-color: #4CAF50;
        }

        .toast-error {
            border-left-color: #F44336;
        }

        .toast-icon {
            font-size: 20px;
        }

        /* Age Verification */
        .age-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            backdrop-filter: blur(20px);
        }

        .age-container {
            background: linear-gradient(135deg, var(--bg-surface), #1a1a1a);
            border-radius: var(--radius-lg);
            padding: 50px;
            max-width: 500px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: zoomIn 0.5s ease;
        }

        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .age-icon {
            font-size: 80px;
            color: var(--primary-red);
            margin-bottom: 30px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .age-container h1 {
            font-size: 36px;
            margin-bottom: 20px;
            background: linear-gradient(45deg, var(--primary-red), #FF6B6B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .age-container p {
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .age-buttons {
            display: flex;
            gap: 16px;
            margin-top: 40px;
        }

        .age-button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .age-confirm {
            background: linear-gradient(45deg, var(--primary-red), #FF6B6B);
            color: white;
        }

        .age-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 0, 0, 0.3);
        }

        .age-deny {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .age-deny:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .videos-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            
            .shorts-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-button {
                display: block;
            }
            
            .videos-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .search-container {
                position: fixed;
                top: 64px;
                left: 0;
                width: 100%;
                padding: 12px;
                background: var(--bg-dark);
                display: none;
            }
            
            .search-container.active {
                display: block;
            }
            
            .video-detail-container {
                padding: 16px;
            }
            
            .video-actions {
                flex-wrap: wrap;
            }
            
            .short-video-container {
                max-width: 100%;
                height: 100vh;
                border-radius: 0;
            }
            
            .short-actions {
                bottom: 150px;
            }
        }

        @media (max-width: 480px) {
            .videos-grid {
                grid-template-columns: 1fr;
            }
            
            .shorts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header-actions .upload-btn span {
                display: none;
            }
            
            .upload-btn {
                min-width: auto;
                width: 44px;
                padding: 10px;
            }
            
            .video-action-btn span {
                display: none;
            }
            
            .video-action-btn {
                padding: 10px;
                min-width: 44px;
                justify-content: center;
            }
        }

        /* Menu Button */
        .menu-button {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
        }

        .menu-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 768px) {
            .menu-button {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .logo-container {
                margin-right: 20px;
            }
            
            .header-actions {
                gap: 8px;
            }
        }

        /* Search Toggle Button */
        .search-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
        }

        @media (max-width: 768px) {
            .search-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .search-container {
                display: none;
            }
        }

        /* No Videos State */
        .no-videos {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }

        .no-videos i {
            font-size: 64px;
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        .no-videos h3 {
            font-size: 24px;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        /* Video Card Badge */
        .video-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: var(--primary-red);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            z-index: 1;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-red);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--primary-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(255, 0, 0, 0.3);
            transition: var(--transition);
            border: none;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(255, 0, 0, 0.4);
        }

        /* Video Stats */
        .video-stats {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Share Modal */
        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(10px);
        }

        .share-container {
            background: var(--bg-surface);
            border-radius: var(--radius-lg);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
        }

        .share-header {
            margin-bottom: 20px;
            text-align: center;
        }

        .share-header h3 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .share-url {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .share-url input {
            flex: 1;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 14px;
        }

        .copy-btn {
            padding: 12px 24px;
            background: var(--primary-red);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .copy-btn:hover {
            background: var(--primary-dark);
        }

        .share-platforms {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .share-platform {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .share-platform:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .share-platform i {
            font-size: 24px;
        }

        .share-platform span {
            font-size: 12px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Age Verification Modal (Always Shows) -->
    <div class="age-modal" id="ageModal">
        <div class="age-container">
            <i class="fas fa-exclamation-triangle age-icon"></i>
            <h1>Age Verification Required</h1>
            <p>You must be at least 18 years old to access Haitian Tube. This platform contains content that may not be suitable for minors.</p>
            <p>By confirming your age, you acknowledge that you are 18 or older and agree to our Terms of Service.</p>
            <div class="age-buttons">
                <button class="age-button age-confirm" id="confirmAge">
                    I am 18 or older
                </button>
                <button class="age-button age-deny" id="denyAge">
                    I am under 18
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile Fullpage Interstitial -->
    <div class="mobile-interstitial" id="mobileInterstitial">
        <div class="interstitial-container">
            <button class="interstitial-close" id="closeInterstitial">
                <i class="fas fa-times"></i>
            </button>
            <ins class="eas6a97888e33" data-zoneid="5834970"></ins>
        </div>
    </div>

    <!-- Header -->
    <header>
        <button class="menu-button" id="menuToggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="logo-container">
            <i class="fas fa-play-circle logo-icon"></i>
            <span class="logo-text">Haitian Tube</span>
        </div>

        <button class="search-toggle" id="searchToggle">
            <i class="fas fa-search"></i>
        </button>

        <div class="search-container" id="searchContainer">
            <input type="text" class="search-input" id="searchInput" placeholder="Search videos...">
            <button class="search-button" id="searchButton">
                <i class="fas fa-search"></i>
            </button>
        </div>

        <div class="header-actions">
            <button class="action-button tooltip" data-tooltip="Upload" id="uploadButton">
                <i class="fas fa-upload"></i>
            </button>
            <button class="action-button tooltip" data-tooltip="Notifications" id="notificationsButton">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" style="display: none;">3</span>
            </button>
            <div class="user-avatar" id="userAvatar">
                <i class="fas fa-user"></i>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="nav-item active" data-view="home">
                <i class="fas fa-home nav-icon"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" data-view="shorts">
                <i class="fas fa-bolt nav-icon"></i>
                <span>Shorts</span>
            </div>
            <div class="nav-item" data-view="subscriptions">
                <i class="fas fa-user-friends nav-icon"></i>
                <span>Subscriptions</span>
            </div>
        </div>

        <div class="sidebar-section">
            <h3>Library</h3>
            <div class="nav-item" data-view="history">
                <i class="fas fa-history nav-icon"></i>
                <span>History</span>
            </div>
            <div class="nav-item" data-view="watch-later">
                <i class="fas fa-clock nav-icon"></i>
                <span>Watch Later</span>
            </div>
            <div class="nav-item" data-view="liked">
                <i class="fas fa-thumbs-up nav-icon"></i>
                <span>Liked Videos</span>
            </div>
        </div>

        <div class="sidebar-section">
            <h3>Account</h3>
            <div class="nav-item" id="loginButton">
                <i class="fas fa-sign-in-alt nav-icon"></i>
                <span>Sign In</span>
            </div>
            <div class="nav-item" id="logoutButton" style="display: none;">
                <i class="fas fa-sign-out-alt nav-icon"></i>
                <span>Log Out</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Home Page Content -->
        <div id="homeContent">
            <!-- Banner Ad -->
            <div class="banner-ad">
                <a href="https://t.ajrkm1.com/387067/8780/0?bo=2779,2778,2777,2776,2775&file_id=600151&po=6533&aff_sub5=SF_006OG000004lmDN" target="_blank">
                    <img src="https://www.imglnkx.com/8780/PMKT-1157_DESIGN-16618_BannersWebinar_HBD_300100.gif" alt="Premium Banner" width="300" height="100">
                </a>
            </div>

            <!-- Video Slider Ads (Main Page) -->
            <div class="video-slider-ads" id="mainVideoSlider">
                <!-- Video Slider Ads will be loaded here -->
            </div>

            <!-- Videos Grid -->
            <div class="videos-grid" id="videosGrid">
                <!-- Videos loaded dynamically -->
            </div>

            <!-- Shorts Section -->
            <div class="shorts-section" id="shortsSection">
                <div class="section-header">
                    <h2><i class="fas fa-bolt shorts-icon"></i> Shorts</h2>
                    <button class="see-all" id="seeAllShorts">See All</button>
                </div>
                <div class="shorts-grid" id="shortsGrid">
                    <!-- Shorts loaded dynamically -->
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading" id="loadingState">
                <div class="spinner"></div>
                <p>Loading amazing content...</p>
            </div>

            <!-- No Videos State -->
            <div class="no-videos" id="noVideos" style="display: none;">
                <i class="fas fa-video-slash"></i>
                <h3>No Videos Found</h3>
                <p>Be the first to upload a video!</p>
                <button class="auth-button" id="uploadFirstVideo">Upload Video</button>
            </div>
        </div>

        <!-- Video Detail Page -->
        <div class="video-detail-container" id="videoDetailPage">
            <div class="video-detail-player">
                <div id="detail-video-player"></div>
            </div>
            
            <!-- Video Slider Ads (Detail Page) -->
            <div class="video-slider-ads" id="detailVideoSlider">
                <!-- Video Slider Ads will be loaded here -->
            </div>
            
            <div class="video-detail-info">
                <h1 class="video-detail-title" id="detailVideoTitle">Video Title</h1>
                
                <div class="video-detail-meta">
                    <div class="video-stats">
                        <span class="stat-item">
                            <i class="fas fa-eye"></i> <span id="detailViews">0</span> views
                        </span>
                        <span class="stat-item">
                            <i class="far fa-calendar"></i> <span id="detailDate">Today</span>
                        </span>
                    </div>
                    
                    <div class="video-actions">
                        <button class="video-action-btn" id="likeBtn">
                            <i class="far fa-thumbs-up"></i>
                            <span id="likeCount">0</span>
                        </button>
                        <button class="video-action-btn" id="dislikeBtn">
                            <i class="far fa-thumbs-down"></i>
                            <span id="dislikeCount">0</span>
                        </button>
                        <button class="video-action-btn" id="shareBtn">
                            <i class="fas fa-share"></i>
                            <span>Share</span>
                        </button>
                        <button class="video-action-btn" id="saveBtn">
                            <i class="far fa-bookmark"></i>
                            <span>Save</span>
                        </button>
                    </div>
                </div>
                
                <div class="video-detail-creator">
                    <div class="creator-avatar" id="detailCreatorAvatar">A</div>
                    <div class="creator-info">
                        <div class="creator-name" id="detailCreatorName">Anonymous</div>
                        <div class="creator-subs" id="detailCreatorSubs">0 subscribers</div>
                    </div>
                    <button class="subscribe-btn" id="subscribeBtn">Subscribe</button>
                </div>
                
                <div class="video-description">
                    <h3>Description</h3>
                    <p id="detailDescription">No description available.</p>
                    <div class="video-tags" id="detailTags">
                        <!-- Tags will be loaded here -->
                    </div>
                </div>
            </div>
            
            <div class="related-videos">
                <h2>Related Videos</h2>
                <div class="related-grid" id="relatedVideosGrid">
                    <!-- Related videos will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- TikTok Style Shorts Player -->
    <div class="shorts-player-container" id="shortsPlayer">
        <button class="close-shorts" id="closeShorts">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="shorts-player">
            <div class="short-video-container">
                <video class="short-video" id="shortVideoPlayer" autoplay muted playsinline></video>
                <div class="short-info-overlay">
                    <h3 class="short-title" id="shortVideoTitle">Short Title</h3>
                    <div class="short-creator" id="shortVideoCreator">@creator</div>
                </div>
                
                <!-- TikTok-style Short Actions -->
                <div class="short-actions">
                    <button class="short-action-btn" id="shortLikeBtn">
                        <div class="short-action-icon">
                            <i class="far fa-heart"></i>
                        </div>
                        <span class="short-action-count" id="shortLikeCount">0</span>
                    </button>
                    
                    <button class="short-action-btn" id="shortDislikeBtn">
                        <div class="short-action-icon">
                            <i class="far fa-thumbs-down"></i>
                        </div>
                        <span class="short-action-count" id="shortDislikeCount">0</span>
                    </button>
                    
                    <button class="short-action-btn" id="shortCommentBtn">
                        <div class="short-action-icon">
                            <i class="far fa-comment"></i>
                        </div>
                        <span class="short-action-count" id="shortCommentCount">0</span>
                    </button>
                    
                    <button class="short-action-btn" id="shortShareBtn">
                        <div class="short-action-icon">
                            <i class="fas fa-share"></i>
                        </div>
                        <span class="short-action-count">Share</span>
                    </button>
                </div>
                
                <div class="short-ad-indicator" style="display: none;" id="adIndicator">Ad</div>
            </div>
            
            <div class="short-video-controls">
                <button class="short-control-btn" id="shortPrevBtn">
                    <i class="fas fa-chevron-up"></i>
                </button>
                <button class="short-control-btn" id="shortPauseBtn">
                    <i class="fas fa-pause"></i>
                </button>
                <button class="short-control-btn" id="shortNextBtn">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Video Player Modal (Fluid Player) -->
    <div class="video-player-container" id="videoPlayerModal">
        <div class="player-header">
            <button class="close-player" id="closePlayer">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="player-content">
            <div id="fluid-player-container">
                <video id="fluid-player-video">
                    <source src="" type="video/mp4">
                </video>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-container">
            <div class="auth-header">
                <h2>Welcome to Haitian Tube</h2>
                <p>Join our community of creators</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Sign In</button>
                <button class="auth-tab" data-tab="signup">Sign Up</button>
            </div>
            
            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" required>
                </div>
                
                <button type="submit" class="auth-button">Sign In</button>
            </form>
            
            <form class="auth-form" id="signupForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="signupUsername" placeholder="Choose a username" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="signupEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="signupPassword" placeholder="At least 6 characters" required minlength="6">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" id="signupConfirmPassword" placeholder="Confirm your password" required>
                </div>
                
                <button type="submit" class="auth-button">Create Account</button>
            </form>
            
            <div class="auth-divider">or continue with</div>
            
            <div class="social-auth">
                <button class="google-button" id="googleSignIn">
                    <i class="fab fa-google"></i>
                    <span>Sign in with Google</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="upload-modal" id="uploadModal">
        <div class="upload-container">
            <div class="upload-header">
                <h2>Upload Your Video</h2>
                <p>Share your content with the world</p>
            </div>
            
            <div class="upload-dropzone" id="uploadDropzone">
                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                <h3>Drag & Drop Video File</h3>
                <p>or click to browse</p>
                <p class="file-types">MP4, MOV, AVI up to 2GB</p>
                <input type="file" class="upload-input" id="videoFileInput" accept="video/*" />
            </div>
            
            <div class="upload-preview" id="uploadPreview">
                <video class="preview-video" controls id="previewVideo"></video>
            </div>
            
            <div class="upload-progress" id="uploadProgress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text">
                    <span>Uploading...</span>
                    <span id="progressPercent">0%</span>
                </div>
            </div>
            
            <form class="auth-form">
                <div class="form-group">
                    <label class="form-label">Video Title</label>
                    <input type="text" class="form-input" id="videoTitle" placeholder="Enter a compelling title" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input" id="videoDescription" rows="4" placeholder="Tell viewers about your video"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tags (comma separated)</label>
                    <input type="text" class="form-input" id="videoTags" placeholder="funny, tutorial, music, etc">
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="isShort">
                        Mark as Short (vertical video)
                    </label>
                </div>
            </form>
            
            <div class="form-actions">
                <button class="cancel-button" id="cancelUpload">Cancel</button>
                <button class="submit-button" id="submitUpload" disabled>Upload Video</button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="share-modal" id="shareModal">
        <div class="share-container">
            <div class="share-header">
                <h3>Share Video</h3>
                <p>Copy the link or share on social media</p>
            </div>
            
            <div class="share-url">
                <input type="text" id="shareUrlInput" readonly>
                <button class="copy-btn" id="copyUrlBtn">Copy</button>
            </div>
            
            <div class="share-platforms">
                <div class="share-platform" data-platform="facebook">
                    <i class="fab fa-facebook" style="color: #1877F2;"></i>
                    <span>Facebook</span>
                </div>
                <div class="share-platform" data-platform="twitter">
                    <i class="fab fa-twitter" style="color: #1DA1F2;"></i>
                    <span>Twitter</span>
                </div>
                <div class="share-platform" data-platform="whatsapp">
                    <i class="fab fa-whatsapp" style="color: #25D366;"></i>
                    <span>WhatsApp</span>
                </div>
                <div class="share-platform" data-platform="telegram">
                    <i class="fab fa-telegram" style="color: #0088cc;"></i>
                    <span>Telegram</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-info-circle toast-icon"></i>
        <span id="toastMessage">Notification</span>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" id="fabUpload">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Video Slider Ads Script -->
    <script async type="application/javascript" src="https://a.magsrv.com/ad-provider.js"></script> 
    
    <script>
        // ============================
        // CONFIGURATION
        // ============================
        const CONFIG = {
            // Firebase Configuration
            firebase: {
                apiKey: "AIzaSyBsfheLc8i-CsRGJ9jkbGUhdTj3ZD3SLu8",
                authDomain: "haitiantube-2affb.firebaseapp.com",
                projectId: "haitiantube-2affb",
                storageBucket: "haitiantube-2affb.firebasestorage.app",
                messagingSenderId: "564033314604",
                appId: "1:564033314604:web:dfcd9b74b670e47dae1689",
                measurementId: "G-8WS57GK218"
            },
            
            // Parse Configuration
            parse: {
                applicationId: "KO17FZ9yhp8XzNQnrlYzj7GaXaTr9hcekpY7u667",
                javascriptKey: "lTMvuwBNvXgAXfHnNHiqkdjj7vQHk5LcEocQY8Ya",
                serverURL: "https://parseapi.back4app.com/"
            },
            
            // Cloudinary Configuration
            cloudinary: {
                cloudName: "dqx9c4kc6",
                uploadPreset: "xp4psfnn",
                apiUrl: "https://api.cloudinary.com/v1_1/dqx9c4kc6/video/upload"
            },
            
            // Ad Configuration
            ads: {
                preRoll: "https://s.magsrv.com/v1/vast.php?idzone=5829940",
                midRoll: "https://s.magsrv.com/v1/vast.php?idzone=5829940",
                postRoll: "https://cpm.afkwa.com/vast?zone=283171&tagid=387067",
                banner: "https://s.magsrv.com/v1/vast.php?idzone=5831138",
                shortsAd: "https://s.magsrv.com/v1/vast.php?idzone=5834688",
                videoSlider: "5830152",
                mobileInterstitial: "5834970"
            },
            
            // App Configuration
            app: {
                maxFileSize: 2 * 1024 * 1024 * 1024, // 2GB
                supportedFormats: ['mp4', 'mov', 'avi', 'webm', 'mkv'],
                siteUrl: window.location.origin,
                shortsInterstitialFrequency: 3 // Show interstitial every 3 shorts
            }
        };

        // ============================
        // STATE MANAGEMENT
        // ============================
        const state = {
            user: null,
            isAuthenticated: false,
            currentView: 'home',
            videos: [],
            shorts: [],
            loading: true,
            currentVideo: null,
            videoPlayer: null,
            detailPlayer: null,
            shortPlayer: null,
            isUploading: false,
            uploadProgress: 0,
            currentShortIndex: 0,
            shortsScrollPosition: 0,
            isPlayingAd: false,
            shortsAdCounter: 0,
            shortsViewed: 0,
            shortLiked: [],
            shortDisliked: [],
            subscribedChannels: []
        };

        // ============================
        // DOM ELEMENTS
        // ============================
        const elements = {
            // Age Verification
            ageModal: document.getElementById('ageModal'),
            confirmAge: document.getElementById('confirmAge'),
            denyAge: document.getElementById('denyAge'),
            
            // Header
            menuToggle: document.getElementById('menuToggle'),
            searchToggle: document.getElementById('searchToggle'),
            searchContainer: document.getElementById('searchContainer'),
            searchInput: document.getElementById('searchInput'),
            searchButton: document.getElementById('searchButton'),
            uploadButton: document.getElementById('uploadButton'),
            userAvatar: document.getElementById('userAvatar'),
            
            // Sidebar
            sidebar: document.getElementById('sidebar'),
            loginButton: document.getElementById('loginButton'),
            logoutButton: document.getElementById('logoutButton'),
            
            // Main Content
            mainContent: document.getElementById('mainContent'),
            homeContent: document.getElementById('homeContent'),
            videoDetailPage: document.getElementById('videoDetailPage'),
            videosGrid: document.getElementById('videosGrid'),
            shortsGrid: document.getElementById('shortsGrid'),
            loadingState: document.getElementById('loadingState'),
            noVideos: document.getElementById('noVideos'),
            uploadFirstVideo: document.getElementById('uploadFirstVideo'),
            
            // Video Slider Ads
            mainVideoSlider: document.getElementById('mainVideoSlider'),
            detailVideoSlider: document.getElementById('detailVideoSlider'),
            
            // Video Detail Page
            detailVideoPlayer: document.getElementById('detail-video-player'),
            detailVideoTitle: document.getElementById('detailVideoTitle'),
            detailViews: document.getElementById('detailViews'),
            detailDate: document.getElementById('detailDate'),
            likeBtn: document.getElementById('likeBtn'),
            dislikeBtn: document.getElementById('dislikeBtn'),
            likeCount: document.getElementById('likeCount'),
            dislikeCount: document.getElementById('dislikeCount'),
            shareBtn: document.getElementById('shareBtn'),
            saveBtn: document.getElementById('saveBtn'),
            detailCreatorAvatar: document.getElementById('detailCreatorAvatar'),
            detailCreatorName: document.getElementById('detailCreatorName'),
            detailCreatorSubs: document.getElementById('detailCreatorSubs'),
            subscribeBtn: document.getElementById('subscribeBtn'),
            detailDescription: document.getElementById('detailDescription'),
            detailTags: document.getElementById('detailTags'),
            relatedVideosGrid: document.getElementById('relatedVideosGrid'),
            
            // Shorts Player
            shortsPlayer: document.getElementById('shortsPlayer'),
            closeShorts: document.getElementById('closeShorts'),
            shortVideoPlayer: document.getElementById('shortVideoPlayer'),
            shortVideoTitle: document.getElementById('shortVideoTitle'),
            shortVideoCreator: document.getElementById('shortVideoCreator'),
            shortPrevBtn: document.getElementById('shortPrevBtn'),
            shortPauseBtn: document.getElementById('shortPauseBtn'),
            shortNextBtn: document.getElementById('shortNextBtn'),
            adIndicator: document.getElementById('adIndicator'),
            
            // Shorts Actions
            shortLikeBtn: document.getElementById('shortLikeBtn'),
            shortDislikeBtn: document.getElementById('shortDislikeBtn'),
            shortCommentBtn: document.getElementById('shortCommentBtn'),
            shortShareBtn: document.getElementById('shortShareBtn'),
            shortLikeCount: document.getElementById('shortLikeCount'),
            shortDislikeCount: document.getElementById('shortDislikeCount'),
            shortCommentCount: document.getElementById('shortCommentCount'),
            
            // Mobile Interstitial
            mobileInterstitial: document.getElementById('mobileInterstitial'),
            closeInterstitial: document.getElementById('closeInterstitial'),
            
            // Video Player
            videoPlayerModal: document.getElementById('videoPlayerModal'),
            closePlayer: document.getElementById('closePlayer'),
            fluidPlayerContainer: document.getElementById('fluid-player-container'),
            fluidPlayerVideo: document.getElementById('fluid-player-video'),
            
            // Authentication
            authModal: document.getElementById('authModal'),
            loginForm: document.getElementById('loginForm'),
            signupForm: document.getElementById('signupForm'),
            loginEmail: document.getElementById('loginEmail'),
            loginPassword: document.getElementById('loginPassword'),
            signupUsername: document.getElementById('signupUsername'),
            signupEmail: document.getElementById('signupEmail'),
            signupPassword: document.getElementById('signupPassword'),
            signupConfirmPassword: document.getElementById('signupConfirmPassword'),
            googleSignIn: document.getElementById('googleSignIn'),
            
            // Upload
            uploadModal: document.getElementById('uploadModal'),
            uploadDropzone: document.getElementById('uploadDropzone'),
            videoFileInput: document.getElementById('videoFileInput'),
            uploadPreview: document.getElementById('uploadPreview'),
            previewVideo: document.getElementById('previewVideo'),
            uploadProgress: document.getElementById('uploadProgress'),
            progressFill: document.getElementById('progressFill'),
            progressPercent: document.getElementById('progressPercent'),
            videoTitle: document.getElementById('videoTitle'),
            videoDescription: document.getElementById('videoDescription'),
            videoTags: document.getElementById('videoTags'),
            isShort: document.getElementById('isShort'),
            cancelUpload: document.getElementById('cancelUpload'),
            submitUpload: document.getElementById('submitUpload'),
            
            // Share Modal
            shareModal: document.getElementById('shareModal'),
            shareUrlInput: document.getElementById('shareUrlInput'),
            copyUrlBtn: document.getElementById('copyUrlBtn'),
            
            // Toast
            toast: document.getElementById('toast'),
            toastMessage: document.getElementById('toastMessage'),
            
            // FAB
            fabUpload: document.getElementById('fabUpload'),
            
            // Navigation
            navItems: document.querySelectorAll('.nav-item'),
            authTabs: document.querySelectorAll('.auth-tab')
        };

        // ============================
        // INITIALIZATION
        // ============================
        document.addEventListener('DOMContentLoaded', () => {
            // Check for URL parameters (for direct video links)
            checkUrlParameters();
            
            // Show age verification on every visit
            showAgeVerification();
            
            // Initialize Firebase
            initializeFirebase();
            
            // Initialize Parse
            initializeParse();
            
            // Load Video Slider Ads
            loadVideoSliderAds();
            
            // Setup event listeners
            setupEventListeners();
            
            // Setup visibility change handler for video pause
            setupVisibilityHandler();
            
            // Load initial content
            loadContent();
            
            // Setup drag and drop
            setupDragAndDrop();
            
            // Setup shorts touch/swipe events
            setupShortsTouchEvents();
            
            // Initialize Mobile Interstitial Ads
            initializeMobileInterstitial();
        });

        // Check URL parameters for direct video links
        function checkUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const videoId = urlParams.get('v');
            const isShort = urlParams.get('short') === 'true';
            
            if (videoId) {
                // Store for later use when content is loaded
                state.pendingVideoId = videoId;
                state.pendingIsShort = isShort;
            }
        }

        // Setup page visibility handler for video pause
        function setupVisibilityHandler() {
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    // Pause all videos when page is hidden
                    if (state.videoPlayer && state.videoPlayer.play) {
                        state.videoPlayer.pause();
                    }
                    if (state.detailPlayer && state.detailPlayer.pause) {
                        state.detailPlayer.pause();
                    }
                    if (state.shortPlayer && !state.shortPlayer.paused) {
                        state.shortPlayer.pause();
                        const pauseBtn = elements.shortPauseBtn.querySelector('i');
                        pauseBtn.className = 'fas fa-play';
                    }
                }
            });
        }

        // ============================
        // AGE VERIFICATION
        // ============================
        function showAgeVerification() {
            elements.ageModal.style.display = 'flex';
            
            elements.confirmAge.addEventListener('click', () => {
                elements.ageModal.style.display = 'none';
                showToast('Welcome to Haitian Tube! Enjoy our premium content.', 'success');
            });
            
            elements.denyAge.addEventListener('click', () => {
                window.location.href = 'https://www.google.com';
            });
        }

        // ============================
        // FIREBASE INITIALIZATION
        // ============================
        function initializeFirebase() {
            try {
                const app = firebase.initializeApp(CONFIG.firebase);
                const auth = firebase.auth();
                const storage = firebase.storage();
                
                // Auth state listener
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        state.user = {
                            uid: user.uid,
                            email: user.email,
                            displayName: user.displayName || user.email.split('@')[0],
                            photoURL: user.photoURL
                        };
                        state.isAuthenticated = true;
                        
                        // Update UI
                        updateAuthUI();
                        
                        showToast(`Welcome back, ${state.user.displayName}!`, 'success');
                    } else {
                        state.user = null;
                        state.isAuthenticated = false;
                        updateAuthUI();
                    }
                });
                
                // Create Google provider
                window.googleProvider = new firebase.auth.GoogleAuthProvider();
                
            } catch (error) {
                console.error('Firebase initialization error:', error);
                showToast('Authentication service unavailable', 'error');
            }
        }

        // ============================
        // PARSE INITIALIZATION
        // ============================
        function initializeParse() {
            Parse.initialize(CONFIG.parse.applicationId, CONFIG.parse.javascriptKey);
            Parse.serverURL = CONFIG.parse.serverURL;
        }

        // ============================
        // AD SYSTEM INITIALIZATION
        // ============================
        function loadVideoSliderAds() {
            // Load Video Slider Ads on main page
            const mainSliderContainer = elements.mainVideoSlider;
            const mainSlider = document.createElement('ins');
            mainSlider.className = 'eas6a97888e31';
            mainSlider.setAttribute('data-zoneid', CONFIG.ads.videoSlider);
            mainSliderContainer.appendChild(mainSlider);
            
            // Load Video Slider Ads on detail page
            const detailSliderContainer = elements.detailVideoSlider;
            const detailSlider = document.createElement('ins');
            detailSlider.className = 'eas6a97888e31';
            detailSlider.setAttribute('data-zoneid', CONFIG.ads.videoSlider);
            detailSliderContainer.appendChild(detailSlider);
            
            // Initialize ad provider
            if (window.AdProvider) {
                window.AdProvider.push({ serve: {} });
            } else {
                window.AdProvider = [{ serve: {} }];
            }
        }

        function initializeMobileInterstitial() {
            // Mobile interstitial will be shown programmatically
            elements.closeInterstitial.addEventListener('click', () => {
                elements.mobileInterstitial.style.display = 'none';
            });
        }

        function showMobileInterstitial() {
            // Only show on mobile devices
            if (window.innerWidth <= 768) {
                elements.mobileInterstitial.style.display = 'flex';
                state.shortsViewed = 0; // Reset counter
            }
        }

        // ============================
        // CONTENT LOADING
        // ============================
        async function loadContent() {
            elements.loadingState.style.display = 'flex';
            elements.videosGrid.innerHTML = '';
            elements.shortsGrid.innerHTML = '';
            
            try {
                // Load regular videos
                await loadVideos();
                
                // Load shorts
                await loadShorts();
                
                // Hide loading state
                elements.loadingState.style.display = 'none';
                
                // Show/hide no videos state
                if (state.videos.length === 0 && state.shorts.length === 0) {
                    elements.noVideos.style.display = 'block';
                } else {
                    elements.noVideos.style.display = 'none';
                }
                
                // Check if there's a pending video to load from URL
                if (state.pendingVideoId) {
                    if (state.pendingIsShort) {
                        const short = state.shorts.find(s => s.id === state.pendingVideoId);
                        if (short) {
                            showShortsPlayer(state.shorts.indexOf(short));
                        }
                    } else {
                        const video = state.videos.find(v => v.id === state.pendingVideoId);
                        if (video) {
                            showVideoDetail(video);
                        }
                    }
                    // Clear pending state
                    delete state.pendingVideoId;
                    delete state.pendingIsShort;
                }
                
            } catch (error) {
                console.error('Error loading content:', error);
                elements.loadingState.style.display = 'none';
                showToast('Error loading content. Please try again.', 'error');
            }
        }

        async function loadVideos(searchQuery = '') {
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                
                // Filter out shorts
                query.notEqualTo('isShort', true);
                
                if (searchQuery) {
                    query.contains('title', searchQuery);
                }
                
                query.descending('createdAt');
                query.limit(50);
                
                const results = await query.find();
                state.videos = results.map(videoToObject);
                
                displayVideos();
                
            } catch (error) {
                console.error('Error loading videos:', error);
                throw error;
            }
        }

        async function loadShorts() {
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                
                query.equalTo('isShort', true);
                query.descending('createdAt');
                query.limit(20);
                
                const results = await query.find();
                state.shorts = results.map(videoToObject);
                
                displayShorts();
                
            } catch (error) {
                console.error('Error loading shorts:', error);
                throw error;
            }
        }

        function videoToObject(video) {
            return {
                id: video.id,
                title: video.get('title') || 'Untitled Video',
                description: video.get('description') || '',
                videoUrl: video.get('videoUrl'),
                thumbnailUrl: video.get('thumbnailUrl') || getDefaultThumbnail(),
                creatorId: video.get('creatorId'),
                creatorName: video.get('creatorName') || 'Anonymous',
                views: video.get('views') || 0,
                likes: video.get('likes') || 0,
                dislikes: video.get('dislikes') || 0,
                comments: video.get('comments') || 0,
                duration: video.get('duration') || '0:00',
                isShort: video.get('isShort') || false,
                createdAt: video.get('createdAt'),
                tags: video.get('tags') || []
            };
        }

        function getDefaultThumbnail() {
            const thumbnails = [
                'https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?w=400&h=225&fit=crop',
                'https://images.unsplash.com/photo-1536240478700-b869070f9279?w=400&h=225&fit=crop',
                'https://images.unsplash.com/photo-1522869635100-9f4c5e86aa37?w-400&h=225&fit=crop',
                'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400&h=225&fit=crop',
                'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=400&h=225&fit=crop'
            ];
            return thumbnails[Math.floor(Math.random() * thumbnails.length)];
        }

        // ============================
        // DISPLAY CONTENT
        // ============================
        function displayVideos() {
            elements.videosGrid.innerHTML = '';
            
            state.videos.forEach(video => {
                const videoCard = createVideoCard(video);
                elements.videosGrid.appendChild(videoCard);
            });
        }

        function displayShorts() {
            elements.shortsGrid.innerHTML = '';
            
            state.shorts.forEach(video => {
                const shortCard = createShortCard(video);
                elements.shortsGrid.appendChild(shortCard);
            });
        }

        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.dataset.videoId = video.id;
            
            const views = formatNumber(video.views);
            const duration = video.duration;
            const timeAgo = getTimeAgo(video.createdAt);
            
            card.innerHTML = `
                <div class="video-thumbnail">
                    <img src="${video.thumbnailUrl}" alt="${video.title}" loading="lazy">
                    ${duration ? `<div class="video-duration">${duration}</div>` : ''}
                    ${video.isShort ? '<div class="video-badge">SHORT</div>' : ''}
                </div>
                <div class="video-info">
                    <h3 class="video-title">${video.title}</h3>
                    <div class="video-creator">
                        <div class="creator-avatar">${video.creatorName.charAt(0)}</div>
                        <span>${video.creatorName}</span>
                    </div>
                    <div class="video-stats">
                        <span class="stat-item">
                            <i class="fas fa-eye"></i> ${views}
                        </span>
                        <span class="stat-item">
                            <i class="fas fa-thumbs-up"></i> ${formatNumber(video.likes)}
                        </span>
                        <span> ${timeAgo}</span>
                    </div>
                </div>
            `;
            
            card.addEventListener('click', () => {
                showVideoDetail(video);
            });
            
            return card;
        }

        function createShortCard(video) {
            const card = document.createElement('div');
            card.className = 'short-card';
            card.dataset.videoId = video.id;
            
            const views = formatNumber(video.views);
            
            card.innerHTML = `
                <div class="short-thumbnail">
                    <img src="${video.thumbnailUrl}" alt="${video.title}" loading="lazy">
                    <div class="video-duration">${video.duration}</div>
                </div>
                <div class="short-info">
                    <h4 class="short-title">${video.title}</h4>
                    <div class="short-stats">
                        <span>${views} views</span>
                    </div>
                </div>
            `;
            
            card.addEventListener('click', () => {
                const index = state.shorts.findIndex(s => s.id === video.id);
                showShortsPlayer(index);
            });
            
            return card;
        }

        // ============================
        // VIDEO DETAIL PAGE
        // ============================
        function showVideoDetail(video) {
            state.currentVideo = video;
            
            // Hide home content, show detail page
            elements.homeContent.style.display = 'none';
            elements.videoDetailPage.style.display = 'block';
            
            // Update page URL for sharing (without reloading)
            const newUrl = `${window.location.origin}${window.location.pathname}?v=${video.id}`;
            window.history.pushState({ path: newUrl }, '', newUrl);
            
            // Update view count
            updateViewCount(video.id);
            
            // Update UI with video data
            elements.detailVideoTitle.textContent = video.title;
            elements.detailViews.textContent = formatNumber(video.views);
            elements.detailDate.textContent = getTimeAgo(video.createdAt);
            elements.likeCount.textContent = formatNumber(video.likes);
            elements.dislikeCount.textContent = formatNumber(video.dislikes);
            elements.detailCreatorAvatar.textContent = video.creatorName.charAt(0);
            elements.detailCreatorName.textContent = video.creatorName;
            elements.detailCreatorSubs.textContent = '1K subscribers'; // Placeholder
            elements.detailDescription.textContent = video.description || 'No description available.';
            
            // Update subscribe button state
            if (state.subscribedChannels.includes(video.creatorId)) {
                elements.subscribeBtn.textContent = 'Subscribed';
                elements.subscribeBtn.classList.add('subscribed');
            } else {
                elements.subscribeBtn.textContent = 'Subscribe';
                elements.subscribeBtn.classList.remove('subscribed');
            }
            
            // Update like/dislike button states
            if (state.user && state.user.likedVideos && state.user.likedVideos.includes(video.id)) {
                elements.likeBtn.classList.add('liked');
            } else {
                elements.likeBtn.classList.remove('liked');
            }
            
            if (state.user && state.user.dislikedVideos && state.user.dislikedVideos.includes(video.id)) {
                elements.dislikeBtn.classList.add('disliked');
            } else {
                elements.dislikeBtn.classList.remove('disliked');
            }
            
            // Update tags
            elements.detailTags.innerHTML = '';
            if (video.tags && video.tags.length > 0) {
                video.tags.forEach(tag => {
                    if (tag.trim()) {
                        const tagElement = document.createElement('span');
                        tagElement.className = 'video-tag';
                        tagElement.textContent = tag.trim();
                        elements.detailTags.appendChild(tagElement);
                    }
                });
            }
            
            // Initialize video player
            initializeDetailPlayer(video);
            
            // Load related videos
            loadRelatedVideos(video);
        }

        function initializeDetailPlayer(video) {
            const playerContainer = document.getElementById('detail-video-player');
            playerContainer.innerHTML = '';
            
            const videoElement = document.createElement('video');
            videoElement.id = 'detail-video';
            videoElement.style.width = '100%';
            videoElement.style.height = 'auto';
            videoElement.controls = true;
            videoElement.autoplay = true;
            videoElement.muted = false;
            
            const source = document.createElement('source');
            source.src = video.videoUrl;
            source.type = 'video/mp4';
            
            videoElement.appendChild(source);
            playerContainer.appendChild(videoElement);
            
            // Store player reference
            state.detailPlayer = videoElement;
            
            // Add event listener for when video ends
            videoElement.addEventListener('ended', () => {
                // Auto-play next related video
                autoPlayNextVideo();
            });
            
            // Handle page navigation - pause video when leaving
            window.addEventListener('popstate', () => {
                if (state.detailPlayer && !state.detailPlayer.paused) {
                    state.detailPlayer.pause();
                }
            });
            
            // Add visibility change handler for this player
            videoElement.addEventListener('pause', () => {
                // Don't auto-pause when user manually pauses
            });
        }

        function autoPlayNextVideo() {
            // Find current video index
            const currentIndex = state.videos.findIndex(v => v.id === state.currentVideo.id);
            if (currentIndex < state.videos.length - 1) {
                const nextVideo = state.videos[currentIndex + 1];
                showVideoDetail(nextVideo);
            }
        }

        async function loadRelatedVideos(video) {
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                
                // Exclude current video
                query.notEqualTo('objectId', video.id);
                
                // Filter by tags if available
                if (video.tags && video.tags.length > 0) {
                    const tagQueries = video.tags.map(tag => {
                        const tagQuery = new Parse.Query(Video);
                        tagQuery.contains('tags', tag.trim());
                        return tagQuery;
                    });
                    
                    if (tagQueries.length > 0) {
                        const mainQuery = Parse.Query.or(...tagQueries);
                        query._where = mainQuery._where;
                    }
                }
                
                query.limit(6);
                query.descending('views');
                
                const results = await query.find();
                const relatedVideos = results.map(videoToObject);
                
                displayRelatedVideos(relatedVideos);
                
            } catch (error) {
                console.error('Error loading related videos:', error);
                // Fallback: show random videos
                const randomVideos = [...state.videos]
                    .filter(v => v.id !== video.id)
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 6);
                displayRelatedVideos(randomVideos);
            }
        }

        function displayRelatedVideos(videos) {
            elements.relatedVideosGrid.innerHTML = '';
            
            videos.forEach(video => {
                const card = createVideoCard(video);
                elements.relatedVideosGrid.appendChild(card);
            });
        }

        // ============================
        // TIKTOK STYLE SHORTS PLAYER
        // ============================
        function showShortsPlayer(startIndex = 0) {
            if (state.shorts.length === 0) return;
            
            state.currentShortIndex = startIndex;
            state.shortsAdCounter = 0;
            state.isPlayingAd = false;
            
            // Show shorts player
            elements.shortsPlayer.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // Load first short
            loadShortVideo(startIndex);
            
            // Update URL for sharing
            const videoId = state.shorts[startIndex].id;
            const newUrl = `${window.location.origin}${window.location.pathname}?v=${videoId}&short=true`;
            window.history.pushState({ path: newUrl }, '', newUrl);
        }

        function loadShortVideo(index) {
            if (index < 0 || index >= state.shorts.length) return;
            
            const short = state.shorts[index];
            state.currentShortIndex = index;
            
            // Update UI
            elements.shortVideoTitle.textContent = short.title;
            elements.shortVideoCreator.textContent = `@${short.creatorName}`;
            elements.shortLikeCount.textContent = formatNumber(short.likes);
            elements.shortDislikeCount.textContent = formatNumber(short.dislikes);
            elements.shortCommentCount.textContent = formatNumber(short.comments);
            
            // Update like/dislike button states
            if (state.shortLiked.includes(short.id)) {
                elements.shortLikeBtn.classList.add('liked');
                elements.shortLikeBtn.querySelector('i').className = 'fas fa-heart';
            } else {
                elements.shortLikeBtn.classList.remove('liked');
                elements.shortLikeBtn.querySelector('i').className = 'far fa-heart';
            }
            
            if (state.shortDisliked.includes(short.id)) {
                elements.shortDislikeBtn.classList.add('disliked');
            } else {
                elements.shortDislikeBtn.classList.remove('disliked');
            }
            
            // Reset ad indicator
            elements.adIndicator.style.display = 'none';
            
            // Check if we should play an ad
            state.shortsAdCounter++;
            if (state.shortsAdCounter >= 3) {
                playShortAd();
                state.shortsAdCounter = 0;
            } else {
                // Play the actual short video
                playShortVideo(short);
            }
            
            // Update view count
            updateViewCount(short.id);
            
            // Track shorts viewed for interstitial
            state.shortsViewed++;
            if (state.shortsViewed >= CONFIG.app.shortsInterstitialFrequency) {
                showMobileInterstitial();
            }
        }

        function playShortVideo(short) {
            state.isPlayingAd = false;
            
            const videoElement = elements.shortVideoPlayer;
            videoElement.src = short.videoUrl;
            videoElement.load();
            
            // Auto-play
            videoElement.play().catch(e => {
                console.error('Auto-play failed:', e);
                // User interaction might be required
            });
            
            // Store reference
            state.shortPlayer = videoElement;
            
            // Update pause/play button
            const pauseBtn = elements.shortPauseBtn.querySelector('i');
            pauseBtn.className = 'fas fa-pause';
            
            // Handle video end
            videoElement.onended = () => {
                // Auto-play next short
                playNextShort();
            };
        }

        function playShortAd() {
            state.isPlayingAd = true;
            
            // Show ad indicator
            elements.adIndicator.style.display = 'block';
            
            // Create a temporary video element for the ad
            const videoElement = elements.shortVideoPlayer;
            videoElement.src = ''; // Clear current source
            
            // In a real implementation, you would use an ad SDK
            // For now, we'll simulate an ad with a message
            elements.shortVideoTitle.textContent = 'Advertisement';
            elements.shortVideoCreator.textContent = 'Sponsored Content';
            
            // Simulate ad play
            setTimeout(() => {
                // After ad, play the actual short
                const short = state.shorts[state.currentShortIndex];
                playShortVideo(short);
            }, 5000); // 5 second ad
            
            // You would integrate with a real ad SDK like:
            // const adPlayer = new VASTPlayer();
            // adPlayer.load(CONFIG.ads.shortsAd);
            // adPlayer.play();
        }

        function playNextShort() {
            const nextIndex = state.currentShortIndex + 1;
            if (nextIndex < state.shorts.length) {
                loadShortVideo(nextIndex);
            } else {
                // Loop back to beginning
                loadShortVideo(0);
            }
        }

        function playPrevShort() {
            const prevIndex = state.currentShortIndex - 1;
            if (prevIndex >= 0) {
                loadShortVideo(prevIndex);
            } else {
                // Loop to end
                loadShortVideo(state.shorts.length - 1);
            }
        }

        function setupShortsTouchEvents() {
            let startY = 0;
            let isSwiping = false;
            
            elements.shortsPlayer.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
                isSwiping = true;
            });
            
            elements.shortsPlayer.addEventListener('touchmove', (e) => {
                if (!isSwiping) return;
                
                const currentY = e.touches[0].clientY;
                const diff = startY - currentY;
                
                // Vertical swipe detection
                if (Math.abs(diff) > 50) {
                    if (diff > 0) {
                        // Swipe up - next video
                        playNextShort();
                    } else {
                        // Swipe down - previous video
                        playPrevShort();
                    }
                    isSwiping = false;
                }
            });
            
            elements.shortsPlayer.addEventListener('touchend', () => {
                isSwiping = false;
            });
        }

        // ============================
        // FLUID VIDEO PLAYER (Full Screen)
        // ============================
        function playVideo(video) {
            state.currentVideo = video;
            
            // Update view count
            updateViewCount(video.id);
            
            // Show player modal
            elements.videoPlayerModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // Initialize Fluid Player
            initializePlayer(video);
        }

        function initializePlayer(video) {
            // Clear previous player
            elements.fluidPlayerVideo.innerHTML = '';
            
            // Set video source
            elements.fluidPlayerVideo.src = video.videoUrl;
            
            // Initialize Fluid Player with ads
            state.videoPlayer = fluidPlayer('fluid-player-video', {
                layoutControls: {
                    primaryColor: "#FF0000",
                    posterImage: video.thumbnailUrl,
                    allowDownload: false,
                    playButtonShowing: true,
                    fillToContainer: true,
                    autoPlay: true,
                    mute: false,
                    keyboardControl: true,
                    playlist: false,
                    allowTheatre: true,
                    playbackRateEnabled: true,
                    title: video.title,
                    subtitlesEnabled: false,
                    logo: {
                        imageUrl: null,
                        position: 'top left',
                        clickUrl: null,
                        opacity: 1
                    }
                },
                vastOptions: {
                    adList: [
                        {
                            roll: 'preRoll',
                            vastTag: CONFIG.ads.preRoll,
                            adText: 'Advertisement'
                        },
                        {
                            roll: 'midRoll',
                            vastTag: CONFIG.ads.midRoll,
                            timer: 30 // Show mid-roll ad at 30 seconds
                        },
                        {
                            roll: 'postRoll',
                            vastTag: CONFIG.ads.postRoll
                        }
                    ],
                    adCTAText: true,
                    adCTATextPosition: 'top right',
                    skipButtonCaption: 'Skip Ad [seconds]',
                    skipButtonClickCaption: 'Skip Ad',
                    adText: 'Advertisement',
                    adTextPosition: 'top left',
                    adClickable: true,
                    autoPlayAd: true,
                    adNotLoaded: function() {
                        console.log('Ad not loaded');
                    },
                    adStarted: function() {
                        console.log('Ad started');
                    },
                    adFinished: function() {
                        console.log('Ad finished');
                    }
                }
            });
            
            // Handle video end
            elements.fluidPlayerVideo.addEventListener('ended', () => {
                // Show next video suggestion
                setTimeout(() => {
                    closeVideoPlayer();
                }, 3000);
            });
        }

        function closeVideoPlayer() {
            elements.videoPlayerModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // Stop video
            if (state.videoPlayer) {
                state.videoPlayer.destroy();
                state.videoPlayer = null;
            }
        }

        // ============================
        // VIDEO ACTIONS (Like, Share, etc.)
        // ============================
        async function updateViewCount(videoId) {
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                
                const currentViews = video.get('views') || 0;
                video.set('views', currentViews + 1);
                
                await video.save();
                
                // Update local state
                const videoIndex = state.videos.findIndex(v => v.id === videoId);
                if (videoIndex !== -1) {
                    state.videos[videoIndex].views++;
                }
                
                const shortIndex = state.shorts.findIndex(v => v.id === videoId);
                if (shortIndex !== -1) {
                    state.shorts[shortIndex].views++;
                }
                
            } catch (error) {
                console.error('Error updating view count:', error);
            }
        }

        async function likeVideo(videoId, isShort = false) {
            if (!state.isAuthenticated) {
                showToast('Please sign in to like videos', 'error');
                showAuthModal();
                return;
            }
            
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                
                const currentLikes = video.get('likes') || 0;
                video.set('likes', currentLikes + 1);
                
                await video.save();
                
                // Update UI
                if (!isShort) {
                    elements.likeCount.textContent = formatNumber(currentLikes + 1);
                    elements.likeBtn.classList.add('liked');
                    
                    // Remove dislike if previously disliked
                    if (elements.dislikeBtn.classList.contains('disliked')) {
                        await dislikeVideo(videoId, true);
                    }
                } else {
                    elements.shortLikeCount.textContent = formatNumber(currentLikes + 1);
                    elements.shortLikeBtn.classList.add('liked');
                    elements.shortLikeBtn.querySelector('i').className = 'fas fa-heart';
                    
                    // Add to liked shorts
                    state.shortLiked.push(videoId);
                    
                    // Remove from disliked if previously disliked
                    const dislikeIndex = state.shortDisliked.indexOf(videoId);
                    if (dislikeIndex !== -1) {
                        state.shortDisliked.splice(dislikeIndex, 1);
                        elements.shortDislikeBtn.classList.remove('disliked');
                        await dislikeVideo(videoId, true); // Remove dislike
                    }
                }
                
                showToast('Video liked!', 'success');
                
            } catch (error) {
                console.error('Error liking video:', error);
            }
        }

        async function dislikeVideo(videoId, removeDislike = false) {
            if (!state.isAuthenticated) {
                showToast('Please sign in to dislike videos', 'error');
                return;
            }
            
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                
                const currentDislikes = video.get('dislikes') || 0;
                
                if (removeDislike && currentDislikes > 0) {
                    video.set('dislikes', currentDislikes - 1);
                    elements.dislikeBtn.classList.remove('disliked');
                } else if (!removeDislike) {
                    video.set('dislikes', currentDislikes + 1);
                    elements.dislikeBtn.classList.add('disliked');
                    
                    // Remove like if previously liked
                    if (elements.likeBtn.classList.contains('liked')) {
                        await likeVideo(videoId, true);
                    }
                }
                
                await video.save();
                
                // Update UI
                if (!removeDislike) {
                    elements.dislikeCount.textContent = formatNumber(currentDislikes + 1);
                    showToast('Video disliked', 'info');
                }
                
            } catch (error) {
                console.error('Error disliking video:', error);
            }
        }

        async function shortDislike(videoId) {
            if (!state.isAuthenticated) {
                showToast('Please sign in to dislike videos', 'error');
                showAuthModal();
                return;
            }
            
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                
                const currentDislikes = video.get('dislikes') || 0;
                video.set('dislikes', currentDislikes + 1);
                
                await video.save();
                
                // Update UI
                elements.shortDislikeCount.textContent = formatNumber(currentDislikes + 1);
                elements.shortDislikeBtn.classList.add('disliked');
                
                // Add to disliked shorts
                state.shortDisliked.push(videoId);
                
                // Remove from liked if previously liked
                const likeIndex = state.shortLiked.indexOf(videoId);
                if (likeIndex !== -1) {
                    state.shortLiked.splice(likeIndex, 1);
                    elements.shortLikeBtn.classList.remove('liked');
                    elements.shortLikeBtn.querySelector('i').className = 'far fa-heart';
                    await likeVideo(videoId, true); // Remove like
                }
                
                showToast('Video disliked', 'info');
                
            } catch (error) {
                console.error('Error disliking video:', error);
            }
        }

        function shareVideo(video) {
            const shareUrl = `${CONFIG.app.siteUrl}?v=${video.id}${video.isShort ? '&short=true' : ''}`;
            
            // Update share modal
            elements.shareUrlInput.value = shareUrl;
            elements.shareModal.style.display = 'flex';
            
            // Setup platform sharing
            setupSharePlatforms(video, shareUrl);
        }

        function setupSharePlatforms(video, shareUrl) {
            const platforms = document.querySelectorAll('.share-platform');
            platforms.forEach(platform => {
                platform.addEventListener('click', () => {
                    const platformName = platform.dataset.platform;
                    let shareLink = '';
                    
                    const encodedUrl = encodeURIComponent(shareUrl);
                    const encodedTitle = encodeURIComponent(video.title);
                    
                    switch(platformName) {
                        case 'facebook':
                            shareLink = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;
                            break;
                        case 'twitter':
                            shareLink = `https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedTitle}`;
                            break;
                        case 'whatsapp':
                            shareLink = `https://api.whatsapp.com/send?text=${encodedTitle} ${encodedUrl}`;
                            break;
                        case 'telegram':
                            shareLink = `https://t.me/share/url?url=${encodedUrl}&text=${encodedTitle}`;
                            break;
                    }
                    
                    if (shareLink) {
                        window.open(shareLink, '_blank', 'width=600,height=400');
                    }
                });
            });
        }

        // ============================
        // VIDEO UPLOAD
        // ============================
        function setupDragAndDrop() {
            const dropzone = elements.uploadDropzone;
            
            dropzone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropzone.classList.add('dragover');
            });
            
            dropzone.addEventListener('dragleave', () => {
                dropzone.classList.remove('dragover');
            });
            
            dropzone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropzone.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            });
            
            elements.videoFileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    handleFileSelect(e.target.files[0]);
                }
            });
        }

        function handleFileSelect(file) {
            // Validate file
            if (!file.type.includes('video/')) {
                showToast('Please select a video file', 'error');
                return;
            }
            
            if (file.size > CONFIG.app.maxFileSize) {
                showToast('File too large. Maximum size is 2GB', 'error');
                return;
            }
            
            // Show preview
            const previewURL = URL.createObjectURL(file);
            elements.previewVideo.src = previewURL;
            elements.uploadPreview.style.display = 'block';
            
            // Enable submit button
            elements.submitUpload.disabled = false;
            
            // Auto-fill title from filename
            if (!elements.videoTitle.value.trim()) {
                const filename = file.name.replace(/\.[^/.]+$/, "");
                elements.videoTitle.value = filename;
            }
            
            showToast('Video selected. Ready to upload!', 'success');
        }

        async function uploadVideo() {
            if (state.isUploading) return;
            
            const file = elements.videoFileInput.files[0];
            const title = elements.videoTitle.value.trim();
            const description = elements.videoDescription.value.trim();
            const tags = elements.videoTags.value.split(',').map(tag => tag.trim()).filter(tag => tag);
            const isShort = elements.isShort.checked;
            
            // Validation
            if (!file) {
                showToast('Please select a video file', 'error');
                return;
            }
            
            if (!title) {
                showToast('Please enter a video title', 'error');
                return;
            }
            
            if (!state.isAuthenticated) {
                showToast('Please sign in to upload videos', 'error');
                showAuthModal();
                return;
            }
            
            // Start upload
            state.isUploading = true;
            state.uploadProgress = 0;
            
            // Show progress bar
            elements.uploadProgress.style.display = 'block';
            elements.submitUpload.disabled = true;
            elements.submitUpload.textContent = 'Uploading...';
            
            try {
                // Create FormData for Cloudinary
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', CONFIG.cloudinary.uploadPreset);
                formData.append('cloud_name', CONFIG.cloudinary.cloudName);
                formData.append('tags', 'haitiantube');
                
                // Simulate progress updates
                simulateProgress();
                
                // Upload to Cloudinary
                const response = await fetch(CONFIG.cloudinary.apiUrl, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) throw new Error('Upload failed');
                
                const cloudinaryData = await response.json();
                
                // Get video URL and thumbnail
                const videoUrl = cloudinaryData.secure_url;
                const thumbnailUrl = cloudinaryData.secure_url.replace(/\.(mp4|mov|avi|webm|mkv)$/, '.jpg');
                const duration = Math.round(cloudinaryData.duration);
                
                // Save to Parse
                const Video = Parse.Object.extend('Video');
                const video = new Video();
                
                video.set('title', title);
                video.set('description', description);
                video.set('videoUrl', videoUrl);
                video.set('thumbnailUrl', thumbnailUrl);
                video.set('creatorId', state.user.uid);
                video.set('creatorName', state.user.displayName);
                video.set('views', 0);
                video.set('likes', 0);
                video.set('dislikes', 0);
                video.set('comments', 0);
                video.set('duration', formatDuration(duration));
                video.set('isShort', isShort);
                video.set('tags', tags);
                
                await video.save();
                
                // Complete progress
                state.uploadProgress = 100;
                updateProgressBar();
                
                // Show success
                showToast('Video uploaded successfully!', 'success');
                
                // Reset form
                setTimeout(() => {
                    closeUploadModal();
                    loadContent(); // Refresh content
                }, 2000);
                
            } catch (error) {
                console.error('Upload error:', error);
                showToast('Upload failed: ' + error.message, 'error');
                state.isUploading = false;
                elements.submitUpload.disabled = false;
                elements.submitUpload.textContent = 'Upload Video';
                elements.uploadProgress.style.display = 'none';
            }
        }

        function simulateProgress() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 90) {
                    progress = 90;
                    clearInterval(interval);
                }
                state.uploadProgress = Math.min(progress, 90);
                updateProgressBar();
            }, 200);
        }

        function updateProgressBar() {
            elements.progressFill.style.width = state.uploadProgress + '%';
            elements.progressPercent.textContent = Math.round(state.uploadProgress) + '%';
        }

        // ============================
        // AUTHENTICATION
        // ============================
        async function handleLogin(email, password) {
            try {
                const auth = firebase.auth();
                await auth.signInWithEmailAndPassword(email, password);
                closeAuthModal();
                showToast('Successfully signed in!', 'success');
            } catch (error) {
                console.error('Login error:', error);
                showToast('Login failed: ' + error.message, 'error');
            }
        }

        async function handleSignup(username, email, password) {
            try {
                const auth = firebase.auth();
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // Update profile
                await userCredential.user.updateProfile({
                    displayName: username
                });
                
                closeAuthModal();
                showToast('Account created successfully!', 'success');
            } catch (error) {
                console.error('Signup error:', error);
                showToast('Signup failed: ' + error.message, 'error');
            }
        }

        async function handleGoogleLogin() {
            try {
                const auth = firebase.auth();
                await auth.signInWithPopup(googleProvider);
                closeAuthModal();
                showToast('Successfully signed in with Google!', 'success');
            } catch (error) {
                console.error('Google login error:', error);
                showToast('Google login failed: ' + error.message, 'error');
            }
        }

        async function logout() {
            try {
                await firebase.auth().signOut();
                showToast('Successfully logged out', 'info');
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Logout failed: ' + error.message, 'error');
            }
        }

        function updateAuthUI() {
            if (state.isAuthenticated) {
                // Update user avatar
                if (state.user.photoURL) {
                    elements.userAvatar.innerHTML = `<img src="${state.user.photoURL}" style="width:100%;height:100%;border-radius:50%;" alt="${state.user.displayName}">`;
                } else {
                    elements.userAvatar.textContent = state.user.displayName.charAt(0).toUpperCase();
                }
                
                // Show logout button
                elements.logoutButton.style.display = 'flex';
                elements.loginButton.style.display = 'none';
                
                // Enable upload button
                elements.uploadButton.style.display = 'flex';
                elements.fabUpload.style.display = 'flex';
                
            } else {
                // Reset user avatar
                elements.userAvatar.innerHTML = '<i class="fas fa-user"></i>';
                
                // Show login button
                elements.logoutButton.style.display = 'none';
                elements.loginButton.style.display = 'flex';
                
                // Hide upload button
                elements.uploadButton.style.display = 'none';
                elements.fabUpload.style.display = 'none';
            }
        }

        // ============================
        // MODAL MANAGEMENT
        // ============================
        function showAuthModal() {
            elements.authModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeAuthModal() {
            elements.authModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            resetAuthForms();
        }

        function showUploadModal() {
            if (!state.isAuthenticated) {
                showToast('Please sign in to upload videos', 'error');
                showAuthModal();
                return;
            }
            
            elements.uploadModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeUploadModal() {
            elements.uploadModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            resetUploadForm();
        }

        function resetAuthForms() {
            elements.loginForm.reset();
            elements.signupForm.reset();
            elements.loginForm.style.display = 'block';
            elements.signupForm.style.display = 'none';
            elements.authTabs[0].classList.add('active');
            elements.authTabs[1].classList.remove('active');
        }

        function resetUploadForm() {
            elements.videoFileInput.value = '';
            elements.videoTitle.value = '';
            elements.videoDescription.value = '';
            elements.videoTags.value = '';
            elements.isShort.checked = false;
            elements.uploadPreview.style.display = 'none';
            elements.uploadProgress.style.display = 'none';
            elements.submitUpload.disabled = true;
            elements.submitUpload.textContent = 'Upload Video';
            state.isUploading = false;
            state.uploadProgress = 0;
        }

        // ============================
        // EVENT LISTENERS
        // ============================
        function setupEventListeners() {
            // Menu toggle
            elements.menuToggle.addEventListener('click', () => {
                elements.sidebar.classList.toggle('active');
            });
            
            // Search toggle
            elements.searchToggle.addEventListener('click', () => {
                elements.searchContainer.classList.toggle('active');
            });
            
            // Search
            elements.searchButton.addEventListener('click', handleSearch);
            elements.searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
            
            // Back button for detail page
            window.addEventListener('popstate', () => {
                if (elements.videoDetailPage.style.display === 'block') {
                    goBackToHome();
                }
                if (elements.shortsPlayer.style.display === 'block') {
                    closeShortsPlayer();
                }
            });
            
            // Close player
            elements.closePlayer.addEventListener('click', closeVideoPlayer);
            
            // Navigation
            elements.navItems.forEach(item => {
                item.addEventListener('click', () => {
                    // Remove active class from all items
                    elements.navItems.forEach(i => i.classList.remove('active'));
                    // Add active class to clicked item
                    item.classList.add('active');
                    
                    const view = item.dataset.view;
                    if (view) {
                        switchView(view);
                    }
                    
                    // Close sidebar on mobile
                    if (window.innerWidth <= 768) {
                        elements.sidebar.classList.remove('active');
                    }
                });
            });
            
            // Authentication
            elements.loginButton.addEventListener('click', showAuthModal);
            elements.logoutButton.addEventListener('click', logout);
            elements.userAvatar.addEventListener('click', () => {
                if (state.isAuthenticated) {
                    // Show user menu (could be implemented)
                } else {
                    showAuthModal();
                }
            });
            
            // Auth modal tabs
            elements.authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    elements.authTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    if (tab.dataset.tab === 'login') {
                        elements.loginForm.style.display = 'block';
                        elements.signupForm.style.display = 'none';
                    } else {
                        elements.loginForm.style.display = 'none';
                        elements.signupForm.style.display = 'block';
                    }
                });
            });
            
            // Auth forms
            elements.loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = elements.loginEmail.value;
                const password = elements.loginPassword.value;
                handleLogin(email, password);
            });
            
            elements.signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = elements.signupUsername.value;
                const email = elements.signupEmail.value;
                const password = elements.signupPassword.value;
                const confirmPassword = elements.signupConfirmPassword.value;
                
                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                
                handleSignup(username, email, password);
            });
            
            elements.googleSignIn.addEventListener('click', handleGoogleLogin);
            
            // Video Detail Actions
            elements.likeBtn.addEventListener('click', () => {
                if (state.currentVideo) {
                    likeVideo(state.currentVideo.id);
                }
            });
            
            elements.dislikeBtn.addEventListener('click', () => {
                if (state.currentVideo) {
                    dislikeVideo(state.currentVideo.id);
                }
            });
            
            elements.shareBtn.addEventListener('click', () => {
                if (state.currentVideo) {
                    shareVideo(state.currentVideo);
                }
            });
            
            elements.saveBtn.addEventListener('click', () => {
                showToast('Video saved to watch later', 'success');
            });
            
            elements.subscribeBtn.addEventListener('click', () => {
                if (state.currentVideo) {
                    if (state.subscribedChannels.includes(state.currentVideo.creatorId)) {
                        // Unsubscribe
                        const index = state.subscribedChannels.indexOf(state.currentVideo.creatorId);
                        state.subscribedChannels.splice(index, 1);
                        elements.subscribeBtn.textContent = 'Subscribe';
                        elements.subscribeBtn.classList.remove('subscribed');
                        showToast('Unsubscribed from channel', 'info');
                    } else {
                        // Subscribe
                        state.subscribedChannels.push(state.currentVideo.creatorId);
                        elements.subscribeBtn.textContent = 'Subscribed';
                        elements.subscribeBtn.classList.add('subscribed');
                        showToast('Subscribed to channel', 'success');
                    }
                }
            });
            
            // Shorts Actions
            elements.shortLikeBtn.addEventListener('click', () => {
                if (state.shorts[state.currentShortIndex]) {
                    const short = state.shorts[state.currentShortIndex];
                    if (state.shortLiked.includes(short.id)) {
                        // Already liked, do nothing or remove like
                    } else {
                        likeVideo(short.id, true);
                    }
                }
            });
            
            elements.shortDislikeBtn.addEventListener('click', () => {
                if (state.shorts[state.currentShortIndex]) {
                    const short = state.shorts[state.currentShortIndex];
                    if (state.shortDisliked.includes(short.id)) {
                        // Already disliked, do nothing
                    } else {
                        shortDislike(short.id);
                    }
                }
            });
            
            elements.shortCommentBtn.addEventListener('click', () => {
                showToast('Comments feature coming soon!', 'info');
            });
            
            elements.shortShareBtn.addEventListener('click', () => {
                if (state.shorts[state.currentShortIndex]) {
                    shareVideo(state.shorts[state.currentShortIndex]);
                }
            });
            
            // Copy URL button
            elements.copyUrlBtn.addEventListener('click', () => {
                elements.shareUrlInput.select();
                document.execCommand('copy');
                showToast('Link copied to clipboard', 'success');
            });
            
            // Shorts Player Controls
            elements.closeShorts.addEventListener('click', closeShortsPlayer);
            
            elements.shortPrevBtn.addEventListener('click', playPrevShort);
            elements.shortNextBtn.addEventListener('click', playNextShort);
            
            elements.shortPauseBtn.addEventListener('click', () => {
                if (state.shortPlayer) {
                    if (state.shortPlayer.paused) {
                        state.shortPlayer.play();
                        const pauseBtn = elements.shortPauseBtn.querySelector('i');
                        pauseBtn.className = 'fas fa-pause';
                    } else {
                        state.shortPlayer.pause();
                        const pauseBtn = elements.shortPauseBtn.querySelector('i');
                        pauseBtn.className = 'fas fa-play';
                    }
                }
            });
            
            // Upload
            elements.uploadButton.addEventListener('click', showUploadModal);
            elements.fabUpload.addEventListener('click', showUploadModal);
            elements.uploadFirstVideo.addEventListener('click', showUploadModal);
            elements.uploadDropzone.addEventListener('click', () => {
                elements.videoFileInput.click();
            });
            
            elements.submitUpload.addEventListener('click', uploadVideo);
            elements.cancelUpload.addEventListener('click', closeUploadModal);
            
            // Close modals on outside click
            window.addEventListener('click', (e) => {
                if (e.target === elements.authModal) {
                    closeAuthModal();
                }
                if (e.target === elements.uploadModal) {
                    closeUploadModal();
                }
                if (e.target === elements.videoPlayerModal) {
                    closeVideoPlayer();
                }
                if (e.target === elements.shareModal) {
                    elements.shareModal.style.display = 'none';
                }
                if (e.target === elements.shortsPlayer) {
                    // Don't close on shorts player background click
                }
                if (e.target === elements.mobileInterstitial) {
                    // Don't close on interstitial background click
                }
            });
            
            // Handle escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAuthModal();
                    closeUploadModal();
                    closeVideoPlayer();
                    elements.shareModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                    if (state.videoPlayer) {
                        state.videoPlayer.destroy();
                        state.videoPlayer = null;
                    }
                    if (elements.shortsPlayer.style.display === 'block') {
                        closeShortsPlayer();
                    }
                    if (elements.videoDetailPage.style.display === 'block') {
                        goBackToHome();
                    }
                }
            });
        }

        function handleSearch() {
            const query = elements.searchInput.value.trim();
            if (query) {
                loadVideos(query);
                showToast(`Searching for "${query}"...`, 'info');
                
                // Close search on mobile
                if (window.innerWidth <= 768) {
                    elements.searchContainer.classList.remove('active');
                }
            }
        }

        function switchView(view) {
            state.currentView = view;
            
            switch(view) {
                case 'home':
                    goBackToHome();
                    break;
                case 'shorts':
                    if (state.shorts.length > 0) {
                        showShortsPlayer(0);
                    }
                    break;
                // Add other views as needed
            }
        }

        function goBackToHome() {
            elements.videoDetailPage.style.display = 'none';
            elements.homeContent.style.display = 'block';
            
            // Pause detail video if playing
            if (state.detailPlayer && !state.detailPlayer.paused) {
                state.detailPlayer.pause();
            }
            
            // Update URL
            window.history.pushState({ path: window.location.origin }, '', window.location.origin);
        }

        function closeShortsPlayer() {
            elements.shortsPlayer.style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // Pause short video if playing
            if (state.shortPlayer && !state.shortPlayer.paused) {
                state.shortPlayer.pause();
            }
            
            // Update URL
            window.history.pushState({ path: window.location.origin }, '', window.location.origin);
        }

        // ============================
        // UTILITY FUNCTIONS
        // ============================
        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        function formatDuration(seconds) {
            if (!seconds) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function getTimeAgo(date) {
            if (!date) return 'Recently';
            const now = new Date();
            const past = new Date(date);
            const diffMs = now - past;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;
            return `${Math.floor(diffDays / 365)} years ago`;
        }

        function showToast(message, type = 'info') {
            elements.toastMessage.textContent = message;
            elements.toast.className = `toast toast-${type}`;
            
            // Set icon
            const icon = elements.toast.querySelector('.toast-icon');
            if (type === 'success') {
                icon.className = 'fas fa-check-circle toast-icon';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle toast-icon';
            } else {
                icon.className = 'fas fa-info-circle toast-icon';
            }
            
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
