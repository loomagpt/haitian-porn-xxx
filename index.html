<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="jUFvWg6T0RGd45tCoerev16CHRJYJ7j_fBJXesmxztE" />
    <title>HaitianTube - Modern Video Platform</title>
    
    <!-- Video.js CSS -->
    <link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">
    
    <!-- Video.js VAST Plugin CSS -->
    <link href="https://cdn.jsdelivr.net/npm/videojs-vast-vpaid@2.0.2/dist/videojs.vast.vpaid.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AYSq3RDGsmBLJE-ornT4tYgXrQdyLQwFf9WVFjj96G5EE9g-oUz2UQzh0xbInqNS-3pbhCfeHxikePxg&vault=true&intent=subscription"></script>
    
    <style>
        :root {
            --primary-blue: #0d6efd;
            --secondary-blue: #3d8bfd;
            --dark-blue: #0a58ca;
            --light-blue: #e7f1ff;
            --background: #ffffff;
            --surface: #f8f9fa;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border: #dee2e6;
            --like-color: #0d6efd;
            --dislike-color: #6c757d;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --border-radius: 8px;
            --success: #198754;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #0dcaf0;
            --premium: #ffd700;
            --premium-dark: #ffc107;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.5;
        }

        /* AGE VERIFICATION 18+ */
        #ageGate {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000f2;
            z-index: 999999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: #fff;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }

        #ageGate h2 {
            font-size: 32px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        #ageGate p {
            max-width: 380px;
            font-size: 16px;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        #ageGate button {
            padding: 12px 35px;
            font-size: 18px;
            background: #e50914;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            transition: 0.3s;
        }

        #ageGate button:hover {
            background: #ff0a16;
        }

        #ageGate a {
            margin-top: 15px;
            font-size: 14px;
            color: #bbb;
            text-decoration: underline;
        }

        /* Cookie Consent */
        #cookieConsent {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #111;
            color: #fff;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: Arial, sans-serif;
            font-size: 14px;
            z-index: 999999;
        }

        #cookieConsent a {
            color: #e50914;
            text-decoration: none;
        }

        #cookieConsent a:hover {
            text-decoration: underline;
        }

        #cookieConsent button {
            padding: 8px 20px;
            background: #e50914;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        #cookieConsent button:hover {
            background: #ff0a16;
        }

        /* Premium Badge */
        .premium-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, var(--premium), var(--premium-dark));
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .premium-badge i {
            margin-right: 4px;
        }

        /* Payment Lock */
        .payment-lock {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            text-align: center;
            z-index: 100;
            max-width: 400px;
            width: 90%;
        }

        .payment-lock h3 {
            margin-bottom: 16px;
            font-size: 24px;
            color: var(--premium);
        }

        .payment-lock p {
            margin-bottom: 20px;
            color: #ddd;
        }

        .payment-price {
            font-size: 32px;
            font-weight: bold;
            color: var(--premium);
            margin: 20px 0;
        }

        #paypal-button-container {
            margin: 20px 0;
        }

        .payment-success {
            background-color: var(--success);
            color: white;
            padding: 10px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            display: none;
        }

        /* Video Card Premium Overlay */
        .premium-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: var(--premium);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .premium-thumbnail-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.2));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .premium-thumbnail-overlay i {
            font-size: 48px;
            color: var(--premium);
            opacity: 0.8;
        }

        /* Header Styles */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--background);
            box-shadow: var(--shadow-sm);
            padding: 0 16px;
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-blue);
            text-decoration: none;
        }

        .logo i {
            margin-right: 8px;
            font-size: 28px;
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            margin: 0 24px;
        }

        .search-form {
            display: flex;
            width: 100%;
        }

        .search-input {
            flex: 1;
            padding: 10px 16px;
            border: 1px solid var(--border);
            border-radius: var(--border-radius) 0 0 var(--border-radius);
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            border-color: var(--primary-blue);
        }

        .search-button {
            background-color: var(--surface);
            border: 1px solid var(--border);
            border-left: none;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            padding: 0 20px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .search-button:hover {
            background-color: var(--border);
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .signin-button, .upload-button, .user-menu-button, .studio-button {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .signin-button:hover, .upload-button:hover, .user-menu-button:hover, .studio-button:hover {
            background-color: var(--dark-blue);
        }

        .studio-button {
            background-color: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .user-menu-button {
            background-color: transparent;
            color: var(--text-primary);
            padding: 8px;
            position: relative;
        }

        .user-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            z-index: 1000;
            display: none;
        }

        .user-menu.show {
            display: block;
        }

        .user-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }

        .user-menu-item:hover {
            background-color: var(--surface);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--light-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-blue);
            font-weight: 600;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.2s;
        }

        .btn-primary:hover {
            background-color: var(--dark-blue);
        }

        .btn-secondary {
            background-color: var(--surface);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.2s;
        }

        .btn-secondary:hover {
            background-color: var(--border);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-danger:hover {
            background-color: #bb2d3b;
        }

        .btn-premium {
            background: linear-gradient(135deg, var(--premium), var(--premium-dark));
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-premium:hover {
            transform: scale(1.05);
        }

        .text-center {
            text-align: center;
        }

        .mt-3 {
            margin-top: 12px;
        }

        .mb-3 {
            margin-bottom: 12px;
        }

        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }

        .success-message {
            color: var(--success);
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: var(--primary-blue);
        }

        .upload-area i {
            font-size: 48px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        /* Upload Progress Animation - FIXED */
        .upload-progress-container {
            margin: 20px 0;
            display: none;
        }

        .upload-progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: var(--border);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-blue), var(--secondary-blue));
            width: 0%;
            transition: width 0.3s ease-out;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
            );
            z-index: 1;
            background-size: 50px 50px;
            animation: move 2s linear infinite;
            border-radius: 10px;
        }

        @keyframes move {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 50px 50px;
            }
        }

        .progress-percentage {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-weight: 600;
            font-size: 12px;
            z-index: 2;
        }

        .upload-stages {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .stage {
            text-align: center;
            flex: 1;
            position: relative;
        }

        .stage.active {
            color: var(--primary-blue);
            font-weight: 600;
        }

        .stage.completed {
            color: var(--success);
        }

        .stage.completed::before {
            content: '✓ ';
            color: var(--success);
        }

        /* Processing Animation */
        .processing-container {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }

        .processing-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--light-blue);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Studio Dashboard */
        #studio-dashboard {
            display: none;
            width: 100%;
        }

        .studio-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px 16px;
        }

        .studio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .studio-header h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .studio-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 32px;
        }

        .studio-sidebar {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 24px;
            height: fit-content;
        }

        .studio-nav {
            list-style: none;
        }

        .studio-nav-item {
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background-color 0.2s;
        }

        .studio-nav-item:hover {
            background-color: var(--light-blue);
        }

        .studio-nav-item.active {
            background-color: var(--light-blue);
            color: var(--primary-blue);
            font-weight: 600;
        }

        .studio-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 32px;
            box-shadow: var(--shadow-sm);
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 24px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 8px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Videos Table */
        .videos-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 24px;
        }

        .videos-table th {
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            color: var(--text-secondary);
        }

        .videos-table td {
            padding: 16px 12px;
            border-bottom: 1px solid var(--border);
        }

        .video-row:hover {
            background-color: var(--surface);
        }

        .video-thumbnail-cell {
            width: 120px;
        }

        .video-thumbnail-small {
            width: 120px;
            height: 68px;
            object-fit: cover;
            border-radius: var(--border-radius);
        }

        .video-title-cell {
            min-width: 200px;
        }

        .video-title-small {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .video-meta-small {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .video-actions-cell {
            width: 150px;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: var(--surface);
        }

        .action-btn.edit {
            color: var(--primary-blue);
        }

        .action-btn.delete {
            color: var(--danger);
        }

        /* Analytics Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 32px;
        }

        .chart-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow-sm);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* Channel Management */
        .channel-header {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .channel-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--light-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: var(--primary-blue);
            font-weight: 700;
        }

        .channel-info h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .channel-info p {
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .channel-edit-btn {
            margin-top: 12px;
            background: transparent;
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Main Content */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px 16px;
        }

        /* Homepage Styles */
        #homepage {
            width: 100%;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .video-card {
            background-color: var(--background);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }

        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .thumbnail-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 aspect ratio */
            overflow: hidden;
            background-color: #000;
        }

        .thumbnail {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-info {
            padding: 16px;
        }

        .video-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-channel {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 4px;
        }

        .video-meta {
            color: var(--text-secondary);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Video Detail Page */
        #video-detail {
            display: none;
            width: 100%;
        }

        .video-detail-container {
            display: flex;
            gap: 24px;
        }

        .video-main {
            flex: 1;
            min-width: 0;
        }

        .video-sidebar {
            width: 360px;
        }

        .video-player-container {
            width: 100%;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            position: relative;
        }

        .video-player {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            position: relative;
            background-color: #000;
        }

        .video-player video,
        .video-js {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .ad-notice {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10;
        }

        .ad-revenue {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #4CAF50;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10;
        }

        .video-info-section {
            background-color: var(--background);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
        }

        .video-title-large {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 16px;
            line-height: 1.4;
        }

        .video-meta-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .video-stats {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .video-actions {
            display: flex;
            gap: 8px;
        }

        /* Modern Buttons */
        .btn-moderne {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: var(--surface);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-primary);
        }

        .btn-moderne.like {
            color: var(--like-color);
        }

        .btn-moderne.like.active {
            background-color: var(--light-blue);
            border-color: var(--primary-blue);
        }

        .btn-moderne.dislike {
            color: var(--dislike-color);
        }

        .btn-moderne.dislike.active {
            background-color: #f8f9fa;
            border-color: var(--dislike-color);
        }

        .btn-moderne.share {
            color: var(--primary-blue);
        }

        .btn-moderne.subscribe {
            background-color: var(--danger);
            color: white;
        }

        .btn-moderne.subscribe.subscribed {
            background-color: var(--text-secondary);
        }

        .btn-moderne.comment {
            color: var(--primary-blue);
        }

        .btn-moderne:hover {
            background-color: var(--light-blue);
        }

        .btn-moderne:active {
            transform: scale(0.97);
        }

        .video-description {
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--surface);
            padding: 16px;
            border-radius: var(--border-radius);
            margin-top: 16px;
        }

        .video-description h3 {
            margin-bottom: 12px;
            font-size: 18px;
            font-weight: 600;
        }

        /* Channel Section */
        .channel-section {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--surface);
            border-radius: var(--border-radius);
        }

        .channel-avatar-small {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--light-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .channel-info-small h4 {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .channel-info-small p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Comments Section */
        .comments-section {
            background-color: var(--background);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
        }

        .comments-section h3 {
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 600;
        }

        .comment-form {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-blue);
            font-weight: 600;
            flex-shrink: 0;
        }

        .comment-input-container {
            flex: 1;
        }

        .comment-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            font-size: 14px;
            outline: none;
            resize: none;
            min-height: 40px;
            font-family: 'Inter', sans-serif;
        }

        .comment-input:focus {
            border-color: var(--primary-blue);
        }

        .comment-submit {
            align-self: flex-start;
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .comment-submit:hover {
            background-color: var(--dark-blue);
        }

        .comment {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .comment:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .comment-content h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .comment-content p {
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .comment-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .comment-actions {
            display: flex;
            gap: 16px;
            margin-top: 8px;
        }

        .comment-action {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s;
        }

        .comment-action:hover {
            color: var(--primary-blue);
        }

        /* Sidebar */
        .sidebar-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .related-videos {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .related-video {
            display: flex;
            gap: 12px;
            cursor: pointer;
        }

        .related-thumbnail {
            width: 160px;
            height: 90px;
            object-fit: cover;
            border-radius: var(--border-radius);
            flex-shrink: 0;
        }

        .related-video-info h4 {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .related-video-info p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Footer */
        footer {
            background-color: var(--surface);
            padding: 40px 16px;
            margin-top: 60px;
            text-align: center;
            border-top: 1px solid var(--border);
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 16px;
        }

        .footer-logo i {
            margin-right: 8px;
        }

        .footer-text {
            color: var(--text-secondary);
            font-size: 14px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Visibility Badge */
        .visibility-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 8px;
        }

        .visibility-public {
            background-color: #d1e7dd;
            color: #0f5132;
        }

        .visibility-private {
            background-color: #f8d7da;
            color: #842029;
        }

        /* Verified Badge */
        .verified-badge {
            display: inline-block;
            background: var(--primary-blue);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            text-align: center;
            line-height: 18px;
            font-size: 10px;
            margin-left: 8px;
        }

        /* Channel Banner */
        .channel-banner {
            width: 100%;
            height: 250px;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            border-radius: var(--border-radius);
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .channel-banner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .channel-header-with-banner {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 24px;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            display: flex;
            align-items: flex-end;
            gap: 24px;
        }

        .channel-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--light-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: var(--primary-blue);
            font-weight: 700;
            border: 4px solid white;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .video-detail-container {
                flex-direction: column;
            }
            
            .video-sidebar {
                width: 100%;
            }
            
            .studio-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-container {
                flex-wrap: wrap;
                height: auto;
                padding: 12px 0;
            }
            
            .search-container {
                order: 3;
                margin: 16px 0 0 0;
                width: 100%;
            }
            
            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 16px;
            }
            
            .video-meta-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .video-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .btn-moderne {
                flex: 1;
                justify-content: center;
            }
            
            .comment-form {
                flex-direction: column;
            }
            
            .comment-submit {
                align-self: flex-end;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            #cookieConsent {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .video-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-moderne span {
                display: none;
            }
            
            .btn-moderne {
                padding: 8px 12px;
            }
            
            .video-title-large {
                font-size: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- AGE VERIFICATION 18+ -->
    <div id="ageGate">
        <h2>Adults Only – 18+</h2>
        <p>
            This website contains explicit adult material.  
            You must be at least 18 years old to access this content.
        </p>
        <button onclick="enterSite()">
            I Confirm I Am 18+
        </button>
        <a href="https://google.com">
            I am under 18 – Leave
        </a>
    </div>
    
    <!-- Header -->
    <header>
        <div class="header-container">
            <a href="/" class="logo" id="home-link">
                <i class="fas fa-play-circle"></i>
                <span>HaitianTube</span>
            </a>
            
            <div class="search-container">
                <form class="search-form" id="search-form">
                    <input type="text" class="search-input" placeholder="Search videos..." id="search-input">
                    <button type="submit" class="search-button">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
            </div>
            
            <div class="user-actions">
                <button class="studio-button" id="studio-btn">
                    <i class="fas fa-tv"></i>
                    <span>Studio</span>
                </button>
                <button class="upload-button" id="upload-btn">
                    <i class="fas fa-upload"></i>
                    <span>Upload</span>
                </button>
                <button class="signin-button" id="signin-btn" style="display: none;">
                    <i class="fas fa-user"></i>
                    <span>Sign In</span>
                </button>
                <div class="user-menu-container" id="user-menu-container" style="display: none;">
                    <button class="user-menu-button" id="user-menu-btn">
                        <div class="user-avatar" id="user-avatar">U</div>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-menu" id="user-menu">
                        <div class="user-menu-item">
                            <i class="fas fa-user"></i>
                            <span id="user-name">User</span>
                        </div>
                        <div class="user-menu-item" id="my-channel-btn">
                            <i class="fas fa-tv"></i>
                            <span>My Channel</span>
                        </div>
                        <div class="user-menu-item" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Auth Modal -->
    <div class="modal" id="auth-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="auth-modal-title">Sign In</h2>
                <button class="modal-close" id="auth-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="auth-error" class="error-message"></div>
                <div id="auth-success" class="success-message"></div>
                
                <div id="signin-form">
                    <div class="form-group">
                        <label for="auth-email">Email</label>
                        <input type="email" id="auth-email" class="form-control" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="auth-password">Password</label>
                        <input type="password" id="auth-password" class="form-control" placeholder="Enter your password">
                    </div>
                    <button class="btn-primary" id="signin-submit">Sign In</button>
                    <div class="mt-3 text-center">
                        <p>Don't have an account? <a href="#" id="switch-to-signup">Sign Up</a></p>
                    </div>
                </div>
                
                <div id="signup-form" style="display: none;">
                    <div class="form-group">
                        <label for="signup-name">Channel Name</label>
                        <input type="text" id="signup-name" class="form-control" placeholder="Enter your channel name">
                    </div>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" class="form-control" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" class="form-control" placeholder="Create a password (min. 6 characters)">
                    </div>
                    <div class="form-group">
                        <label for="signup-confirm-password">Confirm Password</label>
                        <input type="password" id="signup-confirm-password" class="form-control" placeholder="Confirm your password">
                    </div>
                    <button class="btn-primary" id="signup-submit">Sign Up</button>
                    <div class="mt-3 text-center">
                        <p>Already have an account? <a href="#" id="switch-to-signin">Sign In</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Upload Modal -->
    <div class="modal" id="upload-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Upload Video</h2>
                <button class="modal-close" id="upload-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="upload-error" class="error-message"></div>
                <div id="upload-success" class="success-message"></div>
                
                <!-- Step 1: File Selection -->
                <div id="upload-step-1">
                    <div class="upload-area" id="upload-area">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>Select a video file</h3>
                        <p>Drag and drop or click to browse</p>
                        <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                            MP4, WebM, or OGG up to 2GB
                        </p>
                    </div>
                    <input type="file" id="video-file" accept="video/*" style="display: none;">
                    
                    <div class="form-group">
                        <label for="video-title">Video Title</label>
                        <input type="text" id="video-title" class="form-control" placeholder="Enter video title">
                    </div>
                    
                    <div class="form-group">
                        <label for="video-description">Description</label>
                        <textarea id="video-description" class="form-control" rows="3" placeholder="Enter video description"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="video-visibility">Visibility</label>
                        <select id="video-visibility" class="form-control">
                            <option value="public">Public</option>
                            <option value="private">Private</option>
                            <option value="premium">Premium (Paid Access)</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="price-group" style="display: none;">
                        <label for="video-price">Price ($)</label>
                        <input type="number" id="video-price" class="form-control" placeholder="Minimum: $10.99" min="10.99" max="999" step="0.01" value="10.99">
                        <small style="color: var(--text-secondary);">Minimum price: $10.99. You earn 80% ($8.79 per sale)</small>
                    </div>
                    
                    <button class="btn-primary" id="upload-start-btn">Start Upload</button>
                </div>
                
                <!-- Step 2: Upload Progress -->
                <div class="upload-progress-container" id="upload-progress-container">
                    <div class="upload-progress-header">
                        <span>Uploading...</span>
                        <span id="progress-percentage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="upload-progress-fill">
                            <div class="progress-percentage" id="progress-percentage-text">0%</div>
                        </div>
                    </div>
                    
                    <div class="upload-stages">
                        <div class="stage active" id="stage-upload">Uploading</div>
                        <div class="stage" id="stage-process">Processing</div>
                        <div class="stage" id="stage-publish">Publishing</div>
                    </div>
                </div>
                
                <!-- Step 3: Processing -->
                <div class="processing-container" id="processing-container">
                    <div class="processing-spinner"></div>
                    <h3>Processing Video</h3>
                    <p>Your video is being processed. This may take a few minutes...</p>
                    <div id="processing-steps">
                        <p><i class="fas fa-spinner fa-spin"></i> Uploading video file</p>
                        <p><i class="fas fa-spinner"></i> Generating thumbnail</p>
                        <p><i class="fas fa-spinner"></i> Creating video slug</p>
                        <p><i class="fas fa-spinner"></i> Preparing for playback</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Video Modal -->
    <div class="modal" id="edit-video-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Video</h2>
                <button class="modal-close" id="edit-video-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="edit-video-error" class="error-message"></div>
                <div id="edit-video-success" class="success-message"></div>
                
                <div class="form-group">
                    <label for="edit-video-title">Video Title</label>
                    <input type="text" id="edit-video-title" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="edit-video-description">Description</label>
                    <textarea id="edit-video-description" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="edit-video-visibility">Visibility</label>
                    <select id="edit-video-visibility" class="form-control">
                        <option value="public">Public</option>
                        <option value="private">Private</option>
                        <option value="premium">Premium (Paid Access)</option>
                    </select>
                </div>
                
                <div class="form-group" id="edit-price-group" style="display: none;">
                    <label for="edit-video-price">Price ($)</label>
                    <input type="number" id="edit-video-price" class="form-control" min="10.99" max="999" step="0.01">
                    <small style="color: var(--text-secondary);">Minimum price: $10.99</small>
                </div>
                
                <div class="form-group">
                    <label for="edit-video-thumbnail">Change Thumbnail</label>
                    <input type="file" id="edit-video-thumbnail" class="form-control" accept="image/*">
                </div>
                
                <div class="form-group">
                    <label>Video URL</label>
                    <input type="text" id="edit-video-url" class="form-control" readonly>
                    <button type="button" id="copy-video-url" class="btn-secondary mt-3">
                        <i class="fas fa-copy"></i> Copy Video URL
                    </button>
                </div>
                
                <div class="form-group" id="premium-stats" style="display: none;">
                    <label>Premium Video Stats</label>
                    <div class="stat-card" style="text-align: left; padding: 12px;">
                        <div>Total Purchases: <span id="total-purchases">0</span></div>
                        <div>Total Revenue: $<span id="total-revenue">0.00</span></div>
                        <div>Revenue Share: 80% (You keep $<span id="creator-revenue">0.00</span>)</div>
                    </div>
                </div>
                
                <button class="btn-primary" id="edit-video-submit">Save Changes</button>
                <button class="btn-danger mt-3" id="delete-video-btn">
                    <i class="fas fa-trash"></i> Delete Video
                </button>
            </div>
        </div>
    </div>
    
    <!-- Payment Modal -->
    <div class="modal" id="payment-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Unlock Premium Video</h2>
                <button class="modal-close" id="payment-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="payment-error" class="error-message"></div>
                <div id="payment-success" class="success-message"></div>
                
                <div class="text-center">
                    <i class="fas fa-crown" style="font-size: 48px; color: var(--premium); margin-bottom: 16px;"></i>
                    <h3 style="margin-bottom: 8px;" id="payment-video-title">Premium Video</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 24px;">Unlock exclusive content</p>
                    
                    <div class="payment-price" id="payment-price">$10.99</div>
                    
                    <div style="background: var(--surface); padding: 16px; border-radius: var(--border-radius); margin-bottom: 24px;">
                        <h4 style="margin-bottom: 8px;">What you get:</h4>
                        <ul style="text-align: left; padding-left: 20px; color: var(--text-secondary);">
                            <li>Lifetime access to this video</li>
                            <li>No advertisements</li>
                            <li>High quality streaming</li>
                            <li>Download option (if available)</li>
                        </ul>
                    </div>
                    
                    <div id="paypal-button-container"></div>
                    
                    <div class="payment-success" id="payment-success-message">
                        <i class="fas fa-check-circle"></i> Payment successful! Video is now unlocked.
                    </div>
                    
                    <p style="font-size: 12px; color: var(--text-secondary); margin-top: 24px;">
                        By purchasing, you agree to our Terms of Service. 80% goes to the creator, 20% platform fee.
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Channel Modal -->
    <div class="modal" id="edit-channel-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Channel</h2>
                <button class="modal-close" id="edit-channel-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="edit-channel-error" class="error-message"></div>
                <div id="edit-channel-success" class="success-message"></div>
                
                <div class="form-group">
                    <label for="edit-channel-name">Channel Name</label>
                    <input type="text" id="edit-channel-name" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="edit-channel-description">Channel Description</label>
                    <textarea id="edit-channel-description" class="form-control" rows="3" placeholder="Tell viewers about your channel"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="edit-channel-avatar">Profile Picture</label>
                    <input type="file" id="edit-channel-avatar" class="form-control" accept="image/*">
                </div>
                
                <div class="form-group">
                    <label for="edit-channel-banner">Channel Banner (Recommended: 2560x1440)</label>
                    <input type="file" id="edit-channel-banner" class="form-control" accept="image/*">
                </div>
                
                <button class="btn-primary" id="edit-channel-submit">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="container">
        <!-- Homepage with video thumbnails -->
        <section id="homepage">
            <h2 class="section-title" id="section-title">Trending Videos</h2>
            <div class="video-grid" id="video-grid">
                <!-- Video thumbnails will be dynamically generated here -->
            </div>
        </section>
        
        <!-- Video Detail Page (hidden by default) -->
        <section id="video-detail">
            <div class="video-detail-container">
                <div class="video-main">
                    <div class="video-player-container">
                        <!-- Payment Lock Overlay (shown for premium videos) -->
                        <div class="payment-lock" id="payment-lock" style="display: none;">
                            <i class="fas fa-lock" style="font-size: 48px; margin-bottom: 16px; color: var(--premium);"></i>
                            <h3>Premium Content Locked</h3>
                            <p>This video is only available to premium subscribers. Unlock access to watch this exclusive content.</p>
                            <div class="payment-price" id="lock-price">$10.99</div>
                            <button class="btn-premium" id="unlock-btn">
                                <i class="fas fa-unlock"></i> Unlock Video
                            </button>
                            <p style="margin-top: 16px; font-size: 14px; color: #ddd;">
                                No ads • Lifetime access • Supports the creator
                            </p>
                        </div>
                        
                        <div class="video-player">
                            <div class="ad-notice" id="ad-notice">CrackRevenue VAST Ads Enabled</div>
                            <div class="ad-revenue" id="ad-revenue">Ad Revenue: $0.00</div>
                            <!-- Video.js player will be inserted here -->
                            <video id="video-player" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto">
                                <p class="vjs-no-js">
                                    To view this video please enable JavaScript, and consider upgrading to a web browser that
                                    <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
                                </p>
                            </video>
                        </div>
                    </div>
                    
                    <div class="video-info-section">
                        <h1 class="video-title-large" id="detail-video-title">Video Title</h1>
                        
                        <div class="channel-section">
                            <div class="channel-avatar-small" id="detail-channel-avatar">C</div>
                            <div class="channel-info-small">
                                <h4 id="detail-channel-name">Channel Name</h4>
                                <p id="detail-channel-subs">0 subscribers</p>
                            </div>
                            <button class="btn-moderne subscribe" id="subscribe-btn">
                                <i class="fas fa-bell"></i>
                                <span>Subscribe</span>
                            </button>
                        </div>
                        
                        <div class="video-meta-section">
                            <div class="video-stats">
                                <span id="view-count">0 views</span> • 
                                <span id="upload-date">Just now</span> •
                                <span id="like-dislike-ratio">0% liked this video</span>
                            </div>
                            
                            <div class="video-actions">
                                <button class="btn-moderne like" id="like-btn">
                                    <i class="fas fa-thumbs-up"></i>
                                    <span id="like-count">0</span>
                                </button>
                                <button class="btn-moderne dislike" id="dislike-btn">
                                    <i class="fas fa-thumbs-down"></i>
                                    <span id="dislike-count">0</span>
                                </button>
                                <button class="btn-moderne share" id="share-btn">
                                    <i class="fas fa-share"></i>
                                    <span>Share</span>
                                </button>
                                <button class="btn-moderne comment" id="comment-btn">
                                    <i class="fas fa-comment"></i>
                                    <span>Comment</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="video-description">
                            <h3>Description</h3>
                            <p id="detail-video-description">This is where the video description will appear.</p>
                            <div class="video-meta-small" style="margin-top: 8px; color: var(--text-secondary); font-size: 12px;">
                                Video ID: <span id="video-id"></span> | 
                                URL: <span id="video-slug-url">https://haitiantube.icu/watch/</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="comments-section">
                        <h3 id="comments-count">Comments (0)</h3>
                        
                        <div class="comment-form" id="comment-form-section">
                            <div class="comment-avatar" id="comment-user-avatar">U</div>
                            <div class="comment-input-container">
                                <textarea class="comment-input" id="comment-input" placeholder="Add a comment..." rows="1"></textarea>
                            </div>
                            <button class="comment-submit" id="comment-submit-btn">Comment</button>
                        </div>
                        
                        <div class="comments-list" id="comments-list">
                            <!-- Comments will be dynamically generated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar for related videos -->
                <aside class="video-sidebar">
                    <h3 class="sidebar-title">Related Videos</h3>
                    <div class="related-videos" id="related-videos">
                        <!-- Related videos will be dynamically generated here -->
                    </div>
                </aside>
            </div>
        </section>
        
        <!-- Studio Dashboard (hidden by default) -->
        <section id="studio-dashboard">
            <div class="studio-container">
                <div class="studio-header">
                    <h1>Creator Studio</h1>
                    <div id="studio-welcome">Welcome back, <span id="studio-username">Creator</span>!</div>
                </div>
                
                <div class="studio-grid">
                    <div class="studio-sidebar">
                        <ul class="studio-nav">
                            <li class="studio-nav-item active" data-tab="dashboard">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Dashboard</span>
                            </li>
                            <li class="studio-nav-item" data-tab="videos">
                                <i class="fas fa-video"></i>
                                <span>Videos</span>
                            </li>
                            <li class="studio-nav-item" data-tab="analytics">
                                <i class="fas fa-chart-line"></i>
                                <span>Analytics</span>
                            </li>
                            <li class="studio-nav-item" data-tab="channel">
                                <i class="fas fa-tv"></i>
                                <span>Channel</span>
                            </li>
                            <li class="studio-nav-item" data-tab="earnings">
                                <i class="fas fa-dollar-sign"></i>
                                <span>Earnings</span>
                            </li>
                            <li class="studio-nav-item" data-tab="premium">
                                <i class="fas fa-crown"></i>
                                <span>Premium Videos</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="studio-content">
                        <!-- Dashboard Tab -->
                        <div id="dashboard-tab" class="studio-tab">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value" id="total-videos">0</div>
                                    <div class="stat-label">Total Videos</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="total-views">0</div>
                                    <div class="stat-label">Total Views</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="total-subs">0</div>
                                    <div class="stat-label">Subscribers</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="total-earnings">$0.00</div>
                                    <div class="stat-label">Total Earnings</div>
                                </div>
                            </div>
                            
                            <h3 style="margin: 32px 0 16px 0;">Recent Videos</h3>
                            <div id="recent-videos-list">
                                <!-- Recent videos will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Videos Tab -->
                        <div id="videos-tab" class="studio-tab" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                                <h3>Your Videos</h3>
                                <button class="btn-primary" style="width: auto;" id="add-video-btn">
                                    <i class="fas fa-plus"></i> Add Video
                                </button>
                            </div>
                            <table class="videos-table" id="videos-table">
                                <thead>
                                    <tr>
                                        <th>Video</th>
                                        <th>Visibility</th>
                                        <th>Views</th>
                                        <th>Likes</th>
                                        <th>Comments</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="videos-table-body">
                                    <!-- Videos will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Analytics Tab -->
                        <div id="analytics-tab" class="studio-tab" style="display: none;">
                            <h3>Channel Analytics</h3>
                            <div class="charts-grid">
                                <div class="chart-container">
                                    <div class="chart-title">Views Over Time</div>
                                    <canvas id="views-chart"></canvas>
                                </div>
                                <div class="chart-container">
                                    <div class="chart-title">Watch Time (Hours)</div>
                                    <canvas id="watch-time-chart"></canvas>
                                </div>
                                <div class="chart-container">
                                    <div class="chart-title">Top Videos</div>
                                    <div id="top-videos-list">
                                        <!-- Top videos will be loaded here -->
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <div class="chart-title">Audience Demographics</div>
                                    <canvas id="demographics-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Channel Tab -->
                        <div id="channel-tab" class="studio-tab" style="display: none;">
                            <div class="channel-header">
                                <div class="channel-avatar" id="studio-channel-avatar">C</div>
                                <div class="channel-info">
                                    <h2 id="studio-channel-name">Channel Name</h2>
                                    <p id="studio-channel-subs">0 subscribers</p>
                                    <p id="studio-channel-videos">0 videos</p>
                                    <button class="channel-edit-btn" id="edit-channel-btn">
                                        <i class="fas fa-edit"></i> Edit Channel
                                    </button>
                                </div>
                            </div>
                            
                            <h3 style="margin-bottom: 16px;">Channel Description</h3>
                            <p id="studio-channel-description" style="color: var(--text-secondary); margin-bottom: 32px;">
                                No description yet.
                            </p>
                            
                            <h3 style="margin-bottom: 16px;">Channel Stats</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value" id="channel-total-views">0</div>
                                    <div class="stat-label">Total Views</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="channel-avg-watch-time">0:00</div>
                                    <div class="stat-label">Avg. Watch Time</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="channel-subs-growth">0%</div>
                                    <div class="stat-label">Sub Growth (30d)</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="channel-engagement">0%</div>
                                    <div class="stat-label">Engagement Rate</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Earnings Tab -->
                        <div id="earnings-tab" class="studio-tab" style="display: none;">
                            <h3>Earnings Dashboard</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value" id="monthly-earnings">$0.00</div>
                                    <div class="stat-label">This Month</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="total-earnings-tab">$0.00</div>
                                    <div class="stat-label">Total Earnings</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="cpm-rate">$5.00</div>
                                    <div class="stat-label">Avg. CPM</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="estimated-monthly">$0.00</div>
                                    <div class="stat-label">Est. Monthly</div>
                                </div>
                            </div>
                            
                            <div class="chart-container" style="margin-top: 32px;">
                                <div class="chart-title">Earnings Over Time</div>
                                <canvas id="earnings-chart"></canvas>
                            </div>
                            
                            <div style="margin-top: 32px;">
                                <h4>How Earnings Work</h4>
                                <p style="color: var(--text-secondary); margin-top: 8px;">
                                    Earnings are calculated based on ad impressions and clicks through CrackRevenue VAST ads.
                                    You earn money when viewers watch ads on your videos. The more views and engagement your videos get, the more you earn.
                                </p>
                            </div>
                        </div>
                        
                        <!-- Premium Videos Tab -->
                        <div id="premium-tab" class="studio-tab" style="display: none;">
                            <h3>Premium Videos</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 24px;">
                                Manage your premium videos and track purchases. Premium videos are locked behind a paywall and generate direct revenue.
                            </p>
                            
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value" id="premium-videos-count">0</div>
                                    <div class="stat-label">Premium Videos</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="total-premium-sales">0</div>
                                    <div class="stat-label">Total Sales</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="premium-revenue">$0.00</div>
                                    <div class="stat-label">Premium Revenue</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="conversion-rate">0%</div>
                                    <div class="stat-label">Conversion Rate</div>
                                </div>
                            </div>
                            
                            <h3 style="margin: 32px 0 16px 0;">Your Premium Videos</h3>
                            <table class="videos-table" id="premium-videos-table">
                                <thead>
                                    <tr>
                                        <th>Video</th>
                                        <th>Price</th>
                                        <th>Purchases</th>
                                        <th>Revenue</th>
                                        <th>Your Share</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="premium-videos-body">
                                    <!-- Premium videos will be loaded here -->
                                </tbody>
                            </table>
                            
                            <div style="margin-top: 32px; padding: 20px; background: var(--surface); border-radius: var(--border-radius);">
                                <h4 style="margin-bottom: 16px;">How Premium Videos Work</h4>
                                <ul style="color: var(--text-secondary); padding-left: 20px;">
                                    <li>Premium videos are locked behind a paywall</li>
                                    <li>Viewers pay once for lifetime access</li>
                                    <li>Minimum price: $10.99 (You earn $8.79 per sale)</li>
                                    <li>You keep 80% of the revenue, 20% platform fee</li>
                                    <li>No ads are shown on premium videos</li>
                                    <li>Payments are processed through PayPal</li>
                                    <li>Funds are transferred to your PayPal account</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <i class="fas fa-play-circle"></i>
                <span>HaitianTube</span>
            </div>
            <p class="footer-text">© 2023 HaitianTube. All rights reserved. This site is optimized for VAST ads and CrackRevenue approval. A modern, clean, and fast video platform.</p>
            
            <!-- Privacy Policy Section -->
            <div style="margin-top: 30px; padding: 20px; background: var(--surface); border-radius: var(--border-radius); text-align: left;">
                <h3 style="margin-bottom: 15px; font-size: 18px;">Privacy Policy</h3>
                <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
                    This website respects your privacy. We do not collect personal data except basic analytics such as browser, device, and pages visited. We use third-party advertisers who may use cookies to deliver relevant ads. By using this website, you consent to these practices.
                </p>
                <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.6; margin-top: 10px;">
                    If you do not agree with our policy, please leave the site immediately.
                </p>
            </div>
        </div>
    </footer>
    
    <!-- COOKIE CONSENT -->
    <div id="cookieConsent">
        <span>
            This site uses cookies to enhance user experience.  
            By continuing, you accept our  
            <a href="#privacy-policy">Privacy Policy</a> and  
            <a href="#terms-of-use">Terms of Use</a>.
        </span>
        <button onclick="acceptCookies()">
            Accept
        </button>
    </div>

    <!-- Video.js and VAST Plugin Scripts -->
    <script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-vast-vpaid@2.0.2/dist/videojs_4.vast.vpaid.min.js"></script>
    
    <script>
        // Cookie Consent
        function acceptCookies() {
            document.getElementById("cookieConsent").style.display = "none";
            localStorage.setItem("cookiesAccepted", "true");
        }

        if (localStorage.getItem("cookiesAccepted") === "true") {
            document.getElementById("cookieConsent").style.display = "none";
        }

        // Age Verification
        function enterSite() {
            document.getElementById("ageGate").style.display = "none";
            localStorage.setItem("ageVerified", "true");
        }

        if (localStorage.getItem("ageVerified") === "true") {
            document.getElementById("ageGate").style.display = "none";
        }

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyABmWKGHOihq-2A_oywlKke-H4l7Pq_UvM",
            authDomain: "loomastore.firebaseapp.com",
            databaseURL: "https://loomastore-default-rtdb.firebaseio.com",
            projectId: "loomastore",
            storageBucket: "loomastore.firebasestorage.app",
            messagingSenderId: "480260251641",
            appId: "1:480260251641:web:75b1fbea6dc8f33cc16728",
            measurementId: "G-Z4QXNFLQEY"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Global variables
        let videos = [];
        let currentUser = null;
        let currentVideoId = null;
        let currentChannelId = null;
        let player = null;
        let selectedVideoFile = null;
        let videoBeingEdited = null;
        let premiumVideos = [];
        let userPurchases = [];
        
        // Chart instances
        let viewsChart = null;
        let watchTimeChart = null;
        let demographicsChart = null;
        let earningsChart = null;
        
        // Track watch time for current video
        let videoStartTime = null;
        let totalWatchTime = 0;
        let watchTimeInterval = null;
        let adRevenue = 0;
        let adImpressions = 0;
        let playedAds = [];

        // DOM elements
        const homepage = document.getElementById('homepage');
        const videoDetail = document.getElementById('video-detail');
        const studioDashboard = document.getElementById('studio-dashboard');
        const videoGrid = document.getElementById('video-grid');
        const relatedVideos = document.getElementById('related-videos');
        const commentsList = document.getElementById('comments-list');
        const homeLink = document.getElementById('home-link');
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const likeBtn = document.getElementById('like-btn');
        const dislikeBtn = document.getElementById('dislike-btn');
        const shareBtn = document.getElementById('share-btn');
        const subscribeBtn = document.getElementById('subscribe-btn');
        const commentBtn = document.getElementById('comment-btn');
        const commentInput = document.getElementById('comment-input');
        const commentSubmitBtn = document.getElementById('comment-submit-btn');
        const signinBtn = document.getElementById('signin-btn');
        const uploadBtn = document.getElementById('upload-btn');
        const studioBtn = document.getElementById('studio-btn');
        const userMenuContainer = document.getElementById('user-menu-container');
        const userMenuBtn = document.getElementById('user-menu-btn');
        const userMenu = document.getElementById('user-menu');
        const userAvatar = document.getElementById('user-avatar');
        const userName = document.getElementById('user-name');
        const logoutBtn = document.getElementById('logout-btn');
        const myChannelBtn = document.getElementById('my-channel-btn');
        const sectionTitle = document.getElementById('section-title');
        
        // Payment elements
        const paymentLock = document.getElementById('payment-lock');
        const unlockBtn = document.getElementById('unlock-btn');
        const lockPrice = document.getElementById('lock-price');
        const paymentModal = document.getElementById('payment-modal');
        const paymentModalClose = document.getElementById('payment-modal-close');
        const paymentVideoTitle = document.getElementById('payment-video-title');
        const paymentPrice = document.getElementById('payment-price');
        const paypalButtonContainer = document.getElementById('paypal-button-container');
        const paymentSuccessMessage = document.getElementById('payment-success-message');
        const paymentError = document.getElementById('payment-error');
        const paymentSuccess = document.getElementById('payment-success');
        
        // Studio elements
        const studioNavItems = document.querySelectorAll('.studio-nav-item');
        const studioTabs = document.querySelectorAll('.studio-tab');
        const addVideoBtn = document.getElementById('add-video-btn');
        const videosTableBody = document.getElementById('videos-table-body');
        const recentVideosList = document.getElementById('recent-videos-list');
        const topVideosList = document.getElementById('top-videos-list');
        const editChannelBtn = document.getElementById('edit-channel-btn');
        const premiumVideosBody = document.getElementById('premium-videos-body');
        
        // Studio stats
        const totalVideosStat = document.getElementById('total-videos');
        const totalViewsStat = document.getElementById('total-views');
        const totalSubsStat = document.getElementById('total-subs');
        const totalEarningsStat = document.getElementById('total-earnings');
        const studioChannelName = document.getElementById('studio-channel-name');
        const studioChannelSubs = document.getElementById('studio-channel-subs');
        const studioChannelVideos = document.getElementById('studio-channel-videos');
        const studioChannelDescription = document.getElementById('studio-channel-description');
        const studioChannelAvatar = document.getElementById('studio-channel-avatar');
        const channelTotalViews = document.getElementById('channel-total-views');
        const channelAvgWatchTime = document.getElementById('channel-avg-watch-time');
        const channelSubsGrowth = document.getElementById('channel-subs-growth');
        const channelEngagement = document.getElementById('channel-engagement');
        const monthlyEarnings = document.getElementById('monthly-earnings');
        const totalEarningsTab = document.getElementById('total-earnings-tab');
        const cpmRate = document.getElementById('cpm-rate');
        const estimatedMonthly = document.getElementById('estimated-monthly');
        const studioUsername = document.getElementById('studio-username');
        
        // Premium stats
        const premiumVideosCount = document.getElementById('premium-videos-count');
        const totalPremiumSales = document.getElementById('total-premium-sales');
        const premiumRevenue = document.getElementById('premium-revenue');
        const conversionRate = document.getElementById('conversion-rate');
        
        // Modal elements
        const authModal = document.getElementById('auth-modal');
        const authModalClose = document.getElementById('auth-modal-close');
        const authModalTitle = document.getElementById('auth-modal-title');
        const signinForm = document.getElementById('signin-form');
        const signupForm = document.getElementById('signup-form');
        const switchToSignup = document.getElementById('switch-to-signup');
        const switchToSignin = document.getElementById('switch-to-signin');
        const authEmail = document.getElementById('auth-email');
        const authPassword = document.getElementById('auth-password');
        const signinSubmit = document.getElementById('signin-submit');
        const signupName = document.getElementById('signup-name');
        const signupEmail = document.getElementById('signup-email');
        const signupPassword = document.getElementById('signup-password');
        const signupConfirmPassword = document.getElementById('signup-confirm-password');
        const signupSubmit = document.getElementById('signup-submit');
        const authError = document.getElementById('auth-error');
        const authSuccess = document.getElementById('auth-success');
        
        const uploadModal = document.getElementById('upload-modal');
        const uploadModalClose = document.getElementById('upload-modal-close');
        const uploadArea = document.getElementById('upload-area');
        const videoFileInput = document.getElementById('video-file');
        const videoTitleInput = document.getElementById('video-title');
        const videoDescriptionInput = document.getElementById('video-description');
        const videoVisibilityInput = document.getElementById('video-visibility');
        const videoPriceInput = document.getElementById('video-price');
        const priceGroup = document.getElementById('price-group');
        const uploadStartBtn = document.getElementById('upload-start-btn');
        const uploadProgressContainer = document.getElementById('upload-progress-container');
        const processingContainer = document.getElementById('processing-container');
        const uploadProgressFill = document.getElementById('upload-progress-fill');
        const progressPercentage = document.getElementById('progress-percentage');
        const progressPercentageText = document.getElementById('progress-percentage-text');
        const uploadError = document.getElementById('upload-error');
        const uploadSuccess = document.getElementById('upload-success');
        
        const editVideoModal = document.getElementById('edit-video-modal');
        const editVideoModalClose = document.getElementById('edit-video-modal-close');
        const editVideoTitle = document.getElementById('edit-video-title');
        const editVideoDescription = document.getElementById('edit-video-description');
        const editVideoVisibility = document.getElementById('edit-video-visibility');
        const editVideoPrice = document.getElementById('edit-video-price');
        const editPriceGroup = document.getElementById('edit-price-group');
        const editVideoThumbnail = document.getElementById('edit-video-thumbnail');
        const editVideoUrl = document.getElementById('edit-video-url');
        const copyVideoUrlBtn = document.getElementById('copy-video-url');
        const editVideoSubmit = document.getElementById('edit-video-submit');
        const deleteVideoBtn = document.getElementById('delete-video-btn');
        const editVideoError = document.getElementById('edit-video-error');
        const editVideoSuccess = document.getElementById('edit-video-success');
        const premiumStats = document.getElementById('premium-stats');
        const totalPurchases = document.getElementById('total-purchases');
        const totalRevenue = document.getElementById('total-revenue');
        const creatorRevenue = document.getElementById('creator-revenue');
        
        const editChannelModal = document.getElementById('edit-channel-modal');
        const editChannelModalClose = document.getElementById('edit-channel-modal-close');
        const editChannelName = document.getElementById('edit-channel-name');
        const editChannelDescription = document.getElementById('edit-channel-description');
        const editChannelAvatar = document.getElementById('edit-channel-avatar');
        const editChannelBanner = document.getElementById('edit-channel-banner');
        const editChannelSubmit = document.getElementById('edit-channel-submit');
        const editChannelError = document.getElementById('edit-channel-error');
        const editChannelSuccess = document.getElementById('edit-channel-success');
        
        // Detail page elements
        const detailVideoTitle = document.getElementById('detail-video-title');
        const detailVideoDescription = document.getElementById('detail-video-description');
        const viewCount = document.getElementById('view-count');
        const uploadDate = document.getElementById('upload-date');
        const likeCount = document.getElementById('like-count');
        const dislikeCount = document.getElementById('dislike-count');
        const likeDislikeRatio = document.getElementById('like-dislike-ratio');
        const commentsCount = document.getElementById('comments-count');
        const detailChannelName = document.getElementById('detail-channel-name');
        const detailChannelSubs = document.getElementById('detail-channel-subs');
        const detailChannelAvatar = document.getElementById('detail-channel-avatar');
        const videoIdDisplay = document.getElementById('video-id');
        const videoSlugUrl = document.getElementById('video-slug-url');
        const adRevenueDisplay = document.getElementById('ad-revenue');
        const adNotice = document.getElementById('ad-notice');

        // Initialize the homepage with trending videos
        async function initHomepage() {
            try {
                videos = await loadPublicVideos();
                // Sort by trending algorithm (views + recency)
                videos.sort((a, b) => {
                    const aScore = (a.views || 0) * (1 / (1 + daysSince(a.timestamp)));
                    const bScore = (b.views || 0) * (1 / (1 + daysSince(b.timestamp)));
                    return bScore - aScore;
                });
                renderVideoGrid(videos);
            } catch (error) {
                console.error('Error loading videos:', error);
                videos = [];
                renderVideoGrid(videos);
            }
        }

        // Load public videos from Firestore
        async function loadPublicVideos() {
            try {
                const snapshot = await db.collection('videos')
                    .where('visibility', 'in', ['public', 'premium'])
                    .orderBy('timestamp', 'desc')
                    .limit(50)
                    .get();
                
                if (snapshot.empty) {
                    return [];
                }
                
                const videos = [];
                snapshot.forEach(doc => {
                    const video = doc.data();
                    video.id = doc.id;
                    videos.push(video);
                });
                
                return videos;
            } catch (error) {
                console.error('Error loading public videos:', error);
                return [];
            }
        }

        // Load user's videos for studio
        async function loadUserVideos() {
            if (!currentUser) return [];
            
            try {
                const snapshot = await db.collection('videos')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('timestamp', 'desc')
                    .get();
                
                if (snapshot.empty) {
                    return [];
                }
                
                const videos = [];
                snapshot.forEach(doc => {
                    const video = doc.data();
                    video.id = doc.id;
                    videos.push(video);
                });
                
                return videos;
            } catch (error) {
                console.error('Error loading user videos:', error);
                return [];
            }
        }

        // Load premium videos for studio
        async function loadPremiumVideos() {
            if (!currentUser) return [];
            
            try {
                const snapshot = await db.collection('videos')
                    .where('userId', '==', currentUser.uid)
                    .where('visibility', '==', 'premium')
                    .orderBy('timestamp', 'desc')
                    .get();
                
                if (snapshot.empty) {
                    return [];
                }
                
                const videos = [];
                snapshot.forEach(doc => {
                    const video = doc.data();
                    video.id = doc.id;
                    videos.push(video);
                });
                
                return videos;
            } catch (error) {
                console.error('Error loading premium videos:', error);
                return [];
            }
        }

        // Load user's purchases
        async function loadUserPurchases() {
            if (!currentUser) return [];
            
            try {
                const snapshot = await db.collection('purchases')
                    .where('userId', '==', currentUser.uid)
                    .get();
                
                const purchases = [];
                snapshot.forEach(doc => {
                    purchases.push(doc.data().videoId);
                });
                
                return purchases;
            } catch (error) {
                console.error('Error loading user purchases:', error);
                return [];
            }
        }

        // Check if user has purchased a video
        function hasUserPurchased(videoId) {
            return userPurchases.includes(videoId);
        }

        // Load channel data
        async function loadChannelData(userId) {
            try {
                const channelDoc = await db.collection('channels').doc(userId).get();
                if (channelDoc.exists) {
                    const channelData = channelDoc.data();
                    
                    // Auto-verify if 10k+ subscribers
                    if (channelData.subscribers >= 10000 && !channelData.verified) {
                        await db.collection('channels').doc(userId).update({
                            verified: true,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        channelData.verified = true;
                    }
                    
                    return channelData;
                } else {
                    // Create default channel
                    const defaultChannel = {
                        name: currentUser.displayName || currentUser.email.split('@')[0],
                        description: 'Welcome to my channel!',
                        subscribers: 0,
                        totalViews: 0,
                        totalVideos: 0,
                        earnings: 0,
                        premiumEarnings: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        bannerImage: null,
                        profileImage: null,
                        verified: false
                    };
                    await db.collection('channels').doc(userId).set(defaultChannel);
                    return defaultChannel;
                }
            } catch (error) {
                console.error('Error loading channel:', error);
                return null;
            }
        }

        // Update channel stats
        async function updateChannelStats() {
            if (!currentUser) return;
            
            const videos = await loadUserVideos();
            const premiumVideos = await loadPremiumVideos();
            const channelData = await loadChannelData(currentUser.uid);
            
            if (channelData) {
                // Calculate totals
                let totalViews = 0;
                let totalLikes = 0;
                let totalComments = 0;
                let totalPremiumRevenue = 0;
                let totalPremiumPurchases = 0;
                
                videos.forEach(video => {
                    totalViews += video.views || 0;
                    totalLikes += video.likes || 0;
                    totalComments += video.comments || 0;
                    
                    if (video.visibility === 'premium') {
                        totalPremiumPurchases += video.purchases || 0;
                        totalPremiumRevenue += (video.purchases || 0) * (video.price || 0);
                    }
                });
                
                // Update channel in database
                await db.collection('channels').doc(currentUser.uid).update({
                    totalViews: totalViews,
                    totalVideos: videos.length,
                    premiumEarnings: totalPremiumRevenue * 0.8, // 80% for creator
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update UI
                studioChannelName.textContent = channelData.name;
                if (channelData.verified) {
                    studioChannelName.innerHTML = `${channelData.name} <i class="fas fa-check-circle" style="color: var(--primary-blue);"></i>`;
                }
                studioChannelSubs.textContent = `${channelData.subscribers || 0} subscribers`;
                studioChannelVideos.textContent = `${videos.length} videos`;
                studioChannelDescription.textContent = channelData.description || 'No description yet';
                studioChannelAvatar.textContent = channelData.name.charAt(0).toUpperCase();
                
                // Set profile image if exists
                if (channelData.profileImage) {
                    studioChannelAvatar.style.backgroundImage = `url(${channelData.profileImage})`;
                    studioChannelAvatar.style.backgroundSize = 'cover';
                    studioChannelAvatar.textContent = '';
                }
                
                totalVideosStat.textContent = videos.length;
                totalViewsStat.textContent = formatNumber(totalViews);
                totalSubsStat.textContent = channelData.subscribers || 0;
                
                // Calculate total earnings (ads + premium)
                const totalEarnings = (channelData.earnings || 0) + (channelData.premiumEarnings || 0);
                totalEarningsStat.textContent = `$${totalEarnings.toFixed(2)}`;
                
                channelTotalViews.textContent = formatNumber(totalViews);
                channelSubsGrowth.textContent = '0%';
                channelEngagement.textContent = videos.length > 0 ? `${Math.round((totalLikes / totalViews) * 100) || 0}%` : '0%';
                
                // Calculate average watch time
                if (videos.length > 0) {
                    const totalDuration = videos.reduce((sum, video) => sum + (video.duration || 0), 0);
                    const avgDuration = totalDuration / videos.length;
                    channelAvgWatchTime.textContent = formatDuration(avgDuration);
                } else {
                    channelAvgWatchTime.textContent = '0:00';
                }
                
                // Calculate earnings
                const earnings = channelData.earnings || 0;
                const premiumEarnings = channelData.premiumEarnings || 0;
                totalEarningsTab.textContent = `$${totalEarnings.toFixed(2)}`;
                monthlyEarnings.textContent = `$${(totalEarnings / 12).toFixed(2)}`;
                estimatedMonthly.textContent = `$${totalEarnings.toFixed(2)}`;
                
                // Update premium stats
                premiumVideosCount.textContent = premiumVideos.length;
                totalPremiumSales.textContent = totalPremiumPurchases;
                premiumRevenue.textContent = `$${totalPremiumRevenue.toFixed(2)}`;
                conversionRate.textContent = totalViews > 0 ? `${Math.round((totalPremiumPurchases / totalViews) * 100)}%` : '0%';
            }
        }

        // Generate slug from title
        function generateSlug(title) {
            return title
                .toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/--+/g, '-')
                .trim();
        }

        // Generate video URL
        function generateVideoUrl(videoId, title) {
            const slug = generateSlug(title);
            return `https://haitiantube.icu/watch/${videoId}/${slug}`;
        }

        // Generate thumbnail from video (simulated)
        function generateThumbnail(videoId) {
            const colors = ['0d6efd', '198754', 'dc3545', 'ffc107', '0dcaf0', '6f42c1'];
            const colorIndex = parseInt(videoId) % colors.length;
            const color = colors[colorIndex];
            
            return `https://via.placeholder.com/1280x720/${color}/ffffff?text=HaitianTube`;
        }

        // Calculate ad placements based on video duration
        function calculateAdPlacements(videoDurationSeconds) {
            const placements = [0]; // Always pre-roll
            
            if (videoDurationSeconds <= 60) {
                return placements;
            }
            
            if (videoDurationSeconds <= 300) {
                const midRollCount = Math.min(2, Math.floor(videoDurationSeconds / 60));
                for (let i = 1; i <= midRollCount; i++) {
                    placements.push(Math.floor((i / (midRollCount + 1)) * videoDurationSeconds));
                }
                return placements;
            }
            
            const midRollCount = Math.min(6, Math.floor(videoDurationSeconds / 60));
            for (let i = 1; i <= midRollCount; i++) {
                placements.push(Math.floor((i / (midRollCount + 1)) * videoDurationSeconds));
            }
            
            return placements.slice(0, 7);
        }

        // Get CrackRevenue VAST tag
        function getCrackRevenueVastTag(position = 'pre') {
            const tags = {
                pre: 'https://pubads.g.doubleclick.net/gampad/ads?iu=/21775744923/external/single_ad_samples&sz=640x480&cust_params=sample_ar%3Dpreonly&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&correlator=',
                mid: 'https://pubads.g.doubleclick.net/gampad/ads?iu=/21775744923/external/single_ad_samples&sz=640x480&cust_params=sample_ar%3Dmidroll&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&correlator=',
                post: 'https://pubads.g.doubleclick.net/gampad/ads?iu=/21775744923/external/single_ad_samples&sz=640x480&cust_params=sample_ar%3Dpostonly&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&correlator='
            };
            
            return tags[position] || tags.pre;
        }

        // Initialize Video.js player with CrackRevenue VAST ads
        function initVideoPlayer(videoUrl, title, videoId, videoDuration, isPremium = false) {
            // Destroy existing player if it exists
            if (player) {
                player.dispose();
                clearInterval(watchTimeInterval);
            }
            
            // Reset ad tracking
            playedAds = [];
            adRevenue = 0;
            adImpressions = 0;
            
            // Create new player
            player = videojs('video-player', {
                controls: true,
                autoplay: false,
                preload: 'auto',
                fluid: true,
                playbackRates: [0.5, 1, 1.5, 2],
                controlBar: {
                    children: [
                        'playToggle',
                        'volumePanel',
                        'currentTimeDisplay',
                        'timeDivider',
                        'durationDisplay',
                        'progressControl',
                        'remainingTimeDisplay',
                        'playbackRateMenuButton',
                        'fullscreenToggle'
                    ]
                }
            });
            
            // Set video source
            player.src({
                src: videoUrl,
                type: 'video/mp4'
            });
            
            // Set poster image
            const currentVideo = videos.find(v => v.id === videoId);
            if (currentVideo && currentVideo.thumbnail) {
                player.poster(currentVideo.thumbnail);
            }
            
            // Configure VAST plugin for CrackRevenue ads (only for non-premium videos)
            if (!isPremium) {
                player.vastClient({
                    adTagUrl: getCrackRevenueVastTag('pre'),
                    playAdAlways: true,
                    adCancelTimeout: 5000,
                    adsEnabled: true
                });
                
                adNotice.style.display = 'block';
            } else {
                adNotice.style.display = 'none';
            }
            
            // Set title for accessibility
            player.el().setAttribute('aria-label', `Video player: ${title}`);
            
            // Calculate mid-roll ad placements (only for non-premium videos)
            if (!isPremium) {
                const midRollPlacements = calculateAdPlacements(videoDuration).slice(1);
                
                // Track when video reaches mid-roll points
                player.on('timeupdate', function() {
                    const currentTime = player.currentTime();
                    
                    // Check if we're at a mid-roll ad placement
                    midRollPlacements.forEach((adTime, index) => {
                        if (Math.abs(currentTime - adTime) < 1 && !playedAds[index]) {
                            // Trigger mid-roll ad
                            player.vastClient({
                                adTagUrl: getCrackRevenueVastTag('mid'),
                                playAdAlways: true
                            });
                            
                            playedAds[index] = true;
                            
                            // Record ad impression
                            recordAdImpression(videoId, adTime, 'mid-roll');
                        }
                    });
                });
                
                // Track ad events
                player.on('vast.adStart', function() {
                    adImpressions++;
                    // Calculate ad revenue (varies by ad type)
                    const revenue = calculateAdRevenue();
                    adRevenue += revenue;
                    updateAdRevenueDisplay();
                    
                    // Update creator's earnings
                    updateCreatorEarnings(videoId, revenue);
                });
                
                player.on('vast.adEnd', function() {
                    console.log('Ad ended');
                });
            }
            
            // Track watch time
            player.on('play', () => {
                videoStartTime = Date.now();
                watchTimeInterval = setInterval(updateWatchTime, 1000);
                
                // Record view
                recordView(videoId);
            });
            
            player.on('pause', () => {
                if (videoStartTime) {
                    totalWatchTime += (Date.now() - videoStartTime) / 1000;
                    videoStartTime = null;
                    clearInterval(watchTimeInterval);
                }
            });
            
            player.on('ended', () => {
                if (videoStartTime) {
                    totalWatchTime += (Date.now() - videoStartTime) / 1000;
                    videoStartTime = null;
                    clearInterval(watchTimeInterval);
                }
                
                // Save watch time to database
                saveWatchTime(videoId, totalWatchTime);
                
                // Play post-roll ad (only for non-premium videos)
                if (!isPremium) {
                    player.vastClient({
                        adTagUrl: getCrackRevenueVastTag('post'),
                        playAdAlways: true
                    });
                }
            });
        }

        // Calculate ad revenue (simulated based on CPM)
        function calculateAdRevenue() {
            const baseCPM = 5.00;
            return baseCPM / 1000;
        }

        // Record ad impression
        async function recordAdImpression(videoId, adTime, adType) {
            try {
                await db.collection('adImpressions').add({
                    videoId: videoId,
                    time: adTime,
                    type: adType,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    revenue: calculateAdRevenue()
                });
            } catch (error) {
                console.error('Error recording ad impression:', error);
            }
        }

        // Update creator's earnings
        async function updateCreatorEarnings(videoId, amount) {
            try {
                const videoDoc = await db.collection('videos').doc(videoId).get();
                if (!videoDoc.exists) return;
                
                const videoData = videoDoc.data();
                const creatorId = videoData.userId;
                
                if (!creatorId) return;
                
                // Update creator's earnings
                await db.collection('channels').doc(creatorId).update({
                    earnings: firebase.firestore.FieldValue.increment(amount),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
            } catch (error) {
                console.error('Error updating creator earnings:', error);
            }
        }

        // Update ad revenue display
        function updateAdRevenueDisplay() {
            adRevenueDisplay.textContent = `Ad Revenue: $${adRevenue.toFixed(2)}`;
        }

        // Upload video with progress - FIXED WORKING VERSION
        async function uploadVideoWithProgress(videoFile, title, description, visibility, price = 10.99) {
            if (!currentUser) {
                showError(uploadError, 'You must be signed in to upload videos');
                return null;
            }
            
            try {
                // Generate unique ID and slug
                const videoId = Date.now().toString();
                const slug = generateSlug(title);
                const videoPath = `videos/${currentUser.uid}/${videoId}/${videoFile.name}`;
                
                // Get channel data
                const channelData = await loadChannelData(currentUser.uid);
                const channelName = channelData ? channelData.name : (currentUser.displayName || currentUser.email.split('@')[0]);
                
                // Generate thumbnail
                const thumbnailUrl = generateThumbnail(videoId);
                
                // Show progress container
                document.getElementById('upload-step-1').style.display = 'none';
                uploadProgressContainer.style.display = 'block';
                
                // Start upload
                const videoRef = storage.ref(videoPath);
                const videoUploadTask = videoRef.put(videoFile);
                
                // Create a promise that resolves when upload is complete
                return new Promise((resolve, reject) => {
                    videoUploadTask.on('state_changed',
                        (snapshot) => {
                            // Update progress - REAL PROGRESS
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            const roundedProgress = Math.round(progress);
                            updateUploadProgress(roundedProgress, 'upload');
                            
                            // Update UI
                            progressPercentage.textContent = `${roundedProgress}%`;
                            progressPercentageText.textContent = `${roundedProgress}%`;
                            uploadProgressFill.style.width = `${roundedProgress}%`;
                        },
                        (error) => {
                            console.error('Upload error:', error);
                            showError(uploadError, 'Upload failed: ' + error.message);
                            resetUploadUI();
                            reject(error);
                        },
                        async () => {
                            // Upload complete - update progress to 100%
                            updateUploadProgress(100, 'upload');
                            
                            // Get download URL
                            const videoUrl = await videoUploadTask.snapshot.ref.getDownloadURL();
                            
                            // Process video
                            await processVideo(videoId, videoUrl, {
                                title,
                                description,
                                thumbnailUrl,
                                channelName,
                                visibility,
                                slug,
                                price: visibility === 'premium' ? parseFloat(price) : 0
                            });
                            
                            resolve(videoId);
                        }
                    );
                });
                
            } catch (error) {
                console.error('Upload error:', error);
                showError(uploadError, 'Failed to upload: ' + error.message);
                resetUploadUI();
                return null;
            }
        }

        // Process video after upload
        async function processVideo(videoId, videoUrl, videoData) {
            try {
                // Switch to processing view
                uploadProgressContainer.style.display = 'none';
                processingContainer.style.display = 'block';
                
                // Start processing animation
                let progress = 100;
                const steps = processingContainer.querySelectorAll('#processing-steps p');
                
                // Animate through processing steps
                for (let i = 0; i < steps.length; i++) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Update step icon
                    const stepIcon = steps[i].querySelector('i');
                    stepIcon.className = 'fas fa-check';
                    stepIcon.style.color = 'var(--success)';
                    
                    // Update progress
                    progress += 25;
                    updateUploadProgress(Math.min(progress, 100), 'process');
                    
                    if (i === steps.length - 1) {
                        // All steps complete
                        updateUploadProgress(100, 'publish');
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                        // Create video document
                        await createVideoDocument(videoId, videoUrl, videoData);
                        
                        // Show success
                        showSuccess(uploadSuccess, 'Video published successfully!');
                        
                        // Add to local videos array
                        const newVideo = {
                            id: videoId,
                            title: videoData.title,
                            description: videoData.description,
                            thumbnail: videoData.thumbnailUrl,
                            videoUrl: videoUrl,
                            channel: videoData.channelName,
                            views: 0,
                            likes: 0,
                            dislikes: 0,
                            comments: 0,
                            userId: currentUser.uid,
                            visibility: videoData.visibility,
                            price: videoData.price || 0,
                            purchases: 0,
                            timestamp: new Date(),
                            duration: 300,
                            slug: videoData.slug,
                            monetized: videoData.visibility !== 'premium'
                        };
                        
                        videos.unshift(newVideo);
                        
                        // Redirect to video after 3 seconds
                        setTimeout(() => {
                            uploadModal.classList.remove('show');
                            processingContainer.style.display = 'none';
                            uploadSuccess.style.display = 'none';
                            resetUploadUI();
                            openVideoDetail(videoId);
                        }, 3000);
                    }
                }
            } catch (error) {
                console.error('Error processing video:', error);
                showError(uploadError, 'Failed to process video: ' + error.message);
            }
        }

        // Update upload progress
        function updateUploadProgress(progress, stage) {
            const progressValue = Math.round(progress);
            
            // Update progress bar
            uploadProgressFill.style.width = `${progressValue}%`;
            progressPercentage.textContent = `${progressValue}%`;
            progressPercentageText.textContent = `${progressValue}%`;
            
            // Update stages
            const stages = ['upload', 'process', 'publish'];
            stages.forEach((s, index) => {
                const stageElement = document.getElementById(`stage-${s}`);
                if (s === stage) {
                    stageElement.classList.add('active');
                    stageElement.classList.remove('completed');
                } else if (stages.indexOf(stage) > index) {
                    stageElement.classList.remove('active');
                    stageElement.classList.add('completed');
                } else {
                    stageElement.classList.remove('active', 'completed');
                }
            });
        }

        // Create video document in Firestore
        async function createVideoDocument(videoId, videoUrl, videoData) {
            const videoDuration = 300;
            
            const videoDoc = {
                title: videoData.title,
                description: videoData.description,
                thumbnail: videoData.thumbnailUrl,
                videoUrl: videoUrl,
                channel: videoData.channelName,
                channelId: currentUser.uid,
                views: 0,
                likes: 0,
                dislikes: 0,
                comments: 0,
                userId: currentUser.uid,
                visibility: videoData.visibility,
                price: videoData.price || 0,
                purchases: 0,
                duration: videoDuration,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                totalWatchTime: 0,
                avgWatchTime: 0,
                monetized: videoData.visibility !== 'premium',
                slug: videoData.slug,
                adPlacements: calculateAdPlacements(videoDuration),
                url: generateVideoUrl(videoId, videoData.title)
            };
            
            await db.collection('videos').doc(videoId).set(videoDoc);
            
            // Update channel video count
            await db.collection('channels').doc(currentUser.uid).update({
                totalVideos: firebase.firestore.FieldValue.increment(1),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        }

        // Reset upload UI
        function resetUploadUI() {
            document.getElementById('upload-step-1').style.display = 'block';
            uploadProgressContainer.style.display = 'none';
            processingContainer.style.display = 'none';
            
            // Reset form
            videoTitleInput.value = '';
            videoDescriptionInput.value = '';
            videoFileInput.value = '';
            videoPriceInput.value = '10.99';
            selectedVideoFile = null;
            priceGroup.style.display = 'none';
            
            // Reset progress
            uploadProgressFill.style.width = '0%';
            progressPercentage.textContent = '0%';
            progressPercentageText.textContent = '0%';
            
            // Reset stages
            ['upload', 'process', 'publish'].forEach(stage => {
                const stageElement = document.getElementById(`stage-${stage}`);
                stageElement.classList.remove('active', 'completed');
            });
            
            // Reset processing steps
            const steps = processingContainer.querySelectorAll('#processing-steps p i');
            steps.forEach((icon, index) => {
                icon.className = 'fas fa-spinner';
                icon.style.color = '';
            });
            
            // Reset upload area
            uploadArea.innerHTML = `
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>Select a video file</h3>
                <p>Drag and drop or click to browse</p>
                <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                    MP4, WebM, or OGG up to 2GB
                </p>
            `;
        }

        // Record a view for a video
        async function recordView(videoId) {
            try {
                const videoRef = db.collection('videos').doc(videoId);
                await db.runTransaction(async (transaction) => {
                    const videoDoc = await transaction.get(videoRef);
                    if (!videoDoc.exists) return;
                    
                    const videoData = videoDoc.data();
                    const newViews = (videoData.views || 0) + 1;
                    
                    transaction.update(videoRef, {
                        views: newViews,
                        lastViewed: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Update channel views
                    if (videoData.userId) {
                        const channelRef = db.collection('channels').doc(videoData.userId);
                        const channelDoc = await transaction.get(channelRef);
                        if (channelDoc.exists) {
                            const channelData = channelDoc.data();
                            transaction.update(channelRef, {
                                totalViews: (channelData.totalViews || 0) + 1
                            });
                        }
                    }
                });
                
                // Update local data
                const videoIndex = videos.findIndex(v => v.id === videoId);
                if (videoIndex !== -1) {
                    videos[videoIndex].views = (videos[videoIndex].views || 0) + 1;
                }
                
                // Update UI
                if (currentVideoId === videoId) {
                    viewCount.textContent = `${formatNumber(videos[videoIndex].views)} views`;
                }
            } catch (error) {
                console.error('Error recording view:', error);
            }
        }

        // Save watch time
        async function saveWatchTime(videoId, watchTime) {
            try {
                await db.collection('watchTimes').add({
                    videoId: videoId,
                    userId: currentUser ? currentUser.uid : null,
                    watchTime: watchTime,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update video's total watch time
                const videoRef = db.collection('videos').doc(videoId);
                await db.runTransaction(async (transaction) => {
                    const videoDoc = await transaction.get(videoRef);
                    if (!videoDoc.exists) return;
                    
                    const videoData = videoDoc.data();
                    const totalWatchTime = (videoData.totalWatchTime || 0) + watchTime;
                    
                    transaction.update(videoRef, {
                        totalWatchTime: totalWatchTime,
                        avgWatchTime: totalWatchTime / (videoData.views || 1)
                    });
                });
            } catch (error) {
                console.error('Error saving watch time:', error);
            }
        }

        // Open video detail page
        async function openVideoDetail(videoId) {
            const video = videos.find(v => v.id === videoId);
            if (!video) return;
            
            currentVideoId = videoId;
            
            // Hide homepage and studio, show video detail
            homepage.style.display = 'none';
            studioDashboard.style.display = 'none';
            videoDetail.style.display = 'block';
            
            // Check if video is premium and if user has access
            const isPremium = video.visibility === 'premium';
            const hasAccess = !isPremium || (currentUser && hasUserPurchased(videoId));
            
            // Show/hide payment lock
            if (isPremium && !hasAccess) {
                paymentLock.style.display = 'block';
                lockPrice.textContent = `$${video.price || 10.99}`;
            } else {
                paymentLock.style.display = 'none';
            }
            
            // Initialize Video.js player
            initVideoPlayer(video.videoUrl, video.title, videoId, video.duration || 300, isPremium);
            
            // Update video details
            detailVideoTitle.textContent = video.title;
            if (isPremium) {
                detailVideoTitle.innerHTML = `${video.title} <span class="premium-badge"><i class="fas fa-crown"></i> PREMIUM</span>`;
            }
            detailVideoDescription.textContent = video.description || 'No description';
            viewCount.textContent = `${formatNumber(video.views || 0)} views`;
            uploadDate.textContent = formatTimeAgo(video.timestamp?.toDate() || new Date());
            likeCount.textContent = formatNumber(video.likes || 0);
            dislikeCount.textContent = formatNumber(video.dislikes || 0);
            commentsCount.textContent = `Comments (${video.comments || 0})`;
            videoIdDisplay.textContent = videoId;
            videoSlugUrl.textContent = video.url || generateVideoUrl(videoId, video.title);
            
            // Calculate like/dislike ratio
            const totalInteractions = (video.likes || 0) + (video.dislikes || 0);
            const likeRatio = totalInteractions > 0 ? Math.round((video.likes / totalInteractions) * 100) : 0;
            likeDislikeRatio.textContent = `${likeRatio}% liked this video`;
            
            // Load channel info
            const channelData = await loadChannelData(video.userId);
            if (channelData) {
                detailChannelName.textContent = channelData.name;
                if (channelData.verified) {
                    detailChannelName.innerHTML += ' <i class="fas fa-check-circle verified-badge"></i>';
                }
                detailChannelSubs.textContent = `${formatNumber(channelData.subscribers || 0)} subscribers`;
                detailChannelAvatar.textContent = channelData.name.charAt(0).toUpperCase();
                
                // Set profile image if exists
                if (channelData.profileImage) {
                    detailChannelAvatar.style.backgroundImage = `url(${channelData.profileImage})`;
                    detailChannelAvatar.style.backgroundSize = 'cover';
                    detailChannelAvatar.textContent = '';
                }
            }
            
            // Update comment form avatar
            const commentUserAvatar = document.getElementById('comment-user-avatar');
            if (currentUser) {
                commentUserAvatar.textContent = currentUser.displayName ? currentUser.displayName.charAt(0).toUpperCase() : 'U';
            } else {
                commentUserAvatar.textContent = 'Y';
            }
            
            // Reset ad revenue for this session
            adRevenue = 0;
            adImpressions = 0;
            updateAdRevenueDisplay();
            
            // Load comments
            loadComments(videoId);
            
            // Load related videos
            loadRelatedVideos(videoId);
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            // Update URL
            const slug = video.slug || generateSlug(video.title);
            history.pushState({videoId: videoId}, '', `/watch/${videoId}/${slug}`);
        }

        // Load related videos
        async function loadRelatedVideos(currentVideoId) {
            relatedVideos.innerHTML = '';
            
            const currentVideo = videos.find(v => v.id === currentVideoId);
            if (!currentVideo) return;
            
            // Filter videos from same channel and other public videos
            const filteredVideos = videos.filter(v => 
                v.id !== currentVideoId && 
                v.visibility !== 'private'
            );
            
            // Sort by relevance (same channel first, then views)
            filteredVideos.sort((a, b) => {
                const aScore = (a.userId === currentVideo.userId ? 100 : 0) + (a.views || 0);
                const bScore = (b.userId === currentVideo.userId ? 100 : 0) + (b.views || 0);
                return bScore - aScore;
            });
            
            const shuffled = filteredVideos.slice(0, 5);
            
            shuffled.forEach(video => {
                const relatedVideo = document.createElement('div');
                relatedVideo.className = 'related-video';
                relatedVideo.dataset.id = video.id;
                
                const premiumBadge = video.visibility === 'premium' ? 
                    '<span class="premium-badge" style="font-size: 10px;"><i class="fas fa-crown"></i> PREMIUM</span>' : '';
                
                relatedVideo.innerHTML = `
                    <div style="position: relative;">
                        <img src="${video.thumbnail || generateThumbnail(video.id)}" 
                             alt="${video.title}" class="related-thumbnail">
                        ${video.visibility === 'premium' ? '<div class="premium-overlay"><i class="fas fa-lock"></i></div>' : ''}
                    </div>
                    <div class="related-video-info">
                        <h4>${video.title} ${premiumBadge}</h4>
                        <p>${video.channel}</p>
                        <p>${formatNumber(video.views || 0)} views • ${formatTimeAgo(video.timestamp?.toDate() || new Date())}</p>
                    </div>
                `;
                
                relatedVideo.addEventListener('click', () => openVideoDetail(video.id));
                relatedVideos.appendChild(relatedVideo);
            });
        }

        // Load comments
        async function loadComments(videoId) {
            commentsList.innerHTML = '';
            
            try {
                const snapshot = await db.collection('comments')
                    .where('videoId', '==', videoId)
                    .orderBy('timestamp', 'desc')
                    .limit(50)
                    .get();
                
                if (snapshot.empty) {
                    commentsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No comments yet. Be the first to comment!</p>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const comment = doc.data();
                    comment.id = doc.id;
                    
                    const commentElement = document.createElement('div');
                    commentElement.className = 'comment';
                    commentElement.dataset.id = comment.id;
                    
                    commentElement.innerHTML = `
                        <div class="comment-avatar">${comment.authorName ? comment.authorName.charAt(0).toUpperCase() : 'U'}</div>
                        <div class="comment-content">
                            <h4>${comment.authorName || 'Anonymous'}</h4>
                            <p>${comment.text}</p>
                            <div class="comment-time">${formatTimeAgo(comment.timestamp?.toDate() || new Date())}</div>
                            <div class="comment-actions">
                                <div class="comment-action">
                                    <i class="fas fa-thumbs-up"></i>
                                    <span>${comment.likes || 0}</span>
                                </div>
                                <div class="comment-action">
                                    <i class="fas fa-thumbs-down"></i>
                                </div>
                                <div class="comment-action">
                                    Reply
                                </div>
                            </div>
                        </div>
                    `;
                    
                    commentsList.appendChild(commentElement);
                });
            } catch (error) {
                console.error('Error loading comments:', error);
                commentsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Error loading comments.</p>';
            }
        }

        // Render video grid
        function renderVideoGrid(videosToRender) {
            videoGrid.innerHTML = '';
            
            if (videosToRender.length === 0) {
                videoGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        <i class="fas fa-video-slash" style="font-size: 48px; color: var(--text-secondary); margin-bottom: 16px;"></i>
                        <h3>No videos found</h3>
                        <p>Be the first to upload a video!</p>
                    </div>
                `;
                return;
            }
            
            videosToRender.forEach(video => {
                const videoCard = document.createElement('div');
                videoCard.className = 'video-card';
                videoCard.dataset.id = video.id;
                
                const visibilityBadge = video.visibility === 'private' ? 
                    '<span class="visibility-badge visibility-private">Private</span>' :
                    video.visibility === 'premium' ?
                    '<span class="premium-badge"><i class="fas fa-crown"></i> PREMIUM</span>' : '';
                
                const premiumOverlay = video.visibility === 'premium' ? 
                    '<div class="premium-overlay"><i class="fas fa-lock"></i> Premium</div>' +
                    '<div class="premium-thumbnail-overlay"><i class="fas fa-crown"></i></div>' : '';
                
                videoCard.innerHTML = `
                    <div class="thumbnail-container">
                        ${premiumOverlay}
                        <img src="${video.thumbnail || generateThumbnail(video.id)}" 
                             alt="${video.title}" class="thumbnail">
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">${video.title} ${visibilityBadge}</h3>
                        <p class="video-channel">${video.channel}</p>
                        <div class="video-meta">
                            <span>${formatNumber(video.views || 0)} views</span>
                            <span>•</span>
                            <span>${formatTimeAgo(video.timestamp?.toDate() || new Date())}</span>
                            ${video.visibility === 'premium' ? '<span>•</span><span><i class="fas fa-dollar-sign"></i> ' + (video.price || 10.99) + '</span>' : ''}
                        </div>
                    </div>
                `;
                
                videoCard.addEventListener('click', () => openVideoDetail(video.id));
                videoGrid.appendChild(videoCard);
            });
        }

        // Update UI based on auth state
        async function updateUI(user) {
            currentUser = user;
            
            if (user) {
                // User is signed in
                signinBtn.style.display = 'none';
                userMenuContainer.style.display = 'block';
                uploadBtn.style.display = 'flex';
                studioBtn.style.display = 'flex';
                
                // Update user info
                const displayName = user.displayName || user.email.split('@')[0];
                userName.textContent = displayName;
                userAvatar.textContent = displayName.charAt(0).toUpperCase();
                studioUsername.textContent = displayName;
                
                // Load user purchases
                userPurchases = await loadUserPurchases();
                
                // Load channel data
                await updateChannelStats();
                
                // Close auth modal if open
                authModal.classList.remove('show');
            } else {
                // User is signed out
                signinBtn.style.display = 'flex';
                userMenuContainer.style.display = 'none';
                uploadBtn.style.display = 'none';
                studioBtn.style.display = 'none';
                
                // If in studio, go to homepage
                if (studioDashboard.style.display === 'block') {
                    showHomepage();
                }
            }
            
            // Close user menu
            userMenu.classList.remove('show');
        }

        // Show homepage
        function showHomepage() {
            homepage.style.display = 'block';
            videoDetail.style.display = 'none';
            studioDashboard.style.display = 'none';
            
            if (player) {
                player.pause();
                clearInterval(watchTimeInterval);
            }
            
            history.pushState({}, '', '/');
        }

        // Show studio
        async function showStudio() {
            if (!currentUser) {
                authModal.classList.add('show');
                return;
            }
            
            homepage.style.display = 'none';
            videoDetail.style.display = 'none';
            studioDashboard.style.display = 'block';
            
            if (player) {
                player.pause();
                clearInterval(watchTimeInterval);
            }
            
            // Load studio data
            await loadStudioData();
            
            history.pushState({}, '', '/studio');
        }

        // Load studio data
        async function loadStudioData() {
            if (!currentUser) return;
            
            // Load user videos
            const userVideos = await loadUserVideos();
            premiumVideos = await loadPremiumVideos();
            
            // Update dashboard
            updateDashboard(userVideos);
            
            // Update videos table
            updateVideosTable(userVideos);
            
            // Update premium videos table
            updatePremiumVideosTable(premiumVideos);
            
            // Update analytics
            updateAnalytics(userVideos);
            
            // Update channel info
            await updateChannelStats();
        }

        // Update dashboard
        function updateDashboard(userVideos) {
            // Update recent videos list
            recentVideosList.innerHTML = '';
            const recentVideos = userVideos.slice(0, 5);
            
            if (recentVideos.length === 0) {
                recentVideosList.innerHTML = '<p style="color: var(--text-secondary);">No videos yet. Upload your first video!</p>';
                return;
            }
            
            recentVideos.forEach(video => {
                const videoItem = document.createElement('div');
                videoItem.className = 'related-video';
                videoItem.style.marginBottom = '12px';
                videoItem.dataset.id = video.id;
                
                const visibilityBadge = video.visibility === 'private' ? 
                    '<span class="visibility-badge visibility-private" style="font-size: 10px;">Private</span>' : 
                    video.visibility === 'premium' ?
                    '<span class="premium-badge" style="font-size: 10px;"><i class="fas fa-crown"></i> PREMIUM</span>' :
                    '<span class="visibility-badge visibility-public" style="font-size: 10px;">Public</span>';
                
                videoItem.innerHTML = `
                    <img src="${video.thumbnail || generateThumbnail(video.id)}" 
                         alt="${video.title}" class="related-thumbnail">
                    <div class="related-video-info">
                        <h4>${video.title} ${visibilityBadge}</h4>
                        <p>${formatNumber(video.views || 0)} views • ${formatTimeAgo(video.timestamp?.toDate() || new Date())}</p>
                    </div>
                `;
                
                videoItem.addEventListener('click', () => openVideoDetail(video.id));
                recentVideosList.appendChild(videoItem);
            });
        }

        // Update videos table
        function updateVideosTable(userVideos) {
            videosTableBody.innerHTML = '';
            
            if (userVideos.length === 0) {
                videosTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="fas fa-video-slash" style="font-size: 48px; margin-bottom: 16px; display: block;"></i>
                            <h4>No videos yet</h4>
                            <p>Upload your first video to get started!</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            userVideos.forEach(video => {
                const row = document.createElement('tr');
                row.className = 'video-row';
                row.dataset.id = video.id;
                
                let visibilityText, visibilityClass;
                if (video.visibility === 'public') {
                    visibilityText = 'Public';
                    visibilityClass = 'visibility-public';
                } else if (video.visibility === 'private') {
                    visibilityText = 'Private';
                    visibilityClass = 'visibility-private';
                } else if (video.visibility === 'premium') {
                    visibilityText = 'Premium';
                    visibilityClass = 'premium-badge';
                }
                
                row.innerHTML = `
                    <td class="video-thumbnail-cell">
                        <img src="${video.thumbnail || generateThumbnail(video.id)}" 
                             alt="${video.title}" class="video-thumbnail-small">
                    </td>
                    <td class="video-title-cell">
                        <div class="video-title-small">${video.title}</div>
                        <div class="video-meta-small">
                            <span class="${visibilityClass}">${visibilityText}</span>
                            ${video.visibility === 'premium' ? `<br><small>$${video.price || 10.99}</small>` : ''}
                        </div>
                    </td>
                    <td>${formatNumber(video.views || 0)}</td>
                    <td>${formatNumber(video.likes || 0)}</td>
                    <td>${video.comments || 0}</td>
                    <td>${formatTimeAgo(video.timestamp?.toDate() || new Date())}</td>
                    <td class="video-actions-cell">
                        <div class="action-buttons">
                            <button class="action-btn edit" data-action="edit">
                                <i class="fas fa-edit"></i>
                                Edit
                            </button>
                            <button class="action-btn delete" data-action="delete">
                                <i class="fas fa-trash"></i>
                                Delete
                            </button>
                        </div>
                    </td>
                `;
                
                videosTableBody.appendChild(row);
            });
        }

        // Update premium videos table
        function updatePremiumVideosTable(premiumVideos) {
            premiumVideosBody.innerHTML = '';
            
            if (premiumVideos.length === 0) {
                premiumVideosBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="fas fa-crown" style="font-size: 48px; margin-bottom: 16px; display: block; color: var(--premium);"></i>
                            <h4>No premium videos yet</h4>
                            <p>Upload a premium video to start earning directly from your content!</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            premiumVideos.forEach(video => {
                const row = document.createElement('tr');
                row.className = 'video-row';
                row.dataset.id = video.id;
                
                const creatorShare = ((video.purchases || 0) * (video.price || 10.99)) * 0.8;
                
                row.innerHTML = `
                    <td class="video-title-cell">
                        <div class="video-title-small">${video.title}</div>
                    </td>
                    <td>$${video.price || 10.99}</td>
                    <td>${video.purchases || 0}</td>
                    <td>$${((video.purchases || 0) * (video.price || 10.99)).toFixed(2)}</td>
                    <td>$${creatorShare.toFixed(2)}</td>
                    <td class="video-actions-cell">
                        <div class="action-buttons">
                            <button class="action-btn edit" data-action="edit">
                                <i class="fas fa-edit"></i>
                                Edit
                            </button>
                        </div>
                    </td>
                `;
                
                premiumVideosBody.appendChild(row);
            });
        }

        // Update analytics
        function updateAnalytics(userVideos) {
            // Destroy existing charts
            if (viewsChart) viewsChart.destroy();
            if (watchTimeChart) watchTimeChart.destroy();
            if (demographicsChart) demographicsChart.destroy();
            if (earningsChart) earningsChart.destroy();
            
            // Prepare data for charts
            const last30Days = Array.from({length: 30}, (_, i) => {
                const date = new Date();
                date.setDate(date.getDate() - (29 - i));
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            
            // Mock data for views chart
            const viewsData = last30Days.map(() => Math.floor(Math.random() * 1000) + 100);
            
            // Create views chart
            const viewsCtx = document.getElementById('views-chart').getContext('2d');
            viewsChart = new Chart(viewsCtx, {
                type: 'line',
                data: {
                    labels: last30Days,
                    datasets: [{
                        label: 'Views',
                        data: viewsData,
                        borderColor: 'rgb(13, 110, 253)',
                        backgroundColor: 'rgba(13, 110, 253, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Mock watch time data
            const watchTimeData = last30Days.map(() => Math.floor(Math.random() * 50) + 10);
            
            // Create watch time chart
            const watchTimeCtx = document.getElementById('watch-time-chart').getContext('2d');
            watchTimeChart = new Chart(watchTimeCtx, {
                type: 'bar',
                data: {
                    labels: last30Days.slice(-7),
                    datasets: [{
                        label: 'Watch Time (hours)',
                        data: watchTimeData.slice(-7),
                        backgroundColor: 'rgba(32, 201, 151, 0.5)',
                        borderColor: 'rgb(32, 201, 151)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Update top videos list
            topVideosList.innerHTML = '';
            const topVideos = [...userVideos]
                .sort((a, b) => (b.views || 0) - (a.views || 0))
                .slice(0, 5);
            
            topVideos.forEach((video, index) => {
                const videoItem = document.createElement('div');
                videoItem.style.display = 'flex';
                videoItem.style.alignItems = 'center';
                videoItem.style.padding = '12px';
                videoItem.style.borderBottom = '1px solid var(--border)';
                videoItem.dataset.id = video.id;
                
                videoItem.innerHTML = `
                    <div style="font-weight: 600; margin-right: 12px; color: var(--text-secondary);">${index + 1}.</div>
                    <img src="${video.thumbnail || generateThumbnail(video.id)}" 
                         alt="${video.title}" style="width: 60px; height: 34px; object-fit: cover; border-radius: 4px; margin-right: 12px;">
                    <div style="flex: 1;">
                        <div style="font-weight: 500; font-size: 14px; margin-bottom: 4px;">${video.title}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${formatNumber(video.views || 0)} views</div>
                    </div>
                `;
                
                videoItem.addEventListener('click', () => openVideoDetail(video.id));
                topVideosList.appendChild(videoItem);
            });
            
            // Create demographics chart
            const demographicsCtx = document.getElementById('demographics-chart').getContext('2d');
            demographicsChart = new Chart(demographicsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['18-24', '25-34', '35-44', '45-54', '55+'],
                    datasets: [{
                        data: [30, 40, 15, 10, 5],
                        backgroundColor: [
                            'rgb(13, 110, 253)',
                            'rgb(32, 201, 151)',
                            'rgb(255, 193, 7)',
                            'rgb(253, 126, 20)',
                            'rgb(108, 117, 125)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Create earnings chart
            const earningsCtx = document.getElementById('earnings-chart').getContext('2d');
            const earningsData = last30Days.map(() => parseFloat((Math.random() * 10).toFixed(2)));
            
            earningsChart = new Chart(earningsCtx, {
                type: 'line',
                data: {
                    labels: last30Days,
                    datasets: [{
                        label: 'Earnings ($)',
                        data: earningsData,
                        borderColor: 'rgb(32, 201, 151)',
                        backgroundColor: 'rgba(32, 201, 151, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Edit video
        async function editVideo(videoId) {
            const video = videos.find(v => v.id === videoId);
            if (!video) return;
            
            videoBeingEdited = videoId;
            
            editVideoTitle.value = video.title;
            editVideoDescription.value = video.description || '';
            editVideoVisibility.value = video.visibility || 'public';
            editVideoUrl.value = video.url || generateVideoUrl(videoId, video.title);
            
            // Show/hide price field
            if (video.visibility === 'premium') {
                editPriceGroup.style.display = 'block';
                editVideoPrice.value = video.price || 10.99;
                premiumStats.style.display = 'block';
                totalPurchases.textContent = video.purchases || 0;
                totalRevenue.textContent = ((video.purchases || 0) * (video.price || 10.99)).toFixed(2);
                creatorRevenue.textContent = (((video.purchases || 0) * (video.price || 10.99)) * 0.8).toFixed(2);
            } else {
                editPriceGroup.style.display = 'none';
                premiumStats.style.display = 'none';
            }
            
            editVideoModal.classList.add('show');
        }

        // Delete video
        async function deleteVideo(videoId) {
            if (!confirm('Are you sure you want to delete this video? This action cannot be undone.')) {
                return;
            }
            
            try {
                // Delete from Firestore
                await db.collection('videos').doc(videoId).delete();
                
                // Remove from local videos array
                const videoIndex = videos.findIndex(v => v.id === videoId);
                if (videoIndex !== -1) {
                    videos.splice(videoIndex, 1);
                }
                
                // Update UI
                if (currentVideoId === videoId) {
                    showHomepage();
                }
                
                // Reload studio data
                await loadStudioData();
                
                // Close edit modal if open
                editVideoModal.classList.remove('show');
                
                alert('Video deleted successfully!');
            } catch (error) {
                console.error('Error deleting video:', error);
                alert('Failed to delete video: ' + error.message);
            }
        }

        // Process payment for premium video
        async function processPayment(videoId, amount) {
            if (!currentUser) {
                showError(paymentError, 'You must be signed in to purchase videos');
                return;
            }
            
            try {
                // Record purchase
                const purchaseData = {
                    videoId: videoId,
                    userId: currentUser.uid,
                    amount: amount,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'completed'
                };
                
                await db.collection('purchases').add(purchaseData);
                
                // Update video purchase count
                const videoRef = db.collection('videos').doc(videoId);
                await videoRef.update({
                    purchases: firebase.firestore.FieldValue.increment(1)
                });
                
                // Update channel premium earnings (80% for creator)
                const videoDoc = await videoRef.get();
                if (videoDoc.exists) {
                    const videoData = videoDoc.data();
                    const creatorId = videoData.userId;
                    
                    if (creatorId) {
                        await db.collection('channels').doc(creatorId).update({
                            premiumEarnings: firebase.firestore.FieldValue.increment(amount * 0.8),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                }
                
                // Update local data
                userPurchases.push(videoId);
                const videoIndex = videos.findIndex(v => v.id === videoId);
                if (videoIndex !== -1) {
                    videos[videoIndex].purchases = (videos[videoIndex].purchases || 0) + 1;
                }
                
                // Show success message
                showSuccess(paymentSuccess, 'Payment successful! Video is now unlocked.');
                paymentSuccessMessage.style.display = 'block';
                
                // Close payment modal after 2 seconds
                setTimeout(() => {
                    paymentModal.classList.remove('show');
                    paymentSuccessMessage.style.display = 'none';
                    paymentSuccess.style.display = 'none';
                    
                    // Reload video detail to unlock it
                    openVideoDetail(videoId);
                }, 2000);
                
            } catch (error) {
                console.error('Error processing payment:', error);
                showError(paymentError, 'Payment failed: ' + error.message);
            }
        }

        // Subscribe to channel
        async function subscribeToChannel(channelId) {
            if (!currentUser) {
                authModal.classList.add('show');
                return;
            }
            
            try {
                const subscriptionRef = db.collection('subscriptions').doc(`${currentUser.uid}_${channelId}`);
                const subscriptionDoc = await subscriptionRef.get();
                
                if (subscriptionDoc.exists) {
                    // Unsubscribe
                    await subscriptionRef.delete();
                    await db.collection('channels').doc(channelId).update({
                        subscribers: firebase.firestore.FieldValue.increment(-1)
                    });
                    
                    subscribeBtn.classList.remove('subscribed');
                    subscribeBtn.innerHTML = '<i class="fas fa-bell"></i><span>Subscribe</span>';
                } else {
                    // Subscribe
                    await subscriptionRef.set({
                        userId: currentUser.uid,
                        channelId: channelId,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    await db.collection('channels').doc(channelId).update({
                        subscribers: firebase.firestore.FieldValue.increment(1)
                    });
                    
                    subscribeBtn.classList.add('subscribed');
                    subscribeBtn.innerHTML = '<i class="fas fa-bell-slash"></i><span>Subscribed</span>';
                }
                
                // Update channel stats
                await updateChannelStats();
                
            } catch (error) {
                console.error('Error toggling subscription:', error);
            }
        }

        // Helper functions
        function showError(element, message) {
            element.textContent = message;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        function showSuccess(element, message) {
            element.textContent = message;
            element.style.display = 'block';
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        function formatTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = Math.floor(seconds / 31536000);
            if (interval >= 1) return interval + ' year' + (interval === 1 ? '' : 's') + ' ago';
            
            interval = Math.floor(seconds / 2592000);
            if (interval >= 1) return interval + ' month' + (interval === 1 ? '' : 's') + ' ago';
            
            interval = Math.floor(seconds / 86400);
            if (interval >= 1) return interval + ' day' + (interval === 1 ? '' : 's') + ' ago';
            
            interval = Math.floor(seconds / 3600);
            if (interval >= 1) return interval + ' hour' + (interval === 1 ? '' : 's') + ' ago';
            
            interval = Math.floor(seconds / 60);
            if (interval >= 1) return interval + ' minute' + (interval === 1 ? '' : 's') + ' ago';
            
            return 'Just now';
        }

        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function daysSince(date) {
            return Math.floor((new Date() - date) / (1000 * 60 * 60 * 24));
        }

        function updateWatchTime() {
            if (videoStartTime) {
                totalWatchTime += 1;
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Firebase auth state listener
            auth.onAuthStateChanged(async (user) => {
                await updateUI(user);
                await initHomepage();
                
                // Check URL for video or studio
                const path = window.location.pathname;
                const videoMatch = path.match(/\/watch\/([^\/]+)\/([^\/]+)/);
                const studioMatch = path === '/studio';
                
                if (videoMatch && videoMatch[1]) {
                    // Wait for videos to load
                    setTimeout(() => {
                        if (videos.some(v => v.id === videoMatch[1])) {
                            openVideoDetail(videoMatch[1]);
                        }
                    }, 1000);
                } else if (studioMatch && user) {
                    showStudio();
                }
            });
        });

        // Home link
        homeLink.addEventListener('click', function(e) {
            e.preventDefault();
            showHomepage();
        });

        // Studio button
        studioBtn.addEventListener('click', function(e) {
            e.preventDefault();
            showStudio();
        });

        // Upload button
        uploadBtn.addEventListener('click', function(e) {
            e.preventDefault();
            if (!currentUser) {
                authModal.classList.add('show');
                return;
            }
            uploadModal.classList.add('show');
        });

        // Upload area click
        uploadArea.addEventListener('click', function() {
            videoFileInput.click();
        });

        // File selection
        videoFileInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                selectedVideoFile = e.target.files[0];
                uploadArea.innerHTML = `
                    <i class="fas fa-video" style="color: var(--primary-blue);"></i>
                    <h3>${selectedVideoFile.name}</h3>
                    <p>${(selectedVideoFile.size / (1024 * 1024)).toFixed(2)} MB</p>
                    <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                        Click to change file
                    </p>
                `;
            }
        });

        // Show/hide price field based on visibility selection
        videoVisibilityInput.addEventListener('change', function() {
            if (this.value === 'premium') {
                priceGroup.style.display = 'block';
                videoPriceInput.value = '10.99';
            } else {
                priceGroup.style.display = 'none';
            }
        });

        // Start upload - FIXED WORKING VERSION
        uploadStartBtn.addEventListener('click', async function() {
            if (!selectedVideoFile) {
                showError(uploadError, 'Please select a video file');
                return;
            }
            
            const title = videoTitleInput.value.trim();
            if (!title) {
                showError(uploadError, 'Please enter a video title');
                return;
            }
            
            const description = videoDescriptionInput.value.trim();
            const visibility = videoVisibilityInput.value;
            const price = parseFloat(videoPriceInput.value) || 10.99;
            
            if (visibility === 'premium' && price < 10.99) {
                showError(uploadError, 'Minimum price for premium videos is $10.99');
                return;
            }
            
            // Clear any previous errors
            uploadError.style.display = 'none';
            
            // Start upload
            const videoId = await uploadVideoWithProgress(selectedVideoFile, title, description, visibility, price);
            if (videoId) {
                console.log('Video uploaded successfully:', videoId);
            }
        });

        // Studio navigation
        studioNavItems.forEach(item => {
            item.addEventListener('click', function() {
                const tabId = this.dataset.tab;
                
                // Update active state
                studioNavItems.forEach(navItem => navItem.classList.remove('active'));
                this.classList.add('active');
                
                // Show selected tab
                studioTabs.forEach(tab => tab.style.display = 'none');
                document.getElementById(`${tabId}-tab`).style.display = 'block';
            });
        });

        // Add video button in studio
        addVideoBtn.addEventListener('click', () => {
            uploadModal.classList.add('show');
        });

        // Edit channel button
        editChannelBtn.addEventListener('click', async () => {
            if (!currentUser) return;
            
            const channelData = await loadChannelData(currentUser.uid);
            if (channelData) {
                editChannelName.value = channelData.name;
                editChannelDescription.value = channelData.description || '';
                editChannelModal.classList.add('show');
            }
        });

        // Videos table actions
        videosTableBody.addEventListener('click', function(e) {
            const button = e.target.closest('button');
            if (!button) return;
            
            const row = button.closest('tr');
            const videoId = row.dataset.id;
            const action = button.dataset.action;
            
            if (action === 'edit') {
                editVideo(videoId);
            } else if (action === 'delete') {
                deleteVideo(videoId);
            }
        });

        // Unlock premium video button
        unlockBtn.addEventListener('click', function() {
            if (!currentUser) {
                authModal.classList.add('show');
                return;
            }
            
            const video = videos.find(v => v.id === currentVideoId);
            if (!video || video.visibility !== 'premium') return;
            
            // Show payment modal
            paymentVideoTitle.textContent = video.title;
            paymentPrice.textContent = `$${video.price || 10.99}`;
            paymentModal.classList.add('show');
            
            // Initialize PayPal button
            paypalButtonContainer.innerHTML = '';
            paypal.Buttons({
                createOrder: function(data, actions) {
                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: video.price || 10.99
                            }
                        }]
                    });
                },
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(details) {
                        // Process payment
                        processPayment(currentVideoId, video.price || 10.99);
                    });
                },
                onError: function(err) {
                    showError(paymentError, 'Payment failed: ' + err);
                }
            }).render('#paypal-button-container');
        });

        // Close payment modal
        paymentModalClose.addEventListener('click', function() {
            paymentModal.classList.remove('show');
            paypalButtonContainer.innerHTML = '';
        });

        // Like button
        likeBtn.addEventListener('click', async function() {
            if (!currentUser) {
                authModal.classList.add('show');
                return;
            }
            
            if (!currentVideoId) return;
            
            try {
                const videoRef = db.collection('videos').doc(currentVideoId);
                await db.runTransaction(async (transaction) => {
                    const videoDoc = await transaction.get(videoRef);
                    if (!videoDoc.exists) return;
                    
                    const videoData = videoDoc.data();
                    const newLikes = (videoData.likes || 0) + 1;
                    
                    transaction.update(videoRef, {
                        likes: newLikes
                    });
                    
                    // Update local data
                    const videoIndex = videos.findIndex(v => v.id === currentVideoId);
                    if (videoIndex !== -1) {
                        videos[videoIndex].likes = newLikes;
                        likeCount.textContent = formatNumber(newLikes);
                        
                        // Update ratio
                        const totalInteractions = newLikes + (videos[videoIndex].dislikes || 0);
                        const likeRatio = totalInteractions > 0 ? Math.round((newLikes / totalInteractions) * 100) : 0;
                        likeDislikeRatio.textContent = `${likeRatio}% liked this video`;
                    }
                });
                
                this.classList.add('active');
            } catch (error) {
                console.error('Error liking video:', error);
            }
        });

        // Dislike button
        dislikeBtn.addEventListener('click', async function() {
            if (!currentUser) {
                authModal.classList.add('show');
                return;
            }
            
            if (!currentVideoId) return;
            
            try {
                const videoRef = db.collection('videos').doc(currentVideoId);
                await db.runTransaction(async (transaction) => {
                    const videoDoc = await transaction.get(videoRef);
                    if (!videoDoc.exists) return;
                    
                    const videoData = videoDoc.data();
                    const newDislikes = (videoData.dislikes || 0) + 1;
                    
                    transaction.update(videoRef, {
                        dislikes: newDislikes
                    });
                    
                    // Update local data
                    const videoIndex = videos.findIndex(v => v.id === currentVideoId);
                    if (videoIndex !== -1) {
                        videos[videoIndex].dislikes = newDislikes;
                        dislikeCount.textContent = formatNumber(newDislikes);
                        
                        // Update ratio
                        const totalInteractions = (videos[videoIndex].likes || 0) + newDislikes;
                        const likeRatio = totalInteractions > 0 ? Math.round(((videos[videoIndex].likes || 0) / totalInteractions) * 100) : 0;
                        likeDislikeRatio.textContent = `${likeRatio}% liked this video`;
                    }
                });
                
                this.classList.add('active');
            } catch (error) {
                console.error('Error disliking video:', error);
            }
        });

        // Subscribe button
        subscribeBtn.addEventListener('click', async function() {
            if (!currentVideoId) return;
            
            const video = videos.find(v => v.id === currentVideoId);
            if (!video) return;
            
            await subscribeToChannel(video.userId);
        });

        // Share button
        shareBtn.addEventListener('click', function() {
            const videoTitle = detailVideoTitle.textContent;
            const url = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: videoTitle,
                    text: `Check out this video on HaitianTube: ${videoTitle}`,
                    url: url
                });
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    alert(`Link copied to clipboard:\n\n${url}`);
                });
            }
        });

        // Copy video URL button
        copyVideoUrlBtn.addEventListener('click', function() {
            navigator.clipboard.writeText(editVideoUrl.value).then(() => {
                alert('Video URL copied to clipboard!');
            });
        });

        // Comment submission
        commentSubmitBtn.addEventListener('click', async function() {
            if (!currentUser) {
                authModal.classList.add('show');
                return;
            }
            
            if (!currentVideoId) return;
            
            const commentText = commentInput.value.trim();
            if (!commentText) return;
            
            try {
                const commentData = {
                    videoId: currentVideoId,
                    userId: currentUser.uid,
                    authorName: currentUser.displayName || currentUser.email.split('@')[0],
                    text: commentText,
                    likes: 0,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Add to Firestore
                await db.collection('comments').add(commentData);
                
                // Update video comment count
                const videoRef = db.collection('videos').doc(currentVideoId);
                await videoRef.update({
                    comments: firebase.firestore.FieldValue.increment(1)
                });
                
                // Update local data
                const videoIndex = videos.findIndex(v => v.id === currentVideoId);
                if (videoIndex !== -1) {
                    videos[videoIndex].comments = (videos[videoIndex].comments || 0) + 1;
                    commentsCount.textContent = `Comments (${videos[videoIndex].comments})`;
                }
                
                // Clear input
                commentInput.value = '';
                commentInput.style.height = 'auto';
                
                // Reload comments
                loadComments(currentVideoId);
                
            } catch (error) {
                console.error('Error adding comment:', error);
            }
        });

        // Edit video submission
        editVideoSubmit.addEventListener('click', async function() {
            if (!videoBeingEdited) return;
            
            const title = editVideoTitle.value.trim();
            const description = editVideoDescription.value.trim();
            const visibility = editVideoVisibility.value;
            const price = parseFloat(editVideoPrice.value) || 10.99;
            
            if (!title) {
                showError(editVideoError, 'Please enter a video title');
                return;
            }
            
            if (visibility === 'premium' && price < 10.99) {
                showError(editVideoError, 'Minimum price for premium videos is $10.99');
                return;
            }
            
            try {
                const updates = {
                    title: title,
                    description: description,
                    visibility: visibility,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    slug: generateSlug(title),
                    url: generateVideoUrl(videoBeingEdited, title)
                };
                
                if (visibility === 'premium') {
                    updates.price = parseFloat(price);
                    updates.monetized = false;
                } else {
                    updates.monetized = true;
                }
                
                const videoRef = db.collection('videos').doc(videoBeingEdited);
                await videoRef.update(updates);
                
                // Update local data
                const videoIndex = videos.findIndex(v => v.id === videoBeingEdited);
                if (videoIndex !== -1) {
                    videos[videoIndex].title = title;
                    videos[videoIndex].description = description;
                    videos[videoIndex].visibility = visibility;
                    videos[videoIndex].slug = generateSlug(title);
                    videos[videoIndex].url = generateVideoUrl(videoBeingEdited, title);
                    
                    if (visibility === 'premium') {
                        videos[videoIndex].price = parseFloat(price);
                        videos[videoIndex].monetized = false;
                    } else {
                        videos[videoIndex].monetized = true;
                    }
                    
                    // Update detail page if open
                    if (currentVideoId === videoBeingEdited) {
                        detailVideoTitle.textContent = title;
                        detailVideoDescription.textContent = description;
                        videoSlugUrl.textContent = generateVideoUrl(videoBeingEdited, title);
                    }
                }
                
                showSuccess(editVideoSuccess, 'Video updated successfully!');
                
                // Reload studio data
                await loadStudioData();
                
                setTimeout(() => {
                    editVideoModal.classList.remove('show');
                    editVideoSuccess.style.display = 'none';
                }, 2000);
                
            } catch (error) {
                console.error('Error updating video:', error);
                showError(editVideoError, 'Failed to update video: ' + error.message);
            }
        });

        // Delete video button
        deleteVideoBtn.addEventListener('click', async function() {
            if (!videoBeingEdited) return;
            
            await deleteVideo(videoBeingEdited);
        });

        // Edit channel submission
        editChannelSubmit.addEventListener('click', async function() {
            if (!currentUser) return;
            
            const name = editChannelName.value.trim();
            const description = editChannelDescription.value.trim();
            
            if (!name) {
                showError(editChannelError, 'Please enter a channel name');
                return;
            }
            
            try {
                const updates = {
                    name: name,
                    description: description,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Handle profile picture upload
                const profileFile = editChannelAvatar.files[0];
                if (profileFile) {
                    const profilePath = `channels/${currentUser.uid}/profile_${Date.now()}.jpg`;
                    const profileRef = storage.ref(profilePath);
                    await profileRef.put(profileFile);
                    updates.profileImage = await profileRef.getDownloadURL();
                }
                
                // Handle banner upload
                const bannerFile = editChannelBanner.files[0];
                if (bannerFile) {
                    const bannerPath = `channels/${currentUser.uid}/banner_${Date.now()}.jpg`;
                    const bannerRef = storage.ref(bannerPath);
                    await bannerRef.put(bannerFile);
                    updates.bannerImage = await bannerRef.getDownloadURL();
                }
                
                // Update channel
                await db.collection('channels').doc(currentUser.uid).update(updates);
                
                // Update UI
                studioChannelName.textContent = name;
                const channelData = await loadChannelData(currentUser.uid);
                if (channelData.verified) {
                    studioChannelName.innerHTML = `${name} <i class="fas fa-check-circle" style="color: var(--primary-blue);"></i>`;
                }
                studioChannelDescription.textContent = description;
                studioChannelAvatar.textContent = name.charAt(0).toUpperCase();
                
                if (updates.profileImage) {
                    studioChannelAvatar.style.backgroundImage = `url(${updates.profileImage})`;
                    studioChannelAvatar.style.backgroundSize = 'cover';
                    studioChannelAvatar.textContent = '';
                }
                
                // Update all videos with new channel name
                const userVideos = await loadUserVideos();
                const batch = db.batch();
                
                userVideos.forEach(video => {
                    const videoRef = db.collection('videos').doc(video.id);
                    batch.update(videoRef, { 
                        channel: name,
                        channelVerified: channelData.verified || false
                    });
                    
                    // Update local data
                    const videoIndex = videos.findIndex(v => v.id === video.id);
                    if (videoIndex !== -1) {
                        videos[videoIndex].channel = name;
                        videos[videoIndex].channelVerified = channelData.verified || false;
                    }
                });
                
                await batch.commit();
                
                showSuccess(editChannelSuccess, 'Channel updated successfully!');
                
                setTimeout(() => {
                    editChannelModal.classList.remove('show');
                    editChannelSuccess.style.display = 'none';
                }, 2000);
                
            } catch (error) {
                console.error('Error updating channel:', error);
                showError(editChannelError, 'Failed to update channel: ' + error.message);
            }
        });

        // Search functionality
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            performSearch();
        });

        function performSearch() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            if (!searchTerm) {
                initHomepage();
                return;
            }
            
            const filteredVideos = videos.filter(video => 
                video.title.toLowerCase().includes(searchTerm) || 
                video.channel.toLowerCase().includes(searchTerm) ||
                video.description.toLowerCase().includes(searchTerm)
            );
            
            sectionTitle.textContent = `Search Results for "${searchTerm}"`;
            renderVideoGrid(filteredVideos);
        }

        // Handle browser back/forward
        window.addEventListener('popstate', function(event) {
            const path = window.location.pathname;
            const videoMatch = path.match(/\/watch\/([^\/]+)\/([^\/]+)/);
            const studioMatch = path === '/studio';
            
            if (videoMatch && videoMatch[1]) {
                if (videos.some(v => v.id === videoMatch[1])) {
                    openVideoDetail(videoMatch[1]);
                }
            } else if (studioMatch && currentUser) {
                showStudio();
            } else {
                showHomepage();
            }
        });

        // Modal close buttons
        const modalCloses = document.querySelectorAll('.modal-close');
        modalCloses.forEach(closeBtn => {
            closeBtn.addEventListener('click', function() {
                this.closest('.modal').classList.remove('show');
            });
        });

        // Close modal when clicking outside
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('show');
                }
            });
        });

        // User menu toggle
        userMenuBtn.addEventListener('click', function() {
            userMenu.classList.toggle('show');
        });

        // Close user menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!userMenuContainer.contains(e.target)) {
                userMenu.classList.remove('show');
            }
        });

        // Logout
        logoutBtn.addEventListener('click', function() {
            auth.signOut().then(() => {
                showHomepage();
            });
        });

        // Switch between signin/signup forms
        switchToSignup.addEventListener('click', function(e) {
            e.preventDefault();
            signinForm.style.display = 'none';
            signupForm.style.display = 'block';
            authModalTitle.textContent = 'Sign Up';
        });

        switchToSignin.addEventListener('click', function(e) {
            e.preventDefault();
            signupForm.style.display = 'none';
            signinForm.style.display = 'block';
            authModalTitle.textContent = 'Sign In';
        });

        // Sign in
        signinSubmit.addEventListener('click', async function() {
            const email = authEmail.value.trim();
            const password = authPassword.value;
            
            if (!email || !password) {
                showError(authError, 'Please enter email and password');
                return;
            }
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                authModal.classList.remove('show');
                authEmail.value = '';
                authPassword.value = '';
                authError.style.display = 'none';
            } catch (error) {
                console.error('Sign in error:', error);
                showError(authError, 'Failed to sign in: ' + error.message);
            }
        });

        // Sign up
        signupSubmit.addEventListener('click', async function() {
            const name = signupName.value.trim();
            const email = signupEmail.value.trim();
            const password = signupPassword.value;
            const confirmPassword = signupConfirmPassword.value;
            
            // Validation
            if (!name) {
                showError(authError, 'Please enter a channel name');
                return;
            }
            
            if (!email) {
                showError(authError, 'Please enter an email');
                return;
            }
            
            if (!password) {
                showError(authError, 'Please enter a password');
                return;
            }
            
            if (password !== confirmPassword) {
                showError(authError, 'Passwords do not match');
                return;
            }
            
            if (password.length < 6) {
                showError(authError, 'Password must be at least 6 characters');
                return;
            }
            
            try {
                // Create user in Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // Update display name
                await userCredential.user.updateProfile({
                    displayName: name
                });
                
                // Create channel document
                const channelData = {
                    name: name,
                    email: email,
                    subscribers: 0,
                    totalViews: 0,
                    totalVideos: 0,
                    earnings: 0,
                    premiumEarnings: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    bannerImage: null,
                    profileImage: null,
                    verified: false,
                    description: 'Welcome to my channel!'
                };
                
                await db.collection('channels').doc(userCredential.user.uid).set(channelData);
                
                showSuccess(authSuccess, 'Account created successfully! You are now signed in.');
                
                // Clear form
                signupName.value = '';
                signupEmail.value = '';
                signupPassword.value = '';
                signupConfirmPassword.value = '';
                
            } catch (error) {
                console.error('Sign up error:', error);
                let errorMessage = 'Failed to create account. ';
                
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage += 'Email already in use.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage += 'Invalid email address.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage += 'Password is too weak.';
                } else {
                    errorMessage += error.message;
                }
                
                showError(authError, errorMessage);
            }
        });

        // Sign in button in header
        signinBtn.addEventListener('click', function() {
            signinForm.style.display = 'block';
            signupForm.style.display = 'none';
            authModalTitle.textContent = 'Sign In';
            authModal.classList.add('show');
        });

        // My channel button
        myChannelBtn.addEventListener('click', function() {
            showStudio();
            // Switch to channel tab
            studioNavItems.forEach(navItem => navItem.classList.remove('active'));
            document.querySelector('.studio-nav-item[data-tab="channel"]').classList.add('active');
            studioTabs.forEach(tab => tab.style.display = 'none');
            document.getElementById('channel-tab').style.display = 'block';
        });

    </script>
</body>
</html>
