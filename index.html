<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Flix - Video Sharing Platform</title>
    <!-- Fluid Player -->
    <link rel="stylesheet" href="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.css">
    <script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script>
    <!-- Cloudinary Upload Widget -->
    <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-analytics-compat.js"></script>
    <!-- Back4App/Parse -->
    <script src="https://npmcdn.com/parse/dist/parse.min.js"></script>
    <style>
        /* CSS Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #ff0000;
            --primary-dark: #cc0000;
            --secondary-color: #065fd4;
            --dark-bg: #0f0f0f;
            --dark-surface: #212121;
            --dark-surface-light: #3d3d3d;
            --dark-text: #f1f1f1;
            --dark-text-secondary: #aaa;
            --light-bg: #ffffff;
            --light-surface: #f9f9f9;
            --light-surface-dark: #f1f1f1;
            --light-text: #030303;
            --light-text-secondary: #606060;
            --shadow: 0 1px 2px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 8px rgba(0,0,0,0.2);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--light-bg);
            color: var(--light-text);
            transition: var(--transition);
            overflow-x: hidden;
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .hidden {
            display: none !important;
        }

        /* Header Styles */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 56px;
            padding: 0 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--light-bg);
            box-shadow: var(--shadow);
            z-index: 1000;
            transition: var(--transition);
        }

        body.dark-mode header {
            background-color: var(--dark-bg);
            box-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .logo-icon {
            color: var(--primary-color);
            font-size: 28px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            color: var(--light-text);
        }

        body.dark-mode .logo-text {
            color: var(--dark-text);
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            margin: 0 40px;
            display: flex;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px;
            border: 1px solid #ccc;
            border-radius: 20px 0 0 20px;
            font-size: 16px;
            background-color: var(--light-bg);
            color: var(--light-text);
            transition: var(--transition);
        }

        body.dark-mode .search-input {
            background-color: var(--dark-surface);
            color: var(--dark-text);
            border-color: var(--dark-surface-light);
        }

        .search-button {
            padding: 10px 20px;
            background-color: var(--light-surface-dark);
            border: 1px solid #ccc;
            border-left: none;
            border-radius: 0 20px 20px 0;
            cursor: pointer;
            transition: var(--transition);
        }

        body.dark-mode .search-button {
            background-color: var(--dark-surface-light);
            border-color: var(--dark-surface-light);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .icon-button {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--light-text);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        body.dark-mode .icon-button {
            color: var(--dark-text);
        }

        .icon-button:hover {
            background-color: rgba(0,0,0,0.1);
        }

        body.dark-mode .icon-button:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .upload-button {
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-button:hover {
            background-color: var(--primary-dark);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            cursor: pointer;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            margin-top: 56px;
            min-height: calc(100vh - 56px);
        }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background-color: var(--light-bg);
            padding: 12px 0;
            overflow-y: auto;
            position: fixed;
            top: 56px;
            left: 0;
            height: calc(100vh - 56px);
            transition: var(--transition);
            z-index: 999;
        }

        body.dark-mode .sidebar {
            background-color: var(--dark-bg);
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 24px;
            padding: 12px 24px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--light-text);
        }

        body.dark-mode .sidebar-item {
            color: var(--dark-text);
        }

        .sidebar-item:hover {
            background-color: rgba(0,0,0,0.05);
        }

        body.dark-mode .sidebar-item:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .sidebar-item.active {
            background-color: rgba(0,0,0,0.1);
            font-weight: 500;
        }

        body.dark-mode .sidebar-item.active {
            background-color: rgba(255,255,255,0.1);
        }

        .sidebar-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 240px;
            padding: 20px;
            transition: var(--transition);
        }

        /* View Container */
        .view-container {
            min-height: calc(100vh - 96px);
        }

        /* Home View */
        .videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .video-card {
            background-color: var(--light-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        body.dark-mode .video-card {
            background-color: var(--dark-surface);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .video-thumbnail {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background-color: #ddd;
            position: relative;
        }

        body.dark-mode .video-thumbnail {
            background-color: #333;
        }

        .video-info {
            padding: 12px;
        }

        .video-title {
            font-weight: 500;
            margin-bottom: 8px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            height: 40px;
        }

        .video-creator {
            font-size: 14px;
            color: var(--light-text-secondary);
            margin-bottom: 4px;
        }

        body.dark-mode .video-creator {
            color: var(--dark-text-secondary);
        }

        .video-stats {
            font-size: 14px;
            color: var(--light-text-secondary);
            display: flex;
            gap: 8px;
        }

        body.dark-mode .video-stats {
            color: var(--dark-text-secondary);
        }

        /* Loading State */
        .loading-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--light-text-secondary);
            display: none;
        }

        body.dark-mode .loading-state {
            color: var(--dark-text-secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Authentication Views */
        .auth-container {
            max-width: 400px;
            margin: 40px auto;
            padding: 30px;
            background-color: var(--light-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
        }

        body.dark-mode .auth-container {
            background-color: var(--dark-surface);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h2 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 500;
        }

        .form-input {
            padding: 12px 16px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
            background-color: var(--light-bg);
            color: var(--light-text);
        }

        body.dark-mode .form-input {
            background-color: var(--dark-surface);
            color: var(--dark-text);
            border-color: var(--dark-surface-light);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .auth-button {
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .auth-button:hover {
            background-color: var(--primary-dark);
        }

        .auth-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }

        body.dark-mode .auth-footer {
            border-top-color: var(--dark-surface-light);
        }

        .auth-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        /* Upload View */
        .upload-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .upload-area {
            border: 2px dashed #ccc;
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 30px;
            transition: var(--transition);
        }

        body.dark-mode .upload-area {
            border-color: var(--dark-surface-light);
        }

        .upload-area.drag-over {
            border-color: var(--primary-color);
            background-color: rgba(255, 0, 0, 0.05);
        }

        .upload-icon {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        /* Video Player */
        .video-player-container {
            background-color: #000;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .fluid-player-container {
            width: 100% !important;
            height: auto !important;
        }

        /* Video Detail */
        .video-detail-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .video-info-detail {
            background-color: var(--light-surface);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        body.dark-mode .video-info-detail {
            background-color: var(--dark-surface);
        }

        .video-title-detail {
            font-size: 20px;
            margin-bottom: 12px;
        }

        .video-meta {
            color: var(--light-text-secondary);
            margin-bottom: 20px;
        }

        body.dark-mode .video-meta {
            color: var(--dark-text-secondary);
        }

        .video-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .action-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background-color: var(--light-surface-dark);
            border: none;
            border-radius: 20px;
            color: var(--light-text);
            cursor: pointer;
            transition: var(--transition);
        }

        body.dark-mode .action-button {
            background-color: var(--dark-surface-light);
            color: var(--dark-text);
        }

        .action-button:hover {
            background-color: rgba(0,0,0,0.1);
        }

        body.dark-mode .action-button:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .action-button.active {
            background-color: var(--primary-color);
            color: white;
        }

        .creator-info-detail {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        body.dark-mode .creator-info-detail {
            border-bottom-color: var(--dark-surface-light);
        }

        .creator-avatar-small {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 20px;
            color: white;
            background-color: var(--secondary-color);
        }

        .creator-details {
            flex: 1;
        }

        .creator-details h3 {
            margin-bottom: 4px;
        }

        .creator-details p {
            color: var(--light-text-secondary);
            font-size: 14px;
        }

        body.dark-mode .creator-details p {
            color: var(--dark-text-secondary);
        }

        .subscribe-button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .subscribe-button:hover {
            background-color: var(--primary-dark);
        }

        .video-description {
            background-color: var(--light-surface-dark);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        body.dark-mode .video-description {
            background-color: var(--dark-surface);
        }

        /* Comments */
        .comments-section {
            background-color: var(--light-surface);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        body.dark-mode .comments-section {
            background-color: var(--dark-surface);
        }

        .comment-input {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .user-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }

        .comment-input input {
            flex: 1;
            padding: 10px 16px;
            border: 1px solid #ccc;
            border-radius: 20px;
            background-color: var(--light-bg);
            color: var(--light-text);
        }

        body.dark-mode .comment-input input {
            background-color: var(--dark-surface);
            color: var(--dark-text);
            border-color: var(--dark-surface-light);
        }

        .comment-button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }

        .comment {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #666;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }

        .comment-content {
            flex: 1;
        }

        .comment-content h4 {
            margin-bottom: 4px;
        }

        .comment-content p {
            margin-bottom: 8px;
            color: var(--light-text);
        }

        body.dark-mode .comment-content p {
            color: var(--dark-text);
        }

        .comment-actions {
            display: flex;
            gap: 16px;
        }

        .comment-actions button {
            background: none;
            border: none;
            color: var(--light-text-secondary);
            cursor: pointer;
            font-size: 14px;
        }

        body.dark-mode .comment-actions button {
            color: var(--dark-text-secondary);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .search-container {
                margin: 0 10px;
            }
            
            .videos-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
            
            .video-actions {
                justify-content: center;
            }
            
            .thumbnail-options {
                flex-direction: column;
            }
        }

        /* Mobile Menu Button */
        .menu-button {
            display: none;
            background: none;
            border: none;
            font-size: 20px;
            color: var(--light-text);
            cursor: pointer;
            padding: 8px;
        }

        body.dark-mode .menu-button {
            color: var(--dark-text);
        }

        @media (max-width: 768px) {
            .menu-button {
                display: block;
            }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 24px;
            background-color: var(--light-surface);
            color: var(--light-text);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        body.dark-mode .toast {
            background-color: var(--dark-surface);
            color: var(--dark-text);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-success {
            border-left: 4px solid #4caf50;
        }

        .toast-error {
            border-left: 4px solid #f44336;
        }

        .toast-info {
            border-left: 4px solid #2196f3;
        }

        /* Related Videos */
        .related-videos {
            margin-top: 30px;
        }

        .related-video-card {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            cursor: pointer;
        }

        .related-thumbnail {
            width: 160px;
            height: 90px;
            border-radius: 8px;
            background-color: #ddd;
            position: relative;
        }

        body.dark-mode .related-thumbnail {
            background-color: #333;
        }

        .related-info {
            flex: 1;
        }

        .related-info h4 {
            font-size: 14px;
            margin-bottom: 4px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .related-info p {
            font-size: 12px;
            color: var(--light-text-secondary);
        }

        body.dark-mode .related-info p {
            color: var(--dark-text-secondary);
        }

        /* Upload Status */
        .upload-status {
            text-align: center;
            padding: 20px;
            background-color: var(--light-surface);
            border-radius: var(--border-radius);
            margin: 20px 0;
            font-weight: 500;
        }

        body.dark-mode .upload-status {
            background-color: var(--dark-surface);
        }

        .upload-success {
            text-align: center;
            padding: 20px;
            background-color: #d4edda;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        body.dark-mode .upload-success {
            background-color: #155724;
            color: white;
        }

        /* Thumbnail Options */
        .thumbnail-options {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .thumbnail-option {
            flex: 1;
            min-width: 300px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        body.dark-mode .thumbnail-option {
            border-color: var(--dark-surface-light);
        }

        .thumbnail-option:hover {
            border-color: var(--primary-color);
        }

        .thumbnail-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(255, 0, 0, 0.05);
        }

        .thumbnail-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 16px;
        }

        .thumbnail-preview {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin: 10px 0;
            background-color: #f0f0f0;
            display: none;
        }

        body.dark-mode .thumbnail-preview {
            background-color: #333;
        }

        /* Banner Ads */
        .banner-ad {
            width: 300px;
            height: 100px;
            margin: 20px auto;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .banner-ad img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo-container">
            <button class="menu-button" id="menuButton">
                <i class="fas fa-bars"></i>
            </button>
            <i class="fas fa-play-circle logo-icon"></i>
            <span class="logo-text">Stream Flix</span>
        </div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search videos...">
            <button class="search-button" id="searchButton">
                <i class="fas fa-search"></i>
            </button>
        </div>
        
        <div class="header-actions">
            <button class="icon-button" id="darkModeToggle">
                <i class="fas fa-moon"></i>
            </button>
            <button class="upload-button" id="uploadButton" style="display: none;">Upload</button>
            <div class="user-avatar" id="userAvatar">?</div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="main-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-item active" data-view="home">
                <i class="fas fa-home sidebar-icon"></i>
                <span>Home</span>
            </div>
            <div class="sidebar-item" id="loginItem">
                <i class="fas fa-sign-in-alt sidebar-icon"></i>
                <span>Sign In</span>
            </div>
            <div class="sidebar-item" id="logoutItem" style="display: none;">
                <i class="fas fa-sign-out-alt sidebar-icon"></i>
                <span>Log Out</span>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="view-container" id="viewContainer">
                <!-- Home View (Default) -->
                <div class="view" id="homeView">
                    <!-- Banner Ad -->
                    <div class="banner-ad">
                        <a href="https://t.ajrkm1.com/387067/8780/0?bo=2779,2778,2777,2776,2775&file_id=600151&po=6533&aff_sub5=SF_006OG000004lmDN" target="_blank">
                            <img src="https://www.imglnkx.com/8780/PMKT-1157_DESIGN-16618_BannersWebinar_HBD_300100.gif" alt="CrackRevenue Banner" width="300" height="100">
                        </a>
                    </div>
                    
                    <!-- Loading State (Only shows during initial fetch) -->
                    <div class="loading-state" id="loadingState">
                        <div class="spinner"></div>
                        <h2>Loading videos...</h2>
                        <p>Please wait while we load the latest videos</p>
                    </div>
                    
                    <!-- Videos Grid -->
                    <div class="videos-grid" id="videosGrid">
                        <!-- Videos loaded from Back4App -->
                    </div>
                </div>

                <!-- Video Detail View -->
                <div class="view hidden" id="videoDetailView">
                    <!-- Video will be loaded here -->
                </div>

                <!-- Authentication View -->
                <div class="view hidden" id="authView">
                    <div class="auth-container">
                        <div class="auth-header">
                            <i class="fas fa-play-circle" style="font-size: 48px; color: var(--primary-color); margin-bottom: 16px;"></i>
                            <h2 id="authTitle">Sign In</h2>
                            <p id="authSubtitle">to continue to Stream Flix</p>
                        </div>
                        
                        <form class="auth-form" id="authForm">
                            <div class="form-group">
                                <label class="form-label" for="authEmail">Email</label>
                                <input type="email" class="form-input" id="authEmail" placeholder="Enter your email">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="authPassword">Password</label>
                                <input type="password" class="form-input" id="authPassword" placeholder="Enter your password">
                            </div>
                            
                            <button type="submit" class="auth-button" id="authSubmitButton">Sign In</button>
                        </form>
                        
                        <div class="auth-footer">
                            <p>Don't have an account? <a class="auth-link" id="showSignup">Sign up</a></p>
                        </div>
                        
                        <div class="auth-form hidden" id="signupForm">
                            <div class="form-group">
                                <label class="form-label" for="signupUsername">Username</label>
                                <input type="text" class="form-input" id="signupUsername" placeholder="Choose a username">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="signupEmail">Email</label>
                                <input type="email" class="form-input" id="signupEmail" placeholder="Enter your email">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="signupPassword">Password</label>
                                <input type="password" class="form-input" id="signupPassword" placeholder="At least 6 characters">
                            </div>
                            
                            <button type="button" class="auth-button" id="signupButton">Create Account</button>
                        </div>
                    </div>
                </div>

                <!-- Upload View -->
                <div class="view hidden" id="uploadView">
                    <div class="upload-container">
                        <h1>Upload Video</h1>
                        <p>Upload a video to your channel</p>
                        
                        <button class="auth-button" id="cloudinaryUploadButton">
                            <i class="fas fa-cloud-upload-alt"></i> Upload Video via Cloudinary
                        </button>
                        
                        <div id="uploadStatus" class="upload-status" style="display: none;"></div>
                        
                        <!-- Thumbnail Options -->
                        <div class="form-group">
                            <label class="form-label">Choose Thumbnail</label>
                            <div class="thumbnail-options">
                                <div class="thumbnail-option selected" id="autoThumbnailOption">
                                    <i class="fas fa-robot thumbnail-icon"></i>
                                    <h3>Generate Automatically</h3>
                                    <p>We'll create a thumbnail from your video</p>
                                    <img class="thumbnail-preview" id="autoThumbnailPreview" src="" alt="Auto Thumbnail">
                                </div>
                                
                                <div class="thumbnail-option" id="customThumbnailOption">
                                    <i class="fas fa-upload thumbnail-icon"></i>
                                    <h3>Upload Your Own</h3>
                                    <p>Upload a custom thumbnail image</p>
                                    <img class="thumbnail-preview" id="customThumbnailPreview" src="" alt="Custom Thumbnail">
                                    <button type="button" class="auth-button" style="margin-top: 10px; background-color: var(--secondary-color);" id="uploadThumbnailButton">
                                        Choose Image
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Video Info -->
                        <div class="form-group">
                            <label class="form-label" for="videoTitle">Video Title</label>
                            <input type="text" class="form-input" id="videoTitle" placeholder="Enter a title for your video">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="videoDescription">Description</label>
                            <textarea class="form-input" id="videoDescription" rows="4" placeholder="Describe your video"></textarea>
                        </div>
                        
                        <!-- Upload Success Message -->
                        <div class="upload-success" id="uploadSuccess" style="display: none;">
                            <i class="fas fa-check-circle" style="font-size: 48px; color: #4caf50; margin-bottom: 16px;"></i>
                            <h3>Video Uploaded Successfully!</h3>
                            <p>Your video is being processed and will be available shortly.</p>
                            <button class="auth-button" onclick="switchView('home')" style="margin-top: 20px;">Go to Home</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification -->
    <div class="toast hidden" id="toast">
        <i class="fas fa-info-circle" id="toastIcon"></i>
        <span id="toastMessage">This is a toast message</span>
    </div>

    <script>
        // ============================
        // CONFIGURATION
        // ============================
        
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBsfheLc8i-CsRGJ9jkbGUhdTj3ZD3SLu8",
            authDomain: "haitiantube-2affb.firebaseapp.com",
            projectId: "haitiantube-2affb",
            storageBucket: "haitiantube-2affb.firebasestorage.app",
            messagingSenderId: "564033314604",
            appId: "1:564033314604:web:dfcd9b74b670e47dae1689",
            measurementId: "G-8WS57GK218"
        };
        
        // Back4App/Parse Configuration
        Parse.initialize("rdKfwjdUlVpPj3EMvhn8CcrYjOpJz1xcWl1tVv77", "NpON5B9fTS5t1hTKKpNLEuTPPLG1WXLvTYB051xD");
        Parse.serverURL = 'https://parseapi.back4app.com/';
        
        // VAST Ads URLs - Using multiple ad tags for 2 pre-roll, 3 mid-roll, 3 post-roll
        const PRE_ROLL_AD_URLS = [
            "https://s.magsrv.com/v1/vast.php?idzone=5829940",
            "https://s.magsrv.com/v1/vast.php?idzone=5829941"
        ];
        
        const MID_ROLL_AD_URLS = [
            "https://cpm.afkwa.com/vast?zone=283171&tagid=387067",
            "https://cpm.afkwa.com/vast?zone=283172&tagid=387067",
            "https://cpm.afkwa.com/vast?zone=283173&tagid=387067"
        ];
        
        const POST_ROLL_AD_URLS = [
            "https://vast.unityads.unity3d.com/vast/v2/getAds?publisherId=123456&placementId=video",
            "https://pubads.g.doubleclick.net/gampad/ads?iu=/21775744923/external/vmap_ad_samples&sz=640x480&cust_params=sample_ar%3Dpreonly&ciu_szs=300x250&gdfp_req=1&output=vast&unviewed_position_start=1&env=vp&impl=s&correlator=",
            "https://pubads.g.doubleclick.net/gampad/ads?iu=/21775744923/external/single_ad_samples&sz=640x480&cust_params=sample_ct%3Dlinear&ciu_szs=300x250&gdfp_req=1&output=vast&unviewed_position_start=1&env=vp&impl=s&correlator="
        ];
        
        // ============================
        // PLATFORM STATE
        // ============================
        const platformState = {
            currentUser: null,
            isAuthenticated: false,
            currentView: 'home',
            videos: [], // Cache for videos
            loadingVideos: false,
            hasVideosLoaded: false,
            userLikes: new Set(), // Track liked videos for current user
            isDarkMode: localStorage.getItem('streamFlixDarkMode') === 'true',
            currentVideo: null,
            cloudinaryWidget: null,
            uploadedVideoUrl: null,
            uploadedThumbnailUrl: null,
            selectedThumbnailType: 'auto'
        };
        
        // ============================
        // DOM ELEMENTS
        // ============================
        const elements = {
            // Header
            menuButton: document.getElementById('menuButton'),
            sidebar: document.getElementById('sidebar'),
            darkModeToggle: document.getElementById('darkModeToggle'),
            uploadButton: document.getElementById('uploadButton'),
            userAvatar: document.getElementById('userAvatar'),
            searchInput: document.getElementById('searchInput'),
            searchButton: document.getElementById('searchButton'),
            
            // Sidebar
            loginItem: document.getElementById('loginItem'),
            logoutItem: document.getElementById('logoutItem'),
            
            // Views
            viewContainer: document.getElementById('viewContainer'),
            homeView: document.getElementById('homeView'),
            videoDetailView: document.getElementById('videoDetailView'),
            authView: document.getElementById('authView'),
            uploadView: document.getElementById('uploadView'),
            
            // Video Grid
            loadingState: document.getElementById('loadingState'),
            videosGrid: document.getElementById('videosGrid'),
            
            // Authentication
            authForm: document.getElementById('authForm'),
            authEmail: document.getElementById('authEmail'),
            authPassword: document.getElementById('authPassword'),
            authSubmitButton: document.getElementById('authSubmitButton'),
            showSignup: document.getElementById('showSignup'),
            signupForm: document.getElementById('signupForm'),
            signupUsername: document.getElementById('signupUsername'),
            signupEmail: document.getElementById('signupEmail'),
            signupPassword: document.getElementById('signupPassword'),
            signupButton: document.getElementById('signupButton'),
            
            // Upload
            cloudinaryUploadButton: document.getElementById('cloudinaryUploadButton'),
            uploadStatus: document.getElementById('uploadStatus'),
            videoTitle: document.getElementById('videoTitle'),
            videoDescription: document.getElementById('videoDescription'),
            uploadSuccess: document.getElementById('uploadSuccess'),
            
            // Thumbnail Options
            autoThumbnailOption: document.getElementById('autoThumbnailOption'),
            customThumbnailOption: document.getElementById('customThumbnailOption'),
            autoThumbnailPreview: document.getElementById('autoThumbnailPreview'),
            customThumbnailPreview: document.getElementById('customThumbnailPreview'),
            uploadThumbnailButton: document.getElementById('uploadThumbnailButton'),
            
            // Toast
            toast: document.getElementById('toast'),
            toastIcon: document.getElementById('toastIcon'),
            toastMessage: document.getElementById('toastMessage')
        };
        
        // ============================
        // INITIALIZATION
        // ============================
        async function initPlatform() {
            // Initialize Firebase
            initializeFirebase();
            
            // Initialize Cloudinary Upload Widget
            initializeCloudinaryWidget();
            
            // Set up event listeners
            setupEventListeners();
            
            // Load videos from Back4App
            loadVideos();
            
            // Apply dark mode if enabled
            if (platformState.isDarkMode) {
                enableDarkMode();
            }
            
            // Show welcome toast
            setTimeout(() => {
                showToast('Welcome to Stream Flix!', 'success');
            }, 1000);
        }
        
        // ============================
        // CLOUDINARY UPLOAD WIDGET
        // ============================
        function initializeCloudinaryWidget() {
            platformState.cloudinaryWidget = cloudinary.createUploadWidget({
                cloudName: "dsvfrkt4m",
                resourceType: "video",
                uploadSignature: async (callback, paramsToSign) => {
                    try {
                        // You need to implement this server-side function
                        // For now, we'll use a mock signature
                        const mockSignature = {
                            signature: "mock_signature",
                            timestamp: Math.floor(Date.now() / 1000)
                        };
                        callback(mockSignature);
                    } catch (error) {
                        console.error('Signature error:', error);
                        callback(null);
                    }
                },
                sources: ["local", "url", "camera"],
                multiple: false,
                maxFileSize: 10737418240, // 10GB
                chunkSize: 20000000, // 20MB chunks
                maxRetries: 5,
                retryInterval: 3000,
                secure: true,
                showPoweredBy: false,
                showAdvancedOptions: true,
                cropping: false,
                styles: {
                    palette: {
                        window: "#FFFFFF",
                        windowBorder: "#90A0B3",
                        tabIcon: "#0078FF",
                        menuIcons: "#5A616A",
                        textDark: "#000000",
                        textLight: "#FFFFFF",
                        link: "#0078FF",
                        action: "#FF620C",
                        inactiveTabIcon: "#0E2F5A",
                        error: "#F44235",
                        inProgress: "#0078FF",
                        complete: "#20B832",
                        sourceBg: "#E4EBF1"
                    }
                }
            }, (error, result) => {
                if (error) {
                    console.warn("Upload retrying…", error);
                    elements.uploadStatus.innerHTML = "Reconnecting…";
                    elements.uploadStatus.style.display = 'block';
                    return;
                }

                if (result.event === "upload-progress") {
                    elements.uploadStatus.innerHTML = `Uploading ${Math.round(result.info.progress)}%`;
                    elements.uploadStatus.style.display = 'block';
                }

                if (result.event === "success") {
                    elements.uploadStatus.innerHTML = "Upload completed!";
                    elements.uploadStatus.style.backgroundColor = '#d4edda';
                    elements.uploadStatus.style.color = '#155724';
                    
                    platformState.uploadedVideoUrl = result.info.secure_url;
                    
                    // Auto-generate thumbnail from video (frame at 1 second)
                    const publicId = result.info.public_id;
                    platformState.uploadedThumbnailUrl = `https://res.cloudinary.com/dsvfrkt4m/video/upload/so_1/${publicId}.jpg`;
                    
                    // Show auto thumbnail preview
                    elements.autoThumbnailPreview.src = platformState.uploadedThumbnailUrl;
                    elements.autoThumbnailPreview.style.display = 'block';
                    handleThumbnailSelection('auto');
                    
                    // Auto-fill title if empty
                    if (!elements.videoTitle.value.trim()) {
                        const fileName = result.info.original_filename || "My Video";
                        elements.videoTitle.value = fileName.charAt(0).toUpperCase() + fileName.slice(1);
                    }
                    
                    showToast('Video uploaded successfully! Now fill in details and save.', 'success');
                    
                    // Enable save button
                    setTimeout(() => {
                        elements.uploadStatus.innerHTML = "Video uploaded! Fill in details below and click 'Save Video'";
                    }, 2000);
                }
                
                if (result.event === "close") {
                    console.log("Upload widget closed");
                }
                
                if (result.event === "abort") {
                    elements.uploadStatus.innerHTML = "Upload cancelled";
                    elements.uploadStatus.style.display = 'block';
                }
                
                if (result.event === "display-changed") {
                    console.log("Display changed");
                }
            });
            
            // Open widget on button click
            elements.cloudinaryUploadButton.addEventListener('click', () => {
                if (!platformState.isAuthenticated) {
                    showToast('Please login to upload videos', 'error');
                    switchView('auth');
                    return;
                }
                
                platformState.cloudinaryWidget.open();
            });
            
            // Initialize thumbnail upload button
            elements.uploadThumbnailButton.addEventListener('click', () => {
                // Create a simple file input for thumbnail
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            elements.customThumbnailPreview.src = event.target.result;
                            elements.customThumbnailPreview.style.display = 'block';
                            handleThumbnailSelection('custom');
                            
                            // For now, we'll use data URL
                            // In production, upload to Cloudinary
                            platformState.uploadedThumbnailUrl = event.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                };
                input.click();
            });
        }
        
        // ============================
        // FIREBASE AUTHENTICATION
        // ============================
        function initializeFirebase() {
            try {
                const firebaseApp = firebase.initializeApp(firebaseConfig);
                const auth = firebase.auth();
                
                // Listen for auth state changes
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        platformState.currentUser = {
                            uid: user.uid,
                            email: user.email,
                            displayName: user.displayName || user.email.split('@')[0]
                        };
                        platformState.isAuthenticated = true;
                        
                        // Load user's liked videos
                        await loadUserLikes(user.uid);
                        
                        // Update UI
                        updateAuthUI();
                        
                        showToast(`Welcome back, ${platformState.currentUser.displayName}!`, 'success');
                    } else {
                        platformState.currentUser = null;
                        platformState.isAuthenticated = false;
                        platformState.userLikes.clear();
                        updateAuthUI();
                    }
                });
                
            } catch (error) {
                console.error('Firebase initialization error:', error);
                showToast('Authentication service unavailable', 'error');
            }
        }
        
        // ============================
        // BACK4APP VIDEO MANAGEMENT
        // ============================
        async function loadVideos(searchQuery = '') {
            // Only show loading on initial load when no videos cached
            if (!platformState.hasVideosLoaded && !platformState.videos.length) {
                elements.loadingState.style.display = 'block';
                elements.videosGrid.innerHTML = '';
            }
            
            platformState.loadingVideos = true;
            
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                
                // Filter by search query if provided
                if (searchQuery) {
                    query.matches('title', searchQuery, 'i');
                }
                
                // Sort by creation date (newest first)
                query.descending('createdAt');
                
                // Limit to 50 videos
                query.limit(50);
                
                const results = await query.find();
                
                // Clear existing videos
                platformState.videos = [];
                
                // Process results
                results.forEach((videoObj) => {
                    const video = {
                        id: videoObj.id,
                        title: videoObj.get('title') || 'Untitled Video',
                        description: videoObj.get('description') || '',
                        videoUrl: videoObj.get('videoUrl'),
                        thumbnailUrl: videoObj.get('thumbnailUrl'),
                        creatorId: videoObj.get('creatorId'),
                        creatorName: videoObj.get('creatorName') || 'Unknown Creator',
                        views: videoObj.get('views') || 0,
                        likes: videoObj.get('likes') || 0,
                        dislikes: videoObj.get('dislikes') || 0,
                        commentsCount: videoObj.get('commentsCount') || 0,
                        createdAt: videoObj.get('createdAt'),
                        duration: videoObj.get('duration') || '0:00'
                    };
                    
                    platformState.videos.push(video);
                });
                
                // Hide loading state
                elements.loadingState.style.display = 'none';
                platformState.loadingVideos = false;
                platformState.hasVideosLoaded = true;
                
                // Display videos
                displayVideos();
                
            } catch (error) {
                console.error('Error loading videos:', error);
                elements.loadingState.style.display = 'none';
                platformState.loadingVideos = false;
                
                // Only show error if we have no videos at all
                if (!platformState.videos.length) {
                    showToast('Error loading videos', 'error');
                }
            }
        }
        
        function displayVideos() {
            // Clear grid
            elements.videosGrid.innerHTML = '';
            
            // If no videos, show empty container (no messages)
            if (platformState.videos.length === 0) {
                return;
            }
            
            // Create video cards
            platformState.videos.forEach(video => {
                const videoCard = createVideoCard(video);
                elements.videosGrid.appendChild(videoCard);
            });
        }
        
        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.dataset.videoId = video.id;
            
            // Format view count
            const viewCount = formatNumber(video.views);
            
            // Format date
            const uploadDate = formatDate(video.createdAt);
            
            card.innerHTML = `
                <div class="video-thumbnail" style="background-image: url('${video.thumbnailUrl || 'https://via.placeholder.com/280x160?text=No+Thumbnail'}'); background-size: cover; background-position: center;">
                    <i class="fas fa-play-circle" style="font-size: 48px; color: rgba(255, 255, 255, 0.9); position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"></i>
                    ${video.duration ? `<span style="position: absolute; bottom: 8px; right: 8px; background: rgba(0, 0, 0, 0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">${video.duration}</span>` : ''}
                </div>
                <div class="video-info">
                    <h3 class="video-title">${video.title}</h3>
                    <p class="video-creator">${video.creatorName}</p>
                    <div class="video-stats">
                        <span>${viewCount} views</span>
                        <span>•</span>
                        <span>${uploadDate}</span>
                    </div>
                </div>
            `;
            
            card.addEventListener('click', () => {
                showVideoDetail(video);
            });
            
            return card;
        }
        
        async function saveVideoToBack4App() {
            if (!platformState.uploadedVideoUrl) {
                showToast('Please upload a video first', 'error');
                return;
            }
            
            const title = elements.videoTitle.value.trim();
            const description = elements.videoDescription.value.trim();
            
            if (!title) {
                showToast('Please enter a video title', 'error');
                return;
            }
            
            try {
                const Video = Parse.Object.extend('Video');
                const video = new Video();
                
                // Set video properties
                video.set('title', title);
                video.set('description', description);
                video.set('videoUrl', platformState.uploadedVideoUrl);
                
                // Use selected thumbnail
                if (platformState.selectedThumbnailType === 'custom' && platformState.uploadedThumbnailUrl) {
                    video.set('thumbnailUrl', platformState.uploadedThumbnailUrl);
                } else if (platformState.uploadedThumbnailUrl) {
                    // Use auto-generated thumbnail
                    video.set('thumbnailUrl', platformState.uploadedThumbnailUrl);
                }
                
                video.set('creatorId', platformState.currentUser.uid);
                video.set('creatorName', platformState.currentUser.displayName);
                video.set('views', 0);
                video.set('likes', 0);
                video.set('dislikes', 0);
                video.set('commentsCount', 0);
                video.set('duration', '0:00'); // Would need to extract from video metadata
                
                await video.save();
                
                // Add to local cache
                const newVideo = {
                    id: video.id,
                    title: title,
                    description: description,
                    videoUrl: platformState.uploadedVideoUrl,
                    thumbnailUrl: platformState.uploadedThumbnailUrl,
                    creatorId: platformState.currentUser.uid,
                    creatorName: platformState.currentUser.displayName,
                    views: 0,
                    likes: 0,
                    dislikes: 0,
                    commentsCount: 0,
                    duration: '0:00'
                };
                
                platformState.videos.unshift(newVideo);
                displayVideos();
                
                // Show success
                elements.uploadSuccess.style.display = 'block';
                elements.uploadStatus.style.display = 'none';
                
                // Reset form
                elements.videoTitle.value = '';
                elements.videoDescription.value = '';
                elements.autoThumbnailPreview.style.display = 'none';
                elements.customThumbnailPreview.style.display = 'none';
                platformState.uploadedVideoUrl = null;
                platformState.uploadedThumbnailUrl = null;
                
                // Reset thumbnail selection
                elements.autoThumbnailOption.classList.add('selected');
                elements.customThumbnailOption.classList.remove('selected');
                platformState.selectedThumbnailType = 'auto';
                
                showToast('Video saved successfully!', 'success');
                
                return video.id;
                
            } catch (error) {
                console.error('Error saving video to Back4App:', error);
                showToast('Error saving video: ' + error.message, 'error');
                throw error;
            }
        }
        
        async function updateVideoLikes(videoId, increment = true) {
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                
                const currentLikes = video.get('likes') || 0;
                video.set('likes', increment ? currentLikes + 1 : Math.max(0, currentLikes - 1));
                
                await video.save();
                
                // Update local cache
                const videoIndex = platformState.videos.findIndex(v => v.id === videoId);
                if (videoIndex !== -1) {
                    if (increment) {
                        platformState.videos[videoIndex].likes++;
                    } else {
                        platformState.videos[videoIndex].likes = Math.max(0, platformState.videos[videoIndex].likes - 1);
                    }
                }
                
            } catch (error) {
                console.error('Error updating video likes:', error);
                throw error;
            }
        }
        
        async function incrementViewCount(videoId) {
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                
                const currentViews = video.get('views') || 0;
                video.set('views', currentViews + 1);
                
                await video.save();
                
                // Update local cache
                const videoIndex = platformState.videos.findIndex(v => v.id === videoId);
                if (videoIndex !== -1) {
                    platformState.videos[videoIndex].views++;
                }
                
            } catch (error) {
                console.error('Error incrementing view count:', error);
            }
        }
        
        // ============================
        // USER LIKES MANAGEMENT
        // ============================
        async function loadUserLikes(userId) {
            try {
                const UserLike = Parse.Object.extend('UserLike');
                const query = new Parse.Query(UserLike);
                query.equalTo('userId', userId);
                
                const results = await query.find();
                
                platformState.userLikes.clear();
                results.forEach(like => {
                    platformState.userLikes.add(like.get('videoId'));
                });
                
            } catch (error) {
                console.error('Error loading user likes:', error);
            }
        }
        
        async function toggleLike(videoId) {
            if (!platformState.isAuthenticated) {
                showToast('Please login to like videos', 'error');
                switchView('auth');
                return;
            }
            
            try {
                const UserLike = Parse.Object.extend('UserLike');
                const query = new Parse.Query(UserLike);
                query.equalTo('userId', platformState.currentUser.uid);
                query.equalTo('videoId', videoId);
                
                const existingLike = await query.first();
                
                if (existingLike) {
                    // Unlike
                    await existingLike.destroy();
                    platformState.userLikes.delete(videoId);
                    await updateVideoLikes(videoId, false);
                    showToast('Removed like', 'info');
                } else {
                    // Like
                    const like = new UserLike();
                    like.set('userId', platformState.currentUser.uid);
                    like.set('videoId', videoId);
                    await like.save();
                    
                    platformState.userLikes.add(videoId);
                    await updateVideoLikes(videoId, true);
                    showToast('Liked!', 'success');
                }
                
                // Update UI if on video detail page
                if (platformState.currentVideo && platformState.currentVideo.id === videoId) {
                    updateLikeButton(videoId);
                }
                
            } catch (error) {
                console.error('Error toggling like:', error);
                showToast('Error updating like', 'error');
            }
        }
        
        // ============================
        // VIDEO DETAIL VIEW WITH FLUID PLAYER & VAST ADS
        // ============================
        async function showVideoDetail(video) {
            platformState.currentVideo = video;
            
            // Increment view count
            await incrementViewCount(video.id);
            
            // Create video detail HTML
            const videoDetailHTML = `
                <div class="video-detail-container">
                    <div class="video-player-container" id="videoPlayerContainer">
                        <!-- Fluid Player will be initialized here -->
                    </div>
                    
                    <div class="video-info-detail">
                        <h1 class="video-title-detail">${video.title}</h1>
                        <div class="video-meta">
                            <span>${formatNumber(video.views + 1)} views</span>
                            <span>•</span>
                            <span>${formatDate(video.createdAt)}</span>
                        </div>
                        
                        <div class="video-actions">
                            <button class="action-button ${platformState.userLikes.has(video.id) ? 'active' : ''}" 
                                    onclick="toggleLike('${video.id}')" id="likeButton">
                                <i class="fas fa-thumbs-up"></i>
                                <span id="likeCount">${video.likes}</span>
                            </button>
                            <button class="action-button" onclick="shareVideo('${video.id}')">
                                <i class="fas fa-share"></i>
                                <span>Share</span>
                            </button>
                        </div>
                        
                        <div class="creator-info-detail">
                            <div class="creator-avatar-small">${video.creatorName.charAt(0).toUpperCase()}</div>
                            <div class="creator-details">
                                <h3>${video.creatorName}</h3>
                            </div>
                        </div>
                        
                        <div class="video-description">
                            <p>${video.description || 'No description provided.'}</p>
                        </div>
                    </div>
                    
                    <!-- Comments Section -->
                    <div class="comments-section">
                        <h3>Comments (${video.commentsCount || 0})</h3>
                        ${platformState.isAuthenticated ? `
                            <div class="comment-input">
                                <div class="user-avatar-small">${platformState.currentUser.displayName.charAt(0).toUpperCase()}</div>
                                <input type="text" placeholder="Add a comment..." id="commentInput">
                                <button class="comment-button" onclick="addComment('${video.id}')">Comment</button>
                            </div>
                        ` : `
                            <p>Please <a href="#" onclick="switchView('auth')">sign in</a> to comment.</p>
                        `}
                        <div id="commentsList">
                            <!-- Comments will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Related Videos -->
                    <div class="related-videos">
                        <h3>Recommended Videos</h3>
                        <div id="relatedVideos">
                            <!-- Related videos will be loaded here -->
                        </div>
                    </div>
                </div>
            `;
            
            // Update view
            switchView('videoDetail');
            elements.videoDetailView.innerHTML = videoDetailHTML;
            
            // Initialize Fluid Player with VAST ads
            initializeVideoPlayer(video);
            
            // Load comments
            loadComments(video.id);
            
            // Load related videos
            loadRelatedVideos(video.id);
        }
        
        function updateLikeButton(videoId) {
            const likeButton = document.getElementById('likeButton');
            const likeCount = document.getElementById('likeCount');
            const video = platformState.videos.find(v => v.id === videoId);
            
            if (likeButton && video) {
                if (platformState.userLikes.has(videoId)) {
                    likeButton.classList.add('active');
                    likeCount.textContent = video.likes;
                } else {
                    likeButton.classList.remove('active');
                    likeCount.textContent = video.likes;
                }
            }
        }
        
        // ============================
        // FLUID VIDEO PLAYER WITH VAST ADS (EXACT REQUIREMENTS)
        // ============================
        function initializeVideoPlayer(video) {
            const container = document.getElementById('videoPlayerContainer');
            
            // Create video element
            const videoElement = document.createElement('video');
            videoElement.id = 'fluid-player-' + video.id;
            videoElement.style.width = '100%';
            videoElement.style.height = 'auto';
            videoElement.controls = true;
            videoElement.preload = 'metadata';
            
            const source = document.createElement('source');
            source.src = video.videoUrl;
            source.type = 'video/mp4';
            
            videoElement.appendChild(source);
            container.appendChild(videoElement);
            
            // Create ad list exactly as required: 2 pre-roll, 3 mid-roll (at 50%), 3 post-roll
            const adList = [];
            
            // Add 2 pre-roll ads
            PRE_ROLL_AD_URLS.forEach((url, index) => {
                adList.push({
                    roll: 'preRoll',
                    vastTag: url,
                    adText: `Pre-roll Ad ${index + 1}`
                });
            });
            
            // Add 3 mid-roll ads at 50% of video duration
            MID_ROLL_AD_URLS.forEach((url, index) => {
                adList.push({
                    roll: 'midRoll',
                    vastTag: url,
                    timer: "50%", // Exactly at 50% of video duration
                    adText: `Mid-roll Ad ${index + 1}`
                });
            });
            
            // Add 3 post-roll ads
            POST_ROLL_AD_URLS.forEach((url, index) => {
                adList.push({
                    roll: 'postRoll',
                    vastTag: url,
                    adText: `Post-roll Ad ${index + 1}`
                });
            });
            
            // Initialize Fluid Player with exact requirements
            const player = fluidPlayer(
                videoElement.id,
                {
                    layoutControls: {
                        primaryColor: "#ff0000",
                        posterImage: video.thumbnailUrl,
                        allowDownload: false,
                        playButtonShowing: true,
                        fillToContainer: true,
                        autoPlay: false, // Don't auto-play to respect user preference
                        mute: false,
                        keyboardControl: true,
                        playlist: false,
                        allowTheatre: true,
                        playbackRateEnabled: true,
                        logo: {
                            imageUrl: null,
                            position: 'top left',
                            clickUrl: null,
                            opacity: 1
                        },
                        // Enable timeline markers for ads
                        showAdMarkers: true,
                        adList: adList
                    },
                    vastOptions: {
                        adList: adList,
                        adCTAText: true,
                        adCTATextPosition: 'top right',
                        skipButtonCaption: 'Skip Ad [seconds]',
                        skipButtonClickCaption: 'Skip Ad',
                        adText: 'Advertisement',
                        adTextPosition: 'top left',
                        adClickable: true,
                        autoPlayAd: true,
                        // IMPORTANT: Enable timeline markers
                        showTimelineMarkers: true,
                        timelineMarkerDuration: 2000,
                        timelineMarkerStyle: {
                            color: "#FFD700", // Yellow color like YouTube
                            opacity: 0.8
                        },
                        // Set mid-roll to show at 50% exactly
                        midRollPercentage: 50
                    }
                }
            );
            
            // Handle ad events
            player.on('adStarted', function() {
                console.log('Ad started playing');
            });
            
            player.on('adCompleted', function() {
                console.log('Ad completed');
            });
            
            player.on('adError', function(error) {
                console.log('Ad error:', error);
                // Continue playing video if ad fails
                player.play();
            });
            
            player.on('vastAdLoad', function(adData) {
                console.log('VAST ad loaded:', adData);
            });
            
            // Handle video errors
            videoElement.addEventListener('error', function(e) {
                console.error('Video error:', e);
                showToast('Error playing video', 'error');
            });
            
            // Log ad markers info
            setTimeout(() => {
                console.log('Ad markers should be visible on timeline:');
                console.log('- 2 yellow markers at start (pre-roll)');
                console.log('- 3 yellow markers at 50% (mid-roll)');
                console.log('- 3 yellow markers at end (post-roll)');
                console.log('Total: 8 yellow markers on timeline');
            }, 1000);
        }
        
        // ============================
        // COMMENTS MANAGEMENT
        // ============================
        async function loadComments(videoId) {
            try {
                const Comment = Parse.Object.extend('Comment');
                const query = new Parse.Query(Comment);
                query.equalTo('videoId', videoId);
                query.descending('createdAt');
                query.limit(50);
                
                const results = await query.find();
                
                const commentsList = document.getElementById('commentsList');
                commentsList.innerHTML = '';
                
                if (results.length === 0) {
                    commentsList.innerHTML = '<p>No comments yet. Be the first to comment!</p>';
                    return;
                }
                
                results.forEach(comment => {
                    const commentElement = document.createElement('div');
                    commentElement.className = 'comment';
                    
                    const userName = comment.get('userName') || 'Anonymous';
                    const userInitial = userName.charAt(0).toUpperCase();
                    
                    commentElement.innerHTML = `
                        <div class="comment-avatar">${userInitial}</div>
                        <div class="comment-content">
                            <h4>${userName}</h4>
                            <p>${comment.get('text') || ''}</p>
                            <div class="comment-actions">
                                <span style="color: var(--light-text-secondary); font-size: 12px;">
                                    ${formatDate(comment.get('createdAt'))}
                                </span>
                            </div>
                        </div>
                    `;
                    
                    commentsList.appendChild(commentElement);
                });
                
            } catch (error) {
                console.error('Error loading comments:', error);
                document.getElementById('commentsList').innerHTML = '<p>Error loading comments</p>';
            }
        }
        
        async function addComment(videoId) {
            if (!platformState.isAuthenticated) {
                showToast('Please login to comment', 'error');
                return;
            }
            
            const commentInput = document.getElementById('commentInput');
            const text = commentInput.value.trim();
            
            if (!text) {
                showToast('Please enter a comment', 'error');
                return;
            }
            
            try {
                const Comment = Parse.Object.extend('Comment');
                const comment = new Comment();
                
                comment.set('videoId', videoId);
                comment.set('userId', platformState.currentUser.uid);
                comment.set('userName', platformState.currentUser.displayName);
                comment.set('text', text);
                
                await comment.save();
                
                // Update video comment count
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                
                const currentCount = video.get('commentsCount') || 0;
                video.set('commentsCount', currentCount + 1);
                await video.save();
                
                // Update local cache
                const videoIndex = platformState.videos.findIndex(v => v.id === videoId);
                if (videoIndex !== -1) {
                    platformState.videos[videoIndex].commentsCount = currentCount + 1;
                }
                
                // Clear input and reload comments
                commentInput.value = '';
                loadComments(videoId);
                
                showToast('Comment added!', 'success');
                
            } catch (error) {
                console.error('Error adding comment:', error);
                showToast('Error adding comment', 'error');
            }
        }
        
        // ============================
        // RELATED VIDEOS
        // ============================
        function loadRelatedVideos(currentVideoId) {
            const relatedVideosContainer = document.getElementById('relatedVideos');
            
            // Get up to 5 related videos (excluding current)
            const relatedVideos = platformState.videos
                .filter(v => v.id !== currentVideoId)
                .slice(0, 5);
            
            relatedVideosContainer.innerHTML = '';
            
            if (relatedVideos.length === 0) {
                relatedVideosContainer.innerHTML = '<p>No related videos found.</p>';
                return;
            }
            
            relatedVideos.forEach(video => {
                const card = document.createElement('div');
                card.className = 'related-video-card';
                card.innerHTML = `
                    <div class="related-thumbnail" style="background-image: url('${video.thumbnailUrl || 'https://via.placeholder.com/160x90?text=No+Thumbnail'}'); background-size: cover; background-position: center;">
                        <i class="fas fa-play-circle" style="font-size: 24px; color: rgba(255, 255, 255, 0.9); position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"></i>
                    </div>
                    <div class="related-info">
                        <h4>${video.title}</h4>
                        <p>${video.creatorName}</p>
                        <p>${formatNumber(video.views)} views • ${formatDate(video.createdAt)}</p>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    showVideoDetail(video);
                });
                
                relatedVideosContainer.appendChild(card);
            });
        }
        
        // ============================
        // THUMBNAIL MANAGEMENT
        // ============================
        function handleThumbnailSelection(type) {
            platformState.selectedThumbnailType = type;
            
            // Update UI
            if (type === 'auto') {
                elements.autoThumbnailOption.classList.add('selected');
                elements.customThumbnailOption.classList.remove('selected');
                if (platformState.uploadedThumbnailUrl) {
                    elements.autoThumbnailPreview.src = platformState.uploadedThumbnailUrl;
                    elements.autoThumbnailPreview.style.display = 'block';
                }
                elements.customThumbnailPreview.style.display = 'none';
            } else {
                elements.autoThumbnailOption.classList.remove('selected');
                elements.customThumbnailOption.classList.add('selected');
                elements.autoThumbnailPreview.style.display = 'none';
                if (platformState.uploadedThumbnailUrl) {
                    elements.customThumbnailPreview.src = platformState.uploadedThumbnailUrl;
                    elements.customThumbnailPreview.style.display = 'block';
                }
            }
        }
        
        // ============================
        // AUTHENTICATION UI
        // ============================
        function updateAuthUI() {
            if (platformState.isAuthenticated) {
                // Update user avatar
                elements.userAvatar.textContent = platformState.currentUser.displayName.charAt(0).toUpperCase();
                
                // Show upload button
                elements.uploadButton.style.display = 'block';
                
                // Update sidebar
                elements.loginItem.style.display = 'none';
                elements.logoutItem.style.display = 'flex';
            } else {
                elements.userAvatar.textContent = '?';
                elements.uploadButton.style.display = 'none';
                elements.loginItem.style.display = 'flex';
                elements.logoutItem.style.display = 'none';
            }
        }
        
        async function handleLogin(email, password) {
            try {
                await firebase.auth().signInWithEmailAndPassword(email, password);
                showToast('Successfully signed in!', 'success');
                switchView('home');
            } catch (error) {
                console.error('Login error:', error);
                showToast('Login failed: ' + error.message, 'error');
            }
        }
        
        async function handleSignup(username, email, password) {
            try {
                // Create user with email/password
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                
                // Update profile with username
                await userCredential.user.updateProfile({
                    displayName: username
                });
                
                showToast('Account created successfully!', 'success');
                switchView('home');
            } catch (error) {
                console.error('Signup error:', error);
                showToast('Signup failed: ' + error.message, 'error');
            }
        }
        
        async function logout() {
            try {
                await firebase.auth().signOut();
                showToast('Successfully logged out', 'info');
                switchView('home');
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Logout failed: ' + error.message, 'error');
            }
        }
        
        // ============================
        // VIEW MANAGEMENT
        // ============================
        function switchView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Show requested view
            platformState.currentView = viewName;
            
            switch(viewName) {
                case 'home':
                    elements.homeView.classList.remove('hidden');
                    break;
                case 'videoDetail':
                    elements.videoDetailView.classList.remove('hidden');
                    break;
                case 'auth':
                    elements.authView.classList.remove('hidden');
                    break;
                case 'upload':
                    if (platformState.isAuthenticated) {
                        elements.uploadView.classList.remove('hidden');
                        // Reset upload form if needed
                        elements.uploadSuccess.style.display = 'none';
                        elements.uploadStatus.style.display = 'none';
                    } else {
                        switchView('auth');
                    }
                    break;
            }
            
            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                elements.sidebar.classList.remove('active');
            }
        }
        
        // ============================
        // EVENT LISTENERS SETUP
        // ============================
        function setupEventListeners() {
            // Mobile menu
            elements.menuButton.addEventListener('click', () => {
                elements.sidebar.classList.toggle('active');
            });
            
            // Dark mode toggle
            elements.darkModeToggle.addEventListener('click', toggleDarkMode);
            
            // Search
            elements.searchButton.addEventListener('click', handleSearch);
            elements.searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
            
            // Sidebar navigation
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', () => {
                    // Remove active class from all items
                    document.querySelectorAll('.sidebar-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    
                    // Add active class to clicked item
                    item.classList.add('active');
                    
                    const view = item.dataset.view;
                    if (view) {
                        switchView(view);
                    } else if (item.id === 'loginItem') {
                        switchView('auth');
                    } else if (item.id === 'logoutItem') {
                        logout();
                    }
                    
                    // Close sidebar on mobile
                    if (window.innerWidth <= 768) {
                        elements.sidebar.classList.remove('active');
                    }
                });
            });
            
            // Upload button
            elements.uploadButton.addEventListener('click', () => {
                switchView('upload');
            });
            
            // User avatar
            elements.userAvatar.addEventListener('click', () => {
                if (platformState.isAuthenticated) {
                    // Could show user menu
                } else {
                    switchView('auth');
                }
            });
            
            // Authentication
            elements.authForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = elements.authEmail.value;
                const password = elements.authPassword.value;
                handleLogin(email, password);
            });
            
            elements.showSignup.addEventListener('click', () => {
                elements.authForm.classList.add('hidden');
                elements.signupForm.classList.remove('hidden');
            });
            
            elements.signupButton.addEventListener('click', () => {
                const username = elements.signupUsername.value;
                const email = elements.signupEmail.value;
                const password = elements.signupPassword.value;
                handleSignup(username, email, password);
            });
            
            // Save video button in upload view
            document.addEventListener('click', (e) => {
                if (e.target && e.target.id === 'saveVideoButton') {
                    e.preventDefault();
                    saveVideoToBack4App();
                }
            });
            
            // Add save video button dynamically
            const saveButton = document.createElement('button');
            saveButton.id = 'saveVideoButton';
            saveButton.className = 'auth-button';
            saveButton.style.marginTop = '20px';
            saveButton.style.backgroundColor = '#4CAF50';
            saveButton.innerHTML = '<i class="fas fa-save"></i> Save Video to Platform';
            saveButton.onclick = (e) => {
                e.preventDefault();
                saveVideoToBack4App();
            };
            
            // Add save button to upload view
            elements.uploadView.querySelector('.upload-container').appendChild(saveButton);
        }
        
        function handleSearch() {
            const query = elements.searchInput.value.trim();
            if (query) {
                loadVideos(query);
                showToast(`Searching for "${query}"...`, 'info');
            } else {
                loadVideos(); // Reload all videos
            }
        }
        
        // ============================
        // UTILITY FUNCTIONS
        // ============================
        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'Recently';
            
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) return 'Today';
                if (diffDays === 1) return 'Yesterday';
                if (diffDays < 7) return `${diffDays} days ago`;
                if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
                
                return date.toLocaleDateString();
            } catch (e) {
                return 'Recently';
            }
        }
        
        function toggleDarkMode() {
            if (platformState.isDarkMode) {
                document.body.classList.remove('dark-mode');
                platformState.isDarkMode = false;
                localStorage.setItem('streamFlixDarkMode', 'false');
                elements.darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            } else {
                document.body.classList.add('dark-mode');
                platformState.isDarkMode = true;
                localStorage.setItem('streamFlixDarkMode', 'true');
                elements.darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
        }
        
        function enableDarkMode() {
            document.body.classList.add('dark-mode');
            elements.darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }
        
        function shareVideo(videoId) {
            const video = platformState.videos.find(v => v.id === videoId);
            if (video) {
                const shareUrl = window.location.origin + window.location.pathname + '?video=' + videoId;
                const shareText = `Watch "${video.title}" on Stream Flix`;
                
                if (navigator.share) {
                    navigator.share({
                        title: video.title,
                        text: shareText,
                        url: shareUrl
                    });
                } else {
                    navigator.clipboard.writeText(shareUrl);
                    showToast('Link copied to clipboard!', 'success');
                }
            }
        }
        
        function showToast(message, type = 'info') {
            elements.toastMessage.textContent = message;
            elements.toast.className = `toast toast-${type}`;
            
            // Set icon based on type
            switch(type) {
                case 'success':
                    elements.toastIcon.className = 'fas fa-check-circle';
                    break;
                case 'error':
                    elements.toastIcon.className = 'fas fa-exclamation-circle';
                    break;
                default:
                    elements.toastIcon.className = 'fas fa-info-circle';
            }
            
            elements.toast.classList.remove('hidden');
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
                setTimeout(() => {
                    elements.toast.classList.add('hidden');
                }, 300);
            }, 3000);
        }
        
        // ============================
        // INITIALIZE PLATFORM
        // ============================
        document.addEventListener('DOMContentLoaded', initPlatform);
        
        // Make functions globally available for HTML onclick handlers
        window.switchView = switchView;
        window.toggleLike = toggleLike;
        window.shareVideo = shareVideo;
        window.addComment = addComment;
        window.handleThumbnailSelection = handleThumbnailSelection;
        window.saveVideoToBack4App = saveVideoToBack4App;
    </script>
</body>
</html>
