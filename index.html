<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamflix - Streaming Vidéo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3/dist/plyr.css" />
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            GoogleAuthProvider,
            signInWithPopup,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { 
            getDatabase, 
            ref, 
            set, 
            get, 
            update,
            push,
            onValue,
            remove,
            child
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB865dX-tCaHtYPlsF9QjB2hNua9DLgLo4",
            authDomain: "streamflix-96d4c.firebaseapp.com",
            databaseURL: "https://streamflix-96d4c-default-rtdb.firebaseio.com",
            projectId: "streamflix-96d4c",
            storageBucket: "streamflix-96d4c.firebasestorage.app",
            messagingSenderId: "826245046220",
            appId: "1:826245046220:web:6fad6a76ee7da560170769",
            measurementId: "G-EFE74SQWWQ"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const googleProvider = new GoogleAuthProvider();

        window.firebase = {
            app,
            auth,
            database,
            analytics,
            functions: {
                createUserWithEmailAndPassword,
                signInWithEmailAndPassword,
                signOut,
                onAuthStateChanged,
                signInWithPopup,
                GoogleAuthProvider,
                updateProfile,
                get,
                set,
                update,
                onValue,
                push,
                ref,
                remove,
                child
            }
        };
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', Arial, sans-serif;
        }
        
        body {
            background-color: #0f0f0f;
            color: #f1f1f1;
            overflow-x: hidden;
        }
        
        /* Splash Screen */
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0f0f0f;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }
        
        .splash-logo {
            font-size: 48px;
            font-weight: bold;
            color: #ff0000;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .splash-logo i {
            font-size: 52px;
        }
        
        .splash-welcome {
            font-size: 24px;
            color: #f1f1f1;
            margin-bottom: 40px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #303030;
            border-top: 4px solid #ff0000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Offline Message */
        #offlineMessage {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #ffcc00;
            color: #000;
            text-align: center;
            padding: 12px;
            z-index: 2000;
            display: none;
            font-weight: 500;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 14px;
        }
        
        /* Refresh System */
        .refresh-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(to bottom, #ff0000, #cc0000);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1999;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            color: white;
            font-weight: bold;
        }
        
        .refresh-indicator.active {
            transform: translateY(0);
        }
        
        .refresh-btn {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: #ff0000;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 99;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }
        
        .refresh-btn:hover {
            transform: rotate(180deg);
        }
        
        /* Auth Screen */
        #authScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0f0f0f;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
            padding: 20px;
        }
        
        .auth-container {
            background-color: #1a1a1a;
            border-radius: 12px;
            padding: 30px;
            width: 100%;
            max-width: 380px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
        }
        
        .auth-tab {
            flex: 1;
            padding: 10px;
            background: none;
            border: none;
            color: #aaa;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
        }
        
        .auth-tab.active {
            color: #fff;
            border-bottom: 2px solid #ff0000;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .auth-form h2 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #aaa;
            font-size: 13px;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px 14px;
            background-color: #121212;
            border: 1px solid #303030;
            border-radius: 6px;
            color: #f1f1f1;
            font-size: 14px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #ff0000;
        }
        
        .auth-button {
            width: 100%;
            padding: 12px;
            background-color: #ff0000;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            margin-bottom: 12px;
        }
        
        .auth-button:hover {
            background-color: #cc0000;
        }
        
        .google-auth-button {
            width: 100%;
            padding: 12px;
            background-color: #4285F4;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .google-auth-button:hover {
            background-color: #357ae8;
        }
        
        .auth-error {
            color: #ff4444;
            font-size: 13px;
            margin-top: 8px;
            text-align: center;
            display: none;
            min-height: 18px;
        }
        
        .auth-switch {
            text-align: center;
            margin-top: 15px;
            color: #aaa;
            font-size: 13px;
        }
        
        .auth-switch span {
            color: #3ea6ff;
            cursor: pointer;
            font-weight: 500;
        }
        
        .auth-switch span:hover {
            text-decoration: underline;
        }
        
        /* Avatar Selection Modal */
        .avatar-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .avatar-modal-content {
            background-color: #1a1a1a;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .avatar-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .avatar-modal-header h2 {
            font-size: 22px;
            color: #fff;
        }
        
        .avatar-modal-close {
            background: none;
            border: none;
            color: #aaa;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }
        
        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .avatar-option {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .avatar-option:hover {
            transform: scale(1.05);
            border-color: #3ea6ff;
        }
        
        .avatar-option.selected {
            border-color: #ff0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }
        
        .avatar-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .avatar-upload {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            border: 2px dashed #333;
            border-radius: 10px;
            cursor: pointer;
        }
        
        .avatar-upload input {
            display: none;
        }
        
        .avatar-upload label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            color: #aaa;
        }
        
        .avatar-upload label:hover {
            color: #fff;
        }
        
        .avatar-modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .avatar-save-btn {
            flex: 1;
            padding: 12px;
            background-color: #ff0000;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .avatar-cancel-btn {
            flex: 1;
            padding: 12px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Main App */
        #mainApp {
            display: none;
        }
        
        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
            height: 56px;
            background-color: #0f0f0f;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #303030;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logo-image {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            overflow: hidden;
            background-color: #ff0000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .logo-text {
            font-size: 22px;
            font-weight: bold;
            color: #ff0000;
            text-decoration: none;
        }
        
        /* Search */
        .search-container {
            display: flex;
            flex: 0 1 640px;
            margin: 0 40px;
            position: relative;
        }
        
        .search-box-container {
            display: flex;
            width: 100%;
            position: relative;
        }
        
        .search-box {
            flex: 1;
            padding: 8px 16px;
            background-color: #121212;
            border: 1px solid #303030;
            border-right: none;
            border-radius: 40px 0 0 40px;
            color: #f1f1f1;
            font-size: 16px;
            width: 100%;
            font-size: 15px;
        }
        
        .search-btn {
            background-color: #222222;
            border: 1px solid #303030;
            border-left: none;
            border-radius: 0 40px 40px 0;
            padding: 8px 20px;
            cursor: pointer;
            color: #f1f1f1;
            min-width: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .search-btn:hover {
            background-color: #303030;
        }
        
        .voice-search-btn {
            background: #272727;
            border: none;
            color: #f1f1f1;
            padding: 8px;
            margin-left: 12px;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }
        
        .voice-search-btn:hover {
            background-color: #3d3d3d;
        }
        
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: #212121;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 101;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .suggestion-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            color: #f1f1f1;
            text-decoration: none;
            border-bottom: 1px solid #303030;
        }
        
        .suggestion-item:hover {
            background-color: #383838;
        }
        
        .suggestion-item i {
            color: #aaa;
            font-size: 16px;
            width: 24px;
        }
        
        .suggestion-item span {
            font-size: 14px;
        }
        
        .recent-searches {
            padding: 12px 16px;
            color: #aaa;
            font-size: 14px;
            border-bottom: 1px solid #303030;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #1a1a1a;
        }
        
        .clear-recent {
            color: #3ea6ff;
            cursor: pointer;
            font-size: 13px;
        }
        
        .clear-recent:hover {
            text-decoration: underline;
        }
        
        /* User Actions */
        .user-actions {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #ff0000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: #212121;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            width: 220px;
            display: none;
            z-index: 1000;
            margin-top: 10px;
        }
        
        .user-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            color: #f1f1f1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-menu-item:hover {
            background-color: #383838;
        }
        
        .user-menu-item:first-child {
            border-radius: 12px 12px 0 0;
        }
        
        .user-menu-item:last-child {
            border-radius: 0 0 12px 12px;
        }
        
        .user-menu-item.logout {
            color: #ff4444;
        }
        
        /* Navigation */
        .nav-container {
            padding: 0 24px;
            background-color: #0f0f0f;
            border-bottom: 1px solid #303030;
            position: sticky;
            top: 56px;
            z-index: 99;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }
        
        .nav-container::-webkit-scrollbar {
            height: 3px;
        }
        
        .nav-container::-webkit-scrollbar-track {
            background: #0f0f0f;
        }
        
        .nav-container::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 3px;
        }
        
        .nav-items {
            display: inline-flex;
            gap: 12px;
            padding: 12px 0;
        }
        
        .nav-item {
            background-color: #272727;
            color: #f1f1f1;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            transition: all 0.2s ease;
        }
        
        .nav-item:hover {
            background-color: #3a3a3a;
        }
        
        .nav-item.active {
            background-color: #f1f1f1;
            color: #0f0f0f;
            font-weight: 500;
        }
        
        /* Main Container */
        .main-container {
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #ff0000;
        }
        
        .section-header h2 {
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-header .see-all {
            color: #3ea6ff;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
        }
        
        /* Video Sliders */
        .video-slider-container {
            width: 100%;
            margin: 20px 0 40px 0;
            position: relative;
        }
        
        .swiper {
            width: 100%;
            height: 280px;
            padding: 0 24px;
        }
        
        .swiper-slide {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .swiper-slide:hover {
            transform: scale(1.03);
        }
        
        .slider-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .slider-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            color: white;
        }
        
        .slider-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .slider-channel {
            font-size: 14px;
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .verified-badge {
            color: #3ea6ff;
            font-size: 12px;
        }
        
        .swiper-button-next,
        .swiper-button-prev {
            color: white !important;
            background: rgba(0,0,0,0.7);
            width: 40px !important;
            height: 40px !important;
            border-radius: 50%;
            display: flex !important;
            align-items: center;
            justify-content: center;
        }
        
        .swiper-button-next:after,
        .swiper-button-prev:after {
            font-size: 20px !important;
            font-weight: bold;
        }
        
        /* Continue Watching Section */
        .continue-watching-slider {
            height: 240px;
        }
        
        .continue-watching-slider .swiper-slide {
            border: 2px solid #ff0000;
        }
        
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background-color: #333;
        }
        
        .progress {
            height: 100%;
            background-color: #ff0000;
            transition: width 0.3s ease;
        }
        
        .resume-time {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        /* Video Grid */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .video-card {
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .video-card:hover {
            transform: scale(1.02);
        }
        
        /* Thumbnail */
        .thumbnail-container {
            position: relative;
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 12px;
            background-color: #000;
            aspect-ratio: 16/9;
        }
        
        .thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        /* Watch Later Button */
        .watch-later-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .watch-later-btn:hover {
            background-color: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }
        
        .watch-later-btn.active {
            color: #ff0000;
        }
        
        .watch-later-btn.active i {
            animation: popIn 0.3s ease;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Video Info */
        .video-info {
            display: flex;
            gap: 12px;
        }
        
        .channel-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #ff0000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            overflow: hidden;
            position: relative;
        }
        
        .channel-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .verified-channel {
            position: absolute;
            bottom: -2px;
            right: -2px;
            background: #3ea6ff;
            color: white;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            border: 2px solid #0f0f0f;
        }
        
        .video-details h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 6px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.3;
        }
        
        .video-details p {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .channel-name {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Detail Page */
        .detail-page {
            display: none;
        }
        
        .video-container {
            display: flex;
            gap: 24px;
        }
        
        .video-player-section {
            flex: 7;
        }
        
        .sidebar {
            flex: 3;
            max-width: 400px;
        }
        
        .video-player {
            width: 100%;
            background-color: #000;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px;
            position: relative;
        }
        
        video {
            width: 100%;
            height: auto;
            display: block;
        }
        
        /* Plyr Player */
        .plyr-wrapper {
            width: 100%;
            max-width: 100%;
            margin: 0;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
        }
        
        .plyr {
            border-radius: 12px;
            overflow: hidden;
        }
        
        .plyr video {
            width: 100% !important;
            height: auto !important;
        }
        
        .video-title {
            font-size: 20px;
            font-weight: 600;
            margin: 12px 0;
            line-height: 1.4;
        }
        
        .video-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #303030;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .channel-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .channel-avatar-large {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ff0000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            overflow: hidden;
            position: relative;
        }
        
        .channel-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .channel-details {
            display: flex;
            flex-direction: column;
        }
        
        .channel-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .channel-subs {
            font-size: 13px;
            color: #aaa;
        }
        
        .subscribe-btn {
            background-color: #ff0000;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 10px;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .subscribe-btn:hover {
            background-color: #cc0000;
        }
        
        .subscribe-btn.subscribed {
            background-color: #303030;
            color: #aaa;
        }
        
        .subscribe-btn.subscribed:hover {
            background-color: #404040;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            background-color: #272727;
            border: none;
            color: #f1f1f1;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .action-btn:hover {
            background-color: #3f3f3f;
        }
        
        .action-btn.active {
            color: #ff0000;
        }
        
        .video-description {
            background-color: #272727;
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            line-height: 1.6;
            max-height: 200px;
            overflow-y: auto;
            font-size: 14px;
        }
        
        .views-date {
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            gap: 20px;
            font-size: 14px;
        }
        
        .comments-section {
            margin-top: 24px;
        }
        
        .comments-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .comment-input {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .comment-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #3ea6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .comment-user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .comment-box-container {
            flex: 1;
        }
        
        .comment-box {
            width: 100%;
            background: transparent;
            border: none;
            border-bottom: 1px solid #303030;
            color: #f1f1f1;
            padding: 8px 0;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .comment-box:focus {
            outline: none;
            border-bottom-color: #3ea6ff;
        }
        
        .comment-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .comment-button {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }
        
        .comment-button.cancel {
            background: transparent;
            color: #aaa;
        }
        
        .comment-button.submit {
            background-color: #3ea6ff;
            color: white;
        }
        
        .comment-button.submit:disabled {
            background-color: #1a5fa0;
            cursor: not-allowed;
        }
        
        .comment {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background-color: #1a1a1a;
            border-radius: 12px;
        }
        
        .comment-content h4 {
            font-size: 14px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .comment-text {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .comment-actions {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }
        
        .recommendations-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .recommendations-header h3 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .ai-badge {
            background-color: #3ea6ff;
            color: #0f0f0f;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .recommended-video {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
        }
        
        .recommended-video:hover {
            background-color: #272727;
        }
        
        .recommended-thumbnail {
            width: 168px;
            height: 94px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
            background-color: #333;
            position: relative;
        }
        
        .recommended-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .recommended-thumbnail .duration {
            position: absolute;
            bottom: 4px;
            right: 4px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 4px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .recommended-info h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.3;
        }
        
        .recommended-info p {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .back-home {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #f1f1f1;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            background-color: #272727;
            font-size: 14px;
        }
        
        .back-home:hover {
            background-color: #3f3f3f;
        }
        
        /* Lists Pages */
        .list-page {
            display: none;
            padding: 20px;
        }
        
        .list-header {
            margin-bottom: 30px;
        }
        
        .list-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .list-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .clear-list-btn {
            background-color: #ff4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s;
        }
        
        .clear-list-btn:hover {
            background-color: #cc0000;
        }
        
        .empty-list-message {
            text-align: center;
            padding: 60px 20px;
            color: #aaa;
        }
        
        .empty-list-message i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #666;
        }
        
        .empty-list-message h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #f1f1f1;
        }
        
        /* Remove from list button */
        .remove-from-list {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #ff4444;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 11;
        }
        
        .remove-from-list:hover {
            background-color: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }
        
        .video-card:hover .remove-from-list {
            opacity: 1;
        }
        
        /* Mobile Search */
        .mobile-search-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0f0f0f;
            z-index: 1000;
            display: none;
            flex-direction: column;
        }
        
        .mobile-search-header {
            display: flex;
            align-items: center;
            padding: 16px;
            background-color: #0f0f0f;
            border-bottom: 1px solid #303030;
        }
        
        .mobile-search-input {
            flex: 1;
            padding: 12px 16px;
            background-color: #121212;
            border: 1px solid #303030;
            border-radius: 20px;
            color: #f1f1f1;
            font-size: 16px;
            margin: 0 12px;
        }
        
        .mobile-search-close {
            background: none;
            border: none;
            color: #f1f1f1;
            font-size: 20px;
            cursor: pointer;
        }
        
        /* Loading Animation */
        .loading-animation {
            text-align: center;
            padding: 40px;
            color: #aaa;
        }
        
        .loading-animation i {
            font-size: 40px;
            margin-bottom: 20px;
            color: #ff0000;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        /* Subscription Count */
        .subscription-count {
            font-size: 12px;
            color: #aaa;
            margin-left: 8px;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .video-container {
                flex-direction: column;
            }
            
            .sidebar {
                max-width: 100%;
            }
            
            .search-container {
                flex: 0 1 400px;
                margin: 0 20px;
            }
            
            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .swiper {
                height: 240px;
            }
            
            .avatar-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .search-container {
                display: none;
            }
            
            .mobile-search-btn {
                display: block;
            }
            
            .video-actions {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .action-buttons {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }
            
            .recommended-video {
                flex-direction: column;
            }
            
            .recommended-thumbnail {
                width: 100%;
                height: 180px;
            }
            
            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }
            
            .swiper {
                height: 200px;
            }
            
            .continue-watching-slider {
                height: 200px;
            }
            
            .main-container {
                padding: 15px;
            }
            
            .refresh-btn {
                top: 70px;
                right: 10px;
                width: 40px;
                height: 40px;
            }
        }
        
        @media (max-width: 480px) {
            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 12px;
            }
            
            .video-details h3 {
                font-size: 14px;
            }
            
            .video-details p {
                font-size: 12px;
            }
            
            .channel-avatar {
                width: 32px;
                height: 32px;
            }
            
            .nav-container {
                padding: 0 15px;
            }
            
            .nav-item {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            .main-container {
                padding: 12px;
            }
            
            .avatar-modal-content {
                padding: 20px;
            }
            
            .avatar-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 10px;
            }
        }
        
        /* Offline Content */
        .offline-content {
            text-align: center;
            padding: 40px 20px;
        }
        
        .offline-icon {
            font-size: 64px;
            color: #666;
            margin-bottom: 20px;
        }
        
        .offline-content h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #f1f1f1;
        }
        
        .offline-content p {
            color: #aaa;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        /* No Results */
        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px 20px;
            color: #aaa;
        }
        
        .no-results h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #f1f1f1;
        }
    </style>
</head>
<body>
    <!-- Offline Message -->
    <div id="offlineMessage">
        <i class="fas fa-wifi"></i> Vous êtes hors ligne. Vérifiez votre connexion.
    </div>
    
    <!-- Refresh System -->
    <div class="refresh-indicator" id="refreshIndicator">
        <i class="fas fa-sync-alt fa-spin"></i> Actualisation...
    </div>
    
    <div class="refresh-btn" id="refreshButton" title="Actualiser">
        <i class="fas fa-sync-alt"></i>
    </div>
    
    <!-- Splash Screen -->
    <div id="splashScreen">
        <div class="splash-logo">
            <i class="fas fa-play-circle"></i>
            Stream Flix
        </div>
        <div class="splash-welcome">Bienvenue</div>
        <div class="loading-spinner"></div>
    </div>
    
    <!-- Avatar Selection Modal -->
    <div class="avatar-modal" id="avatarModal">
        <div class="avatar-modal-content">
            <div class="avatar-modal-header">
                <h2><i class="fas fa-user-circle"></i> Choisir votre avatar</h2>
                <button class="avatar-modal-close" id="avatarModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="avatar-grid" id="avatarGrid">
                <!-- Avatars will be dynamically added -->
            </div>
            <div class="avatar-upload">
                <input type="file" id="avatarUpload" accept="image/*">
                <label for="avatarUpload">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 32px;"></i>
                    <span>Télécharger votre propre avatar</span>
                    <small>JPG, PNG, GIF (max 2MB)</small>
                </label>
            </div>
            <div class="avatar-modal-actions">
                <button class="avatar-cancel-btn" id="avatarCancelBtn">Annuler</button>
                <button class="avatar-save-btn" id="avatarSaveBtn">Enregistrer</button>
            </div>
        </div>
    </div>
    
    <!-- Auth Screen -->
    <div id="authScreen">
        <div class="auth-container">
            <div class="auth-tabs">
                <button class="auth-tab" id="loginTab">Connexion</button>
                <button class="auth-tab active" id="registerTab">Créer un compte</button>
            </div>
            
            <div class="auth-form" id="loginForm">
                <h2>Content de vous revoir</h2>
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="Entrez votre email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" placeholder="Entrez votre mot de passe">
                </div>
                <div class="auth-error" id="loginError"></div>
                <button class="auth-button" id="loginButton">
                    <i class="fas fa-sign-in-alt"></i> Se connecter
                </button>
                
                <button class="google-auth-button" id="googleLoginButton">
                    <i class="fab fa-google"></i> Se connecter avec Google
                </button>
                
                <div class="auth-switch">
                    Pas de compte ? <span id="switchToRegister">Créer un compte</span>
                </div>
            </div>
            
            <div class="auth-form active" id="registerForm">
                <h2>Créer un compte</h2>
                <div class="form-group">
                    <label for="registerUsername">Nom d'utilisateur</label>
                    <input type="text" id="registerUsername" placeholder="Choisissez un nom d'utilisateur">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="Entrez votre email">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Mot de passe</label>
                    <input type="password" id="registerPassword" placeholder="Créez un mot de passe (min. 6 caractères)">
                </div>
                <div class="auth-error" id="registerError"></div>
                <button class="auth-button" id="registerButton">
                    <i class="fas fa-user-plus"></i> Créer le compte
                </button>
                
                <button class="google-auth-button" id="googleRegisterButton">
                    <i class="fab fa-google"></i> S'inscrire avec Google
                </button>
                
                <div class="auth-switch">
                    Déjà un compte ? <span id="switchToLogin">Se connecter</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mobile Search -->
    <div class="mobile-search-overlay" id="mobileSearchOverlay">
        <div class="mobile-search-header">
            <button class="mobile-search-close" id="mobileSearchClose">
                <i class="fas fa-arrow-left"></i>
            </button>
            <input type="text" class="mobile-search-input" id="mobileSearchInput" placeholder="Rechercher Streamflix">
            <button class="search-btn" id="mobileSearchBtn">
                <i class="fas fa-search"></i>
            </button>
        </div>
        <div class="search-suggestions" id="mobileSearchSuggestions"></div>
    </div>
    
    <!-- Main App -->
    <div id="mainApp">
        <header>
            <div class="logo-container">
                <button class="mobile-search-btn" id="mobileSearchBtnIcon" style="display: none; background: none; border: none; color: #f1f1f1; margin-right: 12px;">
                    <i class="fas fa-search"></i>
                </button>
                <div class="logo-image">
                    <img id="channelLogo" src="https://cdn.leonardo.ai/users/59cc19c6-be61-41ed-ab82-8485d4d58d54/generations/807f5487-c3b8-4ccd-9ab8-dabab318a67d/Phoenix_10_Create_a_clean_bold_modern_logo_for_an_app_named_St_0.jpg" alt="Streamflix Logo">
                </div>
                <a href="#" class="logo-text" id="homeLogo">
                    Streamflix
                </a>
            </div>
            
            <div class="search-container">
                <div class="search-box-container">
                    <input type="text" class="search-box" id="searchBox" placeholder="Rechercher" aria-label="Rechercher des vidéos">
                    <button class="search-btn" id="searchBtn" aria-label="Rechercher">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <button class="voice-search-btn" id="voiceSearchBtn" aria-label="Recherche vocale" title="Recherche vocale">
                    <i class="fas fa-microphone"></i>
                </button>
                
                <div class="search-suggestions" id="searchSuggestions">
                    <div class="recent-searches">
                        <span>Recherches récentes</span>
                        <span class="clear-recent" id="clearRecent">Tout effacer</span>
                    </div>
                </div>
            </div>
            
            <div class="user-actions">
                <div class="user-avatar" id="userAvatar">
                    <span id="avatarInitial">U</span>
                    <div class="user-menu" id="userMenu">
                        <div class="user-menu-item" id="changeAvatarBtn">
                            <i class="fas fa-user-circle"></i> Changer l'avatar
                        </div>
                        <div class="user-menu-item" id="watchHistoryBtn">
                            <i class="fas fa-history"></i> Historique
                        </div>
                        <div class="user-menu-item" id="watchLaterBtn">
                            <i class="fas fa-clock"></i> À regarder plus tard
                        </div>
                        <div class="user-menu-item logout" id="logoutButton">
                            <i class="fas fa-sign-out-alt"></i> Déconnexion
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Navigation -->
        <div class="nav-container">
            <div class="nav-items">
                <button class="nav-item active" data-category="all">Accueil</button>
                <button class="nav-item" data-category="trending">Tendances</button>
                <button class="nav-item" data-category="popular">Populaires</button>
                <button class="nav-item" data-category="recommended">Recommandés</button>
                <button class="nav-item" data-category="continue">Continuer à regarder</button>
                <button class="nav-item" data-category="action">Action</button>
                <button class="nav-item" data-category="horror">Horreur</button>
                <button class="nav-item" data-category="francais">Français</button>
            </div>
        </div>
        
        <!-- Home Page -->
        <div class="main-container" id="homePage">
            <!-- Continue Watching Section -->
            <div class="video-slider-container" id="continueWatchingSection">
                <div class="section-header">
                    <h2><i class="fas fa-play-circle"></i> Continuer à regarder</h2>
                    <a href="#" class="see-all" id="seeAllContinue">Voir tout</a>
                </div>
                <div class="swiper continue-watching-slider">
                    <div class="swiper-wrapper" id="continueWatchingSlider"></div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
            </div>
            
            <!-- Recommended for You Section -->
            <div class="video-slider-container" id="recommendedSection">
                <div class="section-header">
                    <h2><i class="fas fa-star"></i> Recommandé pour vous</h2>
                    <a href="#" class="see-all" id="seeAllRecommended">Voir tout</a>
                </div>
                <div class="swiper recommended-slider">
                    <div class="swiper-wrapper" id="recommendedSlider"></div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
            </div>
            
            <!-- Trending Movies Section -->
            <div class="video-slider-container" id="trendingSection">
                <div class="section-header">
                    <h2><i class="fas fa-fire"></i> Films tendance</h2>
                    <a href="#" class="see-all" id="seeAllTrending">Voir tout</a>
                </div>
                <div class="swiper trending-slider">
                    <div class="swiper-wrapper" id="trendingSlider"></div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
            </div>
            
            <!-- Popular This Week Section -->
            <div class="section-header">
                <h2><i class="fas fa-chart-line"></i> Populaire cette semaine</h2>
                <a href="#" class="see-all" id="seeAllPopular">Voir tout</a>
            </div>
            
            <div class="video-grid" id="popularVideosGrid"></div>
            
            <!-- All Movies Section -->
            <div class="section-header">
                <h2><i class="fas fa-film"></i> Tous les films</h2>
            </div>
            
            <div class="video-grid" id="videoGrid"></div>
            
            <!-- Offline Content -->
            <div id="offlineContent" class="offline-content" style="display: none;">
                <div class="offline-icon">
                    <i class="fas fa-wifi-slash"></i>
                </div>
                <h2>Pas de connexion Internet</h2>
                <p>Vous êtes hors ligne. Vérifiez votre connexion Internet et réessayez.</p>
                <p>Les vidéos apparaîtront lorsque vous serez de nouveau en ligne.</p>
            </div>
        </div>
        
        <!-- Watch History Page -->
        <div class="main-container list-page" id="watchHistoryPage">
            <div class="list-header">
                <h1><i class="fas fa-history"></i> Historique de visionnage</h1>
                <p>Films que vous avez regardés</p>
            </div>
            
            <div class="list-actions">
                <button class="clear-list-btn" id="clearHistoryBtn">
                    <i class="fas fa-trash"></i> Effacer l'historique
                </button>
            </div>
            
            <div class="video-grid" id="historyVideoGrid"></div>
            
            <div id="emptyHistoryMessage" class="empty-list-message" style="display: none;">
                <i class="fas fa-history"></i>
                <h3>Historique vide</h3>
                <p>Les films que vous regardez apparaîtront ici</p>
            </div>
        </div>
        
        <!-- Watch Later Page -->
        <div class="main-container list-page" id="watchLaterPage">
            <div class="list-header">
                <h1><i class="fas fa-clock"></i> À regarder plus tard</h1>
                <p>Films que vous avez sauvegardés</p>
            </div>
            
            <div class="list-actions">
                <button class="clear-list-btn" id="clearWatchLaterBtn">
                    <i class="fas fa-trash"></i> Tout supprimer
                </button>
            </div>
            
            <div class="video-grid" id="watchLaterGrid"></div>
            
            <div id="emptyWatchLaterMessage" class="empty-list-message" style="display: none;">
                <i class="fas fa-clock"></i>
                <h3>Liste vide</h3>
                <p>Ajoutez des films à regarder plus tard</p>
            </div>
        </div>
        
        <!-- Video Detail Page -->
        <div class="main-container detail-page" id="detailPage">
            <a href="#" class="back-home" id="backHomeBtn">
                <i class="fas fa-arrow-left"></i> Retour à l'accueil
            </a>
            
            <div class="video-container">
                <div class="video-player-section">
                    <!-- Plyr Video Player -->
                    <div class="video-player" id="videoPlayerContainer">
                        <div class="plyr-wrapper">
                            <video id="player" playsinline controls poster="">
                                <source src="" type="video/mp4">
                            </video>
                        </div>
                    </div>
                    
                    <h1 class="video-title" id="detailVideoTitle"></h1>
                    
                    <!-- Watch Later Button -->
                    <div class="feature-buttons">
                        <button class="feature-btn" id="watchLaterDetailBtn">
                            <i class="fas fa-clock"></i> À regarder plus tard
                        </button>
                        <button class="feature-btn" id="qualityBtn">
                            <i class="fas fa-hd"></i> Qualité: 1080p
                        </button>
                    </div>
                    
                    <div class="video-actions">
                        <div class="channel-info">
                            <div class="channel-avatar-large" id="detailChannelAvatar">
                                <img id="channelLogoDetail" src="" alt="Channel Logo">
                                <div class="verified-channel" style="display: none;">
                                    <i class="fas fa-check"></i>
                                </div>
                            </div>
                            <div class="channel-details">
                                <div class="channel-name" id="detailChannelName">
                                    <span id="channelNameText"></span>
                                    <i class="fas fa-check verified-badge" id="channelVerifiedBadge" style="display: none;"></i>
                                </div>
                                <div class="channel-subs" id="detailSubscribers"></div>
                            </div>
                            <button class="subscribe-btn" id="subscribeBtn">S'ABONNER</button>
                            <span class="subscription-count" id="subscriptionCount"></span>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="action-btn" id="likeBtn">
                                <i class="fas fa-thumbs-up"></i> <span id="likeCount">0</span>
                            </button>
                            <button class="action-btn" id="dislikeBtn">
                                <i class="fas fa-thumbs-down"></i> <span id="dislikeCount">0</span>
                            </button>
                            <button class="action-btn" id="shareBtn">
                                <i class="fas fa-share"></i> Partager
                            </button>
                            <button class="action-btn" id="saveBtn">
                                <i class="fas fa-bookmark"></i> Sauvegarder
                            </button>
                        </div>
                    </div>
                    
                    <div class="video-description">
                        <div class="views-date">
                            <span id="detailViews">0 vues</span>
                            <span id="detailDate">À l'instant</span>
                        </div>
                        <p id="detailDescription"></p>
                    </div>
                    
                    <div class="comments-section">
                        <div class="comments-title">
                            <span id="commentCount">Commentaires • 0</span>
                        </div>
                        
                        <div class="comment-input">
                            <div class="comment-user-avatar" id="commentUserAvatar">
                                <img id="commentUserAvatarImg" src="" alt="User Avatar">
                            </div>
                            <div class="comment-box-container">
                                <input type="text" class="comment-box" id="commentInput" placeholder="Ajouter un commentaire public...">
                                <div class="comment-buttons" id="commentButtons" style="display: none;">
                                    <button class="comment-button cancel" id="cancelComment">Annuler</button>
                                    <button class="comment-button submit" id="submitComment" disabled>Commenter</button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="commentsContainer"></div>
                    </div>
                </div>
                
                <div class="sidebar">
                    <div class="recommendations-header">
                        <h3>Recommandations</h3>
                        <div class="ai-badge">
                            <i class="fas fa-robot"></i> Recommandé par IA
                        </div>
                    </div>
                    
                    <div id="recommendationsContainer"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/plyr@3/dist/plyr.polyfilled.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initializeApp, 1000);
        });

        function initializeApp() {
            console.log('Streamflix initializing...');
            
            let currentUser = null;
            let videos = [];
            let currentVideoId = null;
            let currentVideoData = null;
            let isOnline = navigator.onLine;
            let plyrPlayer = null;
            let selectedAvatar = null;
            
            // User Data
            let watchHistory = [];
            let watchLater = [];
            let continueWatching = [];
            let userRecommendations = [];
            
            // Swiper instances
            let continueWatchingSwiper = null;
            let recommendedSwiper = null;
            let trendingSwiper = null;
            
            // Avatar options
            const avatarOptions = [
                "https://cdn.leonardo.ai/users/59cc19c6-be61-41ed-ab82-8485d4d58d54/generations/1f0d5ee7-e70f-64b0-8983-bc08f5c88071/ideogram-v3.0_Create_a_smiley_avatar_artist_shakira_lil_Wayne_icon_with_name_app_Streamflix-0.jpg",
                "https://cdn.leonardo.ai/users/59cc19c6-be61-41ed-ab82-8485d4d58d54/generations/10cf07d4-b24b-41b7-b5e9-0f7fbe11981f/Default_Create_a_smiley_avatar_artist_icon_Streamflix_app_1.jpg",
                "https://cdn.leonardo.ai/users/59cc19c6-be61-41ed-ab82-8485d4d58d54/generations/df5b3bd5-e133-4420-b02a-cf8195a0d6a3/ideogram-v3.0_Create_a_smiley_avatar_artist_shakira_lil_Wayne_icon_with_name_app_Streamflix-0.jpg",
                "https://cdn.leonardo.ai/users/59cc19c6-be61-41ed-ab82-8485d4d58d54/generations/0b5191ca-a702-424d-8105-12b637b5a7a0/ideogram-v3.0_Create_a_smiley_avatar_artist_shakira_lil_Wayne_icon_with_name_app_Streamflix-0.jpg",
                "https://cdn.leonardo.ai/users/59cc19c6-be61-41ed-ab82-8485d4d58d54/generations/4d6bdcd8-9f6c-4ce8-aa22-843ccb4bae19/ideogram-v3.0_Create_a_smiley_avatar_artist_shakira_lil_Wayne_icon_with_name_app_Streamflix-0.jpg",
                "https://cdn.leonardo.ai/users/59cc19c6-be61-41ed-ab82-8485d4d58d54/generations/55f3a359-45ed-4209-88e6-9c7c8ccd85a8/Default_Create_a_smiley_avatar_artist_icon_Streamflix_app_0.jpg",
                "https://cdn.leonardo.ai/users/59cc19c6-be61-41ed-ab82-8485d4d58d54/generations/8b3ba748-5543-42a7-96e7-d952e57e5a6f/Default_Create_a_smiley_avatar_artist_icon_Streamflix_app_3.jpg",
                "https://cdn.leonardo.ai/users/59cc19c6-be61-41ed-ab82-8485d4d58d54/generations/1967dd96-3d2f-4678-b4aa-8b58377e5c05/ideogram-v3.0_Create_a_smiley_avatar_artist_shakira_lil_Wayne_icon_with_name_app_Streamflix-0.jpg"
            ];
            
            const db = window.firebase.database;
            const auth = window.firebase.auth;
            const fbFunctions = window.firebase.functions;
            
            // Video Catalog
            const videoData = [
                {
                    id: 1,
                    title: "À Bout - Film Complet en Français",
                    channel: "Streamflix Films",
                    channelId: "streamflix_films",
                    channelInitial: "S",
                    views: 125000,
                    uploadDate: Date.now() - 7 * 24 * 60 * 60 * 1000,
                    duration: "1:45:00",
                    thumbnail: "https://occ-0-1305-3934.1.nflxso.net/dnm/api/v6/6AYY37jfdO6hpXcMjf9Yu5cnmO0/AAAABeQAFqlv9RjvBQmbubUxtbv7-b1aBTNdW70_7SrRKZCp5h41B2TUTvPyPXrbdqXVCE_aXw1q01jLXSjOqWQeET2tfTRCr5qL_I4G.jpg?r=6bc",
                    videoUrl: "https://archive.org/download/145134979426528090/-145134979426528090.mp4",
                    description: "Quel sera le coup de grâce ? Une journée affreusement pénible pousse une mère célibataire travailleuse vers le point de rupture… et un acte de désespoir choquant. Un drame psychologique intense qui explore les limites de la résistance humaine face à l'adversité quotidienne.",
                    subscribers: 50000,
                    likes: 2500,
                    dislikes: 150,
                    comments: 340,
                    tags: ["drame", "thriller", "français", "psychologique", "mère célibataire"],
                    verified: true,
                    categories: ["drame", "thriller", "français", "nouveau"]
                },
                {
                    id: 2,
                    title: "Badland Hunters Film complet Française",
                    channel: "Streamflix Action",
                    channelId: "streamflix_action",
                    channelInitial: "S",
                    views: 98000,
                    uploadDate: Date.now() - 14 * 24 * 60 * 60 * 1000,
                    duration: "1:52:00",
                    thumbnail: "https://occ-0-1323-3933.1.nflxso.net/dnm/api/v6/E8vDc_W8CLv7-yMQu8KMEC7Rrr8/AAAABaMYW0BRFCfHk0kdTPLUv9CNBe_2aoVquNCgcxfXovE0RJDBDvFATZHtF2Rs8_B7YHJm0RoXR8dIB7RZdXdjdP9iMF9JNxNhMzcP.jpg?r=533",
                    videoUrl: "https://archive.org/download/badland-hunters-version-francaise-360-p/Badland_Hunters_%5BVersion_fran%C3%A7aise%5D_360P.mp4",
                    description: "Badland Hunters - Un film d'action post-apocalyptique intense. Dans un monde ravagé, des chasseurs survivent dans les badlands. Quand un groupe de survivants est kidnappé par une secte dangereuse, un chasseur solitaire se lance dans une mission de sauvetage désespérée.",
                    subscribers: 75000,
                    likes: 4200,
                    dislikes: 200,
                    comments: 560,
                    tags: ["action", "post-apocalyptique", "français", "chasseurs", "survie"],
                    verified: true,
                    categories: ["action", "survie", "français", "nouveau", "thriller"]
                },
                {
                    id: 3,
                    title: "Des rats se transforment en zombies !",
                    channel: "Streamflix Horror",
                    channelId: "streamflix_horror",
                    channelInitial: "S",
                    views: 150000,
                    uploadDate: Date.now() - 3 * 24 * 60 * 60 * 1000,
                    duration: "1:32:15",
                    thumbnail: "https://archive.org/download/11d-8d-0d-1-2852-4a-87-b-739-d-5fac-85f-6d-8c/11d8d0d1-2852-4a87-b739-d5fac85f6d8c.jpeg",
                    videoUrl: "https://archive.org/download/des-rats-se-transforment-en-zombies-une-horde-de-rats-mutants-attaque-feroceme/YTDown.com_YouTube_Media_Z91WwO5nCyE_001_1080p.mp4",
                    description: "💕【Sous licence officielle】Toutes les vidéos de cette chaîne sont sous licence. 🙌Abonnez-vous pour être informé des nouvelles vidéos. Un film d'horreur intense où des rats se transforment en zombies ! Une horde de rats mutants attaque férocement des survivants qui tentent désespérément de s'échapper d'un wagon de train exigu. Suspense, action et horreur garantis !",
                    subscribers: 120000,
                    likes: 6800,
                    dislikes: 300,
                    comments: 890,
                    tags: ["horror", "zombie", "rats", "mutants", "survival", "train"],
                    verified: true,
                    categories: ["horror", "zombie", "thriller", "survie", "français"]
                },
                {
                    id: 4,
                    title: "🦖🔬💥 Lab T Rex Escaped",
                    channel: "YOUKU Monsters",
                    channelId: "youku_monsters",
                    channelInitial: "Y",
                    views: 85000,
                    uploadDate: Date.now() - 21 * 24 * 60 * 60 * 1000,
                    duration: "1:15:00",
                    thumbnail: "https://img.youtube.com/vi/d7yqZf6Y43w/maxresdefault.jpg",
                    videoUrl: "https://archive.org/download/lab-t-rex-escaped-the-killing-begins-are-metamorphosis-youku-monster-movie/%F0%9F%A6%96%F0%9F%94%AC%F0%9F%92%A5Lab%20T-Rex%20escaped%2C%20the%20killing%20begins%21%20_are%20%20Metamorphosis%20_%20YOUKU%20MONSTER%20MOVIE.mp4",
                    description: "Un laboratoire génétique secret perd le contrôle de son expérience la plus dangereuse : un T-Rex génétiquement modifié. La créature s'échappe et commence une série de meurtres horribles. Une équipe de scientifiques et de soldats doit l'arrêter avant qu'elle ne détruise la ville entière.",
                    subscribers: 95000,
                    likes: 5100,
                    dislikes: 180,
                    comments: 720,
                    tags: ["monstre", "t-rex", "laboratoire", "science-fiction", "horreur", "action"],
                    verified: true,
                    categories: ["monstre", "science-fiction", "horreur", "action", "thriller"]
                }
            ];

            // DOM Elements
            const DOM = {
                // Basic elements
                splashScreen: document.getElementById('splashScreen'),
                authScreen: document.getElementById('authScreen'),
                mainApp: document.getElementById('mainApp'),
                homePage: document.getElementById('homePage'),
                detailPage: document.getElementById('detailPage'),
                videoGrid: document.getElementById('videoGrid'),
                offlineMessage: document.getElementById('offlineMessage'),
                homeLogo: document.getElementById('homeLogo'),
                backHomeBtn: document.getElementById('backHomeBtn'),
                
                // Refresh elements
                refreshIndicator: document.getElementById('refreshIndicator'),
                refreshButton: document.getElementById('refreshButton'),
                
                // Avatar modal
                avatarModal: document.getElementById('avatarModal'),
                avatarModalClose: document.getElementById('avatarModalClose'),
                avatarGrid: document.getElementById('avatarGrid'),
                avatarUpload: document.getElementById('avatarUpload'),
                avatarCancelBtn: document.getElementById('avatarCancelBtn'),
                avatarSaveBtn: document.getElementById('avatarSaveBtn'),
                changeAvatarBtn: document.getElementById('changeAvatarBtn'),
                
                // List pages
                watchHistoryPage: document.getElementById('watchHistoryPage'),
                watchLaterPage: document.getElementById('watchLaterPage'),
                historyVideoGrid: document.getElementById('historyVideoGrid'),
                watchLaterGrid: document.getElementById('watchLaterGrid'),
                emptyHistoryMessage: document.getElementById('emptyHistoryMessage'),
                emptyWatchLaterMessage: document.getElementById('emptyWatchLaterMessage'),
                
                // User menu buttons
                watchHistoryBtn: document.getElementById('watchHistoryBtn'),
                watchLaterBtn: document.getElementById('watchLaterBtn'),
                
                // Clear buttons
                clearHistoryBtn: document.getElementById('clearHistoryBtn'),
                clearWatchLaterBtn: document.getElementById('clearWatchLaterBtn'),
                
                // Slider containers
                continueWatchingSlider: document.getElementById('continueWatchingSlider'),
                recommendedSlider: document.getElementById('recommendedSlider'),
                trendingSlider: document.getElementById('trendingSlider'),
                popularVideosGrid: document.getElementById('popularVideosGrid'),
                
                // See all buttons
                seeAllContinue: document.getElementById('seeAllContinue'),
                seeAllRecommended: document.getElementById('seeAllRecommended'),
                seeAllTrending: document.getElementById('seeAllTrending'),
                seeAllPopular: document.getElementById('seeAllPopular'),
                
                // Watch later button
                watchLaterDetailBtn: document.getElementById('watchLaterDetailBtn'),
                
                // Auth elements
                loginTab: document.getElementById('loginTab'),
                registerTab: document.getElementById('registerTab'),
                loginForm: document.getElementById('loginForm'),
                registerForm: document.getElementById('registerForm'),
                loginEmail: document.getElementById('loginEmail'),
                loginPassword: document.getElementById('loginPassword'),
                loginButton: document.getElementById('loginButton'),
                loginError: document.getElementById('loginError'),
                registerUsername: document.getElementById('registerUsername'),
                registerEmail: document.getElementById('registerEmail'),
                registerPassword: document.getElementById('registerPassword'),
                registerButton: document.getElementById('registerButton'),
                registerError: document.getElementById('registerError'),
                switchToRegister: document.getElementById('switchToRegister'),
                switchToLogin: document.getElementById('switchToLogin'),
                googleLoginButton: document.getElementById('googleLoginButton'),
                googleRegisterButton: document.getElementById('googleRegisterButton'),
                
                // Search elements
                searchBox: document.getElementById('searchBox'),
                searchBtn: document.getElementById('searchBtn'),
                voiceSearchBtn: document.getElementById('voiceSearchBtn'),
                searchSuggestionsEl: document.getElementById('searchSuggestions'),
                clearRecentBtn: document.getElementById('clearRecent'),
                
                // User avatar
                userAvatar: document.getElementById('userAvatar'),
                avatarInitial: document.getElementById('avatarInitial'),
                userMenu: document.getElementById('userMenu'),
                logoutButton: document.getElementById('logoutButton'),
                
                // Mobile search
                mobileSearchBtnIcon: document.getElementById('mobileSearchBtnIcon'),
                mobileSearchOverlay: document.getElementById('mobileSearchOverlay'),
                mobileSearchClose: document.getElementById('mobileSearchClose'),
                mobileSearchInput: document.getElementById('mobileSearchInput'),
                mobileSearchBtn: document.getElementById('mobileSearchBtn'),
                mobileSearchSuggestions: document.getElementById('mobileSearchSuggestions'),
                
                // Detail page elements
                player: document.getElementById('player'),
                detailVideoTitle: document.getElementById('detailVideoTitle'),
                channelNameText: document.getElementById('channelNameText'),
                channelVerifiedBadge: document.getElementById('channelVerifiedBadge'),
                detailSubscribers: document.getElementById('detailSubscribers'),
                detailViews: document.getElementById('detailViews'),
                detailDate: document.getElementById('detailDate'),
                detailDescription: document.getElementById('detailDescription'),
                likeBtn: document.getElementById('likeBtn'),
                dislikeBtn: document.getElementById('dislikeBtn'),
                likeCount: document.getElementById('likeCount'),
                dislikeCount: document.getElementById('dislikeCount'),
                subscribeBtn: document.getElementById('subscribeBtn'),
                subscriptionCount: document.getElementById('subscriptionCount'),
                commentCount: document.getElementById('commentCount'),
                commentsContainer: document.getElementById('commentsContainer'),
                recommendationsContainer: document.getElementById('recommendationsContainer'),
                commentInput: document.getElementById('commentInput'),
                commentUserAvatar: document.getElementById('commentUserAvatar'),
                commentUserAvatarImg: document.getElementById('commentUserAvatarImg'),
                commentButtons: document.getElementById('commentButtons'),
                cancelComment: document.getElementById('cancelComment'),
                submitComment: document.getElementById('submitComment'),
                shareBtn: document.getElementById('shareBtn'),
                saveBtn: document.getElementById('saveBtn'),
                
                // Navigation
                navItems: document.querySelectorAll('.nav-item')
            };

            function init() {
                console.log('Streamflix initialization complete');
                
                updateNetworkStatus();
                window.addEventListener('online', updateNetworkStatus);
                window.addEventListener('offline', updateNetworkStatus);
                
                checkScreenSize();
                window.addEventListener('resize', checkScreenSize);
                
                setTimeout(() => {
                    DOM.splashScreen.style.opacity = '0';
                    setTimeout(() => {
                        DOM.splashScreen.style.display = 'none';
                        showAuthScreen();
                        switchAuthTab('register');
                        auth.onAuthStateChanged(handleAuthStateChanged);
                    }, 500);
                }, 1500);
                
                setupEventListeners();
                setupPullToRefresh();
                loadLocalData();
                initAvatarGrid();
            }

            function initAvatarGrid() {
                DOM.avatarGrid.innerHTML = '';
                avatarOptions.forEach((avatarUrl, index) => {
                    const avatarOption = document.createElement('div');
                    avatarOption.className = 'avatar-option';
                    avatarOption.dataset.avatar = avatarUrl;
                    avatarOption.innerHTML = `<img src="${avatarUrl}" alt="Avatar ${index + 1}">`;
                    
                    avatarOption.addEventListener('click', () => {
                        document.querySelectorAll('.avatar-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        avatarOption.classList.add('selected');
                        selectedAvatar = avatarUrl;
                    });
                    
                    DOM.avatarGrid.appendChild(avatarOption);
                });
            }

            function setupPullToRefresh() {
                let touchStartY = 0;
                let touchCurrentY = 0;
                let isDragging = false;
                
                document.addEventListener('touchstart', function(e) {
                    if (window.scrollY === 0) {
                        touchStartY = e.touches[0].clientY;
                        isDragging = true;
                    }
                });
                
                document.addEventListener('touchmove', function(e) {
                    if (!isDragging) return;
                    
                    touchCurrentY = e.touches[0].clientY;
                    const diff = touchCurrentY - touchStartY;
                    
                    if (diff > 0 && window.scrollY === 0) {
                        e.preventDefault();
                        const progress = Math.min(diff / 150, 1);
                        DOM.refreshIndicator.style.transform = `translateY(${progress * 60 - 60}px)`;
                        
                        if (progress === 1 && !isRefreshing) {
                            triggerRefresh();
                        }
                    }
                });
                
                document.addEventListener('touchend', function() {
                    if (isDragging) {
                        DOM.refreshIndicator.style.transform = 'translateY(-100%)';
                        isDragging = false;
                    }
                });
                
                DOM.refreshButton.addEventListener('click', triggerRefresh);
            }

            let isRefreshing = false;
            function triggerRefresh() {
                if (isRefreshing) return;
                
                isRefreshing = true;
                DOM.refreshIndicator.classList.add('active');
                
                // Show refreshing animation
                DOM.refreshButton.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i>';
                
                // Refresh data
                setTimeout(async () => {
                    if (currentUser) {
                        await syncFromFirebase(currentUser.uid);
                    }
                    loadVideos().then(() => {
                        renderHomePage();
                        showNotification('Actualisation terminée');
                    });
                    
                    // Reset UI
                    setTimeout(() => {
                        DOM.refreshIndicator.classList.remove('active');
                        DOM.refreshButton.innerHTML = '<i class="fas fa-sync-alt"></i>';
                        isRefreshing = false;
                    }, 1000);
                }, 1500);
            }

            async function loadLocalData() {
                const localHistory = JSON.parse(localStorage.getItem('streamflix_watch_history')) || [];
                const localWatchLater = JSON.parse(localStorage.getItem('streamflix_watch_later')) || [];
                const localContinue = JSON.parse(localStorage.getItem('streamflix_continue_watching')) || [];
                const localAvatar = localStorage.getItem('streamflix_user_avatar');
                
                watchHistory = localHistory;
                watchLater = localWatchLater;
                continueWatching = localContinue;
                
                if (localAvatar && currentUser) {
                    currentUser.photoURL = localAvatar;
                    updateUserAvatarUI(localAvatar);
                }
            }

            async function saveLocalData() {
                localStorage.setItem('streamflix_watch_history', JSON.stringify(watchHistory));
                localStorage.setItem('streamflix_watch_later', JSON.stringify(watchLater));
                localStorage.setItem('streamflix_continue_watching', JSON.stringify(continueWatching));
                
                if (currentUser && currentUser.photoURL) {
                    localStorage.setItem('streamflix_user_avatar', currentUser.photoURL);
                }
            }

            async function syncUserDataToFirebase(userId) {
                if (!isOnline || !userId) return;
                
                try {
                    const userRef = fbFunctions.ref(db, `users/${userId}`);
                    const userData = {
                        watchHistory: watchHistory,
                        watchLater: watchLater,
                        continueWatching: continueWatching,
                        photoURL: currentUser.photoURL || '',
                        lastSync: Date.now()
                    };
                    
                    await fbFunctions.set(userRef, userData);
                    console.log('User data synced to Firebase');
                } catch (error) {
                    console.error('Error syncing to Firebase:', error);
                }
            }

            async function syncFromFirebase(userId) {
                if (!isOnline || !userId) return;
                
                try {
                    const userRef = fbFunctions.ref(db, `users/${userId}`);
                    const snapshot = await fbFunctions.get(userRef);
                    
                    if (snapshot.exists()) {
                        const firebaseData = snapshot.val();
                        
                        if (firebaseData.watchHistory) {
                            watchHistory = mergeArraysUnique(watchHistory, firebaseData.watchHistory, 'videoId');
                        }
                        if (firebaseData.watchLater) {
                            watchLater = mergeArraysUnique(watchLater, firebaseData.watchLater, 'videoId');
                        }
                        if (firebaseData.continueWatching) {
                            continueWatching = mergeArraysUnique(continueWatching, firebaseData.continueWatching, 'videoId');
                        }
                        if (firebaseData.photoURL && firebaseData.photoURL !== currentUser.photoURL) {
                            currentUser.photoURL = firebaseData.photoURL;
                            updateUserAvatarUI(firebaseData.photoURL);
                            localStorage.setItem('streamflix_user_avatar', firebaseData.photoURL);
                        }
                        
                        saveLocalData();
                    }
                } catch (error) {
                    console.error('Error syncing from Firebase:', error);
                }
            }

            function mergeArraysUnique(localArray, firebaseArray, idKey) {
                const merged = [...localArray];
                const seen = new Set(localArray.map(item => item[idKey]));
                
                firebaseArray.forEach(item => {
                    if (!seen.has(item[idKey])) {
                        merged.push(item);
                        seen.add(item[idKey]);
                    }
                });
                
                return merged;
            }

            async function handleAuthStateChanged(user) {
                if (user) {
                    console.log('User logged in:', user.email);
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName || 'Utilisateur',
                        photoURL: user.photoURL || ''
                    };
                    
                    await loadUserData(user.uid);
                    await syncFromFirebase(user.uid);
                    showMainApp();
                    loadVideos();
                    updateUserUI();
                }
            }

            async function loadUserData(userId) {
                try {
                    const userRef = fbFunctions.ref(db, `users/${userId}`);
                    const snapshot = await fbFunctions.get(userRef);
                    
                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        currentUser = { ...currentUser, ...userData };
                        updateUserUI();
                    } else {
                        await createUserData(userId);
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                }
            }

            async function createUserData(userId) {
                const userRef = fbFunctions.ref(db, `users/${userId}`);
                const userData = {
                    username: currentUser.displayName,
                    email: currentUser.email,
                    createdAt: Date.now(),
                    photoURL: currentUser.photoURL || avatarOptions[0],
                    watchHistory: [],
                    watchLater: [],
                    continueWatching: [],
                    preferences: []
                };
                
                await fbFunctions.set(userRef, userData);
                console.log('User data created in Firebase');
                
                // Set default avatar
                currentUser.photoURL = avatarOptions[0];
                updateUserAvatarUI(avatarOptions[0]);
                localStorage.setItem('streamflix_user_avatar', avatarOptions[0]);
            }

            function setupEventListeners() {
                // Avatar modal
                DOM.changeAvatarBtn.addEventListener('click', showAvatarModal);
                DOM.avatarModalClose.addEventListener('click', hideAvatarModal);
                DOM.avatarCancelBtn.addEventListener('click', hideAvatarModal);
                DOM.avatarSaveBtn.addEventListener('click', saveAvatar);
                DOM.avatarUpload.addEventListener('change', handleAvatarUpload);
                
                // List pages
                DOM.watchHistoryBtn.addEventListener('click', showWatchHistory);
                DOM.clearHistoryBtn.addEventListener('click', clearWatchHistory);
                DOM.watchLaterBtn.addEventListener('click', showWatchLater);
                DOM.clearWatchLaterBtn.addEventListener('click', clearWatchLater);
                
                // See all buttons
                DOM.seeAllContinue.addEventListener('click', (e) => {
                    e.preventDefault();
                    showContinueWatchingPage();
                });
                
                DOM.seeAllRecommended.addEventListener('click', (e) => {
                    e.preventDefault();
                    showRecommendedPage();
                });
                
                // Watch later button
                DOM.watchLaterDetailBtn.addEventListener('click', toggleWatchLater);
                
                // Auth
                DOM.loginTab.addEventListener('click', () => switchAuthTab('login'));
                DOM.registerTab.addEventListener('click', () => switchAuthTab('register'));
                DOM.switchToRegister.addEventListener('click', () => switchAuthTab('register'));
                DOM.switchToLogin.addEventListener('click', () => switchAuthTab('login'));
                DOM.loginButton.addEventListener('click', handleLogin);
                DOM.registerButton.addEventListener('click', handleRegister);
                DOM.googleLoginButton.addEventListener('click', () => handleGoogleAuth('login'));
                DOM.googleRegisterButton.addEventListener('click', () => handleGoogleAuth('register'));
                DOM.logoutButton.addEventListener('click', handleLogout);
                
                // Navigation
                DOM.homeLogo.addEventListener('click', (e) => {
                    e.preventDefault();
                    showHomePage();
                });
                DOM.backHomeBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    showHomePage();
                });
                
                // User menu
                DOM.userAvatar.addEventListener('click', toggleUserMenu);
                document.addEventListener('click', (event) => {
                    if (!DOM.userAvatar.contains(event.target) && !DOM.userMenu.contains(event.target)) {
                        DOM.userMenu.style.display = 'none';
                    }
                });
                
                // Search
                DOM.searchBtn.addEventListener('click', () => performSearch(DOM.searchBox.value));
                DOM.searchBox.addEventListener('keypress', (e) => e.key === 'Enter' && performSearch(DOM.searchBox.value));
                DOM.clearRecentBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    clearRecentSearches();
                });
                
                // Mobile search
                DOM.mobileSearchBtnIcon.addEventListener('click', showMobileSearch);
                DOM.mobileSearchClose.addEventListener('click', hideMobileSearch);
                DOM.mobileSearchBtn.addEventListener('click', () => {
                    performSearch(DOM.mobileSearchInput.value);
                    hideMobileSearch();
                });
                
                // Navigation items
                DOM.navItems.forEach(item => {
                    item.addEventListener('click', function() {
                        DOM.navItems.forEach(navItem => navItem.classList.remove('active'));
                        this.classList.add('active');
                        const category = this.getAttribute('data-category');
                        filterVideosByCategory(category);
                    });
                });
            }

            function showAvatarModal() {
                DOM.avatarModal.style.display = 'flex';
                selectedAvatar = currentUser.photoURL || avatarOptions[0];
                
                // Select current avatar
                document.querySelectorAll('.avatar-option').forEach(opt => {
                    opt.classList.toggle('selected', opt.dataset.avatar === selectedAvatar);
                });
            }

            function hideAvatarModal() {
                DOM.avatarModal.style.display = 'none';
                DOM.avatarUpload.value = '';
            }

            async function saveAvatar() {
                if (!selectedAvatar) return;
                
                if (currentUser) {
                    currentUser.photoURL = selectedAvatar;
                    updateUserAvatarUI(selectedAvatar);
                    localStorage.setItem('streamflix_user_avatar', selectedAvatar);
                    
                    // Save to Firebase
                    if (isOnline) {
                        const userRef = fbFunctions.ref(db, `users/${currentUser.uid}`);
                        await fbFunctions.update(userRef, { photoURL: selectedAvatar });
                    }
                    
                    showNotification('Avatar mis à jour avec succès !');
                }
                
                hideAvatarModal();
            }

            function handleAvatarUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!file.type.startsWith('image/')) {
                    alert('Veuillez sélectionner une image valide');
                    return;
                }
                
                if (file.size > 2 * 1024 * 1024) {
                    alert('L\'image est trop volumineuse (max 2MB)');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    selectedAvatar = e.target.result;
                    
                    // Create temporary avatar option
                    const tempAvatar = document.createElement('div');
                    tempAvatar.className = 'avatar-option selected';
                    tempAvatar.innerHTML = `<img src="${selectedAvatar}" alt="Avatar uploadé">`;
                    
                    // Clear selection and add temp avatar
                    document.querySelectorAll('.avatar-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    tempAvatar.classList.add('selected');
                    
                    // Insert at beginning
                    if (DOM.avatarGrid.firstChild) {
                        DOM.avatarGrid.insertBefore(tempAvatar, DOM.avatarGrid.firstChild);
                    }
                };
                
                reader.readAsDataURL(file);
            }

            function updateUserAvatarUI(avatarUrl) {
                if (avatarUrl) {
                    DOM.avatarInitial.style.display = 'none';
                    DOM.userAvatar.innerHTML = `<img src="${avatarUrl}" alt="${currentUser.displayName}">`;
                    
                    // Update comment avatar
                    DOM.commentUserAvatarImg.src = avatarUrl;
                    DOM.commentUserAvatarImg.style.display = 'block';
                    DOM.commentUserAvatar.innerHTML = '';
                    DOM.commentUserAvatar.appendChild(DOM.commentUserAvatarImg);
                } else {
                    DOM.avatarInitial.textContent = currentUser.displayName.charAt(0).toUpperCase();
                    DOM.avatarInitial.style.display = 'flex';
                    DOM.userAvatar.innerHTML = `<span id="avatarInitial">${currentUser.displayName.charAt(0).toUpperCase()}</span>`;
                }
            }

            function updateUserUI() {
                updateUserAvatarUI(currentUser.photoURL);
            }

            function toggleUserMenu() {
                DOM.userMenu.style.display = DOM.userMenu.style.display === 'block' ? 'none' : 'block';
            }

            function showHomePage() {
                DOM.homePage.style.display = 'block';
                DOM.detailPage.style.display = 'none';
                DOM.watchHistoryPage.style.display = 'none';
                DOM.watchLaterPage.style.display = 'none';
                
                renderHomePage();
                window.scrollTo(0, 0);
            }

            async function loadVideos() {
                try {
                    // Load videos from Firebase or use local data
                    videos = videoData;
                    renderHomePage();
                } catch (error) {
                    console.error('Error loading videos:', error);
                    videos = videoData;
                    renderHomePage();
                }
            }

            function renderHomePage() {
                renderVideoGrid(videos);
                renderContinueWatching();
                renderRecommendedVideos();
                renderTrendingVideos();
                renderPopularVideos();
            }

            function renderContinueWatching() {
                DOM.continueWatchingSlider.innerHTML = '';
                
                if (continueWatching.length === 0) {
                    DOM.continueWatchingSection.style.display = 'none';
                    return;
                }
                
                DOM.continueWatchingSection.style.display = 'block';
                
                continueWatching.slice(0, 5).forEach(item => {
                    const video = videos.find(v => v.id === item.videoId);
                    if (!video) return;
                    
                    const slide = document.createElement('div');
                    slide.className = 'swiper-slide';
                    slide.setAttribute('data-id', video.id);
                    
                    const progressPercent = item.progress ? (item.progress / getDurationInSeconds(video.duration)) * 100 : 0;
                    const isInWatchLater = watchLater.some(w => w.videoId === video.id);
                    
                    slide.innerHTML = `
                        <button class="watch-later-btn ${isInWatchLater ? 'active' : ''}" data-id="${video.id}">
                            <i class="fas fa-clock"></i>
                        </button>
                        <img src="${video.thumbnail}" alt="${video.title}" class="slider-thumbnail">
                        <div class="progress-bar">
                            <div class="progress" style="width: ${progressPercent}%"></div>
                        </div>
                        <div class="resume-time">
                            ${formatTime(item.progress || 0)} / ${video.duration}
                        </div>
                        <div class="slider-overlay">
                            <div class="slider-title">${video.title}</div>
                            <div class="slider-channel">
                                ${video.channel}
                                ${video.verified ? '<i class="fas fa-check verified-badge"></i>' : ''}
                            </div>
                        </div>
                    `;
                    
                    slide.addEventListener('click', () => {
                        showVideoDetailDirect(video.id, item.progress || 0);
                    });
                    
                    // Watch later button
                    const watchLaterBtn = slide.querySelector('.watch-later-btn');
                    watchLaterBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleWatchLaterForVideo(video.id);
                    });
                    
                    DOM.continueWatchingSlider.appendChild(slide);
                });
                
                // Initialize or update Swiper
                if (continueWatchingSwiper) {
                    continueWatchingSwiper.update();
                } else {
                    continueWatchingSwiper = new Swiper('.continue-watching-slider', {
                        slidesPerView: 1.2,
                        spaceBetween: 10,
                        navigation: {
                            nextEl: '#continueWatchingSection .swiper-button-next',
                            prevEl: '#continueWatchingSection .swiper-button-prev',
                        },
                        breakpoints: {
                            640: { slidesPerView: 2.2, spaceBetween: 15 },
                            1024: { slidesPerView: 3.2, spaceBetween: 20 }
                        }
                    });
                }
            }

            function renderRecommendedVideos() {
                DOM.recommendedSlider.innerHTML = '';
                
                // Generate recommendations
                let recommendedVideos = [];
                
                if (watchHistory.length > 0) {
                    const lastWatched = watchHistory[0];
                    const lastVideo = videos.find(v => v.id === lastWatched.videoId);
                    
                    if (lastVideo) {
                        recommendedVideos = videos.filter(v => 
                            v.id !== lastVideo.id && 
                            !watchHistory.some(h => h.videoId === v.id) &&
                            v.tags.some(tag => lastVideo.tags.includes(tag))
                        ).slice(0, 5);
                    }
                }
                
                if (recommendedVideos.length === 0) {
                    recommendedVideos = videos
                        .filter(v => !watchHistory.some(h => h.videoId === v.id))
                        .sort(() => Math.random() - 0.5)
                        .slice(0, 5);
                }
                
                if (recommendedVideos.length === 0) {
                    DOM.recommendedSection.style.display = 'none';
                    return;
                }
                
                DOM.recommendedSection.style.display = 'block';
                userRecommendations = recommendedVideos;
                
                recommendedVideos.forEach(video => {
                    const slide = createVideoSlide(video);
                    DOM.recommendedSlider.appendChild(slide);
                });
                
                if (recommendedSwiper) {
                    recommendedSwiper.update();
                } else {
                    recommendedSwiper = new Swiper('.recommended-slider', {
                        slidesPerView: 1.2,
                        spaceBetween: 10,
                        navigation: {
                            nextEl: '#recommendedSection .swiper-button-next',
                            prevEl: '#recommendedSection .swiper-button-prev',
                        },
                        breakpoints: {
                            640: { slidesPerView: 2.2, spaceBetween: 15 },
                            1024: { slidesPerView: 3.2, spaceBetween: 20 }
                        }
                    });
                }
            }

            function renderTrendingVideos() {
                DOM.trendingSlider.innerHTML = '';
                
                const trendingVideos = [...videos]
                    .sort((a, b) => b.views - a.views)
                    .slice(0, 5);
                
                trendingVideos.forEach(video => {
                    const slide = createVideoSlide(video);
                    DOM.trendingSlider.appendChild(slide);
                });
                
                if (trendingSwiper) {
                    trendingSwiper.update();
                } else {
                    trendingSwiper = new Swiper('.trending-slider', {
                        slidesPerView: 1.2,
                        spaceBetween: 10,
                        navigation: {
                            nextEl: '#trendingSection .swiper-button-next',
                            prevEl: '#trendingSection .swiper-button-prev',
                        },
                        breakpoints: {
                            640: { slidesPerView: 2.2, spaceBetween: 15 },
                            1024: { slidesPerView: 3.2, spaceBetween: 20 }
                        }
                    });
                }
            }

            function renderPopularVideos() {
                DOM.popularVideosGrid.innerHTML = '';
                
                const oneWeekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
                const popularVideos = videos
                    .filter(video => video.uploadDate > oneWeekAgo)
                    .sort((a, b) => b.views - a.views)
                    .slice(0, 8);
                
                popularVideos.forEach(video => {
                    const videoCard = createVideoCard(video);
                    DOM.popularVideosGrid.appendChild(videoCard);
                });
            }

            function createVideoSlide(video) {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                slide.setAttribute('data-id', video.id);
                
                const isInWatchLater = watchLater.some(item => item.videoId === video.id);
                
                slide.innerHTML = `
                    <button class="watch-later-btn ${isInWatchLater ? 'active' : ''}" data-id="${video.id}">
                        <i class="fas fa-clock"></i>
                    </button>
                    <img src="${video.thumbnail}" alt="${video.title}" class="slider-thumbnail">
                    <div class="slider-overlay">
                        <div class="slider-title">${video.title}</div>
                        <div class="slider-channel">
                            ${video.channel}
                            ${video.verified ? '<i class="fas fa-check verified-badge"></i>' : ''}
                        </div>
                    </div>
                `;
                
                slide.addEventListener('click', () => {
                    showVideoDetailDirect(video.id);
                });
                
                const watchLaterBtn = slide.querySelector('.watch-later-btn');
                watchLaterBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleWatchLaterForVideo(video.id);
                });
                
                return slide;
            }

            function renderVideoGrid(videosToRender) {
                DOM.videoGrid.innerHTML = '';
                
                if (videosToRender.length === 0) {
                    DOM.videoGrid.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-film" style="font-size: 50px; margin-bottom: 20px; color: #666;"></i>
                            <h3>Aucune vidéo trouvée</h3>
                            <p>Essayez une autre catégorie ou recherche</p>
                        </div>
                    `;
                    return;
                }
                
                videosToRender.forEach(video => {
                    const videoCard = createVideoCard(video);
                    DOM.videoGrid.appendChild(videoCard);
                });
            }

            function createVideoCard(video) {
                const videoCard = document.createElement('div');
                videoCard.className = 'video-card';
                videoCard.setAttribute('data-id', video.id);
                
                const isInWatchLater = watchLater.some(item => item.videoId === video.id);
                const timeAgo = getTimeAgo(video.uploadDate);
                const channelLogo = getChannelLogo(video.channelId);
                
                videoCard.innerHTML = `
                    <div class="thumbnail-container">
                        <img src="${video.thumbnail}" alt="${video.title}" class="thumbnail">
                        <div class="duration">${video.duration}</div>
                        <button class="watch-later-btn ${isInWatchLater ? 'active' : ''}" data-id="${video.id}">
                            <i class="fas fa-clock"></i>
                        </button>
                    </div>
                    <div class="video-info">
                        <div class="channel-avatar">
                            <img src="${channelLogo}" alt="${video.channel}">
                            ${video.verified ? '<div class="verified-channel"><i class="fas fa-check"></i></div>' : ''}
                        </div>
                        <div class="video-details">
                            <h3>${video.title.length > 60 ? video.title.substring(0, 60) + '...' : video.title}</h3>
                            <p class="channel-name">
                                ${video.channel}
                                ${video.verified ? '<i class="fas fa-check verified-badge"></i>' : ''}
                            </p>
                            <p>${formatCount(video.views)} vues • ${timeAgo}</p>
                        </div>
                    </div>
                `;
                
                videoCard.addEventListener('click', () => {
                    showVideoDetailDirect(video.id);
                });
                
                const watchLaterBtn = videoCard.querySelector('.watch-later-btn');
                watchLaterBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleWatchLaterForVideo(video.id);
                });
                
                return videoCard;
            }

            function showVideoDetailDirect(videoId, resumeTime = 0) {
                const video = videos.find(v => v.id === videoId);
                if (!video) return;
                
                currentVideoId = videoId;
                currentVideoData = video;
                
                // Initialize player
                initPlyrPlayer(video.videoUrl, video.thumbnail, resumeTime);
                
                // Update UI
                DOM.detailVideoTitle.textContent = video.title;
                DOM.channelNameText.textContent = video.channel;
                DOM.detailDescription.textContent = video.description;
                DOM.detailViews.textContent = `${formatCount(video.views)} vues`;
                DOM.detailDate.textContent = getTimeAgo(video.uploadDate);
                DOM.likeCount.textContent = formatCount(video.likes);
                DOM.dislikeCount.textContent = formatCount(video.dislikes);
                DOM.detailSubscribers.textContent = `${formatCount(video.subscribers)} abonnés`;
                
                // Update watch later button
                const isInWatchLater = watchLater.some(item => item.videoId === videoId);
                DOM.watchLaterDetailBtn.innerHTML = isInWatchLater ? 
                    '<i class="fas fa-check"></i> Dans la liste' : 
                    '<i class="fas fa-clock"></i> À regarder plus tard';
                DOM.watchLaterDetailBtn.classList.toggle('active', isInWatchLater);
                
                // Show detail page
                DOM.homePage.style.display = 'none';
                DOM.detailPage.style.display = 'block';
                window.scrollTo(0, 0);
                
                // Start playback
                setTimeout(() => {
                    if (plyrPlayer) {
                        plyrPlayer.play();
                    }
                }, 500);
            }

            function initPlyrPlayer(videoUrl, thumbnail, resumeTime = 0) {
                if (plyrPlayer) {
                    plyrPlayer.destroy();
                }
                
                const playerElement = document.getElementById('player');
                const sourceElement = playerElement.querySelector('source');
                sourceElement.src = videoUrl;
                playerElement.poster = thumbnail;
                playerElement.load();
                
                plyrPlayer = new Plyr('#player', {
                    controls: ['play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen'],
                    autoplay: false,
                    clickToPlay: true,
                    ratio: '16:9'
                });
                
                // Set resume time
                plyrPlayer.on('ready', () => {
                    if (resumeTime > 0) {
                        plyrPlayer.currentTime = resumeTime;
                    }
                });
                
                // Save progress
                let progressTimer;
                plyrPlayer.on('timeupdate', () => {
                    if (currentVideoId && plyrPlayer.playing) {
                        clearTimeout(progressTimer);
                        progressTimer = setTimeout(() => {
                            saveProgress(currentVideoId, plyrPlayer.currentTime);
                        }, 1000);
                    }
                });
                
                // Add to watch history when video ends
                plyrPlayer.on('ended', () => {
                    if (currentVideoId) {
                        addToWatchHistory(currentVideoId);
                        removeFromContinueWatching(currentVideoId);
                    }
                });
            }

            function saveProgress(videoId, currentTime) {
                const existingIndex = continueWatching.findIndex(item => item.videoId === videoId);
                const video = videos.find(v => v.id === videoId);
                const duration = getDurationInSeconds(video.duration);
                
                if (currentTime < duration - 60) {
                    if (existingIndex !== -1) {
                        continueWatching[existingIndex].progress = currentTime;
                        continueWatching[existingIndex].timestamp = Date.now();
                    } else {
                        continueWatching.unshift({
                            videoId,
                            progress: currentTime,
                            timestamp: Date.now()
                        });
                        
                        if (continueWatching.length > 10) {
                            continueWatching.pop();
                        }
                    }
                    
                    saveLocalData();
                    if (currentUser && isOnline) {
                        syncUserDataToFirebase(currentUser.uid);
                    }
                    
                    renderContinueWatching();
                }
            }

            function addToWatchHistory(videoId) {
                const existingIndex = watchHistory.findIndex(item => item.videoId === videoId);
                
                if (existingIndex !== -1) {
                    const [item] = watchHistory.splice(existingIndex, 1);
                    item.timestamp = Date.now();
                    watchHistory.unshift(item);
                } else {
                    watchHistory.unshift({
                        videoId,
                        timestamp: Date.now(),
                        completed: true
                    });
                    
                    if (watchHistory.length > 50) {
                        watchHistory.pop();
                    }
                }
                
                saveLocalData();
                if (currentUser && isOnline) {
                    syncUserDataToFirebase(currentUser.uid);
                }
                
                userRecommendations = userRecommendations.filter(v => v.id !== videoId);
                renderRecommendedVideos();
            }

            function toggleWatchLater() {
                if (!currentVideoId) return;
                toggleWatchLaterForVideo(currentVideoId);
            }

            function toggleWatchLaterForVideo(videoId) {
                const existingIndex = watchLater.findIndex(item => item.videoId === videoId);
                
                if (existingIndex !== -1) {
                    watchLater.splice(existingIndex, 1);
                    showNotification('Retiré de la liste "À regarder plus tard"');
                } else {
                    watchLater.unshift({
                        videoId,
                        addedAt: Date.now()
                    });
                    showNotification('Ajouté à "À regarder plus tard"');
                }
                
                saveLocalData();
                if (currentUser && isOnline) {
                    syncUserDataToFirebase(currentUser.uid);
                }
                
                updateWatchLaterButtonState(videoId);
                if (DOM.watchLaterPage.style.display === 'block') {
                    renderWatchLaterPage();
                }
                
                renderContinueWatching();
            }

            function updateWatchLaterButtonState(videoId) {
                const isInWatchLater = watchLater.some(item => item.videoId === videoId);
                
                DOM.watchLaterDetailBtn.innerHTML = isInWatchLater ? 
                    '<i class="fas fa-check"></i> Dans la liste' : 
                    '<i class="fas fa-clock"></i> À regarder plus tard';
                DOM.watchLaterDetailBtn.classList.toggle('active', isInWatchLater);
                
                document.querySelectorAll(`.watch-later-btn[data-id="${videoId}"]`).forEach(btn => {
                    btn.classList.toggle('active', isInWatchLater);
                    btn.innerHTML = `<i class="fas fa-clock"></i>`;
                });
            }

            function removeFromContinueWatching(videoId) {
                const index = continueWatching.findIndex(item => item.videoId === videoId);
                if (index !== -1) {
                    continueWatching.splice(index, 1);
                    saveLocalData();
                    if (currentUser && isOnline) {
                        syncUserDataToFirebase(currentUser.uid);
                    }
                    renderContinueWatching();
                }
            }

            function showWatchHistory() {
                DOM.homePage.style.display = 'none';
                DOM.detailPage.style.display = 'none';
                DOM.watchLaterPage.style.display = 'none';
                DOM.watchHistoryPage.style.display = 'block';
                
                renderWatchHistoryPage();
                window.scrollTo(0, 0);
            }

            function renderWatchHistoryPage() {
                DOM.historyVideoGrid.innerHTML = '';
                
                if (watchHistory.length === 0) {
                    DOM.emptyHistoryMessage.style.display = 'block';
                    return;
                }
                
                DOM.emptyHistoryMessage.style.display = 'none';
                
                watchHistory.forEach(item => {
                    const video = videos.find(v => v.id === item.videoId);
                    if (!video) return;
                    
                    const videoCard = createVideoCard(video);
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-from-list';
                    removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                    removeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        removeFromWatchHistory(item.videoId);
                    });
                    
                    videoCard.querySelector('.thumbnail-container').appendChild(removeBtn);
                    DOM.historyVideoGrid.appendChild(videoCard);
                });
            }

            function removeFromWatchHistory(videoId) {
                const index = watchHistory.findIndex(item => item.videoId === videoId);
                if (index !== -1) {
                    watchHistory.splice(index, 1);
                    saveLocalData();
                    if (currentUser && isOnline) {
                        syncUserDataToFirebase(currentUser.uid);
                    }
                    renderWatchHistoryPage();
                    showNotification('Retiré de l\'historique');
                }
            }

            function clearWatchHistory() {
                if (confirm('Voulez-vous vraiment effacer tout votre historique ?')) {
                    watchHistory = [];
                    saveLocalData();
                    if (currentUser && isOnline) {
                        syncUserDataToFirebase(currentUser.uid);
                    }
                    renderWatchHistoryPage();
                    showNotification('Historique effacé');
                }
            }

            function showWatchLater() {
                DOM.homePage.style.display = 'none';
                DOM.detailPage.style.display = 'none';
                DOM.watchHistoryPage.style.display = 'none';
                DOM.watchLaterPage.style.display = 'block';
                
                renderWatchLaterPage();
                window.scrollTo(0, 0);
            }

            function renderWatchLaterPage() {
                DOM.watchLaterGrid.innerHTML = '';
                
                if (watchLater.length === 0) {
                    DOM.emptyWatchLaterMessage.style.display = 'block';
                    return;
                }
                
                DOM.emptyWatchLaterMessage.style.display = 'none';
                
                watchLater.forEach(item => {
                    const video = videos.find(v => v.id === item.videoId);
                    if (!video) return;
                    
                    const videoCard = createVideoCard(video);
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-from-list';
                    removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                    removeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        removeFromWatchLater(item.videoId);
                    });
                    
                    videoCard.querySelector('.thumbnail-container').appendChild(removeBtn);
                    DOM.watchLaterGrid.appendChild(videoCard);
                });
            }

            function removeFromWatchLater(videoId) {
                const index = watchLater.findIndex(item => item.videoId === videoId);
                if (index !== -1) {
                    watchLater.splice(index, 1);
                    saveLocalData();
                    if (currentUser && isOnline) {
                        syncUserDataToFirebase(currentUser.uid);
                    }
                    updateWatchLaterButtonState(videoId);
                    renderWatchLaterPage();
                    showNotification('Retiré de la liste');
                }
            }

            function clearWatchLater() {
                if (confirm('Voulez-vous vraiment vider votre liste "À regarder plus tard" ?')) {
                    watchLater = [];
                    saveLocalData();
                    if (currentUser && isOnline) {
                        syncUserDataToFirebase(currentUser.uid);
                    }
                    renderWatchLaterPage();
                    showNotification('Liste "À regarder plus tard" vidée');
                }
            }

            function showContinueWatchingPage() {
                showHomePage();
                // You could add filtering logic here
            }

            function showRecommendedPage() {
                showHomePage();
                // You could add filtering logic here
            }

            // Auth Functions
            function switchAuthTab(tab) {
                if (tab === 'login') {
                    DOM.loginTab.classList.add('active');
                    DOM.registerTab.classList.remove('active');
                    DOM.loginForm.classList.add('active');
                    DOM.registerForm.classList.remove('active');
                    DOM.loginError.style.display = 'none';
                    DOM.registerError.style.display = 'none';
                } else {
                    DOM.registerTab.classList.add('active');
                    DOM.loginTab.classList.remove('active');
                    DOM.registerForm.classList.add('active');
                    DOM.loginForm.classList.remove('active');
                    DOM.loginError.style.display = 'none';
                    DOM.registerError.style.display = 'none';
                }
            }

            async function handleLogin() {
                const email = DOM.loginEmail.value.trim();
                const password = DOM.loginPassword.value.trim();
                
                if (!email || !password) {
                    showAuthError(DOM.loginError, 'Veuillez remplir tous les champs');
                    return;
                }
                
                try {
                    await fbFunctions.signInWithEmailAndPassword(auth, email, password);
                    DOM.loginError.style.display = 'none';
                } catch (error) {
                    showAuthError(DOM.loginError, getAuthErrorMessage(error.code));
                }
            }

            async function handleRegister() {
                const username = DOM.registerUsername.value.trim();
                const email = DOM.registerEmail.value.trim();
                const password = DOM.registerPassword.value.trim();
                
                if (!username || !email || !password) {
                    showAuthError(DOM.registerError, 'Veuillez remplir tous les champs');
                    return;
                }
                
                if (password.length < 6) {
                    showAuthError(DOM.registerError, 'Le mot de passe doit comporter au moins 6 caractères');
                    return;
                }
                
                try {
                    const userCredential = await fbFunctions.createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    
                    await fbFunctions.updateProfile(user, { displayName: username });
                    
                    const userRef = fbFunctions.ref(db, `users/${user.uid}`);
                    const userData = {
                        username: username,
                        email: email,
                        createdAt: Date.now(),
                        photoURL: avatarOptions[0],
                        watchHistory: [],
                        watchLater: [],
                        continueWatching: [],
                        preferences: []
                    };
                    
                    await fbFunctions.set(userRef, userData);
                    
                    DOM.registerError.style.display = 'none';
                    switchAuthTab('login');
                    DOM.loginEmail.value = email;
                    DOM.registerUsername.value = '';
                    DOM.registerEmail.value = '';
                    DOM.registerPassword.value = '';
                    
                    showNotification('Compte créé avec succès ! Veuillez vous connecter.');
                } catch (error) {
                    showAuthError(DOM.registerError, getAuthErrorMessage(error.code));
                }
            }

            async function handleGoogleAuth(mode) {
                try {
                    const result = await fbFunctions.signInWithPopup(auth, googleProvider);
                    const user = result.user;
                    
                    const userRef = fbFunctions.ref(db, `users/${user.uid}`);
                    const snapshot = await fbFunctions.get(userRef);
                    
                    if (!snapshot.exists()) {
                        const userData = {
                            username: user.displayName,
                            email: user.email,
                            createdAt: Date.now(),
                            photoURL: user.photoURL || avatarOptions[0],
                            watchHistory: [],
                            watchLater: [],
                            continueWatching: [],
                            preferences: []
                        };
                        
                        await fbFunctions.set(userRef, userData);
                    }
                } catch (error) {
                    const errorElement = mode === 'login' ? DOM.loginError : DOM.registerError;
                    showAuthError(errorElement, getAuthErrorMessage(error.code));
                }
            }

            async function handleLogout() {
                try {
                    await fbFunctions.signOut(auth);
                    DOM.userMenu.style.display = 'none';
                    showAuthScreen();
                    switchAuthTab('login');
                } catch (error) {
                    console.error('Logout error:', error);
                }
            }

            function showAuthError(element, message) {
                element.textContent = message;
                element.style.display = 'block';
            }

            function getAuthErrorMessage(errorCode) {
                const messages = {
                    'auth/email-already-in-use': 'Cet email est déjà utilisé',
                    'auth/invalid-email': 'Adresse email invalide',
                    'auth/operation-not-allowed': 'Opération non autorisée',
                    'auth/weak-password': 'Le mot de passe est trop faible',
                    'auth/user-disabled': 'Le compte utilisateur est désactivé',
                    'auth/user-not-found': 'Utilisateur non trouvé',
                    'auth/wrong-password': 'Mot de passe incorrect',
                    'auth/too-many-requests': 'Trop de requêtes. Réessayez plus tard'
                };
                return messages[errorCode] || 'Erreur d\'authentification. Veuillez réessayer';
            }

            // Utility Functions
            function updateNetworkStatus() {
                isOnline = navigator.onLine;
                
                if (isOnline) {
                    DOM.offlineMessage.style.display = 'none';
                } else {
                    DOM.offlineMessage.style.display = 'block';
                }
            }

            function checkScreenSize() {
                if (window.innerWidth <= 768) {
                    document.querySelector('.search-container').style.display = 'none';
                    DOM.mobileSearchBtnIcon.style.display = 'block';
                } else {
                    document.querySelector('.search-container').style.display = 'flex';
                    DOM.mobileSearchBtnIcon.style.display = 'none';
                }
            }

            function showAuthScreen() {
                DOM.authScreen.style.display = 'flex';
                DOM.mainApp.style.display = 'none';
            }

            function showMainApp() {
                DOM.authScreen.style.display = 'none';
                DOM.mainApp.style.display = 'block';
                updateUserUI();
            }

            function getDurationInSeconds(durationStr) {
                const parts = durationStr.split(':');
                if (parts.length === 3) {
                    return parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(parts[2]);
                } else if (parts.length === 2) {
                    return parseInt(parts[0]) * 60 + parseInt(parts[1]);
                }
                return 0;
            }

            function formatTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);
                
                if (hours > 0) {
                    return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }

            function getChannelLogo(channelId) {
                if (channelId === 'youku_monsters') {
                    return 'https://yt3.googleusercontent.com/ytc/AIdro_k6E6UKOm59PC4O8rDXS0RDNlIx15yVmpCyNkm_n_PCmg=s800-c-k-c0x00ffffff-no-rj';
                }
                return 'https://cdn.leonardo.ai/users/59cc19c6-be61-41ed-ab82-8485d4d58d54/generations/807f5487-c3b8-4ccd-9ab8-dabab318a67d/Phoenix_10_Create_a_clean_bold_modern_logo_for_an_app_named_St_3.jpg';
            }

            function formatCount(num) {
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                } else if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K';
                }
                return num.toString();
            }

            function getTimeAgo(timestamp) {
                const now = Date.now();
                const diff = now - timestamp;
                const seconds = Math.floor(diff / 1000);
                
                if (seconds < 60) return `à l'instant`;
                const minutes = Math.floor(seconds / 60);
                if (minutes < 60) return `il y a ${minutes} minute${minutes !== 1 ? 's' : ''}`;
                const hours = Math.floor(minutes / 60);
                if (hours < 24) return `il y a ${hours} heure${hours !== 1 ? 's' : ''}`;
                const days = Math.floor(hours / 24);
                if (days < 30) return `il y a ${days} jour${days !== 1 ? 's' : ''}`;
                const months = Math.floor(days / 30);
                if (months < 12) return `il y a ${months} mois`;
                const years = Math.floor(months / 12);
                return `il y a ${years} an${years !== 1 ? 's' : ''}`;
            }

            function showNotification(message) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background-color: #ff0000;
                    color: white;
                    padding: 12px 24px;
                    border-radius: 8px;
                    z-index: 2000;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    animation: slideIn 0.3s ease;
                    max-width: 300px;
                    word-wrap: break-word;
                `;
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            // Add CSS for animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);

            // Search Functions
            function performSearch(query) {
                const searchTerm = query.trim();
                if (!searchTerm) return;
                
                const searchLower = searchTerm.toLowerCase();
                const filteredVideos = videos.filter(video => {
                    if (video.title.toLowerCase().includes(searchLower)) return true;
                    if (video.channel.toLowerCase().includes(searchLower)) return true;
                    if (video.tags.some(tag => tag.toLowerCase().includes(searchLower))) return true;
                    if (video.description.toLowerCase().includes(searchLower)) return true;
                    return false;
                });
                
                renderVideoGrid(filteredVideos);
                showHomePage();
            }

            function clearRecentSearches() {
                // Implement if needed
            }

            function showMobileSearch() {
                DOM.mobileSearchOverlay.style.display = 'flex';
                DOM.mobileSearchInput.focus();
            }

            function hideMobileSearch() {
                DOM.mobileSearchOverlay.style.display = 'none';
                DOM.mobileSearchInput.value = '';
            }

            function filterVideosByCategory(category) {
                if (category === 'all') {
                    renderVideoGrid(videos);
                    return;
                }
                
                if (category === 'continue') {
                    const continueVideos = continueWatching.map(item => {
                        return videos.find(v => v.id === item.videoId);
                    }).filter(v => v);
                    renderVideoGrid(continueVideos);
                    return;
                }
                
                if (category === 'recommended') {
                    renderVideoGrid(userRecommendations);
                    return;
                }
                
                const filteredVideos = videos.filter(video => {
                    if (video.categories && Array.isArray(video.categories)) {
                        return video.categories.includes(category);
                    }
                    return video.tags && video.tags.some(tag => 
                        tag.toLowerCase() === category.toLowerCase()
                    );
                });
                
                renderVideoGrid(filteredVideos);
            }

            // Initialize the app
            init();
        }
    </script>
</body>
</html>
