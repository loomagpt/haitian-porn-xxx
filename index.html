<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamFlix Pro - Ultimate Video Platform</title>
    <!-- Fluid Player -->
    <link rel="stylesheet" href="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.css">
    <script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <!-- Back4App/Parse -->
    <script src="https://npmcdn.com/parse/dist/parse.min.js"></script>
    <!-- Uploadcare -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@1/web/uc-file-uploader-regular.min.css">
    <script type="module">
        import * as UC from 'https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@1/web/uc-file-uploader-regular.min.js';
        UC.defineComponents(UC);
    </script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #ff0000;
            --primary-neon: #ff3333;
            --primary-glow: rgba(255, 0, 0, 0.5);
            --primary-dark: #cc0000;
            --secondary-color: #065fd4;
            --dark-bg: #0f0f0f;
            --dark-surface: #212121;
            --dark-surface-light: #3d3d3d;
            --dark-text: #f1f1f1;
            --dark-text-secondary: #aaa;
            --light-bg: #ffffff;
            --light-surface: #f9f9f9;
            --light-surface-dark: #f1f1f1;
            --light-text: #030303;
            --light-text-secondary: #606060;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --info: #2196f3;
            --shadow: 0 1px 2px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 8px rgba(0,0,0,0.2);
            --shadow-xl: 0 8px 16px rgba(0,0,0,0.3);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --neon-glow: 0 0 5px var(--primary-neon), 0 0 10px var(--primary-neon), 0 0 15px var(--primary-neon);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-bg);
            color: var(--light-text);
            transition: var(--transition);
            overflow-x: hidden;
            line-height: 1.6;
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .hidden {
            display: none !important;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Loading Spinner */
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        /* Neon Button Styles */
        .neon-button {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 24px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(255,0,0,0.3);
        }

        .neon-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .neon-button:hover::before {
            left: 100%;
        }

        .neon-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--neon-glow), 0 6px 20px rgba(255,0,0,0.4);
        }

        .neon-button:active {
            transform: translateY(0);
        }

        .neon-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .neon-button.pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 var(--primary-glow); }
            70% { box-shadow: 0 0 0 15px rgba(255, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }

        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 70px;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--light-bg);
            box-shadow: var(--shadow);
            z-index: 1000;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            background-color: rgba(var(--light-bg), 0.95);
        }

        body.dark-mode header {
            background-color: rgba(15,15,15,0.95);
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-button {
            background: none;
            border: none;
            font-size: 22px;
            color: var(--light-text);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        body.dark-mode .menu-button {
            color: var(--dark-text);
        }

        .menu-button:hover {
            background-color: rgba(255,0,0,0.1);
            color: var(--primary-color);
            transform: rotate(90deg);
        }

        .logo-icon {
            color: var(--primary-color);
            font-size: 36px;
            animation: neonPulse 2s infinite;
        }

        .logo-text {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-color), var(--primary-neon), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            margin: 0 24px;
            display: flex;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 14px 24px;
            border: 2px solid transparent;
            border-radius: 30px 0 0 30px;
            font-size: 16px;
            background-color: var(--light-surface-dark);
            color: var(--light-text);
            transition: var(--transition);
        }

        body.dark-mode .search-input {
            background-color: var(--dark-surface);
            color: var(--dark-text);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 20px var(--primary-glow);
        }

        .search-button {
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            border: none;
            border-radius: 0 30px 30px 0;
            cursor: pointer;
            transition: var(--transition);
            color: white;
            font-size: 18px;
        }

        .search-button:hover {
            background: var(--primary-dark);
            box-shadow: var(--neon-glow);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .icon-button {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--light-text);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
            position: relative;
        }

        body.dark-mode .icon-button {
            color: var(--dark-text);
        }

        .icon-button:hover {
            background-color: rgba(255,0,0,0.1);
            color: var(--primary-color);
            transform: scale(1.1) rotate(5deg);
        }

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
            font-size: 10px;
            padding: 2px 5px;
            border-radius: 12px;
            min-width: 18px;
            text-align: center;
            font-weight: 600;
            animation: pulse 1s infinite;
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon), var(--secondary-color));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .user-avatar:hover {
            transform: scale(1.1);
            border-color: white;
            box-shadow: var(--neon-glow);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .avatar-status {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
            border: 2px solid white;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: var(--light-bg);
            padding: 24px 0;
            position: fixed;
            top: 70px;
            left: 0;
            height: calc(100vh - 70px);
            overflow-y: auto;
            transition: var(--transition);
            z-index: 999;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            background-color: rgba(var(--light-bg), 0.95);
        }

        body.dark-mode .sidebar {
            background-color: rgba(15,15,15,0.95);
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 24px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--light-text);
            position: relative;
            overflow: hidden;
            font-weight: 500;
        }

        body.dark-mode .sidebar-item {
            color: var(--dark-text);
        }

        .sidebar-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-neon));
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .sidebar-item:hover::before {
            transform: scaleY(1);
        }

        .sidebar-item:hover {
            background-color: rgba(255,0,0,0.1);
            color: var(--primary-color);
            padding-left: 32px;
        }

        .sidebar-item.active {
            background: linear-gradient(90deg, rgba(255,0,0,0.15), transparent);
            color: var(--primary-color);
            font-weight: 600;
        }

        .sidebar-item.active::before {
            transform: scaleY(1);
        }

        .sidebar-icon {
            font-size: 22px;
            width: 28px;
            text-align: center;
            transition: var(--transition);
        }

        .sidebar-item:hover .sidebar-icon {
            transform: scale(1.2) rotate(5deg);
            color: var(--primary-color);
        }

        .sidebar-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, var(--primary-color), transparent);
            margin: 20px 0;
        }

        .sidebar-header {
            padding: 12px 24px;
            font-size: 13px;
            font-weight: 600;
            color: var(--light-text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        body.dark-mode .sidebar-header {
            color: var(--dark-text-secondary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 90px 24px 24px;
            transition: var(--transition);
            min-height: 100vh;
        }

        /* Video Grid */
        .videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 28px;
            margin-top: 24px;
        }

        .shorts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .video-card {
            background-color: var(--light-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            animation: fadeInUp 0.5s ease;
        }

        body.dark-mode .video-card {
            background-color: var(--dark-surface);
        }

        .video-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-xl), 0 0 30px var(--primary-glow);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .video-thumbnail {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            position: relative;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .video-card:hover .video-thumbnail img {
            transform: scale(1.1);
        }

        .video-duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            backdrop-filter: blur(5px);
        }

        .video-info {
            padding: 16px;
        }

        .video-title {
            font-weight: 600;
            margin-bottom: 8px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            height: 48px;
            font-size: 16px;
        }

        .video-creator {
            font-size: 14px;
            color: var(--light-text-secondary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        body.dark-mode .video-creator {
            color: var(--dark-text-secondary);
        }

        .video-creator i {
            color: var(--primary-color);
            font-size: 14px;
        }

        .video-stats {
            font-size: 14px;
            color: var(--light-text-secondary);
            display: flex;
            gap: 8px;
        }

        body.dark-mode .video-stats {
            color: var(--dark-text-secondary);
        }

        .short-card {
            background-color: var(--light-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            aspect-ratio: 9/16;
            position: relative;
            animation: fadeInUp 0.5s ease;
        }

        body.dark-mode .short-card {
            background-color: var(--dark-surface);
        }

        .short-card:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-xl), 0 0 30px var(--primary-glow);
        }

        .short-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .short-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            animation: neonPulse 2s infinite;
            backdrop-filter: blur(5px);
        }

        .short-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            color: white;
        }

        .short-info h4 {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .short-info p {
            font-size: 13px;
            opacity: 0.9;
        }

        /* Video Player */
        .video-player-container {
            background-color: #000;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 24px;
            position: relative;
            box-shadow: var(--shadow-xl);
        }

        .fluid-player-container {
            width: 100% !important;
            height: auto !important;
        }

        /* Video Detail */
        .video-detail-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .video-info-detail {
            background-color: var(--light-surface);
            padding: 28px;
            border-radius: var(--border-radius);
            margin-top: 24px;
            box-shadow: var(--shadow);
        }

        body.dark-mode .video-info-detail {
            background-color: var(--dark-surface);
        }

        .video-title-detail {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
            line-height: 1.3;
        }

        .video-meta {
            display: flex;
            gap: 20px;
            color: var(--light-text-secondary);
            margin-bottom: 24px;
            font-size: 15px;
        }

        body.dark-mode .video-meta {
            color: var(--dark-text-secondary);
        }

        .video-actions {
            display: flex;
            gap: 16px;
            margin-bottom: 28px;
            flex-wrap: wrap;
        }

        .action-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background-color: var(--light-surface-dark);
            border: none;
            border-radius: 30px;
            color: var(--light-text);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
            overflow: hidden;
            font-size: 14px;
        }

        body.dark-mode .action-button {
            background-color: var(--dark-surface-light);
            color: var(--dark-text);
        }

        .action-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background-color: rgba(255,0,0,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .action-button:hover::before {
            width: 200px;
            height: 200px;
        }

        .action-button:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--neon-glow);
        }

        .action-button.active {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
        }

        .action-button i {
            font-size: 18px;
        }

        .creator-info-detail {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 28px;
            padding-bottom: 24px;
            border-bottom: 2px solid rgba(255,0,0,0.1);
        }

        .creator-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid var(--primary-color);
            box-shadow: var(--neon-glow);
        }

        .creator-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .creator-details {
            flex: 1;
        }

        .creator-details h3 {
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
        }

        .verified-badge {
            color: var(--primary-color);
            font-size: 18px;
        }

        .creator-stats {
            color: var(--light-text-secondary);
            font-size: 15px;
        }

        body.dark-mode .creator-stats {
            color: var(--dark-text-secondary);
        }

        .subscribe-button {
            padding: 12px 32px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: var(--transition);
            animation: pulse 2s infinite;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .subscribe-button:hover {
            transform: scale(1.05);
            box-shadow: var(--neon-glow);
        }

        .subscribe-button.subscribed {
            background: linear-gradient(135deg, #4caf50, #45a049);
            animation: none;
        }

        .video-description {
            background-color: var(--light-surface-dark);
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            line-height: 1.8;
            font-size: 15px;
        }

        body.dark-mode .video-description {
            background-color: var(--dark-surface);
        }

        /* Comments */
        .comments-section {
            background-color: var(--light-surface);
            padding: 28px;
            border-radius: var(--border-radius);
            margin-top: 24px;
            box-shadow: var(--shadow);
        }

        body.dark-mode .comments-section {
            background-color: var(--dark-surface);
        }

        .comments-section h3 {
            font-size: 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comment-input {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
        }

        .comment-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--primary-color);
        }

        .comment-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .comment-input input {
            flex: 1;
            padding: 14px 24px;
            border: 2px solid transparent;
            border-radius: 30px;
            font-size: 15px;
            background-color: var(--light-surface-dark);
            color: var(--light-text);
            transition: var(--transition);
        }

        body.dark-mode .comment-input input {
            background-color: var(--dark-surface);
            color: var(--dark-text);
        }

        .comment-input input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 20px var(--primary-glow);
        }

        .comment-button {
            padding: 14px 32px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .comment-button:hover {
            transform: scale(1.05);
            box-shadow: var(--neon-glow);
        }

        .comment {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            animation: fadeIn 0.5s ease;
            padding: 16px;
            border-radius: 16px;
            transition: var(--transition);
        }

        .comment:hover {
            background-color: rgba(255,0,0,0.05);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .comment-content {
            flex: 1;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 6px;
        }

        .comment-header h4 {
            font-size: 15px;
            font-weight: 600;
        }

        .comment-time {
            font-size: 12px;
            color: var(--light-text-secondary);
        }

        body.dark-mode .comment-time {
            color: var(--dark-text-secondary);
        }

        .comment-text {
            margin-bottom: 10px;
            line-height: 1.6;
            font-size: 14px;
        }

        .comment-actions {
            display: flex;
            gap: 20px;
        }

        .comment-actions button {
            background: none;
            border: none;
            color: var(--light-text-secondary);
            cursor: pointer;
            font-size: 13px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .comment-actions button:hover {
            color: var(--primary-color);
            transform: scale(1.05);
        }

        /* Notifications Panel */
        .notifications-panel {
            position: absolute;
            top: 80px;
            right: 24px;
            width: 380px;
            background-color: var(--light-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-xl), 0 0 30px var(--primary-glow);
            z-index: 1100;
            display: none;
            animation: slideIn 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            overflow: hidden;
        }

        body.dark-mode .notifications-panel {
            background-color: var(--dark-surface);
        }

        .notifications-panel.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .notifications-header {
            padding: 18px 24px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(255,0,0,0.1), transparent);
        }

        .notifications-header h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary-color);
            font-size: 18px;
        }

        .notifications-list {
            max-height: 450px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 16px 24px;
            border-bottom: 1px solid rgba(255,0,0,0.1);
            cursor: pointer;
            transition: var(--transition);
            animation: fadeIn 0.5s ease;
            display: flex;
            gap: 12px;
        }

        .notification-item:hover {
            background-color: rgba(255,0,0,0.05);
            padding-left: 28px;
        }

        .notification-item.unread {
            background-color: rgba(255,0,0,0.1);
            border-left: 4px solid var(--primary-color);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--primary-color);
            font-size: 15px;
        }

        .notification-message {
            font-size: 14px;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .notification-time {
            font-size: 11px;
            color: var(--light-text-secondary);
        }

        /* Subscriptions List */
        .subscriptions-list {
            max-height: 350px;
            overflow-y: auto;
            padding: 12px;
        }

        .subscription-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 12px;
            border-radius: 12px;
            transition: var(--transition);
            cursor: pointer;
        }

        .subscription-item:hover {
            background-color: rgba(255,0,0,0.1);
            transform: translateX(8px);
        }

        .subscription-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--primary-color);
        }

        .subscription-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .subscription-info h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .subscription-info p {
            font-size: 12px;
            color: var(--light-text-secondary);
        }

        .new-video-badge {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 10px;
            font-weight: 600;
            animation: pulse 1s infinite;
        }

        /* Channel Creation */
        .channel-creation {
            max-width: 550px;
            margin: 50px auto;
            padding: 40px;
            background-color: var(--light-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-xl), 0 0 40px var(--primary-glow);
            animation: fadeInUp 0.6s ease;
        }

        body.dark-mode .channel-creation {
            background-color: var(--dark-surface);
        }

        .channel-step {
            display: none;
        }

        .channel-step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: var(--light-text-secondary);
        }

        body.dark-mode .form-label {
            color: var(--dark-text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 15px;
            background-color: var(--light-surface-dark);
            color: var(--light-text);
            transition: var(--transition);
        }

        body.dark-mode .form-input {
            background-color: var(--dark-surface);
            color: var(--dark-text);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 20px var(--primary-glow);
        }

        .channel-preview {
            text-align: center;
            margin-bottom: 40px;
        }

        .channel-banner-preview {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #ff0000, #ff6666, #ff0000);
            border-radius: 16px;
            margin-bottom: -50px;
            overflow: hidden;
            position: relative;
            background-size: 200% 200%;
            animation: gradientMove 5s ease infinite;
        }

        @keyframes gradientMove {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .channel-banner-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .channel-avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto;
            border: 5px solid var(--primary-color);
            overflow: hidden;
            background: linear-gradient(135deg, #ff0000, #ff6666);
            position: relative;
            z-index: 2;
            box-shadow: var(--neon-glow);
        }

        .channel-avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-initial {
            font-size: 48px;
            font-weight: 700;
            color: white;
            line-height: 120px;
            text-transform: uppercase;
        }

        /* Upload View */
        .upload-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 24px;
            animation: fadeInUp 0.5s ease;
        }

        .upload-container h1 {
            font-size: 32px;
            margin-bottom: 28px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .upload-area {
            border: 3px dashed var(--primary-color);
            border-radius: 24px;
            padding: 60px 30px;
            text-align: center;
            margin-bottom: 32px;
            transition: var(--transition);
            background-color: var(--light-surface);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        body.dark-mode .upload-area {
            background-color: var(--dark-surface);
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--primary-glow) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }

        .upload-area:hover::before {
            opacity: 0.3;
        }

        .upload-area.drag-over {
            border-color: var(--primary-neon);
            background-color: rgba(255,0,0,0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 100px;
            color: var(--primary-color);
            margin-bottom: 24px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .upload-area h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .upload-area p {
            color: var(--light-text-secondary);
            font-size: 16px;
        }

        .upload-input {
            display: none;
        }

        .video-info-form {
            background-color: var(--light-surface);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 24px;
        }

        body.dark-mode .video-info-form {
            background-color: var(--dark-surface);
        }

        .thumbnail-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin: 28px 0;
        }

        .thumbnail-option {
            border: 3px solid transparent;
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            background-color: var(--light-surface-dark);
        }

        body.dark-mode .thumbnail-option {
            background-color: var(--dark-surface-light);
        }

        .thumbnail-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--primary-glow);
        }

        .thumbnail-option.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(255,0,0,0.1), transparent);
            animation: pulse 2s infinite;
        }

        .thumbnail-option i {
            font-size: 40px;
            color: var(--primary-color);
            margin-bottom: 12px;
        }

        .thumbnail-option h4 {
            font-size: 18px;
            margin-bottom: 12px;
        }

        .thumbnail-preview {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border-radius: 12px;
            margin: 12px 0;
            display: none;
            border: 2px solid var(--primary-color);
        }

        /* Progress Bar */
        .upload-progress-container {
            margin: 24px 0;
            display: none;
            background-color: var(--light-surface);
            padding: 24px;
            border-radius: 20px;
        }

        body.dark-mode .upload-progress-container {
            background-color: var(--dark-surface);
        }

        .upload-progress {
            width: 100%;
            height: 30px;
            background-color: rgba(255,0,0,0.1);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 12px;
            position: relative;
        }

        .upload-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), #ffaa00, var(--primary-neon), var(--primary-color));
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
            background-size: 300% 100%;
            animation: moveGradient 3s linear infinite;
            border-radius: 15px;
        }

        @keyframes moveGradient {
            0% { background-position: 0% 0; }
            100% { background-position: 300% 0; }
        }

        .progress-text {
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .upload-success {
            text-align: center;
            padding: 40px;
            background-color: var(--light-surface);
            border-radius: 24px;
            margin: 24px 0;
            display: none;
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .upload-success i {
            font-size: 80px;
            color: var(--success);
            margin-bottom: 20px;
        }

        .upload-success h3 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .upload-success p {
            font-size: 16px;
            color: var(--light-text-secondary);
            margin-bottom: 24px;
        }

        /* Studio Dashboard */
        .studio-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .studio-container h1 {
            font-size: 32px;
            margin-bottom: 28px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin: 30px 0;
        }

        .analytics-card {
            background: linear-gradient(135deg, var(--light-surface), var(--light-surface-dark));
            padding: 28px;
            border-radius: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .analytics-card {
            background: linear-gradient(135deg, var(--dark-surface), var(--dark-surface-light));
        }

        .analytics-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--primary-glow) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }

        .analytics-card:hover::before {
            opacity: 0.2;
        }

        .analytics-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl), 0 0 30px var(--primary-glow);
        }

        .analytics-card i {
            font-size: 32px;
            color: var(--primary-color);
            margin-bottom: 12px;
        }

        .analytics-value {
            font-size: 42px;
            font-weight: 700;
            margin: 15px 0 5px;
            color: var(--primary-color);
            line-height: 1.2;
        }

        .analytics-label {
            font-size: 15px;
            color: var(--light-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: rgba(255,0,0,0.1);
            border-radius: 6px;
            margin: 12px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), #ffaa00);
            border-radius: 6px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .monetization-status {
            padding: 15px 30px;
            border-radius: 40px;
            font-weight: 600;
            display: inline-block;
            font-size: 18px;
            margin: 20px 0;
        }

        .monetization-status.eligible {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            animation: pulse 2s infinite;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
        }

        .monetization-status.pending {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
        }

        .monetization-status.ineligible {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        /* Content Table */
        .content-table {
            width: 100%;
            border-collapse: collapse;
            margin: 24px 0;
            background-color: var(--light-surface);
            border-radius: 20px;
            overflow: hidden;
        }

        body.dark-mode .content-table {
            background-color: var(--dark-surface);
        }

        .content-table th {
            background: linear-gradient(135deg, rgba(255,0,0,0.1), transparent);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            color: var(--primary-color);
        }

        .content-table td {
            padding: 16px;
            border-bottom: 1px solid rgba(255,0,0,0.1);
        }

        .content-table tr:hover td {
            background-color: rgba(255,0,0,0.05);
        }

        /* Tags */
        .collaboration-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .tag {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            animation: fadeIn 0.3s ease;
        }

        .tag button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }

        .tag button:hover {
            transform: scale(1.2);
        }

        .tag-input {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .tag-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid transparent;
            border-radius: 25px;
            font-size: 14px;
            background-color: var(--light-surface-dark);
            color: var(--light-text);
        }

        body.dark-mode .tag-input input {
            background-color: var(--dark-surface-light);
            color: var(--dark-text);
        }

        .tag-input input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* Categories */
        .categories-container {
            margin: 24px 0;
        }

        .category-chip {
            display: inline-flex;
            align-items: center;
            padding: 10px 20px;
            margin: 0 8px 8px 0;
            background-color: var(--light-surface-dark);
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            font-weight: 500;
        }

        body.dark-mode .category-chip {
            background-color: var(--dark-surface-light);
        }

        .category-chip:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--neon-glow);
        }

        .category-chip.active {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            color: white;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 18px 28px;
            background-color: var(--light-bg);
            color: var(--light-text);
            border-radius: 50px;
            box-shadow: var(--shadow-xl), 0 0 30px var(--primary-glow);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(150px);
            opacity: 0;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.3s;
            border-left: 5px solid var(--primary-color);
            max-width: 400px;
        }

        body.dark-mode .toast {
            background-color: var(--dark-surface);
            color: var(--dark-text);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
            animation: slideInRight 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast i {
            font-size: 28px;
        }

        .toast-success i {
            color: var(--success);
        }

        .toast-error i {
            color: var(--danger);
        }

        .toast-info i {
            color: var(--primary-color);
        }

        /* Auth Container */
        .auth-container {
            max-width: 450px;
            margin: 50px auto;
            padding: 40px;
            background-color: var(--light-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-xl), 0 0 40px var(--primary-glow);
            animation: fadeInUp 0.6s ease;
        }

        body.dark-mode .auth-container {
            background-color: var(--dark-surface);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .auth-header i {
            font-size: 70px;
            color: var(--primary-color);
            margin-bottom: 16px;
        }

        .auth-header h2 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 24px;
        }

        .auth-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,0,0,0.1);
        }

        .auth-link {
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .auth-link:hover {
            text-decoration: underline;
            color: var(--primary-neon);
        }

        /* Wallet */
        .wallet-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 30px;
            background-color: var(--light-surface);
            border-radius: 24px;
        }

        body.dark-mode .wallet-container {
            background-color: var(--dark-surface);
        }

        .balance-card {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-neon));
            padding: 30px;
            border-radius: 20px;
            color: white;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3), transparent);
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .balance-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .balance-amount {
            font-size: 48px;
            font-weight: 700;
        }

        .transaction-list {
            margin-top: 24px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid rgba(255,0,0,0.1);
        }

        .transaction-info h4 {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .transaction-info p {
            font-size: 13px;
            color: var(--light-text-secondary);
        }

        .transaction-amount {
            font-weight: 600;
        }

        .transaction-amount.positive {
            color: var(--success);
        }

        .transaction-amount.negative {
            color: var(--danger);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 300px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 80px 16px 16px;
            }
            
            .search-container {
                margin: 0 10px;
            }
            
            .search-input {
                padding: 10px 16px;
            }
            
            .search-button {
                padding: 10px 20px;
            }
            
            .videos-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 16px;
            }
            
            .video-actions {
                justify-content: center;
            }
            
            .thumbnail-options {
                grid-template-columns: 1fr;
            }
            
            .notifications-panel {
                width: 320px;
                right: 10px;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .auth-container {
                margin: 30px 16px;
                padding: 30px 20px;
            }
            
            .video-title-detail {
                font-size: 22px;
            }
            
            .creator-info-detail {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .subscribe-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <header>
        <div class="logo-container">
            <button class="menu-button" id="menuButton">
                <i class="fas fa-bars"></i>
            </button>
            <i class="fas fa-play-circle logo-icon"></i>
            <span class="logo-text">StreamFlix Pro</span>
        </div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search videos, creators, or categories...">
            <button class="search-button" id="searchButton">
                <i class="fas fa-search"></i>
            </button>
        </div>
        
        <div class="header-actions">
            <button class="icon-button" id="darkModeToggle">
                <i class="fas fa-moon"></i>
            </button>
            <button class="icon-button" id="notificationsButton">
                <i class="fas fa-bell"></i>
                <span class="notification-badge hidden" id="notificationBadge">0</span>
            </button>
            <button class="neon-button" id="uploadButton" style="display: none;">
                <i class="fas fa-upload"></i> Upload
            </button>
            <div class="user-avatar" id="userAvatar">
                <span id="avatarInitial">?</span>
                <img id="avatarImage" style="display: none;">
                <span class="avatar-status" id="avatarStatus" style="display: none;"></span>
            </div>
        </div>

        <div class="notifications-panel" id="notificationsPanel">
            <div class="notifications-header">
                <h3><i class="fas fa-bell"></i> Notifications</h3>
                <button class="icon-button" onclick="markAllNotificationsRead()">
                    <i class="fas fa-check-double"></i>
                </button>
            </div>
            <div class="notifications-list" id="notificationsList">
                <div style="text-align: center; padding: 30px; color: var(--light-text-secondary);">
                    <i class="fas fa-bell-slash" style="font-size: 40px; margin-bottom: 10px;"></i>
                    <p>No notifications</p>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-item active" data-view="home">
                <i class="fas fa-home sidebar-icon"></i>
                <span>Home</span>
            </div>
            <div class="sidebar-item" data-view="shorts">
                <i class="fas fa-video sidebar-icon"></i>
                <span>Shorts</span>
            </div>
            <div class="sidebar-item" id="subscriptionsSidebar">
                <i class="fas fa-users sidebar-icon"></i>
                <span>Subscriptions</span>
            </div>
            <div class="sidebar-item" data-view="trending">
                <i class="fas fa-fire sidebar-icon"></i>
                <span>Trending</span>
            </div>
            
            <div class="sidebar-divider"></div>
            
            <div class="sidebar-header">Categories</div>
            <div class="categories-container" id="sidebarCategories">
                <div class="category-chip" data-category="all" onclick="filterByCategory('all')">All</div>
                <div class="category-chip" data-category="music" onclick="filterByCategory('music')">Music</div>
                <div class="category-chip" data-category="gaming" onclick="filterByCategory('gaming')">Gaming</div>
                <div class="category-chip" data-category="education" onclick="filterByCategory('education')">Education</div>
                <div class="category-chip" data-category="entertainment" onclick="filterByCategory('entertainment')">Entertainment</div>
                <div class="category-chip" data-category="sports" onclick="filterByCategory('sports')">Sports</div>
                <div class="category-chip" data-category="news" onclick="filterByCategory('news')">News</div>
                <div class="category-chip" data-category="technology" onclick="filterByCategory('technology')">Technology</div>
            </div>
            
            <div class="sidebar-divider"></div>
            
            <div class="sidebar-header">Subscriptions</div>
            <div class="subscriptions-list" id="subscriptionsList">
                <div style="padding: 20px; text-align: center; color: var(--light-text-secondary);">
                    <i class="fas fa-users" style="font-size: 30px; margin-bottom: 10px;"></i>
                    <p>No subscriptions yet</p>
                </div>
            </div>
            
            <div class="sidebar-divider"></div>
            
            <div class="sidebar-header">You</div>
            <div class="sidebar-item" id="yourChannelItem" style="display: none;">
                <i class="fas fa-user-circle sidebar-icon"></i>
                <span>Your Channel</span>
            </div>
            <div class="sidebar-item" id="studioItem" style="display: none;">
                <i class="fas fa-tachometer-alt sidebar-icon"></i>
                <span>Creator Studio</span>
            </div>
            <div class="sidebar-item" id="walletItem" style="display: none;">
                <i class="fas fa-wallet sidebar-icon"></i>
                <span>Wallet</span>
            </div>
            <div class="sidebar-item" id="analyticsItem" style="display: none;">
                <i class="fas fa-chart-line sidebar-icon"></i>
                <span>Analytics</span>
            </div>
            
            <div class="sidebar-divider"></div>
            
            <div class="sidebar-item" id="createChannelItem" style="display: none;">
                <i class="fas fa-plus-circle sidebar-icon"></i>
                <span>Create Channel</span>
            </div>
            <div class="sidebar-item" id="loginItem">
                <i class="fas fa-sign-in-alt sidebar-icon"></i>
                <span>Sign In</span>
            </div>
            <div class="sidebar-item" id="logoutItem" style="display: none;">
                <i class="fas fa-sign-out-alt sidebar-icon"></i>
                <span>Log Out</span>
            </div>
        </nav>

        <main class="main-content">
            <div class="view-container" id="viewContainer">
                <!-- Home View -->
                <div class="view" id="homeView">
                    <div class="banner-ad" style="text-align: center; margin-bottom: 30px;">
                        <a href="https://t.ajrkm1.com/387067/8780/0" target="_blank">
                            <img src="https://www.imglnkx.com/8780/PMKT-1157_DESIGN-16618_BannersWebinar_HBD_300100.gif" alt="Ad" style="max-width: 100%; border-radius: 16px; box-shadow: var(--shadow-lg);">
                        </a>
                    </div>
                    
                    <h2 class="section-title"><i class="fas fa-video" style="color: var(--primary-color);"></i> Shorts</h2>
                    <div class="shorts-grid" id="shortsGrid"></div>
                    
                    <h2 class="section-title"><i class="fas fa-fire" style="color: var(--primary-color);"></i> Recommended For You</h2>
                    
                    <div class="loading-state" id="loadingState" style="text-align: center; padding: 50px;">
                        <div class="spinner" style="margin: 0 auto 20px;"></div>
                        <h3>Loading amazing videos...</h3>
                    </div>
                    
                    <div class="videos-grid" id="videosGrid"></div>
                </div>

                <!-- Video Detail View -->
                <div class="view hidden" id="videoDetailView"></div>

                <!-- Authentication View -->
                <div class="view hidden" id="authView">
                    <div class="auth-container">
                        <div class="auth-header">
                            <i class="fas fa-play-circle logo-icon"></i>
                            <h2 id="authTitle">Welcome Back!</h2>
                            <p>Sign in to continue</p>
                        </div>
                        
                        <form class="auth-form" id="authForm">
                            <div class="form-group">
                                <input type="email" class="form-input" id="authEmail" placeholder="Email address" required>
                            </div>
                            <div class="form-group">
                                <input type="password" class="form-input" id="authPassword" placeholder="Password" required>
                            </div>
                            <button type="submit" class="neon-button" id="authSubmitButton" style="width: 100%;">Sign In</button>
                        </form>
                        
                        <div class="auth-footer">
                            <p>Don't have an account? <a class="auth-link" id="showSignup">Create one now</a></p>
                        </div>
                        
                        <div class="auth-form hidden" id="signupForm">
                            <div class="form-group">
                                <input type="text" class="form-input" id="signupUsername" placeholder="Username" required>
                            </div>
                            <div class="form-group">
                                <input type="email" class="form-input" id="signupEmail" placeholder="Email" required>
                            </div>
                            <div class="form-group">
                                <input type="password" class="form-input" id="signupPassword" placeholder="Password (min. 6 characters)" required>
                            </div>
                            <div class="form-group">
                                <input type="password" class="form-input" id="signupConfirmPassword" placeholder="Confirm password" required>
                            </div>
                            <button type="button" class="neon-button" id="signupButton" style="width: 100%;">Create Account</button>
                        </div>
                    </div>
                </div>

                <!-- Channel Creation View -->
                <div class="view hidden" id="channelCreationView">
                    <div class="channel-creation">
                        <div class="auth-header">
                            <i class="fas fa-play-circle logo-icon"></i>
                            <h2>Create Your Channel</h2>
                            <p>Start your creator journey today!</p>
                        </div>

                        <div class="channel-step active" id="step1">
                            <div class="form-group">
                                <label class="form-label">Channel Name</label>
                                <input type="text" class="form-input" id="channelName" placeholder="Enter your channel name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Channel Handle</label>
                                <input type="text" class="form-input" id="channelHandle" placeholder="@channel" readonly>
                                <small style="color: var(--light-text-secondary);">This will be your unique URL</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Channel Description</label>
                                <textarea class="form-input" id="channelDescription" rows="3" placeholder="Tell viewers about your channel"></textarea>
                            </div>
                            <button class="neon-button" onclick="nextStep(2)" style="width: 100%;">Continue</button>
                        </div>

                        <div class="channel-step" id="step2">
                            <div class="channel-preview">
                                <div class="channel-banner-preview" id="bannerPreview">
                                    <img id="bannerPreviewImg" style="display: none;">
                                </div>
                                <div class="channel-avatar-preview" id="avatarPreview">
                                    <img id="avatarPreviewImg" style="display: none;">
                                    <div class="avatar-initial" id="avatarInitial">?</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Channel Avatar</label>
                                <uc-config
                                    ctx-name="avatar-uploader"
                                    source-list="local, camera, url"
                                    pubkey="0e2cf388a6ab45953e9f"
                                    multiple="false"
                                ></uc-config>
                                <uc-file-uploader-regular
                                    ctx-name="avatar-uploader"
                                    class="uc-light"
                                ></uc-file-uploader-regular>
                                <uc-upload-ctx-provider ctx-name="avatar-uploader"></uc-upload-ctx-provider>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Channel Banner</label>
                                <uc-config
                                    ctx-name="banner-uploader"
                                    source-list="local, url"
                                    pubkey="0e2cf388a6ab45953e9f"
                                    multiple="false"
                                ></uc-config>
                                <uc-file-uploader-regular
                                    ctx-name="banner-uploader"
                                    class="uc-light"
                                ></uc-file-uploader-regular>
                                <uc-upload-ctx-provider ctx-name="banner-uploader"></uc-upload-ctx-provider>
                            </div>

                            <button class="neon-button" onclick="createChannel()" style="width: 100%;">Create Channel</button>
                            <button class="action-button" onclick="nextStep(1)" style="width: 100%; margin-top: 10px;">Back</button>
                        </div>
                    </div>
                </div>

                <!-- Upload View -->
                <div class="view hidden" id="uploadView">
                    <div class="upload-container">
                        <h1><i class="fas fa-upload" style="color: var(--primary-color);"></i> Upload Video</h1>
                        
                        <div class="upload-area" id="uploadArea">
                            <i class="fas fa-cloud-upload-alt upload-icon"></i>
                            <h3>Drag & Drop or Click to Upload</h3>
                            <p>MP4, WebM, or MOV. Max 2GB.</p>
                            <input type="file" class="upload-input" id="videoUpload" accept="video/*">
                        </div>

                        <div class="video-info-form">
                            <div class="form-group">
                                <label class="form-label">Video Title</label>
                                <input type="text" class="form-input" id="videoTitle" placeholder="Enter video title" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Video Description</label>
                                <textarea class="form-input" id="videoDescription" rows="4" placeholder="Tell viewers about your video"></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select class="form-input" id="videoCategory">
                                    <option value="entertainment">Entertainment</option>
                                    <option value="music">Music</option>
                                    <option value="gaming">Gaming</option>
                                    <option value="education">Education</option>
                                    <option value="sports">Sports</option>
                                    <option value="news">News</option>
                                    <option value="technology">Technology</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Tags (separate with commas)</label>
                                <input type="text" class="form-input" id="videoTags" placeholder="e.g., tutorial, vlog, review">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Visibility</label>
                                <select class="form-input" id="videoVisibility">
                                    <option value="public">Public</option>
                                    <option value="unlisted">Unlisted</option>
                                    <option value="private">Private</option>
                                </select>
                            </div>
                        </div>

                        <div class="thumbnail-options">
                            <div class="thumbnail-option selected" id="autoThumbnailOption" onclick="selectThumbnailType('auto')">
                                <i class="fas fa-robot"></i>
                                <h4>Auto Generate</h4>
                                <p>Automatically create thumbnail from video</p>
                                <img class="thumbnail-preview" id="autoThumbnailPreview">
                            </div>
                            <div class="thumbnail-option" id="customThumbnailOption" onclick="selectThumbnailType('custom')">
                                <i class="fas fa-image"></i>
                                <h4>Upload Custom</h4>
                                <p>Upload your own thumbnail image</p>
                                <input type="file" class="thumbnail-input" id="customThumbnailUpload" accept="image/*" style="display: none;">
                                <img class="thumbnail-preview" id="customThumbnailPreview">
                                <button class="neon-button" style="margin-top: 15px;" onclick="document.getElementById('customThumbnailUpload').click()">Choose Image</button>
                            </div>
                        </div>

                        <div class="upload-progress-container" id="uploadProgressContainer">
                            <div class="upload-progress">
                                <div class="upload-progress-bar" id="uploadProgressBar"></div>
                            </div>
                            <div class="progress-text" id="progressText">0% uploaded</div>
                            <div style="text-align: center; margin-top: 10px;" id="uploadSpeed"></div>
                        </div>

                        <div class="upload-success" id="uploadSuccess">
                            <i class="fas fa-check-circle"></i>
                            <h3>Upload Successful!</h3>
                            <p>Your video is now being processed. You'll be notified when it's ready.</p>
                            <button class="neon-button" onclick="switchView('home')">Go to Home</button>
                            <button class="action-button" onclick="uploadAnotherVideo()" style="margin-left: 10px;">Upload Another</button>
                        </div>

                        <button class="neon-button" id="submitUpload" style="width: 100%; margin-top: 20px; font-size: 16px; padding: 16px;">Publish Video</button>
                    </div>
                </div>

                <!-- Creator Studio View -->
                <div class="view hidden" id="studioView">
                    <div class="studio-container">
                        <h1><i class="fas fa-tachometer-alt" style="color: var(--primary-color);"></i> Creator Studio</h1>

                        <div class="analytics-grid">
                            <div class="analytics-card">
                                <i class="fas fa-eye"></i>
                                <div class="analytics-value" id="totalViews">0</div>
                                <div class="analytics-label">Total Views</div>
                            </div>
                            <div class="analytics-card">
                                <i class="fas fa-clock"></i>
                                <div class="analytics-value" id="watchTime">0</div>
                                <div class="analytics-label">Watch Time (hours)</div>
                            </div>
                            <div class="analytics-card">
                                <i class="fas fa-users"></i>
                                <div class="analytics-value" id="subscriberCount">0</div>
                                <div class="analytics-label">Subscribers</div>
                            </div>
                            <div class="analytics-card">
                                <i class="fas fa-dollar-sign"></i>
                                <div class="analytics-value" id="estimatedRevenue">$0</div>
                                <div class="analytics-label">Estimated Revenue</div>
                            </div>
                        </div>

                        <div style="text-align: center; margin: 20px 0;">
                            <div class="monetization-status" id="monetizationStatus">Checking eligibility...</div>
                        </div>

                        <h2>Monetization Progress</h2>
                        <div class="analytics-card">
                            <h3>Subscribers: <span id="currentSubs">0</span>/500</h3>
                            <div class="progress-bar">
                                <div class="progress-fill" id="subsProgress" style="width: 0%"></div>
                            </div>
                            <h3>Watch Time: <span id="currentWatchTime">0</span>/2300 hours</h3>
                            <div class="progress-bar">
                                <div class="progress-fill" id="watchTimeProgress" style="width: 0%"></div>
                            </div>
                        </div>

                        <h2>Your Videos</h2>
                        <table class="content-table">
                            <thead>
                                <tr>
                                    <th>Video</th>
                                    <th>Views</th>
                                    <th>Likes</th>
                                    <th>Comments</th>
                                    <th>Duration</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="creatorVideos"></tbody>
                        </table>

                        <h2>Analytics Chart</h2>
                        <div class="analytics-card" style="height: 400px;">
                            <canvas id="analyticsChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Wallet View -->
                <div class="view hidden" id="walletView">
                    <div class="studio-container">
                        <h1><i class="fas fa-wallet" style="color: var(--primary-color);"></i> Wallet</h1>
                        
                        <div class="wallet-container">
                            <div class="balance-card">
                                <div class="balance-label">Available Balance</div>
                                <div class="balance-amount" id="walletBalance">$0.00</div>
                                <div style="margin-top: 20px;">Lifetime earnings: <span id="lifetimeEarnings">$0.00</span></div>
                            </div>

                            <button class="neon-button" onclick="withdrawEarnings()" style="width: 100%; margin-bottom: 20px;">
                                <i class="fas fa-money-bill-wave"></i> Withdraw Earnings
                            </button>

                            <h3>Recent Transactions</h3>
                            <div class="transaction-list" id="transactionList">
                                <div class="transaction-item">
                                    <div class="transaction-info">
                                        <h4>No transactions yet</h4>
                                        <p>Start earning by uploading videos</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="toast hidden" id="toast">
        <i class="fas fa-info-circle" id="toastIcon"></i>
        <span id="toastMessage"></span>
    </div>

    <script>
        // Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBsfheLc8i-CsRGJ9jkbGUhdTj3ZD3SLu8",
            authDomain: "haitiantube-2affb.firebaseapp.com",
            projectId: "haitiantube-2affb",
            storageBucket: "haitiantube-2affb.firebasestorage.app",
            messagingSenderId: "564033314604",
            appId: "1:564033314604:web:dfcd9b74b670e47dae1689"
        };

        Parse.initialize("4oDcAZ2ONTyTIaPd5K5WMCYwvaRlJPVPuLhHvv4V", "JvxJd9ziRr1m1wxOoHTXJpuwzLUHuJfo5LtrVaw2");
        Parse.serverURL = 'https://parseapi.back4app.com/';

        const VAST_AD_URL = "https://s.magsrv.com/v1/vast.php?idzone=5829940";

        // Platform State
        const platformState = {
            currentUser: null,
            isAuthenticated: false,
            currentView: 'home',
            videos: [],
            shorts: [],
            userChannel: null,
            hasChannel: false,
            subscriptions: new Set(),
            subscribers: new Set(),
            notifications: [],
            unreadNotifications: 0,
            userLikes: new Set(),
            isDarkMode: localStorage.getItem('darkMode') === 'true',
            isUploading: false,
            selectedThumbnailType: 'auto',
            customThumbnailFile: null,
            collaborationTags: [],
            videoDuration: 0,
            uploadcareFiles: new Map(),
            currentVideoFile: null,
            currentCategory: 'all',
            searchQuery: '',
            uploadStartTime: null,
            uploadedBytes: 0
        };

        // DOM Elements
        const elements = {
            menuButton: document.getElementById('menuButton'),
            sidebar: document.getElementById('sidebar'),
            darkModeToggle: document.getElementById('darkModeToggle'),
            uploadButton: document.getElementById('uploadButton'),
            userAvatar: document.getElementById('userAvatar'),
            avatarInitial: document.getElementById('avatarInitial'),
            avatarImage: document.getElementById('avatarImage'),
            avatarStatus: document.getElementById('avatarStatus'),
            searchInput: document.getElementById('searchInput'),
            searchButton: document.getElementById('searchButton'),
            notificationsButton: document.getElementById('notificationsButton'),
            notificationBadge: document.getElementById('notificationBadge'),
            notificationsPanel: document.getElementById('notificationsPanel'),
            notificationsList: document.getElementById('notificationsList'),
            subscriptionsList: document.getElementById('subscriptionsList'),
            loginItem: document.getElementById('loginItem'),
            logoutItem: document.getElementById('logoutItem'),
            yourChannelItem: document.getElementById('yourChannelItem'),
            studioItem: document.getElementById('studioItem'),
            walletItem: document.getElementById('walletItem'),
            analyticsItem: document.getElementById('analyticsItem'),
            createChannelItem: document.getElementById('createChannelItem'),
            subscriptionsSidebar: document.getElementById('subscriptionsSidebar'),
            homeView: document.getElementById('homeView'),
            videoDetailView: document.getElementById('videoDetailView'),
            authView: document.getElementById('authView'),
            uploadView: document.getElementById('uploadView'),
            channelCreationView: document.getElementById('channelCreationView'),
            studioView: document.getElementById('studioView'),
            walletView: document.getElementById('walletView'),
            loadingState: document.getElementById('loadingState'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            videosGrid: document.getElementById('videosGrid'),
            shortsGrid: document.getElementById('shortsGrid'),
            authForm: document.getElementById('authForm'),
            authEmail: document.getElementById('authEmail'),
            authPassword: document.getElementById('authPassword'),
            authSubmitButton: document.getElementById('authSubmitButton'),
            showSignup: document.getElementById('showSignup'),
            signupForm: document.getElementById('signupForm'),
            signupUsername: document.getElementById('signupUsername'),
            signupEmail: document.getElementById('signupEmail'),
            signupPassword: document.getElementById('signupPassword'),
            signupConfirmPassword: document.getElementById('signupConfirmPassword'),
            signupButton: document.getElementById('signupButton'),
            channelName: document.getElementById('channelName'),
            channelHandle: document.getElementById('channelHandle'),
            channelDescription: document.getElementById('channelDescription'),
            avatarPreview: document.getElementById('avatarPreview'),
            avatarPreviewImg: document.getElementById('avatarPreviewImg'),
            avatarInitial: document.getElementById('avatarInitial'),
            bannerPreview: document.getElementById('bannerPreview'),
            bannerPreviewImg: document.getElementById('bannerPreviewImg'),
            uploadArea: document.getElementById('uploadArea'),
            videoUpload: document.getElementById('videoUpload'),
            videoTitle: document.getElementById('videoTitle'),
            videoDescription: document.getElementById('videoDescription'),
            videoCategory: document.getElementById('videoCategory'),
            videoTags: document.getElementById('videoTags'),
            videoVisibility: document.getElementById('videoVisibility'),
            submitUpload: document.getElementById('submitUpload'),
            uploadProgressContainer: document.getElementById('uploadProgressContainer'),
            uploadProgressBar: document.getElementById('uploadProgressBar'),
            progressText: document.getElementById('progressText'),
            uploadSpeed: document.getElementById('uploadSpeed'),
            uploadSuccess: document.getElementById('uploadSuccess'),
            autoThumbnailOption: document.getElementById('autoThumbnailOption'),
            customThumbnailOption: document.getElementById('customThumbnailOption'),
            autoThumbnailPreview: document.getElementById('autoThumbnailPreview'),
            customThumbnailPreview: document.getElementById('customThumbnailPreview'),
            customThumbnailUpload: document.getElementById('customThumbnailUpload'),
            totalViews: document.getElementById('totalViews'),
            watchTime: document.getElementById('watchTime'),
            subscriberCount: document.getElementById('subscriberCount'),
            estimatedRevenue: document.getElementById('estimatedRevenue'),
            currentSubs: document.getElementById('currentSubs'),
            currentWatchTime: document.getElementById('currentWatchTime'),
            subsProgress: document.getElementById('subsProgress'),
            watchTimeProgress: document.getElementById('watchTimeProgress'),
            monetizationStatus: document.getElementById('monetizationStatus'),
            creatorVideos: document.getElementById('creatorVideos'),
            walletBalance: document.getElementById('walletBalance'),
            lifetimeEarnings: document.getElementById('lifetimeEarnings'),
            transactionList: document.getElementById('transactionList'),
            toast: document.getElementById('toast'),
            toastIcon: document.getElementById('toastIcon'),
            toastMessage: document.getElementById('toastMessage')
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const storage = firebase.storage();
        const db = firebase.firestore();

        // Auth State Listener
        auth.onAuthStateChanged(async (user) => {
            showLoading(true);
            if (user) {
                platformState.currentUser = {
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName || user.email.split('@')[0]
                };
                platformState.isAuthenticated = true;
                
                await loadUserChannel(user.uid);
                await loadUserLikes(user.uid);
                await loadSubscriptions(user.uid);
                await loadNotifications(user.uid);
                await loadUserWallet(user.uid);
                
                updateAuthUI();
                showToast(`Welcome back, ${platformState.currentUser.displayName}!`, 'success');
                
                if (elements.avatarStatus) {
                    elements.avatarStatus.style.display = 'block';
                }
            } else {
                platformState.currentUser = null;
                platformState.isAuthenticated = false;
                platformState.userChannel = null;
                platformState.hasChannel = false;
                platformState.subscriptions.clear();
                platformState.userLikes.clear();
                updateAuthUI();
                
                if (elements.avatarStatus) {
                    elements.avatarStatus.style.display = 'none';
                }
            }
            showLoading(false);
        });

        // Initialize Platform
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            loadVideos();
            loadShorts();
            setupUploadcareListeners();
            
            if (platformState.isDarkMode) {
                document.body.classList.add('dark-mode');
                elements.darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
        });

        // Show/Hide Loading
        function showLoading(show) {
            if (show) {
                elements.loadingOverlay.classList.remove('hidden');
            } else {
                elements.loadingOverlay.classList.add('hidden');
            }
        }

        // Event Listeners
        function setupEventListeners() {
            elements.menuButton.addEventListener('click', () => {
                elements.sidebar.classList.toggle('active');
            });

            elements.darkModeToggle.addEventListener('click', toggleDarkMode);

            elements.searchButton.addEventListener('click', handleSearch);
            elements.searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSearch();
            });

            elements.notificationsButton.addEventListener('click', (e) => {
                e.stopPropagation();
                elements.notificationsPanel.classList.toggle('show');
            });

            document.addEventListener('click', (e) => {
                if (!elements.notificationsButton.contains(e.target) && !elements.notificationsPanel.contains(e.target)) {
                    elements.notificationsPanel.classList.remove('show');
                }
            });

            elements.subscriptionsSidebar.addEventListener('click', () => {
                showSubscriptionsView();
            });

            document.querySelectorAll('.sidebar-item[data-view]').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    
                    const view = item.dataset.view;
                    if (view === 'home') switchView('home');
                    else if (view === 'shorts') showShortsView();
                    else if (view === 'trending') showTrendingView();
                });
            });

            elements.loginItem.addEventListener('click', () => {
                switchView('auth');
                resetAuthForms();
            });
            
            elements.logoutItem.addEventListener('click', logout);
            elements.createChannelItem.addEventListener('click', () => switchView('channelCreation'));
            
            elements.studioItem.addEventListener('click', () => {
                switchView('studio');
                loadCreatorStudio();
            });

            elements.walletItem.addEventListener('click', () => {
                switchView('wallet');
                loadWallet();
            });

            elements.analyticsItem.addEventListener('click', () => {
                switchView('studio');
                loadCreatorStudio();
            });

            elements.uploadButton.addEventListener('click', () => {
                switchView('upload');
                resetUploadForm();
            });

            elements.userAvatar.addEventListener('click', () => {
                if (platformState.isAuthenticated) {
                    if (platformState.hasChannel) {
                        switchView('studio');
                    } else {
                        switchView('channelCreation');
                    }
                } else {
                    switchView('auth');
                }
            });

            elements.authForm.addEventListener('submit', (e) => {
                e.preventDefault();
                handleLogin(elements.authEmail.value, elements.authPassword.value);
            });

            elements.showSignup.addEventListener('click', () => {
                elements.authForm.classList.add('hidden');
                elements.signupForm.classList.remove('hidden');
                document.getElementById('authTitle').textContent = 'Create Account';
            });

            elements.signupButton.addEventListener('click', () => {
                const username = elements.signupUsername.value.trim();
                const email = elements.signupEmail.value.trim();
                const password = elements.signupPassword.value;
                const confirmPassword = elements.signupConfirmPassword.value;

                if (!username || !email || !password) {
                    showToast('Please fill in all fields', 'error');
                    return;
                }

                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }

                if (password.length < 6) {
                    showToast('Password must be at least 6 characters', 'error');
                    return;
                }

                handleSignup(username, email, password);
            });

            elements.channelName.addEventListener('input', () => {
                const name = elements.channelName.value.trim();
                if (name) {
                    const handle = '@' + name.toLowerCase().replace(/[^a-z0-9]/g, '');
                    elements.channelHandle.value = handle;
                }
            });

            elements.uploadArea.addEventListener('click', () => elements.videoUpload.click());
            
            elements.uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                elements.uploadArea.classList.add('drag-over');
            });

            elements.uploadArea.addEventListener('dragleave', () => {
                elements.uploadArea.classList.remove('drag-over');
            });

            elements.uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                elements.uploadArea.classList.remove('drag-over');
                if (e.dataTransfer.files.length) {
                    handleVideoFile(e.dataTransfer.files[0]);
                }
            });

            elements.videoUpload.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    handleVideoFile(e.target.files[0]);
                }
            });

            elements.customThumbnailUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (!file.type.startsWith('image/')) {
                        showToast('Please select an image file', 'error');
                        return;
                    }
                    
                    if (file.size > 5 * 1024 * 1024) {
                        showToast('Image must be less than 5MB', 'error');
                        return;
                    }
                    
                    platformState.customThumbnailFile = file;
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        elements.customThumbnailPreview.src = event.target.result;
                        elements.customThumbnailPreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });

            elements.submitUpload.addEventListener('click', (e) => {
                e.preventDefault();
                uploadVideo();
            });
        }

        // Handle Video File Selection
        function handleVideoFile(file) {
            // Check file size (2GB max)
            if (file.size > 2 * 1024 * 1024 * 1024) {
                showToast('File size must be less than 2GB', 'error');
                return;
            }

            // Check file type
            if (!file.type.startsWith('video/')) {
                showToast('Please select a video file', 'error');
                return;
            }

            platformState.currentVideoFile = file;
            showToast(`Selected: ${file.name}`, 'success');
            
            // Get video duration
            const video = document.createElement('video');
            video.preload = 'metadata';
            video.onloadedmetadata = () => {
                platformState.videoDuration = Math.round(video.duration);
                if (!elements.videoTitle.value.trim()) {
                    const fileName = file.name.replace(/\.[^/.]+$/, "");
                    elements.videoTitle.value = fileName;
                }
                generateAutoThumbnail(video);
            };
            video.onerror = () => {
                showToast('Error loading video metadata', 'error');
            };
            video.src = URL.createObjectURL(file);
        }

        // Generate Auto Thumbnail
        function generateAutoThumbnail(video) {
            video.currentTime = Math.min(video.duration * 0.25, 10);
            video.onseeked = () => {
                const canvas = document.createElement('canvas');
                canvas.width = 320;
                canvas.height = 180;
                canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
                elements.autoThumbnailPreview.src = canvas.toDataURL('image/jpeg', 0.8);
                elements.autoThumbnailPreview.style.display = 'block';
                URL.revokeObjectURL(video.src);
            };
        }

        // Select Thumbnail Type
        function selectThumbnailType(type) {
            platformState.selectedThumbnailType = type;
            elements.autoThumbnailOption.classList.toggle('selected', type === 'auto');
            elements.customThumbnailOption.classList.toggle('selected', type === 'custom');
        }

        // Upload Video
        async function uploadVideo() {
            if (platformState.isUploading) return;
            
            if (!platformState.isAuthenticated || !platformState.hasChannel) {
                showToast('Please create a channel first', 'error');
                switchView('channelCreation');
                return;
            }

            const videoFile = platformState.currentVideoFile;
            const title = elements.videoTitle.value.trim();
            const description = elements.videoDescription.value.trim();
            const category = elements.videoCategory.value;
            const tags = elements.videoTags.value.split(',').map(t => t.trim()).filter(t => t);
            const visibility = elements.videoVisibility.value;

            if (!videoFile) {
                showToast('Please select a video', 'error');
                return;
            }

            if (!title) {
                showToast('Please enter a title', 'error');
                return;
            }

            platformState.isUploading = true;
            platformState.uploadStartTime = Date.now();
            platformState.uploadedBytes = 0;
            
            elements.uploadProgressContainer.style.display = 'block';
            elements.uploadProgressBar.style.width = '0%';
            elements.progressText.textContent = '0% uploaded';
            elements.uploadSpeed.textContent = '';
            elements.submitUpload.disabled = true;
            elements.uploadSuccess.style.display = 'none';

            try {
                // Upload video to Firebase Storage
                const fileName = `${Date.now()}_${videoFile.name.replace(/[^a-zA-Z0-9.]/g, '_')}`;
                const videoRef = storage.ref(`videos/${platformState.currentUser.uid}/${fileName}`);
                
                const uploadTask = videoRef.put(videoFile, {
                    customMetadata: {
                        uploadedBy: platformState.currentUser.uid,
                        channelName: platformState.userChannel.name,
                        title: title
                    }
                });

                uploadTask.on('state_changed',
                    (snapshot) => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        platformState.uploadedBytes = snapshot.bytesTransferred;
                        
                        // Update progress bar with smooth animation
                        elements.uploadProgressBar.style.width = progress + '%';
                        elements.progressText.textContent = Math.round(progress) + '% uploaded';
                        
                        // Calculate and display upload speed
                        const elapsedSeconds = (Date.now() - platformState.uploadStartTime) / 1000;
                        const speed = snapshot.bytesTransferred / elapsedSeconds / 1024; // KB/s
                        elements.uploadSpeed.textContent = `Speed: ${speed.toFixed(2)} KB/s`;
                    },
                    (error) => {
                        throw error;
                    }
                );

                await uploadTask;
                const videoUrl = await videoRef.getDownloadURL();

                // Upload thumbnail
                let thumbnailUrl;
                if (platformState.selectedThumbnailType === 'custom' && platformState.customThumbnailFile) {
                    const thumbnailFileName = `thumb_${Date.now()}_${platformState.customThumbnailFile.name.replace(/[^a-zA-Z0-9.]/g, '_')}`;
                    const thumbnailRef = storage.ref(`thumbnails/${platformState.currentUser.uid}/${thumbnailFileName}`);
                    await thumbnailRef.put(platformState.customThumbnailFile, {
                        contentType: platformState.customThumbnailFile.type
                    });
                    thumbnailUrl = await thumbnailRef.getDownloadURL();
                } else {
                    // Convert data URL to blob and upload
                    const response = await fetch(elements.autoThumbnailPreview.src);
                    const blob = await response.blob();
                    const thumbnailFileName = `thumb_${Date.now()}_auto.jpg`;
                    const thumbnailRef = storage.ref(`thumbnails/${platformState.currentUser.uid}/${thumbnailFileName}`);
                    await thumbnailRef.put(blob, {
                        contentType: 'image/jpeg'
                    });
                    thumbnailUrl = await thumbnailRef.getDownloadURL();
                }

                // Determine if it's a short (duration < 60 seconds)
                const isShort = platformState.videoDuration < 60;

                // Save to Back4App
                const Video = Parse.Object.extend('Video');
                const video = new Video();
                
                video.set('title', title);
                video.set('description', description);
                video.set('videoUrl', videoUrl);
                video.set('thumbnailUrl', thumbnailUrl);
                video.set('creatorId', platformState.currentUser.uid);
                video.set('creatorName', platformState.userChannel.name);
                video.set('creatorAvatar', platformState.userChannel.avatar);
                video.set('channelId', platformState.userChannel.id);
                video.set('duration', formatDuration(platformState.videoDuration));
                video.set('isShort', isShort);
                video.set('category', category);
                video.set('tags', tags);
                video.set('visibility', visibility);
                video.set('views', 0);
                video.set('likes', 0);
                video.set('commentsCount', 0);
                video.set('watchTime', 0);
                video.set('status', 'processing');

                await video.save();

                // Save to Firestore for real-time updates
                await db.collection('videos').doc(video.id).set({
                    title: title,
                    creatorId: platformState.currentUser.uid,
                    creatorName: platformState.userChannel.name,
                    status: 'processing',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Notify subscribers
                await notifySubscribers(platformState.userChannel.id, video.id, title);

                // Update channel stats
                const Channel = Parse.Object.extend('Channel');
                const channelQuery = new Parse.Query(Channel);
                const channel = await channelQuery.get(platformState.userChannel.id);
                channel.set('totalVideos', (channel.get('totalVideos') || 0) + 1);
                await channel.save();

                // Show success
                elements.uploadProgressContainer.style.display = 'none';
                elements.uploadSuccess.style.display = 'block';
                elements.submitUpload.style.display = 'none';

                showToast('Video uploaded successfully! It is now being processed.', 'success');

                // Reset form
                resetUploadForm();

                // Reload videos
                loadVideos();
                loadShorts();

            } catch (error) {
                console.error('Upload error:', error);
                showToast('Upload failed: ' + error.message, 'error');
                elements.uploadProgressContainer.style.display = 'none';
                elements.submitUpload.disabled = false;
            } finally {
                platformState.isUploading = false;
            }
        }

        // Reset Upload Form
        function resetUploadForm() {
            elements.videoUpload.value = '';
            elements.videoTitle.value = '';
            elements.videoDescription.value = '';
            elements.videoTags.value = '';
            elements.videoVisibility.value = 'public';
            elements.videoCategory.value = 'entertainment';
            elements.autoThumbnailPreview.style.display = 'none';
            elements.customThumbnailPreview.style.display = 'none';
            elements.uploadProgressContainer.style.display = 'none';
            elements.uploadSuccess.style.display = 'none';
            elements.submitUpload.style.display = 'block';
            elements.submitUpload.disabled = false;
            platformState.currentVideoFile = null;
            platformState.customThumbnailFile = null;
            platformState.selectedThumbnailType = 'auto';
            elements.autoThumbnailOption.classList.add('selected');
            elements.customThumbnailOption.classList.remove('selected');
        }

        // Upload Another Video
        function uploadAnotherVideo() {
            resetUploadForm();
            switchView('upload');
        }

        // Notify Subscribers
        async function notifySubscribers(channelId, videoId, videoTitle) {
            try {
                const Subscription = Parse.Object.extend('Subscription');
                const query = new Parse.Query(Subscription);
                query.equalTo('channelId', channelId);
                
                const subscribers = await query.find();
                
                for (const sub of subscribers) {
                    const userId = sub.get('userId');
                    
                    const Notification = Parse.Object.extend('Notification');
                    const notification = new Notification();
                    
                    notification.set('userId', userId);
                    notification.set('type', 'new_video');
                    notification.set('title', 'New Video Uploaded!');
                    notification.set('message', `${platformState.userChannel.name} just uploaded: ${videoTitle}`);
                    notification.set('data', { videoId, channelId });
                    notification.set('read', false);
                    
                    await notification.save();
                    
                    // Also save to Firestore for real-time
                    await db.collection('notifications').add({
                        userId: userId,
                        type: 'new_video',
                        title: 'New Video Uploaded!',
                        message: `${platformState.userChannel.name} just uploaded: ${videoTitle}`,
                        data: { videoId, channelId },
                        read: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
            } catch (error) {
                console.error('Error notifying subscribers:', error);
            }
        }

        // Load Videos
        async function loadVideos(searchQuery = '') {
            elements.loadingState.style.display = 'block';
            platformState.searchQuery = searchQuery;
            
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                query.equalTo('isShort', false);
                query.equalTo('visibility', 'public');
                
                if (searchQuery) {
                    query.matches('title', searchQuery, 'i');
                }
                
                if (platformState.currentCategory !== 'all') {
                    query.equalTo('category', platformState.currentCategory);
                }
                
                query.descending('createdAt');
                query.limit(50);
                
                const results = await query.find();
                
                platformState.videos = results.map(v => ({
                    id: v.id,
                    title: v.get('title'),
                    description: v.get('description'),
                    videoUrl: v.get('videoUrl'),
                    thumbnailUrl: v.get('thumbnailUrl'),
                    creatorId: v.get('creatorId'),
                    creatorName: v.get('creatorName'),
                    creatorAvatar: v.get('creatorAvatar'),
                    views: v.get('views') || 0,
                    likes: v.get('likes') || 0,
                    commentsCount: v.get('commentsCount') || 0,
                    duration: v.get('duration'),
                    category: v.get('category'),
                    tags: v.get('tags') || [],
                    createdAt: v.get('createdAt')
                }));
                
                displayVideos();
                
            } catch (error) {
                console.error('Error loading videos:', error);
                showToast('Error loading videos', 'error');
            } finally {
                elements.loadingState.style.display = 'none';
            }
        }

        // Display Videos
        function displayVideos() {
            elements.videosGrid.innerHTML = '';
            
            if (platformState.videos.length === 0) {
                elements.videosGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px;"><i class="fas fa-video-slash" style="font-size: 50px; color: var(--primary-color); margin-bottom: 20px;"></i><h3>No videos found</h3><p>Try a different search or category</p></div>';
                return;
            }
            
            platformState.videos.forEach(video => {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.onclick = () => showVideoDetail(video);
                
                card.innerHTML = `
                    <div class="video-thumbnail">
                        <img src="${video.thumbnailUrl || 'https://via.placeholder.com/320x180?text=No+Thumbnail'}" alt="${video.title}" loading="lazy">
                        <span class="video-duration">${video.duration || '0:00'}</span>
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">${video.title}</h3>
                        <p class="video-creator">
                            <i class="fas fa-check-circle"></i> ${video.creatorName}
                        </p>
                        <div class="video-stats">
                            <span>${formatNumber(video.views)} views</span>
                            <span></span>
                            <span>${formatDate(video.createdAt)}</span>
                        </div>
                        <div class="video-tags" style="margin-top: 8px;">
                            ${video.category ? `<span class="category-chip" style="padding: 4px 8px; font-size: 11px;">${video.category}</span>` : ''}
                        </div>
                    </div>
                `;
                
                elements.videosGrid.appendChild(card);
            });
        }

        // Load Shorts
        async function loadShorts() {
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                query.equalTo('isShort', true);
                query.equalTo('visibility', 'public');
                query.descending('createdAt');
                query.limit(30);
                
                const results = await query.find();
                
                platformState.shorts = results.map(v => ({
                    id: v.id,
                    title: v.get('title'),
                    thumbnailUrl: v.get('thumbnailUrl'),
                    creatorName: v.get('creatorName'),
                    views: v.get('views') || 0
                }));
                
                displayShorts();
                
            } catch (error) {
                console.error('Error loading shorts:', error);
            }
        }

        // Display Shorts
        function displayShorts() {
            elements.shortsGrid.innerHTML = '';
            
            if (platformState.shorts.length === 0) {
                elements.shortsGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 30px;">No shorts available</div>';
                return;
            }
            
            platformState.shorts.forEach(short => {
                const card = document.createElement('div');
                card.className = 'short-card';
                card.onclick = () => {
                    const video = platformState.videos.find(v => v.id === short.id);
                    if (video) showVideoDetail(video);
                };
                
                card.innerHTML = `
                    <img class="short-thumbnail" src="${short.thumbnailUrl || 'https://via.placeholder.com/180x320'}" alt="${short.title}" loading="lazy">
                    <div class="short-badge">
                        <i class="fas fa-video"></i> Short
                    </div>
                    <div class="short-info">
                        <h4>${short.title}</h4>
                        <p>${short.creatorName}</p>
                        <p>${formatNumber(short.views)} views</p>
                    </div>
                `;
                
                elements.shortsGrid.appendChild(card);
            });
        }

        // Filter by Category
        function filterByCategory(category) {
            platformState.currentCategory = category;
            
            // Update active category chip
            document.querySelectorAll('.category-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.category === category);
            });
            
            loadVideos(platformState.searchQuery);
        }

        // Show Video Detail
        async function showVideoDetail(video) {
            platformState.currentVideo = video;
            showLoading(true);
            
            // Increment view count
            await incrementViewCount(video.id);
            
            const videoDetailHTML = `
                <div class="video-detail-container">
                    <div class="video-player-container" id="videoPlayerContainer">
                        <video id="player-${video.id}" controls style="width: 100%;">
                            <source src="${video.videoUrl}" type="video/mp4">
                        </video>
                    </div>
                    
                    <div class="video-info-detail">
                        <h1 class="video-title-detail">${video.title}</h1>
                        
                        <div class="video-meta">
                            <span><i class="fas fa-eye"></i> ${formatNumber(video.views + 1)} views</span>
                            <span><i class="fas fa-calendar"></i> ${formatDate(video.createdAt)}</span>
                            ${video.category ? `<span><i class="fas fa-tag"></i> ${video.category}</span>` : ''}
                        </div>
                        
                        <div class="video-actions">
                            <button class="action-button ${platformState.userLikes.has(video.id) ? 'active' : ''}" onclick="toggleLike('${video.id}')">
                                <i class="fas fa-thumbs-up"></i>
                                <span id="likeCount-${video.id}">${formatNumber(video.likes)}</span>
                            </button>
                            <button class="action-button" onclick="shareVideo('${video.id}')">
                                <i class="fas fa-share"></i> Share
                            </button>
                            <button class="action-button" onclick="saveVideo('${video.id}')">
                                <i class="fas fa-bookmark"></i> Save
                            </button>
                            <button class="action-button" onclick="reportVideo('${video.id}')">
                                <i class="fas fa-flag"></i> Report
                            </button>
                        </div>
                        
                        <div class="creator-info-detail">
                            <div class="creator-avatar">
                                <img src="${video.creatorAvatar || 'https://via.placeholder.com/70x70'}" alt="${video.creatorName}">
                            </div>
                            <div class="creator-details">
                                <h3>
                                    ${video.creatorName}
                                    <i class="fas fa-check-circle verified-badge"></i>
                                </h3>
                                <div class="creator-stats">
                                    <span id="subscriberCount-${video.creatorId}">${formatNumber(Math.floor(Math.random() * 10000))} subscribers</span>
                                </div>
                            </div>
                            <button class="subscribe-button ${platformState.subscriptions.has(video.creatorId) ? 'subscribed' : ''}" 
                                    onclick="toggleSubscribe('${video.creatorId}', '${video.creatorName}')">
                                ${platformState.subscriptions.has(video.creatorId) ? 'Subscribed' : 'Subscribe'}
                            </button>
                        </div>
                        
                        <div class="video-description">
                            <p>${video.description || 'No description provided.'}</p>
                            ${video.tags && video.tags.length ? `
                                <div style="margin-top: 15px;">
                                    ${video.tags.map(tag => `<span class="category-chip" style="padding: 4px 8px; font-size: 11px;">#${tag}</span>`).join(' ')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="comments-section">
                        <h3><i class="fas fa-comments"></i> Comments (${video.commentsCount || 0})</h3>
                        ${platformState.isAuthenticated ? `
                            <div class="comment-input">
                                <div class="comment-avatar">
                                    <img src="${platformState.userChannel?.avatar || 'https://via.placeholder.com/48x48'}" alt="You">
                                </div>
                                <input type="text" id="commentInput" placeholder="Add a public comment...">
                                <button class="comment-button" onclick="addComment('${video.id}')">Comment</button>
                            </div>
                        ` : `
                            <p style="text-align: center; padding: 20px;">Please <a href="#" onclick="switchView('auth')">sign in</a> to join the discussion.</p>
                        `}
                        <div id="commentsList" style="margin-top: 30px;"></div>
                    </div>
                </div>
            `;
            
            switchView('videoDetail');
            elements.videoDetailView.innerHTML = videoDetailHTML;
            
            // Initialize video player
            const videoElement = document.getElementById('player-' + video.id);
            if (videoElement) {
                const player = fluidPlayer('player-' + video.id, {
                    layoutControls: {
                        primaryColor: "#ff0000",
                        posterImage: video.thumbnailUrl,
                        allowDownload: false,
                        playButtonShowing: true,
                        fillToContainer: true,
                        autoPlay: true,
                        mute: false
                    },
                    vastOptions: {
                        adList: [
                            { roll: 'preRoll', vastTag: VAST_AD_URL },
                            { roll: 'midRoll', vastTag: VAST_AD_URL, timer: 30 }
                        ],
                        adCTAText: true,
                        skipButtonCaption: 'Skip Ad [seconds]',
                        adClickable: true
                    }
                });
                
                // Track watch time
                let watchTimeCounter = 0;
                videoElement.addEventListener('timeupdate', () => {
                    watchTimeCounter++;
                    if (watchTimeCounter % 30 === 0) { // Every 30 seconds
                        updateWatchTime(video.id, 30);
                    }
                });
            }
            
            loadComments(video.id);
            showLoading(false);
        }

        // Toggle Like
        async function toggleLike(videoId) {
            if (!platformState.isAuthenticated) {
                showToast('Please login to like videos', 'error');
                switchView('auth');
                return;
            }
            
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                
                const currentLikes = video.get('likes') || 0;
                
                if (platformState.userLikes.has(videoId)) {
                    video.set('likes', Math.max(0, currentLikes - 1));
                    platformState.userLikes.delete(videoId);
                    
                    // Remove from Firestore
                    const likeQuery = await db.collection('likes')
                        .where('userId', '==', platformState.currentUser.uid)
                        .where('videoId', '==', videoId)
                        .get();
                    
                    likeQuery.forEach(doc => doc.ref.delete());
                    
                } else {
                    video.set('likes', currentLikes + 1);
                    platformState.userLikes.add(videoId);
                    
                    // Save to Firestore
                    await db.collection('likes').add({
                        userId: platformState.currentUser.uid,
                        videoId: videoId,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                await video.save();
                
                const likeCount = document.getElementById(`likeCount-${videoId}`);
                if (likeCount) {
                    likeCount.textContent = formatNumber(video.get('likes'));
                }
                
                showToast(platformState.userLikes.has(videoId) ? 'Video liked!' : 'Like removed', 'success');
                
            } catch (error) {
                console.error('Error toggling like:', error);
                showToast('Error updating like', 'error');
            }
        }

        // Toggle Subscribe
        async function toggleSubscribe(creatorId, creatorName) {
            if (!platformState.isAuthenticated) {
                showToast('Please login to subscribe', 'error');
                switchView('auth');
                return;
            }
            
            showLoading(true);
            
            try {
                const Subscription = Parse.Object.extend('Subscription');
                const query = new Parse.Query(Subscription);
                query.equalTo('userId', platformState.currentUser.uid);
                query.equalTo('creatorId', creatorId);
                
                const existing = await query.first();
                
                if (existing) {
                    await existing.destroy();
                    platformState.subscriptions.delete(creatorId);
                    
                    // Update creator's subscriber count
                    const Channel = Parse.Object.extend('Channel');
                    const channelQuery = new Parse.Query(Channel);
                    channelQuery.equalTo('userId', creatorId);
                    const channel = await channelQuery.first();
                    if (channel) {
                        channel.set('subscribers', Math.max(0, (channel.get('subscribers') || 0) - 1));
                        await channel.save();
                    }
                    
                    // Remove from Firestore
                    const subQuery = await db.collection('subscriptions')
                        .where('userId', '==', platformState.currentUser.uid)
                        .where('creatorId', '==', creatorId)
                        .get();
                    
                    subQuery.forEach(doc => doc.ref.delete());
                    
                    showToast(`Unsubscribed from ${creatorName}`, 'info');
                } else {
                    const subscription = new Subscription();
                    subscription.set('userId', platformState.currentUser.uid);
                    subscription.set('creatorId', creatorId);
                    subscription.set('creatorName', creatorName);
                    subscription.set('channelId', creatorId);
                    await subscription.save();
                    
                    platformState.subscriptions.add(creatorId);
                    
                    // Update creator's subscriber count
                    const Channel = Parse.Object.extend('Channel');
                    const channelQuery = new Parse.Query(Channel);
                    channelQuery.equalTo('userId', creatorId);
                    const channel = await channelQuery.first();
                    if (channel) {
                        channel.set('subscribers', (channel.get('subscribers') || 0) + 1);
                        await channel.save();
                    }
                    
                    // Save to Firestore
                    await db.collection('subscriptions').add({
                        userId: platformState.currentUser.uid,
                        creatorId: creatorId,
                        creatorName: creatorName,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    showToast(`Subscribed to ${creatorName}!`, 'success');
                }
                
                // Update button
                const subscribeBtn = document.querySelector('.subscribe-button');
                if (subscribeBtn) {
                    subscribeBtn.classList.toggle('subscribed');
                    subscribeBtn.textContent = platformState.subscriptions.has(creatorId) ? 'Subscribed' : 'Subscribe';
                }
                
                // Update subscriber count display
                const countElement = document.getElementById(`subscriberCount-${creatorId}`);
                if (countElement) {
                    const currentCount = parseInt(countElement.textContent.replace(/[^0-9]/g, '')) || 0;
                    countElement.textContent = formatNumber(
                        platformState.subscriptions.has(creatorId) ? currentCount + 1 : Math.max(0, currentCount - 1)
                    ) + ' subscribers';
                }
                
                // Reload subscriptions list
                await loadSubscriptions(platformState.currentUser.uid);
                
            } catch (error) {
                console.error('Error toggling subscription:', error);
                showToast('Error updating subscription', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Add Comment
        async function addComment(videoId) {
            const input = document.getElementById('commentInput');
            const text = input.value.trim();
            
            if (!text) {
                showToast('Please enter a comment', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const Comment = Parse.Object.extend('Comment');
                const comment = new Comment();
                
                comment.set('videoId', videoId);
                comment.set('userId', platformState.currentUser.uid);
                comment.set('userName', platformState.currentUser.displayName);
                comment.set('userAvatar', platformState.userChannel?.avatar);
                comment.set('text', text);
                
                await comment.save();
                
                // Update comment count
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                video.set('commentsCount', (video.get('commentsCount') || 0) + 1);
                await video.save();
                
                // Save to Firestore
                await db.collection('comments').add({
                    videoId: videoId,
                    userId: platformState.currentUser.uid,
                    userName: platformState.currentUser.displayName,
                    userAvatar: platformState.userChannel?.avatar,
                    text: text,
                    likes: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                input.value = '';
                loadComments(videoId);
                
                showToast('Comment added!', 'success');
                
            } catch (error) {
                console.error('Error adding comment:', error);
                showToast('Error adding comment', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Load Comments
        async function loadComments(videoId) {
            try {
                const Comment = Parse.Object.extend('Comment');
                const query = new Parse.Query(Comment);
                query.equalTo('videoId', videoId);
                query.descending('createdAt');
                query.limit(50);
                
                const results = await query.find();
                
                const commentsList = document.getElementById('commentsList');
                commentsList.innerHTML = '';
                
                if (results.length === 0) {
                    commentsList.innerHTML = '<p style="text-align: center; padding: 30px;">No comments yet. Be the first to comment!</p>';
                    return;
                }
                
                results.forEach(comment => {
                    const commentEl = document.createElement('div');
                    commentEl.className = 'comment';
                    
                    commentEl.innerHTML = `
                        <div class="comment-avatar">
                            <img src="${comment.get('userAvatar') || 'https://via.placeholder.com/48x48'}" alt="${comment.get('userName')}">
                        </div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <h4>${comment.get('userName')}</h4>
                                <span class="comment-time">${formatDate(comment.get('createdAt'))}</span>
                            </div>
                            <div class="comment-text">${comment.get('text')}</div>
                            <div class="comment-actions">
                                <button onclick="likeComment('${comment.id}')"><i class="far fa-thumbs-up"></i> Like</button>
                                <button onclick="replyToComment('${comment.id}')"><i class="far fa-comment"></i> Reply</button>
                                ${comment.get('userId') === platformState.currentUser?.uid ? `
                                    <button onclick="deleteComment('${comment.id}')"><i class="far fa-trash-alt"></i> Delete</button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    
                    commentsList.appendChild(commentEl);
                });
                
            } catch (error) {
                console.error('Error loading comments:', error);
            }
        }

        // Load User Channel
        async function loadUserChannel(userId) {
            try {
                const Channel = Parse.Object.extend('Channel');
                const query = new Parse.Query(Channel);
                query.equalTo('userId', userId);
                
                const channel = await query.first();
                
                if (channel) {
                    platformState.userChannel = {
                        id: channel.id,
                        name: channel.get('name'),
                        handle: channel.get('handle'),
                        avatar: channel.get('avatar'),
                        banner: channel.get('banner'),
                        description: channel.get('description'),
                        subscribers: channel.get('subscribers') || 0,
                        totalVideos: channel.get('totalVideos') || 0,
                        totalViews: channel.get('totalViews') || 0,
                        joinDate: channel.get('createdAt')
                    };
                    platformState.hasChannel = true;
                    
                    elements.yourChannelItem.style.display = 'flex';
                    elements.studioItem.style.display = 'flex';
                    elements.walletItem.style.display = 'flex';
                    elements.analyticsItem.style.display = 'flex';
                    elements.createChannelItem.style.display = 'none';
                } else {
                    platformState.hasChannel = false;
                    elements.yourChannelItem.style.display = 'none';
                    elements.studioItem.style.display = 'none';
                    elements.walletItem.style.display = 'none';
                    elements.analyticsItem.style.display = 'none';
                    elements.createChannelItem.style.display = 'flex';
                }
                
                elements.uploadButton.style.display = platformState.hasChannel ? 'flex' : 'none';
                
            } catch (error) {
                console.error('Error loading channel:', error);
            }
        }

        // Load Subscriptions
        async function loadSubscriptions(userId) {
            try {
                const Subscription = Parse.Object.extend('Subscription');
                const query = new Parse.Query(Subscription);
                query.equalTo('userId', userId);
                
                const results = await query.find();
                
                platformState.subscriptions.clear();
                results.forEach(sub => {
                    platformState.subscriptions.add(sub.get('creatorId'));
                });
                
                displaySubscriptions();
                
            } catch (error) {
                console.error('Error loading subscriptions:', error);
            }
        }

        // Display Subscriptions
        async function displaySubscriptions() {
            elements.subscriptionsList.innerHTML = '';
            
            if (platformState.subscriptions.size === 0) {
                elements.subscriptionsList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--light-text-secondary);"><i class="fas fa-users" style="font-size: 30px; margin-bottom: 10px;"></i><p>No subscriptions yet</p><p style="font-size: 12px;">Subscribe to channels to see their videos here</p></div>';
                return;
            }
            
            // Load channel details for each subscription
            const Channel = Parse.Object.extend('Channel');
            
            for (const creatorId of platformState.subscriptions) {
                const query = new Parse.Query(Channel);
                query.equalTo('userId', creatorId);
                const channel = await query.first();
                
                if (channel) {
                    const item = document.createElement('div');
                    item.className = 'subscription-item';
                    item.onclick = () => filterByCreator(creatorId);
                    
                    item.innerHTML = `
                        <div class="subscription-avatar">
                            <img src="${channel.get('avatar') || 'https://via.placeholder.com/44x44'}" alt="${channel.get('name')}">
                        </div>
                        <div class="subscription-info">
                            <h4>${channel.get('name')}</h4>
                            <p>${formatNumber(channel.get('subscribers') || 0)} subscribers</p>
                        </div>
                    `;
                    
                    elements.subscriptionsList.appendChild(item);
                }
            }
        }

        // Load User Likes
        async function loadUserLikes(userId) {
            try {
                const Like = Parse.Object.extend('Like');
                const query = new Parse.Query(Like);
                query.equalTo('userId', userId);
                
                const results = await query.find();
                
                platformState.userLikes.clear();
                results.forEach(like => {
                    platformState.userLikes.add(like.get('videoId'));
                });
                
            } catch (error) {
                console.error('Error loading likes:', error);
            }
        }

        // Load Notifications
        async function loadNotifications(userId) {
            try {
                // Load from Firestore for real-time updates
                const snapshot = await db.collection('notifications')
                    .where('userId', '==', userId)
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .get();
                
                platformState.notifications = [];
                platformState.unreadNotifications = 0;
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const notification = {
                        id: doc.id,
                        type: data.type,
                        title: data.title,
                        message: data.message,
                        data: data.data,
                        read: data.read,
                        createdAt: data.createdAt?.toDate()
                    };
                    
                    platformState.notifications.push(notification);
                    if (!notification.read) {
                        platformState.unreadNotifications++;
                    }
                });
                
                updateNotificationBadge();
                displayNotifications();
                
            } catch (error) {
                console.error('Error loading notifications:', error);
                
                // Fallback to Parse
                try {
                    const Notification = Parse.Object.extend('Notification');
                    const query = new Parse.Query(Notification);
                    query.equalTo('userId', userId);
                    query.descending('createdAt');
                    query.limit(50);
                    
                    const results = await query.find();
                    
                    platformState.notifications = [];
                    platformState.unreadNotifications = 0;
                    
                    results.forEach(notif => {
                        const notification = {
                            id: notif.id,
                            type: notif.get('type'),
                            title: notif.get('title'),
                            message: notif.get('message'),
                            data: notif.get('data'),
                            read: notif.get('read'),
                            createdAt: notif.get('createdAt')
                        };
                        
                        platformState.notifications.push(notification);
                        if (!notification.read) {
                            platformState.unreadNotifications++;
                        }
                    });
                    
                    updateNotificationBadge();
                    displayNotifications();
                    
                } catch (parseError) {
                    console.error('Error loading from Parse:', parseError);
                }
            }
        }

        // Display Notifications
        function displayNotifications() {
            elements.notificationsList.innerHTML = '';
            
            if (platformState.notifications.length === 0) {
                elements.notificationsList.innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fas fa-bell-slash" style="font-size: 40px; color: var(--light-text-secondary); margin-bottom: 15px;"></i><p style="color: var(--light-text-secondary);">No notifications</p></div>';
                return;
            }
            
            platformState.notifications.forEach(notification => {
                const item = document.createElement('div');
                item.className = `notification-item ${notification.read ? '' : 'unread'}`;
                item.onclick = () => handleNotificationClick(notification);
                
                item.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas ${getNotificationIcon(notification.type)}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${notification.title}</div>
                        <div class="notification-message">${notification.message}</div>
                        <div class="notification-time">${formatDate(notification.createdAt)}</div>
                    </div>
                `;
                
                elements.notificationsList.appendChild(item);
            });
        }

        // Get Notification Icon
        function getNotificationIcon(type) {
            switch(type) {
                case 'new_video': return 'fa-video';
                case 'subscription': return 'fa-user-plus';
                case 'like': return 'fa-thumbs-up';
                case 'comment': return 'fa-comment';
                case 'mention': return 'fa-at';
                case 'earnings': return 'fa-dollar-sign';
                default: return 'fa-bell';
            }
        }

        // Handle Notification Click
        function handleNotificationClick(notification) {
            markNotificationRead(notification.id);
            
            if (notification.type === 'new_video' && notification.data?.videoId) {
                const video = platformState.videos.find(v => v.id === notification.data.videoId);
                if (video) showVideoDetail(video);
            }
        }

        // Mark Notification as Read
        async function markNotificationRead(notificationId) {
            try {
                await db.collection('notifications').doc(notificationId).update({
                    read: true
                });
                
                const notif = platformState.notifications.find(n => n.id === notificationId);
                if (notif && !notif.read) {
                    notif.read = true;
                    platformState.unreadNotifications--;
                    updateNotificationBadge();
                    displayNotifications();
                }
                
            } catch (error) {
                console.error('Error marking notification read:', error);
            }
        }

        // Mark All Notifications as Read
        async function markAllNotificationsRead() {
            for (const notification of platformState.notifications) {
                if (!notification.read) {
                    await markNotificationRead(notification.id);
                }
            }
            showToast('All notifications marked as read', 'success');
        }

        // Update Notification Badge
        function updateNotificationBadge() {
            if (platformState.unreadNotifications > 0) {
                elements.notificationBadge.textContent = platformState.unreadNotifications;
                elements.notificationBadge.classList.remove('hidden');
            } else {
                elements.notificationBadge.classList.add('hidden');
            }
        }

        // Create Channel
        async function createChannel() {
            const channelName = elements.channelName.value.trim();
            const channelDescription = elements.channelDescription?.value.trim() || '';
            
            if (!channelName) {
                showToast('Please enter a channel name', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const handle = '@' + channelName.toLowerCase().replace(/[^a-z0-9]/g, '');
                
                const avatarFile = platformState.uploadcareFiles.get('avatar');
                const bannerFile = platformState.uploadcareFiles.get('banner');
                
                const Channel = Parse.Object.extend('Channel');
                const channel = new Channel();
                
                channel.set('userId', platformState.currentUser.uid);
                channel.set('name', channelName);
                channel.set('handle', handle);
                channel.set('description', channelDescription);
                channel.set('avatar', avatarFile ? avatarFile.cdnUrl : null);
                channel.set('banner', bannerFile ? bannerFile.cdnUrl : null);
                channel.set('subscribers', 0);
                channel.set('totalVideos', 0);
                channel.set('totalViews', 0);
                channel.set('watchTime', 0);
                channel.set('createdAt', new Date());
                
                await channel.save();
                
                // Save to Firestore
                await db.collection('channels').doc(channel.id).set({
                    userId: platformState.currentUser.uid,
                    name: channelName,
                    handle: handle,
                    description: channelDescription,
                    avatar: avatarFile ? avatarFile.cdnUrl : null,
                    banner: bannerFile ? bannerFile.cdnUrl : null,
                    subscribers: 0,
                    totalVideos: 0,
                    totalViews: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                platformState.userChannel = {
                    id: channel.id,
                    name: channelName,
                    handle: handle,
                    avatar: avatarFile ? avatarFile.cdnUrl : null,
                    banner: bannerFile ? bannerFile.cdnUrl : null,
                    description: channelDescription,
                    subscribers: 0
                };
                platformState.hasChannel = true;
                
                showToast(`Welcome ${channelName}! Your channel is ready.`, 'success');
                switchView('home');
                
            } catch (error) {
                console.error('Error creating channel:', error);
                showToast('Error creating channel: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Load Creator Studio
        async function loadCreatorStudio() {
            if (!platformState.hasChannel) return;
            
            showLoading(true);
            
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                query.equalTo('creatorId', platformState.currentUser.uid);
                query.descending('createdAt');
                
                const videos = await query.find();
                
                let totalViews = 0;
                let totalWatchTime = 0;
                let totalLikes = 0;
                
                videos.forEach(video => {
                    totalViews += video.get('views') || 0;
                    totalWatchTime += video.get('watchTime') || 0;
                    totalLikes += video.get('likes') || 0;
                });
                
                const watchTimeHours = Math.floor(totalWatchTime / 3600);
                const estimatedRevenue = (totalViews / 1000) * 2.5; // $2.5 per 1000 views
                
                elements.totalViews.textContent = formatNumber(totalViews);
                elements.watchTime.textContent = watchTimeHours;
                elements.subscriberCount.textContent = formatNumber(platformState.userChannel.subscribers);
                elements.estimatedRevenue.textContent = '$' + estimatedRevenue.toFixed(2);
                
                elements.currentSubs.textContent = platformState.userChannel.subscribers;
                elements.currentWatchTime.textContent = watchTimeHours;
                
                const subsProgress = Math.min((platformState.userChannel.subscribers / 500) * 100, 100);
                const watchTimeProgress = Math.min((watchTimeHours / 2300) * 100, 100);
                
                elements.subsProgress.style.width = subsProgress + '%';
                elements.watchTimeProgress.style.width = watchTimeProgress + '%';
                
                if (platformState.userChannel.subscribers >= 500 && watchTimeHours >= 2300) {
                    elements.monetizationStatus.textContent = 'Eligible for Monetization ';
                    elements.monetizationStatus.className = 'monetization-status eligible';
                } else {
                    const subsNeeded = Math.max(0, 500 - platformState.userChannel.subscribers);
                    const hoursNeeded = Math.max(0, 2300 - watchTimeHours);
                    elements.monetizationStatus.textContent = `Not Eligible - Need ${subsNeeded} more subscribers and ${hoursNeeded} more hours`;
                    elements.monetizationStatus.className = 'monetization-status ineligible';
                }
                
                displayCreatorVideos(videos);
                createAnalyticsChart(videos);
                
            } catch (error) {
                console.error('Error loading studio:', error);
                showToast('Error loading studio data', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Display Creator Videos
        function displayCreatorVideos(videos) {
            elements.creatorVideos.innerHTML = '';
            
            if (videos.length === 0) {
                elements.creatorVideos.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px;">No videos uploaded yet. Click Upload to start creating!</td></tr>';
                return;
            }
            
            videos.forEach(video => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${video.get('title')}</td>
                    <td>${formatNumber(video.get('views') || 0)}</td>
                    <td>${formatNumber(video.get('likes') || 0)}</td>
                    <td>${formatNumber(video.get('commentsCount') || 0)}</td>
                    <td>${video.get('duration') || '0:00'}</td>
                    <td>
                        <button class="action-button" onclick="editVideo('${video.id}')"><i class="fas fa-edit"></i></button>
                        <button class="action-button" onclick="viewVideoStats('${video.id}')"><i class="fas fa-chart-bar"></i></button>
                        <button class="action-button" onclick="deleteVideo('${video.id}')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                elements.creatorVideos.appendChild(row);
            });
        }

        // Create Analytics Chart
        function createAnalyticsChart(videos) {
            const ctx = document.getElementById('analyticsChart')?.getContext('2d');
            if (!ctx) return;
            
            // Group by date
            const last7Days = [];
            const viewsData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                
                let dailyViews = 0;
                videos.forEach(video => {
                    const createdAt = video.get('createdAt');
                    if (createdAt && new Date(createdAt).toDateString() === date.toDateString()) {
                        dailyViews += video.get('views') || 0;
                    }
                });
                viewsData.push(dailyViews);
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'Daily Views',
                        data: viewsData,
                        borderColor: '#ff0000',
                        backgroundColor: 'rgba(255, 0, 0, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: platformState.isDarkMode ? '#fff' : '#000'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: platformState.isDarkMode ? '#333' : '#eee'
                            },
                            ticks: {
                                color: platformState.isDarkMode ? '#fff' : '#000'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: platformState.isDarkMode ? '#fff' : '#000'
                            }
                        }
                    }
                }
            });
        }

        // Load User Wallet
        async function loadUserWallet(userId) {
            try {
                const Wallet = Parse.Object.extend('Wallet');
                const query = new Parse.Query(Wallet);
                query.equalTo('userId', userId);
                
                const wallet = await query.first();
                
                if (wallet) {
                    const balance = wallet.get('balance') || 0;
                    const lifetimeEarnings = wallet.get('lifetimeEarnings') || 0;
                    
                    if (elements.walletBalance) {
                        elements.walletBalance.textContent = '$' + balance.toFixed(2);
                    }
                    if (elements.lifetimeEarnings) {
                        elements.lifetimeEarnings.textContent = '$' + lifetimeEarnings.toFixed(2);
                    }
                    
                    // Load transactions
                    const transactions = wallet.get('transactions') || [];
                    displayTransactions(transactions);
                }
                
            } catch (error) {
                console.error('Error loading wallet:', error);
            }
        }

        // Display Transactions
        function displayTransactions(transactions) {
            if (!elements.transactionList) return;
            
            if (transactions.length === 0) {
                elements.transactionList.innerHTML = '<div class="transaction-item"><div class="transaction-info"><h4>No transactions yet</h4><p>Start earning by uploading videos</p></div></div>';
                return;
            }
            
            elements.transactionList.innerHTML = transactions.map(t => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <h4>${t.description}</h4>
                        <p>${formatDate(t.date)}</p>
                    </div>
                    <div class="transaction-amount ${t.amount > 0 ? 'positive' : 'negative'}">
                        ${t.amount > 0 ? '+' : ''}$${Math.abs(t.amount).toFixed(2)}
                    </div>
                </div>
            `).join('');
        }

        // Withdraw Earnings
        async function withdrawEarnings() {
            if (!platformState.isAuthenticated || !platformState.hasChannel) {
                showToast('Please login and create a channel first', 'error');
                return;
            }
            
            showToast('Withdrawal feature coming soon!', 'info');
        }

        // Increment View Count
        async function incrementViewCount(videoId) {
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                
                video.set('views', (video.get('views') || 0) + 1);
                await video.save();
                
                // Update Firestore
                await db.collection('videos').doc(videoId).update({
                    views: firebase.firestore.FieldValue.increment(1)
                });
                
            } catch (error) {
                console.error('Error incrementing views:', error);
            }
        }

        // Update Watch Time
        async function updateWatchTime(videoId, seconds) {
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                
                video.set('watchTime', (video.get('watchTime') || 0) + seconds);
                await video.save();
                
                // Update channel watch time
                if (platformState.userChannel) {
                    const Channel = Parse.Object.extend('Channel');
                    const channelQuery = new Parse.Query(Channel);
                    const channel = await channelQuery.get(platformState.userChannel.id);
                    channel.set('watchTime', (channel.get('watchTime') || 0) + seconds);
                    await channel.save();
                }
                
            } catch (error) {
                console.error('Error updating watch time:', error);
            }
        }

        // Handle Search
        function handleSearch() {
            const query = elements.searchInput.value.trim();
            if (query) {
                loadVideos(query);
                showToast(`Searching for "${query}"...`, 'info');
            } else {
                loadVideos();
            }
        }

        // Handle Login
        async function handleLogin(email, password) {
            showLoading(true);
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showToast('Signed in successfully!', 'success');
                switchView('home');
            } catch (error) {
                showToast(error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Handle Signup
        async function handleSignup(username, email, password) {
            showLoading(true);
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: username });
                
                // Create user profile in Firestore
                await db.collection('users').doc(userCredential.user.uid).set({
                    username: username,
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showToast('Account created successfully!', 'success');
                switchView('channelCreation');
            } catch (error) {
                showToast(error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Logout
        async function logout() {
            showLoading(true);
            try {
                await auth.signOut();
                showToast('Logged out successfully', 'info');
                switchView('home');
            } catch (error) {
                showToast(error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Toggle Dark Mode
        function toggleDarkMode() {
            platformState.isDarkMode = !platformState.isDarkMode;
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', platformState.isDarkMode);
            elements.darkModeToggle.innerHTML = platformState.isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        }

        // Switch View
        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(view => view.classList.add('hidden'));
            
            platformState.currentView = viewName;
            
            switch(viewName) {
                case 'home':
                    elements.homeView.classList.remove('hidden');
                    break;
                case 'videoDetail':
                    elements.videoDetailView.classList.remove('hidden');
                    break;
                case 'auth':
                    elements.authView.classList.remove('hidden');
                    break;
                case 'channelCreation':
                    if (platformState.isAuthenticated && !platformState.hasChannel) {
                        elements.channelCreationView.classList.remove('hidden');
                    } else {
                        switchView('home');
                    }
                    break;
                case 'upload':
                    if (platformState.isAuthenticated && platformState.hasChannel) {
                        elements.uploadView.classList.remove('hidden');
                    } else {
                        switchView('home');
                    }
                    break;
                case 'studio':
                    if (platformState.isAuthenticated && platformState.hasChannel) {
                        elements.studioView.classList.remove('hidden');
                    } else {
                        switchView('home');
                    }
                    break;
                case 'wallet':
                    if (platformState.isAuthenticated && platformState.hasChannel) {
                        elements.walletView.classList.remove('hidden');
                        loadWallet();
                    } else {
                        switchView('home');
                    }
                    break;
            }
            
            if (window.innerWidth <= 768) {
                elements.sidebar.classList.remove('active');
            }
        }

        // Reset Auth Forms
        function resetAuthForms() {
            elements.authForm.classList.remove('hidden');
            elements.signupForm.classList.add('hidden');
            document.getElementById('authTitle').textContent = 'Welcome Back!';
            elements.authEmail.value = '';
            elements.authPassword.value = '';
            elements.signupUsername.value = '';
            elements.signupEmail.value = '';
            elements.signupPassword.value = '';
            elements.signupConfirmPassword.value = '';
        }

        // Update Auth UI
        function updateAuthUI() {
            if (platformState.isAuthenticated) {
                if (platformState.userChannel?.avatar) {
                    elements.avatarImage.src = platformState.userChannel.avatar;
                    elements.avatarImage.style.display = 'block';
                    elements.avatarInitial.style.display = 'none';
                } else {
                    elements.avatarInitial.textContent = platformState.currentUser.displayName.charAt(0).toUpperCase();
                    elements.avatarInitial.style.display = 'block';
                    elements.avatarImage.style.display = 'none';
                }
                
                elements.loginItem.style.display = 'none';
                elements.logoutItem.style.display = 'flex';
                elements.uploadButton.style.display = platformState.hasChannel ? 'flex' : 'none';
            } else {
                elements.avatarInitial.textContent = '?';
                elements.avatarInitial.style.display = 'block';
                elements.avatarImage.style.display = 'none';
                elements.loginItem.style.display = 'flex';
                elements.logoutItem.style.display = 'none';
                elements.uploadButton.style.display = 'none';
            }
        }

        // Setup Uploadcare Listeners
        function setupUploadcareListeners() {
            const avatarUploader = document.querySelector('uc-upload-ctx-provider[ctx-name="avatar-uploader"]');
            if (avatarUploader) {
                avatarUploader.addEventListener('change', (e) => {
                    const file = e.detail?.data;
                    if (file) {
                        platformState.uploadcareFiles.set('avatar', file);
                        elements.avatarPreviewImg.src = file.cdnUrl;
                        elements.avatarPreviewImg.style.display = 'block';
                        elements.avatarInitial.style.display = 'none';
                    }
                });
            }
            
            const bannerUploader = document.querySelector('uc-upload-ctx-provider[ctx-name="banner-uploader"]');
            if (bannerUploader) {
                bannerUploader.addEventListener('change', (e) => {
                    const file = e.detail?.data;
                    if (file) {
                        platformState.uploadcareFiles.set('banner', file);
                        elements.bannerPreviewImg.src = file.cdnUrl;
                        elements.bannerPreviewImg.style.display = 'block';
                    }
                });
            }
        }

        // Next Step in Channel Creation
        function nextStep(step) {
            if (step === 2 && !elements.channelName.value.trim()) {
                showToast('Please enter a channel name', 'error');
                return;
            }
            
            document.querySelectorAll('.channel-step').forEach(el => el.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
        }

        // Show Subscriptions View
        function showSubscriptionsView() {
            const subscribedVideos = platformState.videos.filter(v => 
                platformState.subscriptions.has(v.creatorId)
            );
            
            elements.videosGrid.innerHTML = '';
            
            if (subscribedVideos.length === 0) {
                elements.videosGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px;"><i class="fas fa-users" style="font-size: 50px; color: var(--primary-color); margin-bottom: 20px;"></i><h3>No videos from your subscriptions</h3><p>Subscribe to channels to see their latest videos here</p></div>';
                return;
            }
            
            subscribedVideos.forEach(video => {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.onclick = () => showVideoDetail(video);
                
                card.innerHTML = `
                    <div class="video-thumbnail">
                        <img src="${video.thumbnailUrl}" alt="${video.title}">
                        <span class="video-duration">${video.duration}</span>
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">${video.title}</h3>
                        <p class="video-creator">
                            <i class="fas fa-check-circle"></i> ${video.creatorName}
                        </p>
                        <div class="video-stats">
                            <span>${formatNumber(video.views)} views</span>
                            <span></span>
                            <span>${formatDate(video.createdAt)}</span>
                        </div>
                    </div>
                `;
                
                elements.videosGrid.appendChild(card);
            });
            
            switchView('home');
        }

        // Show Shorts View
        function showShortsView() {
            elements.videosGrid.innerHTML = '';
            
            platformState.shorts.forEach(short => {
                const card = document.createElement('div');
                card.className = 'short-card';
                card.onclick = () => {
                    const video = platformState.videos.find(v => v.id === short.id);
                    if (video) showVideoDetail(video);
                };
                
                card.innerHTML = `
                    <img class="short-thumbnail" src="${short.thumbnailUrl}" alt="${short.title}">
                    <div class="short-badge">
                        <i class="fas fa-video"></i> Short
                    </div>
                    <div class="short-info">
                        <h4>${short.title}</h4>
                        <p>${short.creatorName}</p>
                        <p>${formatNumber(short.views)} views</p>
                    </div>
                `;
                
                elements.videosGrid.appendChild(card);
            });
            
            switchView('home');
        }

        // Show Trending View
        function showTrendingView() {
            const trendingVideos = [...platformState.videos].sort((a, b) => b.views - a.views).slice(0, 20);
            
            elements.videosGrid.innerHTML = '';
            
            trendingVideos.forEach(video => {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.onclick = () => showVideoDetail(video);
                
                card.innerHTML = `
                    <div class="video-thumbnail">
                        <img src="${video.thumbnailUrl}" alt="${video.title}">
                        <span class="video-duration">${video.duration}</span>
                        <span class="trending-badge" style="position: absolute; top: 8px; left: 8px; background: linear-gradient(135deg, var(--primary-color), var(--primary-neon)); color: white; padding: 4px 10px; border-radius: 20px; font-size: 12px;"><i class="fas fa-fire"></i> Trending</span>
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">${video.title}</h3>
                        <p class="video-creator">
                            <i class="fas fa-check-circle"></i> ${video.creatorName}
                        </p>
                        <div class="video-stats">
                            <span>${formatNumber(video.views)} views</span>
                            <span></span>
                            <span>${formatDate(video.createdAt)}</span>
                        </div>
                    </div>
                `;
                
                elements.videosGrid.appendChild(card);
            });
            
            switchView('home');
        }

        // Filter by Creator
        function filterByCreator(creatorId) {
            const creatorVideos = platformState.videos.filter(v => v.creatorId === creatorId);
            
            elements.videosGrid.innerHTML = '';
            
            if (creatorVideos.length === 0) {
                elements.videosGrid.innerHTML = '<p style="text-align: center; grid-column: 1/-1;">No videos from this creator yet</p>';
                return;
            }
            
            creatorVideos.forEach(video => {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.onclick = () => showVideoDetail(video);
                
                card.innerHTML = `
                    <div class="video-thumbnail">
                        <img src="${video.thumbnailUrl}" alt="${video.title}">
                        <span class="video-duration">${video.duration}</span>
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">${video.title}</h3>
                        <p class="video-creator">
                            <i class="fas fa-check-circle"></i> ${video.creatorName}
                        </p>
                        <div class="video-stats">
                            <span>${formatNumber(video.views)} views</span>
                            <span></span>
                            <span>${formatDate(video.createdAt)}</span>
                        </div>
                    </div>
                `;
                
                elements.videosGrid.appendChild(card);
            });
            
            switchView('home');
        }

        // Load Wallet
        async function loadWallet() {
            if (!platformState.isAuthenticated || !platformState.hasChannel) return;
            
            await loadUserWallet(platformState.currentUser.uid);
        }

        // Share Video
        function shareVideo(videoId) {
            const video = platformState.videos.find(v => v.id === videoId);
            if (navigator.share) {
                navigator.share({
                    title: video.title,
                    text: `Check out "${video.title}" on StreamFlix Pro!`,
                    url: window.location.href
                }).catch(() => {
                    navigator.clipboard.writeText(window.location.href);
                    showToast('Link copied to clipboard!', 'success');
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showToast('Link copied to clipboard!', 'success');
            }
        }

        // Save Video
        function saveVideo(videoId) {
            if (!platformState.isAuthenticated) {
                showToast('Please login to save videos', 'error');
                return;
            }
            showToast('Video saved to playlist', 'success');
        }

        // Report Video
        function reportVideo(videoId) {
            if (!platformState.isAuthenticated) {
                showToast('Please login to report', 'error');
                return;
            }
            showToast('Thank you for your report. We will review this video.', 'success');
        }

        // Like Comment
        function likeComment(commentId) {
            showToast('Comment liked!', 'success');
        }

        // Reply to Comment
        function replyToComment(commentId) {
            showToast('Reply feature coming soon', 'info');
        }

        // Delete Comment
        async function deleteComment(commentId) {
            if (!confirm('Delete this comment?')) return;
            
            showLoading(true);
            try {
                const Comment = Parse.Object.extend('Comment');
                const query = new Parse.Query(Comment);
                const comment = await query.get(commentId);
                await comment.destroy();
                
                showToast('Comment deleted', 'success');
                if (platformState.currentVideo) {
                    loadComments(platformState.currentVideo.id);
                }
            } catch (error) {
                console.error('Error deleting comment:', error);
                showToast('Error deleting comment', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Edit Video
        function editVideo(videoId) {
            showToast('Edit feature coming soon', 'info');
        }

        // View Video Stats
        function viewVideoStats(videoId) {
            showToast('Detailed stats coming soon', 'info');
        }

        // Delete Video
        async function deleteVideo(videoId) {
            if (!confirm('Are you sure you want to delete this video? This action cannot be undone.')) return;
            
            showLoading(true);
            try {
                const Video = Parse.Object.extend('Video');
                const query = new Parse.Query(Video);
                const video = await query.get(videoId);
                await video.destroy();
                
                // Delete from Firestore
                await db.collection('videos').doc(videoId).delete();
                
                showToast('Video deleted successfully', 'success');
                loadCreatorStudio();
                loadVideos();
                
            } catch (error) {
                console.error('Error deleting video:', error);
                showToast('Error deleting video', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Format Number
        function formatNumber(num) {
            if (!num && num !== 0) return '0';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        // Format Date
        function formatDate(dateString) {
            if (!dateString) return 'Recently';
            
            const date = new Date(dateString);
            const now = new Date();
            const diff = Math.floor((now - date) / 86400000);
            
            if (diff === 0) return 'Today';
            if (diff === 1) return 'Yesterday';
            if (diff < 7) return `${diff} days ago`;
            if (diff < 30) return `${Math.floor(diff / 7)} weeks ago`;
            if (diff < 365) return `${Math.floor(diff / 30)} months ago`;
            return `${Math.floor(diff / 365)} years ago`;
        }

        // Format Duration
        function formatDuration(seconds) {
            if (!seconds) return '0:00';
            const hours = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            if (hours > 0) {
                return `${hours}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Show Toast
        function showToast(message, type = 'info') {
            elements.toastMessage.textContent = message;
            elements.toast.className = `toast toast-${type} show`;
            
            const icon = elements.toastIcon;
            if (type === 'success') icon.className = 'fas fa-check-circle';
            else if (type === 'error') icon.className = 'fas fa-exclamation-circle';
            else icon.className = 'fas fa-info-circle';
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 4000);
        }

        // Global Functions
        window.toggleLike = toggleLike;
        window.toggleSubscribe = toggleSubscribe;
        window.addComment = addComment;
        window.shareVideo = shareVideo;
        window.saveVideo = saveVideo;
        window.reportVideo = reportVideo;
        window.likeComment = likeComment;
        window.replyToComment = replyToComment;
        window.deleteComment = deleteComment;
        window.editVideo = editVideo;
        window.viewVideoStats = viewVideoStats;
        window.deleteVideo = deleteVideo;
        window.switchView = switchView;
        window.nextStep = nextStep;
        window.createChannel = createChannel;
        window.selectThumbnailType = selectThumbnailType;
        window.markAllNotificationsRead = markAllNotificationsRead;
        window.filterByCategory = filterByCategory;
        window.uploadAnotherVideo = uploadAnotherVideo;
        window.withdrawEarnings = withdrawEarnings;
    </script>
</body>
</html>
